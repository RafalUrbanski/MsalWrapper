!function(I,g){"object"==typeof exports&&"object"==typeof module?module.exports=g():"function"==typeof define&&define.amd?define("MsalWrapper",[],g):"object"==typeof exports?exports.MsalWrapper=g():I.MsalWrapper=g()}(window,(function(){return function(I){var g={};function c(n){if(g[n])return g[n].exports;var e=g[n]={i:n,l:!1,exports:{}};return I[n].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=I,c.c=g,c.d=function(I,g,n){c.o(I,g)||Object.defineProperty(I,g,{enumerable:!0,get:n})},c.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},c.t=function(I,g){if(1&g&&(I=c(I)),8&g)return I;if(4&g&&"object"==typeof I&&I&&I.__esModule)return I;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:I}),2&g&&"string"!=typeof I)for(var e in I)c.d(n,e,function(g){return I[g]}.bind(null,e));return n},c.n=function(I){var g=I&&I.__esModule?function(){return I.default}:function(){return I};return c.d(g,"a",g),g},c.o=function(I,g){return Object.prototype.hasOwnProperty.call(I,g)},c.p="",c(c.s=0)}([function(module,exports,__webpack_require__){"use strict";eval('\r\nObject.defineProperty(exports, "__esModule", { value: true });\r\nvar Msal = __webpack_require__(1);\r\nvar TokenRequestType;\r\n(function (TokenRequestType) {\r\n    TokenRequestType[TokenRequestType["LoginToken"] = 0] = "LoginToken";\r\n    TokenRequestType[TokenRequestType["AccessToken"] = 1] = "AccessToken";\r\n})(TokenRequestType || (TokenRequestType = {}));\r\nvar MsalWrapper = /** @class */ (function () {\r\n    function MsalWrapper(configuration) {\r\n        var _this = this;\r\n        this._basicConfiguration = {\r\n            auth: {\r\n                clientId: null,\r\n                validateAuthority: true\r\n            },\r\n            cache: {\r\n                cacheLocation: "localStorage",\r\n                storeAuthStateInCookie: false\r\n            },\r\n            system: {\r\n                loadFrameTimeout: 30000\r\n            }\r\n        };\r\n        this._basicLoginRequest = {\r\n            scopes: ["openid", "User.Read"],\r\n            prompt: "login"\r\n        };\r\n        this.acquireAccessToken = function (request) {\r\n            return new Promise(function (resolve, reject) {\r\n                _this._resolve = resolve;\r\n                _this._reject = reject;\r\n                _this._requestType = TokenRequestType.AccessToken;\r\n                _this._acquireAccessTokenInternal(request);\r\n            });\r\n        };\r\n        this.acquireLoginToken = function (request) {\r\n            return new Promise(function (resolve, reject) {\r\n                _this._resolve = resolve;\r\n                _this._reject = reject;\r\n                _this._requestType = TokenRequestType.LoginToken;\r\n                var mergedLoginRequest = Object.assign(_this._basicLoginRequest, request);\r\n                _this._userAgentApplication\r\n                    .loginPopup(mergedLoginRequest)\r\n                    .then(function (loginResponse) {\r\n                    _this._resolve(loginResponse);\r\n                })\r\n                    .catch(function (error) {\r\n                    _this._reject(error);\r\n                });\r\n            });\r\n        };\r\n        this._authRedirectCallBack = function (error, response) {\r\n            console.log("Authorization redirect fired");\r\n            if (error) {\r\n                console.log(error);\r\n            }\r\n            else {\r\n                if (response.tokenType === "id_token") {\r\n                    if (_this._requestType === TokenRequestType.AccessToken)\r\n                        _this._acquireAccessTokenInternal({ scopes: response.scopes });\r\n                    else\r\n                        _this._resolve(response);\r\n                }\r\n                else if (response.tokenType === "access_token") {\r\n                    _this._resolve(response);\r\n                }\r\n                else {\r\n                    console.log("token type is:" + response.tokenType);\r\n                }\r\n            }\r\n        };\r\n        this._requiresInteraction = function (errorMessage) {\r\n            if (!errorMessage || !errorMessage.length) {\r\n                return false;\r\n            }\r\n            console.log(errorMessage);\r\n            return (errorMessage.indexOf("consent_required") !== -1 ||\r\n                errorMessage.indexOf("interaction_required") !== -1 ||\r\n                errorMessage.indexOf("login_required") !== -1);\r\n        };\r\n        this._acquireAccessTokenInternal = function (request) {\r\n            _this._userAgentApplication\r\n                .loginPopup(_this._basicLoginRequest)\r\n                .then(function () {\r\n                _this._userAgentApplication\r\n                    .acquireTokenSilent(request)\r\n                    .then(function (tokenResponse) {\r\n                    _this._resolve(tokenResponse);\r\n                })\r\n                    .catch(function (error) {\r\n                    if (_this._requiresInteraction(error.errorCode)) {\r\n                        _this._userAgentApplication\r\n                            .acquireTokenPopup(request)\r\n                            .then(function (tokenResponse) {\r\n                            _this._resolve(tokenResponse);\r\n                        })\r\n                            .catch(function (error) {\r\n                            _this._reject(error);\r\n                        });\r\n                    }\r\n                    else\r\n                        _this._reject(error);\r\n                });\r\n            })\r\n                .catch(function (error) {\r\n                _this._reject(error);\r\n            });\r\n        };\r\n        if (!configuration.auth.clientId)\r\n            throw "ClientId has to be set";\r\n        var mergedConfiguration = Object.assign(this._basicConfiguration, configuration);\r\n        this._userAgentApplication = new Msal.UserAgentApplication(mergedConfiguration);\r\n        this._userAgentApplication.handleRedirectCallback(this._authRedirectCallBack);\r\n    }\r\n    ;\r\n    return MsalWrapper;\r\n}());\r\nexports.default = MsalWrapper;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL3NyYy9Nc2FsV3JhcHBlci50cz84NGRmIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsa0NBQTZCO0FBRTdCLElBQUssZ0JBR0o7QUFIRCxXQUFLLGdCQUFnQjtJQUNqQixtRUFBVTtJQUNWLHFFQUFXO0FBQ2YsQ0FBQyxFQUhJLGdCQUFnQixLQUFoQixnQkFBZ0IsUUFHcEI7QUFFRDtJQXdCSSxxQkFBWSxhQUFpQztRQUE3QyxpQkFPQztRQXpCTyx3QkFBbUIsR0FBdUI7WUFDOUMsSUFBSSxFQUFFO2dCQUNGLFFBQVEsRUFBRSxJQUFJO2dCQUNkLGlCQUFpQixFQUFFLElBQUk7YUFDMUI7WUFDRCxLQUFLLEVBQUU7Z0JBQ0gsYUFBYSxFQUFFLGNBQWM7Z0JBQzdCLHNCQUFzQixFQUFFLEtBQUs7YUFDaEM7WUFDRCxNQUFNLEVBQUU7Z0JBQ0osZ0JBQWdCLEVBQUUsS0FBSzthQUMxQjtTQUNKLENBQUM7UUFDTSx1QkFBa0IsR0FBa0M7WUFDeEQsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQztZQUMvQixNQUFNLEVBQUUsT0FBTztTQUNsQjtRQVdELHVCQUFrQixHQUFHLFVBQUMsT0FBc0M7WUFDeEQsT0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFDLE9BQU8sRUFBRSxNQUFNO2dCQUMvQixLQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztnQkFDeEIsS0FBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7Z0JBRXRCLEtBQUksQ0FBQyxZQUFZLEdBQUcsZ0JBQWdCLENBQUMsV0FBVyxDQUFDO2dCQUNqRCxLQUFJLENBQUMsMkJBQTJCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDOUMsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUM7UUFFRixzQkFBaUIsR0FBRyxVQUFDLE9BQXVDO1lBQ3hELE9BQU8sSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtnQkFDL0IsS0FBSSxD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QUFDO3dCQUNqQyxDQUFDLENBQUM7NkJBQ0QsS0FBSyxDQUFDLFVBQUMsS0FBSzs0QkFDVCxLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUN4QixDQUFDLENBQUMsQ0FBQztxQkFDVjs7d0JBRUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDNUIsQ0FBQyxDQUFDLENBQUM7WUFDWCxDQUFDLENBQUM7aUJBQ0QsS0FBSyxDQUFDLFVBQUMsS0FBSztnQkFDVCxLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBRVgsQ0FBQyxDQUFDO1FBOUZFLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVE7WUFDNUIsTUFBTSx3QkFBd0IsQ0FBQztRQUVuQyxJQUFNLG1CQUFtQixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQ25GLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ2hGLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxzQkFBc0IsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBQUEsQ0FBQztJQXlGTixrQkFBQztBQUFELENBQUM7QUFHRCxrQkFBZSxXQUFXLENBQUMiLCJmaWxlIjoiMC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIE1zYWwgZnJvbSBcIm1zYWxcIjtcclxuXHJcbmVudW0gVG9rZW5SZXF1ZXN0VHlwZSB7XHJcbiAgICBMb2dpblRva2VuLFxyXG4gICAgQWNjZXNzVG9rZW5cclxufVxyXG5cclxuY2xhc3MgTXNhbFdyYXBwZXIge1xyXG4gICAgcHJpdmF0ZSBfdXNlckFnZW50QXBwbGljYXRpb246IE1zYWwuVXNlckFnZW50QXBwbGljYXRpb247XHJcbiAgICBwcml2YXRlIF9yZXNvbHZlOiAodmFsdWU/OiBNc2FsLkF1dGhSZXNwb25zZSkgPT4gdm9pZDtcclxuICAgIHByaXZhdGUgX3JlamVjdDogKHZhbHVlPzogYW55KSA9PiB2b2lkO1xyXG4gICAgcHJpdmF0ZSBfcmVxdWVzdFR5cGU6IFRva2VuUmVxdWVzdFR5cGU7XHJcblxyXG4gICAgcHJpdmF0ZSBfYmFzaWNDb25maWd1cmF0aW9uOiBNc2FsLkNvbmZpZ3VyYXRpb24gPSB7XHJcbiAgICAgICAgYXV0aDoge1xyXG4gICAgICAgICAgICBjbGllbnRJZDogbnVsbCxcclxuICAgICAgICAgICAgdmFsaWRhdGVBdXRob3JpdHk6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGNhY2hlOiB7XHJcbiAgICAgICAgICAgIGNhY2hlTG9jYXRpb246IFwibG9jYWxTdG9yYWdlXCIsXHJcbiAgICAgICAgICAgIHN0b3JlQXV0aFN0YXRlSW5Db29raWU6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzeXN0ZW06IHtcclxuICAgICAgICAgICAgbG9hZEZyYW1lVGltZW91dDogMzAwMDBcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcHJpdmF0ZSBfYmFzaWNMb2dpblJlcXVlc3Q6IE1zYWwuQXV0aGVudGljYXRpb25QYXJhbWV0ZXJzID0ge1xyXG4gICAgICAgIHNjb3BlczogW1wib3BlbmlkXCIsIFwiVXNlci5SZWFkXCJdLFxyXG4gICAgICAgIHByb21wdDogXCJsb2dpblwiXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoY29uZmlndXJhdGlvbjogTXNhbC5Db25maWd1cmF0aW9uKSB7XHJcbiAgICAgICAgaWYgKCFjb25maWd1cmF0aW9uLmF1dGguY2xpZW50SWQpXHJcbiAgICAgICAgICAgIHRocm93IFwiQ2xpZW50SWQgaGFzIHRvIGJlIHNldFwiO1xyXG5cclxuICAgICAgICBjb25zdCBtZXJnZWRDb25maWd1cmF0aW9uID0gT2JqZWN0LmFzc2lnbih0aGlzLl9iYXNpY0NvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb24pO1xyXG4gICAgICAgIHRoaXMuX3VzZXJBZ2VudEFwcGxpY2F0aW9uID0gbmV3IE1zYWwuVXNlckFnZW50QXBwbGljYXRpb24obWVyZ2VkQ29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgdGhpcy5fdXNlckFnZW50QXBwbGljYXRpb24uaGFuZGxlUmVkaXJlY3RDYWxsYmFjayh0aGlzLl9hdXRoUmVkaXJlY3RDYWxsQmFjayk7XHJcbiAgICB9O1xyXG5cclxuICAgIGFjcXVpcmVBY2Nlc3NUb2tlbiA9IChyZXF1ZXN0OiBNc2FsLkF1dGhlbnRpY2F0aW9uUGFyYW1ldGVycyk6IFByb21pc2U8TXNhbC5BdXRoUmVzcG9uc2U+ID0+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlID0gcmVzb2x2ZTtcclxuICAgICAgICAgICAgdGhpcy5fcmVqZWN0ID0gcmVqZWN0O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5fcmVxdWVzdFR5cGUgPSBUb2tlblJlcXVlc3RUeXBlLkFjY2Vzc1Rva2VuO1xyXG4gICAgICAgICAgICB0aGlzLl9hY3F1aXJlQWNjZXNzVG9rZW5JbnRlcm5hbChyZXF1ZXN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgYWNxdWlyZUxvZ2luVG9rZW4gPSAocmVxdWVzdD86IE1zYWwuQXV0aGVudGljYXRpb25QYXJhbWV0ZXJzKTogUHJvbWlzZTxNc2FsLkF1dGhSZXNwb25zZT4gPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Jlc29sdmUgPSByZXNvbHZlO1xyXG4gICAgICAgICAgICB0aGlzLl9yZWplY3QgPSByZWplY3Q7XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9yZXF1ZXN0VHlwZSA9IFRva2VuUmVxdWVzdFR5cGUuTG9naW5Ub2tlbjtcclxuICAgICAgICAgICAgY29uc3QgbWVyZ2VkTG9naW5SZXF1ZXN0ID0gT2JqZWN0LmFzc2lnbih0aGlzLl9iYXNpY0xvZ2luUmVxdWVzdCwgcmVxdWVzdCk7XHJcbiAgICAgICAgICAgIHRoaXMuX3VzZXJBZ2VudEFwcGxpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAubG9naW5Qb3B1cChtZXJnZWRMb2dpblJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAudGhlbigobG9naW5SZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc29sdmUobG9naW5SZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBfYXV0aFJlZGlyZWN0Q2FsbEJhY2sgPSAoZXJyb3I6IE1zYWwuQXV0aEVycm9yLCByZXNwb25zZT86IE1zYWwuQXV0aFJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJBdXRob3JpemF0aW9uIHJlZGlyZWN0IGZpcmVkXCIpO1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnRva2VuVHlwZSA9PT0gXCJpZF90b2tlblwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVxdWVzdFR5cGUgPT09IFRva2VuUmVxdWVzdFR5cGUuQWNjZXNzVG9rZW4pXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWNxdWlyZUFjY2Vzc1Rva2VuSW50ZXJuYWwoeyBzY29wZXM6IHJlc3BvbnNlLnNjb3BlcyB9KTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS50b2tlblR5cGUgPT09IFwiYWNjZXNzX3Rva2VuXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Jlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0b2tlbiB0eXBlIGlzOlwiICsgcmVzcG9uc2UudG9rZW5UeXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBfcmVxdWlyZXNJbnRlcmFjdGlvbiA9IChlcnJvck1lc3NhZ2UpID0+IHtcclxuICAgICAgICBpZiAoIWVycm9yTWVzc2FnZSB8fCAhZXJyb3JNZXNzYWdlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlLmluZGV4T2YoXCJjb25zZW50X3JlcXVpcmVkXCIpICE9PSAtMSB8fFxyXG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UuaW5kZXhPZihcImludGVyYWN0aW9uX3JlcXVpcmVkXCIpICE9PSAtMSB8fFxyXG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UuaW5kZXhPZihcImxvZ2luX3JlcXVpcmVkXCIpICE9PSAtMVxyXG4gICAgICAgICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHByaXZhdGUgX2FjcXVpcmVBY2Nlc3NUb2tlbkludGVybmFsID0gKHJlcXVlc3Q6IE1zYWwuQXV0aGVudGljYXRpb25QYXJhbWV0ZXJzKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fdXNlckFnZW50QXBwbGljYXRpb25cclxuICAgICAgICAgICAgLmxvZ2luUG9wdXAodGhpcy5fYmFzaWNMb2dpblJlcXVlc3QpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3VzZXJBZ2VudEFwcGxpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgLmFjcXVpcmVUb2tlblNpbGVudChyZXF1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKCh0b2tlblJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc29sdmUodG9rZW5SZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZXF1aXJlc0ludGVyYWN0aW9uKGVycm9yLmVycm9yQ29kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3VzZXJBZ2VudEFwcGxpY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFjcXVpcmVUb2tlblBvcHVwKHJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHRva2VuUmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZSh0b2tlblJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICB9O1xyXG59XHJcblxyXG5leHBvcnQgeyBDb25maWd1cmF0aW9uLCBBdXRoZW50aWNhdGlvblBhcmFtZXRlcnMgfSBmcm9tIFwibXNhbFwiO1xyXG5leHBvcnQgZGVmYXVsdCBNc2FsV3JhcHBlcjsiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./node_modules/tslib/tslib.es6.js\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the "License"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === "function")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nfunction __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nfunction __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError("Generator is already executing.");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nfunction __values(o) {\r\n    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nfunction __read(o, n) {\r\n    var m = typeof Symbol === "function" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i["return"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nfunction __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nfunction __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nfunction __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume("next", value); }\r\n    function reject(value) { resume("throw", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nfunction __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nfunction __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nfunction __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nfunction __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nfunction __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/utils/CryptoUtils.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n */\r\nvar CryptoUtils = /** @class */ (function () {\r\n    function CryptoUtils() {\r\n    }\r\n    /**\r\n     * Creates a new random GUID - used to populate state?\r\n     * @returns string (GUID)\r\n     */\r\n    CryptoUtils.createNewGuid = function () {\r\n        // RFC4122: The version 4 UUID is meant for generating UUIDs from truly-random or\r\n        // pseudo-random numbers.\r\n        // The algorithm is as follows:\r\n        //     Set the two most significant bits (bits 6 and 7) of the\r\n        //        clock_seq_hi_and_reserved to zero and one, respectively.\r\n        //     Set the four most significant bits (bits 12 through 15) of the\r\n        //        time_hi_and_version field to the 4-bit version number from\r\n        //        Section 4.1.3. Version4\r\n        //     Set all the other bits to randomly (or pseudo-randomly) chosen\r\n        //     values.\r\n        // UUID                   = time-low "-" time-mid "-"time-high-and-version "-"clock-seq-reserved and low(2hexOctet)"-" node\r\n        // time-low               = 4hexOctet\r\n        // time-mid               = 2hexOctet\r\n        // time-high-and-version  = 2hexOctet\r\n        // clock-seq-and-reserved = hexOctet:\r\n        // clock-seq-low          = hexOctet\r\n        // node                   = 6hexOctet\r\n        // Format: xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\r\n        // y could be 1000, 1001, 1010, 1011 since most significant two bits needs to be 10\r\n        // y values are 8, 9, A, B\r\n        var cryptoObj = window.crypto; // for IE 11\r\n        if (cryptoObj && cryptoObj.getRandomValues) {\r\n            var buffer = new Uint8Array(16);\r\n            cryptoObj.getRandomValues(buffer);\r\n            //buffer[6] and buffer[7] represents the time_hi_and_version field. We will set the four most significant bits (4 through 7) of buffer[6] to represent decimal number 4 (UUID version number).\r\n            buffer[6] |= 0x40; //buffer[6] | 01000000 will set the 6 bit to 1.\r\n            buffer[6] &= 0x4f; //buffer[6] & 01001111 will set the 4, 5, and 7 bit to 0 such that bits 4-7 == 0100 = "4".\r\n            //buffer[8] represents the clock_seq_hi_and_reserved field. We will set the two most significant bits (6 and 7) of the clock_seq_hi_and_reserved to zero and one, respectively.\r\n            buffer[8] |= 0x80; //buffer[8] | 10000000 will set the 7 bit to 1.\r\n            buffer[8] &= 0xbf; //buffer[8] & 10111111 will set the 6 bit to 0.\r\n            return CryptoUtils.decimalToHex(buffer[0]) + CryptoUtils.decimalToHex(buffer[1])\r\n                + CryptoUtils.decimalToHex(buffer[2]) + CryptoUtils.decimalToHex(buffer[3])\r\n                + "-" + CryptoUtils.decimalToHex(buffer[4]) + CryptoUtils.decimalToHex(buffer[5])\r\n                + "-" + CryptoUtils.decimalToHex(buffer[6]) + CryptoUtils.decimalToHex(buffer[7])\r\n                + "-" + CryptoUtils.decimalToHex(buffer[8]) + CryptoUtils.decimalToHex(buffer[9])\r\n                + "-" + CryptoUtils.decimalToHex(buffer[10]) + CryptoUtils.decimalToHex(buffer[11])\r\n                + CryptoUtils.decimalToHex(buffer[12]) + CryptoUtils.decimalToHex(buffer[13])\r\n                + CryptoUtils.decimalToHex(buffer[14]) + CryptoUtils.decimalToHex(buffer[15]);\r\n        }\r\n        else {\r\n            var guidHolder = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";\r\n            var hex = "0123456789abcdef";\r\n            var r = 0;\r\n            var guidResponse = "";\r\n            for (var i = 0; i < 36; i++) {\r\n                if (guidHolder[i] !== "-" && guidHolder[i] !== "4") {\r\n                    // each x and y needs to be random\r\n                    r = Math.random() * 16 | 0;\r\n                }\r\n                if (guidHolder[i] === "x") {\r\n                    guidResponse += hex[r];\r\n                }\r\n                else if (guidHolder[i] === "y") {\r\n                    // clock-seq-and-reserved first hex is filtered and remaining hex values are random\r\n                    r &= 0x3; // bit and with 0011 to set pos 2 to zero ?0??\r\n                    r |= 0x8; // set pos 3 to 1 as 1???\r\n                    guidResponse += hex[r];\r\n                }\r\n                else {\r\n                    guidResponse += guidHolder[i];\r\n                }\r\n            }\r\n            return guidResponse;\r\n        }\r\n    };\r\n    /**\r\n     * Decimal to Hex\r\n     *\r\n     * @param num\r\n     */\r\n    CryptoUtils.decimalToHex = function (num) {\r\n        var hex = num.toString(16);\r\n        while (hex.length < 2) {\r\n            hex = "0" + hex;\r\n        }\r\n        return hex;\r\n    };\r\n    // See: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#Solution_4_%E2%80%93_escaping_the_string_before_encoding_it\r\n    /**\r\n     * encoding string to base64 - platform specific check\r\n     *\r\n     * @param input\r\n     */\r\n    CryptoUtils.base64Encode = function (input) {\r\n        return btoa(encodeURIComponent(input).replace(/%([0-9A-F]{2})/g, function toSolidBytes(match, p1) {\r\n            return String.fromCharCode(Number("0x" + p1));\r\n        }));\r\n    };\r\n    /**\r\n     * decoding base64 token - platform specific check\r\n     *\r\n     * @param base64IdToken\r\n     */\r\n    CryptoUtils.base64Decode = function (input) {\r\n        return decodeURIComponent(atob(input).split("").map(function (c) {\r\n            return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);\r\n        }).join(""));\r\n    };\r\n    /**\r\n     * deserialize a string\r\n     *\r\n     * @param query\r\n     */\r\n    CryptoUtils.deserialize = function (query) {\r\n        var match; // Regex for replacing addition symbol with a space\r\n        var pl = /\\+/g;\r\n        var search = /([^&=]+)=([^&]*)/g;\r\n        var decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); };\r\n        var obj = {};\r\n        match = search.exec(query);\r\n        while (match) {\r\n            obj[decode(match[1])] = decode(match[2]);\r\n            match = search.exec(query);\r\n        }\r\n        return obj;\r\n    };\r\n    return CryptoUtils;\r\n}());\r\n\r\n//# sourceMappingURL=CryptoUtils.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/utils/Constants.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n * Constants\r\n */\r\nvar Constants = /** @class */ (function () {\r\n    function Constants() {\r\n    }\r\n    Object.defineProperty(Constants, "errorDescription", {\r\n        get: function () { return "error_description"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "error", {\r\n        get: function () { return "error"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "scope", {\r\n        get: function () { return "scope"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "clientInfo", {\r\n        get: function () { return "client_info"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "clientId", {\r\n        get: function () { return "clientId"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "idToken", {\r\n        get: function () { return "id_token"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "adalIdToken", {\r\n        get: function () { return "adal.idtoken"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "accessToken", {\r\n        get: function () { return "access_token"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "expiresIn", {\r\n        get: function () { return "expires_in"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "sessionState", {\r\n        get: function () { return "session_state"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "claims", {\r\n        get: function () { return "claims"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "msalClientInfo", {\r\n        get: function () { return "msal.client.info"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "msalError", {\r\n        get: function () { return "msal.error"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "msalErrorDescription", {\r\n        get: function () { return "msal.error.description"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "msalSessionState", {\r\n        get: function () { return "msal.session.state"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "tokenKeys", {\r\n        get: function () { return "msal.token.keys"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "accessTokenKey", {\r\n        get: function () { return "msal.access.token.key"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "expirationKey", {\r\n        get: function () { return "msal.expiration.key"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "stateLogin", {\r\n        get: function () { return "msal.state.login"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "stateAcquireToken", {\r\n        get: function () { return "msal.state.acquireToken"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "stateRenew", {\r\n        get: function () { return "msal.state.renew"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "nonceIdToken", {\r\n        get: function () { return "msal.nonce.idtoken"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "userName", {\r\n        get: function () { return "msal.username"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "idTokenKey", {\r\n        get: function () { return "msal.idtoken"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "loginRequest", {\r\n        get: function () { return "msal.login.request"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "loginError", {\r\n        get: function () { return "msal.login.error"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "renewStatus", {\r\n        get: function () { return "msal.token.renew.status"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "urlHash", {\r\n        get: function () { return "msal.urlHash"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "angularLoginRequest", {\r\n        get: function () { return "msal.angular.login.request"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "msal", {\r\n        get: function () { return "msal"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "no_account", {\r\n        get: function () { return "NO_ACCOUNT"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "consumersUtid", {\r\n        get: function () { return "9188040d-6c67-4c5b-b112-36a304b66dad"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "upn", {\r\n        get: function () { return "upn"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "prompt_select_account", {\r\n        get: function () { return "&prompt=select_account"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "prompt_none", {\r\n        get: function () { return "&prompt=none"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "prompt", {\r\n        get: function () { return "prompt"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "response_mode_fragment", {\r\n        get: function () { return "&response_mode=fragment"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "resourceDelimiter", {\r\n        get: function () { return "|"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "tokenRenewStatusCancelled", {\r\n        get: function () { return "Canceled"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "tokenRenewStatusCompleted", {\r\n        get: function () { return "Completed"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "tokenRenewStatusInProgress", {\r\n        get: function () { return "In Progress"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "popUpWidth", {\r\n        get: function () { return this._popUpWidth; },\r\n        set: function (width) {\r\n            this._popUpWidth = width;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "popUpHeight", {\r\n        get: function () { return this._popUpHeight; },\r\n        set: function (height) {\r\n            this._popUpHeight = height;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "login", {\r\n        get: function () { return "LOGIN"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "renewToken", {\r\n        get: function () { return "RENEW_TOKEN"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "unknown", {\r\n        get: function () { return "UNKNOWN"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "homeAccountIdentifier", {\r\n        get: function () { return "homeAccountIdentifier"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "common", {\r\n        get: function () { return "common"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "openidScope", {\r\n        get: function () { return "openid"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "profileScope", {\r\n        get: function () { return "profile"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "cacheLocationLocal", {\r\n        get: function () { return "localStorage"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "cacheLocationSession", {\r\n        get: function () { return "sessionStorage"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "interactionTypeRedirect", {\r\n        get: function () { return "redirectInteraction"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Constants, "interactionTypePopup", {\r\n        get: function () { return "popupInteraction"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Constants._popUpWidth = 483;\r\n    Constants._popUpHeight = 600;\r\n    return Constants;\r\n}());\r\n\r\n/**\r\n * @hidden\r\n * CacheKeys for \'authority\' and \'account\'\r\n */\r\nvar CacheKeys = {\r\n    AUTHORITY: "msal.authority",\r\n    ACQUIRE_TOKEN_ACCOUNT: "msal.acquireTokenAccount"\r\n};\r\nvar AADTrustedHostList = {\r\n    "login.windows.net": "login.windows.net",\r\n    "login.chinacloudapi.cn": "login.chinacloudapi.cn",\r\n    "login.cloudgovapi.us": "login.cloudgovapi.us",\r\n    "login.microsoftonline.com": "login.microsoftonline.com",\r\n    "login.microsoftonline.de": "login.microsoftonline.de",\r\n    "login.microsoftonline.us": "login.microsoftonline.us"\r\n};\r\n/**\r\n * @hidden\r\n * SSO Types - generated to populate hints\r\n */\r\nvar SSOTypes = {\r\n    ACCOUNT: "account",\r\n    SID: "sid",\r\n    LOGIN_HINT: "login_hint",\r\n    ID_TOKEN: "id_token",\r\n    DOMAIN_HINT: "domain_hint",\r\n    ORGANIZATIONS: "organizations",\r\n    CONSUMERS: "consumers",\r\n    ACCOUNT_ID: "accountIdentifier",\r\n    HOMEACCOUNT_ID: "homeAccountIdentifier",\r\n    LOGIN_REQ: "login_req",\r\n    DOMAIN_REQ: "domain_req"\r\n};\r\n/**\r\n * @hidden\r\n */\r\nvar BlacklistedEQParams = [\r\n    SSOTypes.SID,\r\n    SSOTypes.LOGIN_HINT\r\n];\r\n/**\r\n * we considered making this "enum" in the request instead of string, however it looks like the allowed list of\r\n * prompt values kept changing over past couple of years. There are some undocumented prompt values for some\r\n * internal partners too, hence the choice of generic "string" type instead of the "enum"\r\n * @hidden\r\n */\r\nvar PromptState = {\r\n    LOGIN: "login",\r\n    SELECT_ACCOUNT: "select_account",\r\n    CONSENT: "consent",\r\n    NONE: "none",\r\n};\r\n/**\r\n * MSAL JS Library Version\r\n */\r\nfunction libraryVersion() {\r\n    return "1.1.3";\r\n}\r\n//# sourceMappingURL=Constants.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/ScopeSet.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\nvar ScopeSet = /** @class */ (function () {\r\n    function ScopeSet() {\r\n    }\r\n    /**\r\n   * Check if there are dup scopes in a given request\r\n   *\r\n   * @param cachedScopes\r\n   * @param scopes\r\n   */\r\n    // TODO: Rename this, intersecting scopes isn\'t a great name for duplicate checker\r\n    ScopeSet.isIntersectingScopes = function (cachedScopes, scopes) {\r\n        cachedScopes = this.convertToLowerCase(cachedScopes);\r\n        for (var i = 0; i < scopes.length; i++) {\r\n            if (cachedScopes.indexOf(scopes[i].toLowerCase()) > -1) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    /**\r\n     * Check if a given scope is present in the request\r\n     *\r\n     * @param cachedScopes\r\n     * @param scopes\r\n     */\r\n    ScopeSet.containsScope = function (cachedScopes, scopes) {\r\n        cachedScopes = this.convertToLowerCase(cachedScopes);\r\n        return scopes.every(function (value) { return cachedScopes.indexOf(value.toString().toLowerCase()) >= 0; });\r\n    };\r\n    /**\r\n     * toLower\r\n     *\r\n     * @param scopes\r\n     */\r\n    // TODO: Rename this, too generic name for a function that only deals with scopes\r\n    ScopeSet.convertToLowerCase = function (scopes) {\r\n        return scopes.map(function (scope) { return scope.toLowerCase(); });\r\n    };\r\n    /**\r\n     * remove one element from a scope array\r\n     *\r\n     * @param scopes\r\n     * @param scope\r\n     */\r\n    // TODO: Rename this, too generic name for a function that only deals with scopes\r\n    ScopeSet.removeElement = function (scopes, scope) {\r\n        return scopes.filter(function (value) { return value !== scope; });\r\n    };\r\n    /**\r\n     * Parse the scopes into a formatted scopeList\r\n     * @param scopes\r\n     */\r\n    ScopeSet.parseScope = function (scopes) {\r\n        var scopeList = "";\r\n        if (scopes) {\r\n            for (var i = 0; i < scopes.length; ++i) {\r\n                scopeList += (i !== scopes.length - 1) ? scopes[i] + " " : scopes[i];\r\n            }\r\n        }\r\n        return scopeList;\r\n    };\r\n    return ScopeSet;\r\n}());\r\n\r\n//# sourceMappingURL=ScopeSet.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/utils/StringUtils.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n */\r\nvar StringUtils = /** @class */ (function () {\r\n    function StringUtils() {\r\n    }\r\n    /**\r\n     * Check if a string is empty\r\n     *\r\n     * @param str\r\n     */\r\n    StringUtils.isEmpty = function (str) {\r\n        return (typeof str === "undefined" || !str || 0 === str.length);\r\n    };\r\n    return StringUtils;\r\n}());\r\n\r\n//# sourceMappingURL=StringUtils.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/utils/UrlUtils.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar UrlUtils_UrlUtils = /** @class */ (function () {\r\n    function UrlUtils() {\r\n    }\r\n    /**\r\n     * generates the URL with QueryString Parameters\r\n     * @param scopes\r\n     */\r\n    UrlUtils.createNavigateUrl = function (serverRequestParams) {\r\n        var str = this.createNavigationUrlString(serverRequestParams);\r\n        var authEndpoint = serverRequestParams.authorityInstance.AuthorizationEndpoint;\r\n        // if the endpoint already has queryparams, lets add to it, otherwise add the first one\r\n        if (authEndpoint.indexOf("?") < 0) {\r\n            authEndpoint += "?";\r\n        }\r\n        else {\r\n            authEndpoint += "&";\r\n        }\r\n        var requestUrl = "" + authEndpoint + str.join("&");\r\n        return requestUrl;\r\n    };\r\n    /**\r\n     * Generate the array of all QueryStringParams to be sent to the server\r\n     * @param scopes\r\n     */\r\n    UrlUtils.createNavigationUrlString = function (serverRequestParams) {\r\n        var scopes = serverRequestParams.scopes;\r\n        if (scopes.indexOf(serverRequestParams.clientId) === -1) {\r\n            scopes.push(serverRequestParams.clientId);\r\n        }\r\n        var str = [];\r\n        str.push("response_type=" + serverRequestParams.responseType);\r\n        this.translateclientIdUsedInScope(scopes, serverRequestParams.clientId);\r\n        str.push("scope=" + encodeURIComponent(ScopeSet.parseScope(scopes)));\r\n        str.push("client_id=" + encodeURIComponent(serverRequestParams.clientId));\r\n        str.push("redirect_uri=" + encodeURIComponent(serverRequestParams.redirectUri));\r\n        str.push("state=" + encodeURIComponent(serverRequestParams.state));\r\n        str.push("nonce=" + encodeURIComponent(serverRequestParams.nonce));\r\n        str.push("client_info=1");\r\n        str.push("x-client-SKU=" + serverRequestParams.xClientSku);\r\n        str.push("x-client-Ver=" + serverRequestParams.xClientVer);\r\n        if (serverRequestParams.promptValue) {\r\n            str.push("prompt=" + encodeURIComponent(serverRequestParams.promptValue));\r\n        }\r\n        if (serverRequestParams.claimsValue) {\r\n            str.push("claims=" + encodeURIComponent(serverRequestParams.claimsValue));\r\n        }\r\n        if (serverRequestParams.queryParameters) {\r\n            str.push(serverRequestParams.queryParameters);\r\n        }\r\n        if (serverRequestParams.extraQueryParameters) {\r\n            str.push(serverRequestParams.extraQueryParameters);\r\n        }\r\n        str.push("client-request-id=" + encodeURIComponent(serverRequestParams.correlationId));\r\n        return str;\r\n    };\r\n    /**\r\n     * append the required scopes: https://openid.net/specs/openid-connect-basic-1_0.html#Scopes\r\n     * @param scopes\r\n     */\r\n    UrlUtils.translateclientIdUsedInScope = function (scopes, clientId) {\r\n        var clientIdIndex = scopes.indexOf(clientId);\r\n        if (clientIdIndex >= 0) {\r\n            scopes.splice(clientIdIndex, 1);\r\n            if (scopes.indexOf("openid") === -1) {\r\n                scopes.push("openid");\r\n            }\r\n            if (scopes.indexOf("profile") === -1) {\r\n                scopes.push("profile");\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Returns current window URL as redirect uri\r\n     */\r\n    UrlUtils.getDefaultRedirectUri = function () {\r\n        return window.location.href.split("?")[0].split("#")[0];\r\n    };\r\n    /**\r\n     * Given a url like https://a:b/common/d?e=f#g, and a tenantId, returns https://a:b/tenantId/d\r\n     * @param href The url\r\n     * @param tenantId The tenant id to replace\r\n     */\r\n    UrlUtils.replaceTenantPath = function (url, tenantId) {\r\n        url = url.toLowerCase();\r\n        var urlObject = this.GetUrlComponents(url);\r\n        var pathArray = urlObject.PathSegments;\r\n        if (tenantId && (pathArray.length !== 0 && (pathArray[0] === Constants.common || pathArray[0] === SSOTypes.ORGANIZATIONS))) {\r\n            pathArray[0] = tenantId;\r\n        }\r\n        return this.constructAuthorityUriFromObject(urlObject, pathArray);\r\n    };\r\n    UrlUtils.constructAuthorityUriFromObject = function (urlObject, pathArray) {\r\n        return this.CanonicalizeUri(urlObject.Protocol + "//" + urlObject.HostNameAndPort + "/" + pathArray.join("/"));\r\n    };\r\n    /**\r\n     * Parses out the components from a url string.\r\n     * @returns An object with the various components. Please cache this value insted of calling this multiple times on the same url.\r\n     */\r\n    UrlUtils.GetUrlComponents = function (url) {\r\n        if (!url) {\r\n            throw "Url required";\r\n        }\r\n        // https://gist.github.com/curtisz/11139b2cfcaef4a261e0\r\n        var regEx = RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\\\?([^#]*))?(#(.*))?");\r\n        var match = url.match(regEx);\r\n        if (!match || match.length < 6) {\r\n            throw "Valid url required";\r\n        }\r\n        var urlComponents = {\r\n            Protocol: match[1],\r\n            HostNameAndPort: match[4],\r\n            AbsolutePath: match[5]\r\n        };\r\n        var pathSegments = urlComponents.AbsolutePath.split("/");\r\n        pathSegments = pathSegments.filter(function (val) { return val && val.length > 0; }); // remove empty elements\r\n        urlComponents.PathSegments = pathSegments;\r\n        return urlComponents;\r\n    };\r\n    /**\r\n     * Given a url or path, append a trailing slash if one doesnt exist\r\n     *\r\n     * @param url\r\n     */\r\n    UrlUtils.CanonicalizeUri = function (url) {\r\n        if (url) {\r\n            url = url.toLowerCase();\r\n        }\r\n        if (url && !UrlUtils.endsWith(url, "/")) {\r\n            url += "/";\r\n        }\r\n        return url;\r\n    };\r\n    /**\r\n     * Checks to see if the url ends with the suffix\r\n     * Required because we are compiling for es5 instead of es6\r\n     * @param url\r\n     * @param str\r\n     */\r\n    // TODO: Rename this, not clear what it is supposed to do\r\n    UrlUtils.endsWith = function (url, suffix) {\r\n        if (!url || !suffix) {\r\n            return false;\r\n        }\r\n        return url.indexOf(suffix, url.length - suffix.length) !== -1;\r\n    };\r\n    /**\r\n     * Utils function to remove the login_hint and domain_hint from the i/p extraQueryParameters\r\n     * @param url\r\n     * @param name\r\n     */\r\n    UrlUtils.urlRemoveQueryStringParameter = function (url, name) {\r\n        if (StringUtils.isEmpty(url)) {\r\n            return url;\r\n        }\r\n        var regex = new RegExp("(\\\\&" + name + "=)[^\\&]+");\r\n        url = url.replace(regex, "");\r\n        // name=value&\r\n        regex = new RegExp("(" + name + "=)[^\\&]+&");\r\n        url = url.replace(regex, "");\r\n        // name=value\r\n        regex = new RegExp("(" + name + "=)[^\\&]+");\r\n        url = url.replace(regex, "");\r\n        return url;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * Returns the anchor part(#) of the URL\r\n     */\r\n    UrlUtils.getHashFromUrl = function (urlStringOrFragment) {\r\n        var hashIndex1 = urlStringOrFragment.indexOf("#");\r\n        var hashIndex2 = urlStringOrFragment.indexOf("#/");\r\n        if (hashIndex2 > -1) {\r\n            return urlStringOrFragment.substring(hashIndex2 + 2);\r\n        }\r\n        else if (hashIndex1 > -1) {\r\n            return urlStringOrFragment.substring(hashIndex1 + 1);\r\n        }\r\n        return urlStringOrFragment;\r\n    };\r\n    return UrlUtils;\r\n}());\r\n\r\n//# sourceMappingURL=UrlUtils.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/AccessTokenKey.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar AccessTokenKey_AccessTokenKey = /** @class */ (function () {\r\n    function AccessTokenKey(authority, clientId, scopes, uid, utid) {\r\n        this.authority = UrlUtils_UrlUtils.CanonicalizeUri(authority);\r\n        this.clientId = clientId;\r\n        this.scopes = scopes;\r\n        this.homeAccountIdentifier = CryptoUtils.base64Encode(uid) + "." + CryptoUtils.base64Encode(utid);\r\n    }\r\n    return AccessTokenKey;\r\n}());\r\n\r\n//# sourceMappingURL=AccessTokenKey.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/AccessTokenValue.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n */\r\nvar AccessTokenValue = /** @class */ (function () {\r\n    function AccessTokenValue(accessToken, idToken, expiresIn, homeAccountIdentifier) {\r\n        this.accessToken = accessToken;\r\n        this.idToken = idToken;\r\n        this.expiresIn = expiresIn;\r\n        this.homeAccountIdentifier = homeAccountIdentifier;\r\n    }\r\n    return AccessTokenValue;\r\n}());\r\n\r\n//# sourceMappingURL=AccessTokenValue.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/error/AuthError.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nvar AuthErrorMessage = {\r\n    unexpectedError: {\r\n        code: "unexpected_error",\r\n        desc: "Unexpected error in authentication."\r\n    }\r\n};\r\n/**\r\n* General error class thrown by the MSAL.js library.\r\n*/\r\nvar AuthError_AuthError = /** @class */ (function (_super) {\r\n    __extends(AuthError, _super);\r\n    function AuthError(errorCode, errorMessage) {\r\n        var _this = _super.call(this, errorMessage) || this;\r\n        Object.setPrototypeOf(_this, AuthError.prototype);\r\n        _this.errorCode = errorCode;\r\n        _this.errorMessage = errorMessage;\r\n        _this.name = "AuthError";\r\n        return _this;\r\n    }\r\n    AuthError.createUnexpectedError = function (errDesc) {\r\n        return new AuthError(AuthErrorMessage.unexpectedError.code, AuthErrorMessage.unexpectedError.desc + ": " + errDesc);\r\n    };\r\n    return AuthError;\r\n}(Error));\r\n\r\n//# sourceMappingURL=AuthError.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/error/ClientAuthError.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\nvar ClientAuthErrorMessage = {\r\n    multipleMatchingTokens: {\r\n        code: "multiple_matching_tokens",\r\n        desc: "The cache contains multiple tokens satisfying the requirements. " +\r\n            "Call AcquireToken again providing more requirements like authority."\r\n    },\r\n    multipleCacheAuthorities: {\r\n        code: "multiple_authorities",\r\n        desc: "Multiple authorities found in the cache. Pass authority in the API overload."\r\n    },\r\n    endpointResolutionError: {\r\n        code: "endpoints_resolution_error",\r\n        desc: "Error: could not resolve endpoints. Please check network and try again."\r\n    },\r\n    popUpWindowError: {\r\n        code: "popup_window_error",\r\n        desc: "Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser."\r\n    },\r\n    tokenRenewalError: {\r\n        code: "token_renewal_error",\r\n        desc: "Token renewal operation failed due to timeout."\r\n    },\r\n    invalidIdToken: {\r\n        code: "invalid_id_token",\r\n        desc: "Invalid ID token format."\r\n    },\r\n    invalidStateError: {\r\n        code: "invalid_state_error",\r\n        desc: "Invalid state."\r\n    },\r\n    nonceMismatchError: {\r\n        code: "nonce_mismatch_error",\r\n        desc: "Nonce is not matching, Nonce received: "\r\n    },\r\n    loginProgressError: {\r\n        code: "login_progress_error",\r\n        desc: "Login_In_Progress: Error during login call - login is already in progress."\r\n    },\r\n    acquireTokenProgressError: {\r\n        code: "acquiretoken_progress_error",\r\n        desc: "AcquireToken_In_Progress: Error during login call - login is already in progress."\r\n    },\r\n    userCancelledError: {\r\n        code: "user_cancelled",\r\n        desc: "User cancelled the flow."\r\n    },\r\n    callbackError: {\r\n        code: "callback_error",\r\n        desc: "Error occurred in token received callback function."\r\n    },\r\n    userLoginRequiredError: {\r\n        code: "user_login_error",\r\n        desc: "User login is required."\r\n    },\r\n    userDoesNotExistError: {\r\n        code: "user_non_existent",\r\n        desc: "User object does not exist. Please call a login API."\r\n    },\r\n    clientInfoDecodingError: {\r\n        code: "client_info_decoding_error",\r\n        desc: "The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause."\r\n    },\r\n    clientInfoNotPopulatedError: {\r\n        code: "client_info_not_populated_error",\r\n        desc: "The service did not populate client_info in the response, Please verify with the service team"\r\n    },\r\n    nullOrEmptyIdToken: {\r\n        code: "null_or_empty_id_token",\r\n        desc: "The idToken is null or empty. Please review the trace to determine the root cause."\r\n    },\r\n    idTokenNotParsed: {\r\n        code: "id_token_parsing_error",\r\n        desc: "ID token cannot be parsed. Please review stack trace to determine root cause."\r\n    },\r\n    tokenEncodingError: {\r\n        code: "token_encoding_error",\r\n        desc: "The token to be decoded is not encoded correctly."\r\n    },\r\n    invalidInteractionType: {\r\n        code: "invalid_interaction_type",\r\n        desc: "The interaction type passed to the handler was incorrect or unknown"\r\n    }\r\n};\r\n/**\r\n * Error thrown when there is an error in the client code running on the browser.\r\n */\r\nvar ClientAuthError_ClientAuthError = /** @class */ (function (_super) {\r\n    __extends(ClientAuthError, _super);\r\n    function ClientAuthError(errorCode, errorMessage) {\r\n        var _this = _super.call(this, errorCode, errorMessage) || this;\r\n        _this.name = "ClientAuthError";\r\n        Object.setPrototypeOf(_this, ClientAuthError.prototype);\r\n        return _this;\r\n    }\r\n    ClientAuthError.createEndpointResolutionError = function (errDetail) {\r\n        var errorMessage = ClientAuthErrorMessage.endpointResolutionError.desc;\r\n        if (errDetail && !StringUtils.isEmpty(errDetail)) {\r\n            errorMessage += " Details: " + errDetail;\r\n        }\r\n        return new ClientAuthError(ClientAuthErrorMessage.endpointResolutionError.code, errorMessage);\r\n    };\r\n    ClientAuthError.createMultipleMatchingTokensInCacheError = function (scope) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.multipleMatchingTokens.code, "Cache error for scope " + scope + ": " + ClientAuthErrorMessage.multipleMatchingTokens.desc + ".");\r\n    };\r\n    ClientAuthError.createMultipleAuthoritiesInCacheError = function (scope) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.multipleCacheAuthorities.code, "Cache error for scope " + scope + ": " + ClientAuthErrorMessage.multipleCacheAuthorities.desc + ".");\r\n    };\r\n    ClientAuthError.createPopupWindowError = function (errDetail) {\r\n        var errorMessage = ClientAuthErrorMessage.popUpWindowError.desc;\r\n        if (errDetail && !StringUtils.isEmpty(errDetail)) {\r\n            errorMessage += " Details: " + errDetail;\r\n        }\r\n        return new ClientAuthError(ClientAuthErrorMessage.popUpWindowError.code, errorMessage);\r\n    };\r\n    ClientAuthError.createTokenRenewalTimeoutError = function () {\r\n        return new ClientAuthError(ClientAuthErrorMessage.tokenRenewalError.code, ClientAuthErrorMessage.tokenRenewalError.desc);\r\n    };\r\n    ClientAuthError.createInvalidIdTokenError = function (idToken) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.invalidIdToken.code, ClientAuthErrorMessage.invalidIdToken.desc + " Given token: " + idToken);\r\n    };\r\n    //TODO: Is this not a security flaw to send the user the state expected??\r\n    ClientAuthError.createInvalidStateError = function (invalidState, actualState) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.invalidStateError.code, ClientAuthErrorMessage.invalidStateError.desc + " " + invalidState + ", state expected : " + actualState + ".");\r\n    };\r\n    //TODO: Is this not a security flaw to send the user the Nonce expected??\r\n    ClientAuthError.createNonceMismatchError = function (invalidNonce, actualNonce) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.nonceMismatchError.code, ClientAuthErrorMessage.nonceMismatchError.desc + " " + invalidNonce + ", nonce expected : " + actualNonce + ".");\r\n    };\r\n    ClientAuthError.createLoginInProgressError = function () {\r\n        return new ClientAuthError(ClientAuthErrorMessage.loginProgressError.code, ClientAuthErrorMessage.loginProgressError.desc);\r\n    };\r\n    ClientAuthError.createAcquireTokenInProgressError = function () {\r\n        return new ClientAuthError(ClientAuthErrorMessage.acquireTokenProgressError.code, ClientAuthErrorMessage.acquireTokenProgressError.desc);\r\n    };\r\n    ClientAuthError.createUserCancelledError = function () {\r\n        return new ClientAuthError(ClientAuthErrorMessage.userCancelledError.code, ClientAuthErrorMessage.userCancelledError.desc);\r\n    };\r\n    ClientAuthError.createErrorInCallbackFunction = function (errorDesc) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.callbackError.code, ClientAuthErrorMessage.callbackError.desc + " " + errorDesc + ".");\r\n    };\r\n    ClientAuthError.createUserLoginRequiredError = function () {\r\n        return new ClientAuthError(ClientAuthErrorMessage.userLoginRequiredError.code, ClientAuthErrorMessage.userLoginRequiredError.desc);\r\n    };\r\n    ClientAuthError.createUserDoesNotExistError = function () {\r\n        return new ClientAuthError(ClientAuthErrorMessage.userDoesNotExistError.code, ClientAuthErrorMessage.userDoesNotExistError.desc);\r\n    };\r\n    ClientAuthError.createClientInfoDecodingError = function (caughtError) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.clientInfoDecodingError.code, ClientAuthErrorMessage.clientInfoDecodingError.desc + " Failed with error: " + caughtError);\r\n    };\r\n    ClientAuthError.createClientInfoNotPopulatedError = function (caughtError) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.clientInfoNotPopulatedError.code, ClientAuthErrorMessage.clientInfoNotPopulatedError.desc + " Failed with error: " + caughtError);\r\n    };\r\n    ClientAuthError.createIdTokenNullOrEmptyError = function (invalidRawTokenString) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.nullOrEmptyIdToken.code, ClientAuthErrorMessage.nullOrEmptyIdToken.desc + " Raw ID Token Value: " + invalidRawTokenString);\r\n    };\r\n    ClientAuthError.createIdTokenParsingError = function (caughtParsingError) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.idTokenNotParsed.code, ClientAuthErrorMessage.idTokenNotParsed.desc + " Failed with error: " + caughtParsingError);\r\n    };\r\n    ClientAuthError.createTokenEncodingError = function (incorrectlyEncodedToken) {\r\n        return new ClientAuthError(ClientAuthErrorMessage.tokenEncodingError.code, ClientAuthErrorMessage.tokenEncodingError.desc + " Attempted to decode: " + incorrectlyEncodedToken);\r\n    };\r\n    ClientAuthError.createInvalidInteractionTypeError = function () {\r\n        return new ClientAuthError(ClientAuthErrorMessage.invalidInteractionType.code, ClientAuthErrorMessage.invalidInteractionType.desc);\r\n    };\r\n    return ClientAuthError;\r\n}(AuthError_AuthError));\r\n\r\n//# sourceMappingURL=ClientAuthError.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/error/ClientConfigurationError.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\nvar ClientConfigurationErrorMessage = {\r\n    configurationNotSet: {\r\n        code: "no_config_set",\r\n        desc: "Configuration has not been set. Please call the UserAgentApplication constructor with a valid Configuration object."\r\n    },\r\n    invalidCacheLocation: {\r\n        code: "invalid_cache_location",\r\n        desc: "The cache location provided is not valid."\r\n    },\r\n    noStorageSupported: {\r\n        code: "browser_storage_not_supported",\r\n        desc: "localStorage and sessionStorage are not supported."\r\n    },\r\n    noRedirectCallbacksSet: {\r\n        code: "no_redirect_callbacks",\r\n        desc: "No redirect callbacks have been set. Please call setRedirectCallbacks() with the appropriate function arguments before continuing. " +\r\n            "More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."\r\n    },\r\n    invalidCallbackObject: {\r\n        code: "invalid_callback_object",\r\n        desc: "The object passed for the callback was invalid. " +\r\n            "More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics."\r\n    },\r\n    scopesRequired: {\r\n        code: "scopes_required",\r\n        desc: "Scopes are required to obtain an access token."\r\n    },\r\n    emptyScopes: {\r\n        code: "empty_input_scopes_error",\r\n        desc: "Scopes cannot be passed as empty array."\r\n    },\r\n    nonArrayScopes: {\r\n        code: "nonarray_input_scopes_error",\r\n        desc: "Scopes cannot be passed as non-array."\r\n    },\r\n    clientScope: {\r\n        code: "clientid_input_scopes_error",\r\n        desc: "Client ID can only be provided as a single scope."\r\n    },\r\n    invalidPrompt: {\r\n        code: "invalid_prompt_value",\r\n        desc: "Supported prompt values are \'login\', \'select_account\', \'consent\' and \'none\'",\r\n    },\r\n    invalidAuthorityType: {\r\n        code: "invalid_authority_type",\r\n        desc: "The given authority is not a valid type of authority supported by MSAL. Please see here for valid authorities: <insert URL here>."\r\n    },\r\n    authorityUriInsecure: {\r\n        code: "authority_uri_insecure",\r\n        desc: "Authority URIs must use https."\r\n    },\r\n    authorityUriInvalidPath: {\r\n        code: "authority_uri_invalid_path",\r\n        desc: "Given authority URI is invalid."\r\n    },\r\n    unsupportedAuthorityValidation: {\r\n        code: "unsupported_authority_validation",\r\n        desc: "The authority validation is not supported for this authority type."\r\n    },\r\n    b2cAuthorityUriInvalidPath: {\r\n        code: "b2c_authority_uri_invalid_path",\r\n        desc: "The given URI for the B2C authority is invalid."\r\n    },\r\n    claimsRequestParsingError: {\r\n        code: "claims_request_parsing_error",\r\n        desc: "Could not parse the given claims request object."\r\n    },\r\n    emptyRequestError: {\r\n        code: "empty_request_error",\r\n        desc: "Request object is required."\r\n    },\r\n    telemetryConfigError: {\r\n        code: "telemetry_config_error",\r\n        desc: "Telemetry config is not configured with required values"\r\n    }\r\n};\r\n/**\r\n * Error thrown when there is an error in configuration of the .js library.\r\n */\r\nvar ClientConfigurationError_ClientConfigurationError = /** @class */ (function (_super) {\r\n    __extends(ClientConfigurationError, _super);\r\n    function ClientConfigurationError(errorCode, errorMessage) {\r\n        var _this = _super.call(this, errorCode, errorMessage) || this;\r\n        _this.name = "ClientConfigurationError";\r\n        Object.setPrototypeOf(_this, ClientConfigurationError.prototype);\r\n        return _this;\r\n    }\r\n    ClientConfigurationError.createNoSetConfigurationError = function () {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.configurationNotSet.code, "" + ClientConfigurationErrorMessage.configurationNotSet.desc);\r\n    };\r\n    ClientConfigurationError.createInvalidCacheLocationConfigError = function (givenCacheLocation) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidCacheLocation.code, ClientConfigurationErrorMessage.invalidCacheLocation.desc + " Provided value: " + givenCacheLocation + ". Possible values are: " + Constants.cacheLocationLocal + ", " + Constants.cacheLocationSession + ".");\r\n    };\r\n    ClientConfigurationError.createNoStorageSupportedError = function () {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.noStorageSupported.code, ClientConfigurationErrorMessage.noStorageSupported.desc);\r\n    };\r\n    ClientConfigurationError.createRedirectCallbacksNotSetError = function () {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.noRedirectCallbacksSet.code, ClientConfigurationErrorMessage.noRedirectCallbacksSet.desc);\r\n    };\r\n    ClientConfigurationError.createInvalidCallbackObjectError = function (callbackObject) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidCallbackObject.code, ClientConfigurationErrorMessage.invalidCallbackObject.desc + " Given value for callback function: " + callbackObject);\r\n    };\r\n    ClientConfigurationError.createEmptyScopesArrayError = function (scopesValue) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.emptyScopes.code, ClientConfigurationErrorMessage.emptyScopes.desc + " Given value: " + scopesValue + ".");\r\n    };\r\n    ClientConfigurationError.createScopesNonArrayError = function (scopesValue) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.nonArrayScopes.code, ClientConfigurationErrorMessage.nonArrayScopes.desc + " Given value: " + scopesValue + ".");\r\n    };\r\n    ClientConfigurationError.createClientIdSingleScopeError = function (scopesValue) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.clientScope.code, ClientConfigurationErrorMessage.clientScope.desc + " Given value: " + scopesValue + ".");\r\n    };\r\n    ClientConfigurationError.createScopesRequiredError = function (scopesValue) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.scopesRequired.code, ClientConfigurationErrorMessage.scopesRequired.desc + " Given value: " + scopesValue);\r\n    };\r\n    ClientConfigurationError.createInvalidPromptError = function (promptValue) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidPrompt.code, ClientConfigurationErrorMessage.invalidPrompt.desc + " Given value: " + promptValue);\r\n    };\r\n    ClientConfigurationError.createClaimsRequestParsingError = function (claimsRequestParseError) {\r\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.claimsRequestParsingError.code, ClientConfigurationErrorMessage.claimsRequestParsingError.desc + " Given value: " + claimsRequestParseError);\r\n    };\r\n    ClientConfigurationError.createEmptyRequestError = function () {\r\n        var _a = ClientConfigurationErrorMessage.emptyRequestError, code = _a.code, desc = _a.desc;\r\n        return new ClientConfigurationError(code, desc);\r\n    };\r\n    ClientConfigurationError.createTelemetryConfigError = function (config) {\r\n        var _a = ClientConfigurationErrorMessage.telemetryConfigError, code = _a.code, desc = _a.desc;\r\n        var requiredKeys = {\r\n            applicationName: "string",\r\n            applicationVersion: "string",\r\n            telemetryEmitter: "function"\r\n        };\r\n        var missingKeys = Object.keys(requiredKeys)\r\n            .reduce(function (keys, key) {\r\n            return config[key] ? keys : keys.concat([key + " (" + requiredKeys[key] + ")"]);\r\n        }, []);\r\n        return new ClientConfigurationError(code, desc + " mising values: " + missingKeys.join(","));\r\n    };\r\n    return ClientConfigurationError;\r\n}(ClientAuthError_ClientAuthError));\r\n\r\n//# sourceMappingURL=ClientConfigurationError.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/AuthenticationParameters.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\nfunction validateClaimsRequest(request) {\r\n    if (!request.claimsRequest) {\r\n        return;\r\n    }\r\n    var claims;\r\n    try {\r\n        claims = JSON.parse(request.claimsRequest);\r\n    }\r\n    catch (e) {\r\n        throw ClientConfigurationError_ClientConfigurationError.createClaimsRequestParsingError(e);\r\n    }\r\n    // TODO: More validation will be added when the server team tells us how they have actually implemented claims\r\n}\r\n//# sourceMappingURL=AuthenticationParameters.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/ServerRequestParameters.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Nonce: OIDC Nonce definition: https://openid.net/specs/openid-connect-core-1_0.html#IDToken\r\n * State: OAuth Spec: https://tools.ietf.org/html/rfc6749#section-10.12\r\n * @hidden\r\n */\r\nvar ServerRequestParameters_ServerRequestParameters = /** @class */ (function () {\r\n    /**\r\n     * Constructor\r\n     * @param authority\r\n     * @param clientId\r\n     * @param scope\r\n     * @param responseType\r\n     * @param redirectUri\r\n     * @param state\r\n     */\r\n    function ServerRequestParameters(authority, clientId, scope, responseType, redirectUri, state) {\r\n        this.authorityInstance = authority;\r\n        this.clientId = clientId;\r\n        if (!scope) {\r\n            this.scopes = [clientId];\r\n        }\r\n        else {\r\n            this.scopes = scope.slice();\r\n        }\r\n        this.nonce = CryptoUtils.createNewGuid();\r\n        this.state = state && !StringUtils.isEmpty(state) ? CryptoUtils.createNewGuid() + "|" + state : CryptoUtils.createNewGuid();\r\n        // TODO: Change this to user passed vs generated with the new PR\r\n        this.correlationId = CryptoUtils.createNewGuid();\r\n        // telemetry information\r\n        this.xClientSku = "MSAL.JS";\r\n        this.xClientVer = libraryVersion();\r\n        this.responseType = responseType;\r\n        this.redirectUri = redirectUri;\r\n    }\r\n    Object.defineProperty(ServerRequestParameters.prototype, "authority", {\r\n        get: function () {\r\n            return this.authorityInstance ? this.authorityInstance.CanonicalAuthority : null;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * Utility to populate QueryParameters and ExtraQueryParameters to ServerRequestParamerers\r\n     * @param request\r\n     * @param serverAuthenticationRequest\r\n     */\r\n    ServerRequestParameters.prototype.populateQueryParams = function (account, request, adalIdTokenObject) {\r\n        var queryParameters = {};\r\n        if (request) {\r\n            // add the prompt parameter to serverRequestParameters if passed\r\n            if (request.prompt) {\r\n                this.validatePromptParameter(request.prompt);\r\n                this.promptValue = request.prompt;\r\n            }\r\n            // Add claims challenge to serverRequestParameters if passed\r\n            if (request.claimsRequest) {\r\n                validateClaimsRequest(request);\r\n                this.claimsValue = request.claimsRequest;\r\n            }\r\n            // if the developer provides one of these, give preference to developer choice\r\n            if (ServerRequestParameters.isSSOParam(request)) {\r\n                queryParameters = this.constructUnifiedCacheQueryParameter(request, null);\r\n            }\r\n        }\r\n        if (adalIdTokenObject) {\r\n            queryParameters = this.constructUnifiedCacheQueryParameter(null, adalIdTokenObject);\r\n        }\r\n        // adds sid/login_hint if not populated; populates domain_req, login_req and domain_hint\r\n        // this.logger.verbose("Calling addHint parameters");\r\n        queryParameters = this.addHintParameters(account, queryParameters);\r\n        // sanity check for developer passed extraQueryParameters\r\n        var eQParams;\r\n        if (request) {\r\n            eQParams = this.sanitizeEQParams(request);\r\n        }\r\n        // Populate the extraQueryParameters to be sent to the server\r\n        this.queryParameters = ServerRequestParameters.generateQueryParametersString(queryParameters);\r\n        this.extraQueryParameters = ServerRequestParameters.generateQueryParametersString(eQParams);\r\n    };\r\n    //#region QueryParam helpers\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * Utility to test if valid prompt value is passed in the request\r\n     * @param request\r\n     */\r\n    ServerRequestParameters.prototype.validatePromptParameter = function (prompt) {\r\n        if (!([PromptState.LOGIN, PromptState.SELECT_ACCOUNT, PromptState.CONSENT, PromptState.NONE].indexOf(prompt) >= 0)) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createInvalidPromptError(prompt);\r\n        }\r\n    };\r\n    /**\r\n     * Constructs extraQueryParameters to be sent to the server for the AuthenticationParameters set by the developer\r\n     * in any login() or acquireToken() calls\r\n     * @param idTokenObject\r\n     * @param extraQueryParameters\r\n     * @param sid\r\n     * @param loginHint\r\n     */\r\n    //TODO: check how this behaves when domain_hint only is sent in extraparameters and idToken has no upn.\r\n    ServerRequestParameters.prototype.constructUnifiedCacheQueryParameter = function (request, idTokenObject) {\r\n        // preference order: account > sid > login_hint\r\n        var ssoType;\r\n        var ssoData;\r\n        var serverReqParam = {};\r\n        // if account info is passed, account.sid > account.login_hint\r\n        if (request) {\r\n            if (request.account) {\r\n                var account = request.account;\r\n                if (account.sid) {\r\n                    ssoType = SSOTypes.SID;\r\n                    ssoData = account.sid;\r\n                }\r\n                else if (account.userName) {\r\n                    ssoType = SSOTypes.LOGIN_HINT;\r\n                    ssoData = account.userName;\r\n                }\r\n            }\r\n            // sid from request\r\n            else if (request.sid) {\r\n                ssoType = SSOTypes.SID;\r\n                ssoData = request.sid;\r\n            }\r\n            // loginHint from request\r\n            else if (request.loginHint) {\r\n                ssoType = SSOTypes.LOGIN_HINT;\r\n                ssoData = request.loginHint;\r\n            }\r\n        }\r\n        // adalIdToken retrieved from cache\r\n        else if (idTokenObject) {\r\n            if (idTokenObject.hasOwnProperty(Constants.upn)) {\r\n                ssoType = SSOTypes.ID_TOKEN;\r\n                ssoData = idTokenObject.upn;\r\n            }\r\n            else {\r\n                ssoType = SSOTypes.ORGANIZATIONS;\r\n                ssoData = null;\r\n            }\r\n        }\r\n        serverReqParam = this.addSSOParameter(ssoType, ssoData);\r\n        // add the HomeAccountIdentifier info/ domain_hint\r\n        if (request && request.account && request.account.homeAccountIdentifier) {\r\n            serverReqParam = this.addSSOParameter(SSOTypes.HOMEACCOUNT_ID, request.account.homeAccountIdentifier, serverReqParam);\r\n        }\r\n        return serverReqParam;\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Adds login_hint to authorization URL which is used to pre-fill the username field of sign in page for the user if known ahead of time\r\n     * domain_hint can be one of users/organizations which when added skips the email based discovery process of the user\r\n     * domain_req utid received as part of the clientInfo\r\n     * login_req uid received as part of clientInfo\r\n     * Also does a sanity check for extraQueryParameters passed by the user to ensure no repeat queryParameters\r\n     *\r\n     * @param {@link Account} account - Account for which the token is requested\r\n     * @param queryparams\r\n     * @param {@link ServerRequestParameters}\r\n     * @ignore\r\n     */\r\n    ServerRequestParameters.prototype.addHintParameters = function (account, qParams) {\r\n        // This is a final check for all queryParams added so far; preference order: sid > login_hint\r\n        // sid cannot be passed along with login_hint or domain_hint, hence we check both are not populated yet in queryParameters\r\n        if (account && !qParams[SSOTypes.SID]) {\r\n            // sid - populate only if login_hint is not already populated and the account has sid\r\n            var populateSID = !qParams[SSOTypes.LOGIN_HINT] && account.sid && this.promptValue === PromptState.NONE;\r\n            if (populateSID) {\r\n                qParams = this.addSSOParameter(SSOTypes.SID, account.sid, qParams);\r\n            }\r\n            // login_hint - account.userName\r\n            else {\r\n                var populateLoginHint = !qParams[SSOTypes.LOGIN_HINT] && account.userName && !StringUtils.isEmpty(account.userName);\r\n                if (populateLoginHint) {\r\n                    qParams = this.addSSOParameter(SSOTypes.LOGIN_HINT, account.userName, qParams);\r\n                }\r\n            }\r\n            var populateReqParams = !qParams[SSOTypes.DOMAIN_REQ] && !qParams[SSOTypes.LOGIN_REQ];\r\n            if (populateReqParams) {\r\n                qParams = this.addSSOParameter(SSOTypes.HOMEACCOUNT_ID, account.homeAccountIdentifier, qParams);\r\n            }\r\n        }\r\n        return qParams;\r\n    };\r\n    /**\r\n     * Add SID to extraQueryParameters\r\n     * @param sid\r\n     */\r\n    ServerRequestParameters.prototype.addSSOParameter = function (ssoType, ssoData, ssoParam) {\r\n        if (!ssoParam) {\r\n            ssoParam = {};\r\n        }\r\n        if (!ssoData) {\r\n            return ssoParam;\r\n        }\r\n        switch (ssoType) {\r\n            case SSOTypes.SID: {\r\n                ssoParam[SSOTypes.SID] = ssoData;\r\n                break;\r\n            }\r\n            case SSOTypes.ID_TOKEN: {\r\n                ssoParam[SSOTypes.LOGIN_HINT] = ssoData;\r\n                ssoParam[SSOTypes.DOMAIN_HINT] = SSOTypes.ORGANIZATIONS;\r\n                break;\r\n            }\r\n            case SSOTypes.LOGIN_HINT: {\r\n                ssoParam[SSOTypes.LOGIN_HINT] = ssoData;\r\n                break;\r\n            }\r\n            case SSOTypes.ORGANIZATIONS: {\r\n                ssoParam[SSOTypes.DOMAIN_HINT] = SSOTypes.ORGANIZATIONS;\r\n                break;\r\n            }\r\n            case SSOTypes.CONSUMERS: {\r\n                ssoParam[SSOTypes.DOMAIN_HINT] = SSOTypes.CONSUMERS;\r\n                break;\r\n            }\r\n            case SSOTypes.HOMEACCOUNT_ID: {\r\n                var homeAccountId = ssoData.split(".");\r\n                var uid = CryptoUtils.base64Decode(homeAccountId[0]);\r\n                var utid = CryptoUtils.base64Decode(homeAccountId[1]);\r\n                // TODO: domain_req and login_req are not needed according to eSTS team\r\n                ssoParam[SSOTypes.LOGIN_REQ] = uid;\r\n                ssoParam[SSOTypes.DOMAIN_REQ] = utid;\r\n                if (utid === Constants.consumersUtid) {\r\n                    ssoParam[SSOTypes.DOMAIN_HINT] = SSOTypes.CONSUMERS;\r\n                }\r\n                else {\r\n                    ssoParam[SSOTypes.DOMAIN_HINT] = SSOTypes.ORGANIZATIONS;\r\n                }\r\n                break;\r\n            }\r\n            case SSOTypes.LOGIN_REQ: {\r\n                ssoParam[SSOTypes.LOGIN_REQ] = ssoData;\r\n                break;\r\n            }\r\n            case SSOTypes.DOMAIN_REQ: {\r\n                ssoParam[SSOTypes.DOMAIN_REQ] = ssoData;\r\n                break;\r\n            }\r\n        }\r\n        return ssoParam;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     * Removes unnecessary or duplicate query parameters from extraQueryParameters\r\n     * @param request\r\n     */\r\n    ServerRequestParameters.prototype.sanitizeEQParams = function (request) {\r\n        var eQParams = request.extraQueryParameters;\r\n        if (!eQParams) {\r\n            return null;\r\n        }\r\n        if (request.claimsRequest) {\r\n            // this.logger.warning("Removed duplicate claims from extraQueryParameters. Please use either the claimsRequest field OR pass as extraQueryParameter - not both.");\r\n            delete eQParams[Constants.claims];\r\n        }\r\n        BlacklistedEQParams.forEach(function (param) {\r\n            if (eQParams[param]) {\r\n                // this.logger.warning("Removed duplicate " + param + " from extraQueryParameters. Please use the " + param + " field in request object.");\r\n                delete eQParams[param];\r\n            }\r\n        });\r\n        return eQParams;\r\n    };\r\n    /**\r\n     * Utility to generate a QueryParameterString from a Key-Value mapping of extraQueryParameters passed\r\n     * @param extraQueryParameters\r\n     */\r\n    ServerRequestParameters.generateQueryParametersString = function (queryParameters) {\r\n        var paramsString = null;\r\n        if (queryParameters) {\r\n            Object.keys(queryParameters).forEach(function (key) {\r\n                if (paramsString == null) {\r\n                    paramsString = key + "=" + encodeURIComponent(queryParameters[key]);\r\n                }\r\n                else {\r\n                    paramsString += "&" + key + "=" + encodeURIComponent(queryParameters[key]);\r\n                }\r\n            });\r\n        }\r\n        return paramsString;\r\n    };\r\n    //#endregion\r\n    /**\r\n     * Check to see if there are SSO params set in the Request\r\n     * @param request\r\n     */\r\n    ServerRequestParameters.isSSOParam = function (request) {\r\n        return request && (request.account || request.sid || request.loginHint);\r\n    };\r\n    return ServerRequestParameters;\r\n}());\r\n\r\n//# sourceMappingURL=ServerRequestParameters.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/ClientInfo.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar ClientInfo_ClientInfo = /** @class */ (function () {\r\n    function ClientInfo(rawClientInfo) {\r\n        if (!rawClientInfo || StringUtils.isEmpty(rawClientInfo)) {\r\n            this.uid = "";\r\n            this.utid = "";\r\n            return;\r\n        }\r\n        try {\r\n            var decodedClientInfo = CryptoUtils.base64Decode(rawClientInfo);\r\n            var clientInfo = JSON.parse(decodedClientInfo);\r\n            if (clientInfo) {\r\n                if (clientInfo.hasOwnProperty("uid")) {\r\n                    this.uid = clientInfo.uid;\r\n                }\r\n                if (clientInfo.hasOwnProperty("utid")) {\r\n                    this.utid = clientInfo.utid;\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            throw ClientAuthError_ClientAuthError.createClientInfoDecodingError(e);\r\n        }\r\n    }\r\n    Object.defineProperty(ClientInfo.prototype, "uid", {\r\n        get: function () {\r\n            return this._uid ? this._uid : "";\r\n        },\r\n        set: function (uid) {\r\n            this._uid = uid;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ClientInfo.prototype, "utid", {\r\n        get: function () {\r\n            return this._utid ? this._utid : "";\r\n        },\r\n        set: function (utid) {\r\n            this._utid = utid;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return ClientInfo;\r\n}());\r\n\r\n//# sourceMappingURL=ClientInfo.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/utils/TokenUtils.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar TokenUtils_TokenUtils = /** @class */ (function () {\r\n    function TokenUtils() {\r\n    }\r\n    /**\r\n     * decode a JWT\r\n     *\r\n     * @param jwtToken\r\n     */\r\n    TokenUtils.decodeJwt = function (jwtToken) {\r\n        if (StringUtils.isEmpty(jwtToken)) {\r\n            return null;\r\n        }\r\n        var idTokenPartsRegex = /^([^\\.\\s]*)\\.([^\\.\\s]+)\\.([^\\.\\s]*)$/;\r\n        var matches = idTokenPartsRegex.exec(jwtToken);\r\n        if (!matches || matches.length < 4) {\r\n            //this._requestContext.logger.warn("The returned id_token is not parseable.");\r\n            return null;\r\n        }\r\n        var crackedToken = {\r\n            header: matches[1],\r\n            JWSPayload: matches[2],\r\n            JWSSig: matches[3]\r\n        };\r\n        return crackedToken;\r\n    };\r\n    /**\r\n     * Extract IdToken by decoding the RAWIdToken\r\n     *\r\n     * @param encodedIdToken\r\n     */\r\n    TokenUtils.extractIdToken = function (encodedIdToken) {\r\n        // id token will be decoded to get the username\r\n        var decodedToken = this.decodeJwt(encodedIdToken);\r\n        if (!decodedToken) {\r\n            return null;\r\n        }\r\n        try {\r\n            var base64IdToken = decodedToken.JWSPayload;\r\n            var base64Decoded = CryptoUtils.base64Decode(base64IdToken);\r\n            if (!base64Decoded) {\r\n                //this._requestContext.logger.info("The returned id_token could not be base64 url safe decoded.");\r\n                return null;\r\n            }\r\n            // ECMA script has JSON built-in support\r\n            return JSON.parse(base64Decoded);\r\n        }\r\n        catch (err) {\r\n            //this._requestContext.logger.error("The returned id_token could not be decoded" + err);\r\n        }\r\n        return null;\r\n    };\r\n    return TokenUtils;\r\n}());\r\n\r\n//# sourceMappingURL=TokenUtils.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/IdToken.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar IdToken_IdToken = /** @class */ (function () {\r\n    /* tslint:disable:no-string-literal */\r\n    function IdToken(rawIdToken) {\r\n        if (StringUtils.isEmpty(rawIdToken)) {\r\n            throw ClientAuthError_ClientAuthError.createIdTokenNullOrEmptyError(rawIdToken);\r\n        }\r\n        try {\r\n            this.rawIdToken = rawIdToken;\r\n            this.claims = TokenUtils_TokenUtils.extractIdToken(rawIdToken);\r\n            if (this.claims) {\r\n                if (this.claims.hasOwnProperty("iss")) {\r\n                    this.issuer = this.claims["iss"];\r\n                }\r\n                if (this.claims.hasOwnProperty("oid")) {\r\n                    this.objectId = this.claims["oid"];\r\n                }\r\n                if (this.claims.hasOwnProperty("sub")) {\r\n                    this.subject = this.claims["sub"];\r\n                }\r\n                if (this.claims.hasOwnProperty("tid")) {\r\n                    this.tenantId = this.claims["tid"];\r\n                }\r\n                if (this.claims.hasOwnProperty("ver")) {\r\n                    this.version = this.claims["ver"];\r\n                }\r\n                if (this.claims.hasOwnProperty("preferred_username")) {\r\n                    this.preferredName = this.claims["preferred_username"];\r\n                }\r\n                if (this.claims.hasOwnProperty("name")) {\r\n                    this.name = this.claims["name"];\r\n                }\r\n                if (this.claims.hasOwnProperty("nonce")) {\r\n                    this.nonce = this.claims["nonce"];\r\n                }\r\n                if (this.claims.hasOwnProperty("exp")) {\r\n                    this.expiration = this.claims["exp"];\r\n                }\r\n                if (this.claims.hasOwnProperty("home_oid")) {\r\n                    this.homeObjectId = this.claims["home_oid"];\r\n                }\r\n                if (this.claims.hasOwnProperty("sid")) {\r\n                    this.sid = this.claims["sid"];\r\n                }\r\n                /* tslint:enable:no-string-literal */\r\n            }\r\n        }\r\n        catch (e) {\r\n            // TODO: This error here won\'t really every be thrown, since extractIdToken() returns null if the decodeJwt() fails.\r\n            // Need to add better error handling here to account for being unable to decode jwts.\r\n            throw ClientAuthError_ClientAuthError.createIdTokenParsingError(e);\r\n        }\r\n    }\r\n    return IdToken;\r\n}());\r\n\r\n//# sourceMappingURL=IdToken.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/AccessTokenCacheItem.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n */\r\nvar AccessTokenCacheItem = /** @class */ (function () {\r\n    function AccessTokenCacheItem(key, value) {\r\n        this.key = key;\r\n        this.value = value;\r\n    }\r\n    return AccessTokenCacheItem;\r\n}());\r\n\r\n//# sourceMappingURL=AccessTokenCacheItem.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/Storage.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar Storage_Storage = /** @class */ (function () {\r\n    function Storage(cacheLocation) {\r\n        if (Storage.instance) {\r\n            return Storage.instance;\r\n        }\r\n        this.cacheLocation = cacheLocation;\r\n        this.localStorageSupported = typeof window[this.cacheLocation] !== "undefined" && window[this.cacheLocation] != null;\r\n        this.sessionStorageSupported = typeof window[cacheLocation] !== "undefined" && window[cacheLocation] != null;\r\n        Storage.instance = this;\r\n        if (!this.localStorageSupported && !this.sessionStorageSupported) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createNoStorageSupportedError();\r\n        }\r\n        return Storage.instance;\r\n    }\r\n    // add value to storage\r\n    Storage.prototype.setItem = function (key, value, enableCookieStorage) {\r\n        if (window[this.cacheLocation]) {\r\n            window[this.cacheLocation].setItem(key, value);\r\n        }\r\n        if (enableCookieStorage) {\r\n            this.setItemCookie(key, value);\r\n        }\r\n    };\r\n    // get one item by key from storage\r\n    Storage.prototype.getItem = function (key, enableCookieStorage) {\r\n        if (enableCookieStorage && this.getItemCookie(key)) {\r\n            return this.getItemCookie(key);\r\n        }\r\n        if (window[this.cacheLocation]) {\r\n            return window[this.cacheLocation].getItem(key);\r\n        }\r\n        return null;\r\n    };\r\n    // remove value from storage\r\n    Storage.prototype.removeItem = function (key) {\r\n        if (window[this.cacheLocation]) {\r\n            return window[this.cacheLocation].removeItem(key);\r\n        }\r\n    };\r\n    // clear storage (remove all items from it)\r\n    Storage.prototype.clear = function () {\r\n        if (window[this.cacheLocation]) {\r\n            return window[this.cacheLocation].clear();\r\n        }\r\n    };\r\n    Storage.prototype.getAllAccessTokens = function (clientId, homeAccountIdentifier) {\r\n        var results = [];\r\n        var accessTokenCacheItem;\r\n        var storage = window[this.cacheLocation];\r\n        if (storage) {\r\n            var key = void 0;\r\n            for (key in storage) {\r\n                if (storage.hasOwnProperty(key)) {\r\n                    if (key.match(clientId) && key.match(homeAccountIdentifier)) {\r\n                        var value = this.getItem(key);\r\n                        if (value) {\r\n                            accessTokenCacheItem = new AccessTokenCacheItem(JSON.parse(key), JSON.parse(value));\r\n                            results.push(accessTokenCacheItem);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return results;\r\n    };\r\n    Storage.prototype.removeAcquireTokenEntries = function (state) {\r\n        var storage = window[this.cacheLocation];\r\n        if (storage) {\r\n            var key = void 0;\r\n            for (key in storage) {\r\n                if (storage.hasOwnProperty(key)) {\r\n                    if ((key.indexOf(CacheKeys.AUTHORITY) !== -1 || key.indexOf(CacheKeys.ACQUIRE_TOKEN_ACCOUNT) !== 1) && (!state || key.indexOf(state) !== -1)) {\r\n                        var splitKey = key.split(Constants.resourceDelimiter);\r\n                        var state_1 = void 0;\r\n                        if (splitKey.length > 1) {\r\n                            state_1 = splitKey[1];\r\n                        }\r\n                        if (state_1 && !this.tokenRenewalInProgress(state_1)) {\r\n                            this.removeItem(key);\r\n                            this.removeItem(Constants.renewStatus + state_1);\r\n                            this.removeItem(Constants.stateLogin);\r\n                            this.removeItem(Constants.stateAcquireToken);\r\n                            this.setItemCookie(key, "", -1);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.clearCookie();\r\n    };\r\n    Storage.prototype.tokenRenewalInProgress = function (stateValue) {\r\n        var storage = window[this.cacheLocation];\r\n        var renewStatus = storage[Constants.renewStatus + stateValue];\r\n        return !(!renewStatus || renewStatus !== Constants.tokenRenewStatusInProgress);\r\n    };\r\n    Storage.prototype.resetCacheItems = function () {\r\n        var storage = window[this.cacheLocation];\r\n        if (storage) {\r\n            var key = void 0;\r\n            for (key in storage) {\r\n                if (storage.hasOwnProperty(key)) {\r\n                    if (key.indexOf(Constants.msal) !== -1) {\r\n                        this.removeItem(key);\r\n                    }\r\n                }\r\n            }\r\n            this.removeAcquireTokenEntries();\r\n        }\r\n    };\r\n    Storage.prototype.setItemCookie = function (cName, cValue, expires) {\r\n        var cookieStr = cName + "=" + cValue + ";";\r\n        if (expires) {\r\n            var expireTime = this.getCookieExpirationTime(expires);\r\n            cookieStr += "expires=" + expireTime + ";";\r\n        }\r\n        document.cookie = cookieStr;\r\n    };\r\n    Storage.prototype.getItemCookie = function (cName) {\r\n        var name = cName + "=";\r\n        var ca = document.cookie.split(";");\r\n        for (var i = 0; i < ca.length; i++) {\r\n            var c = ca[i];\r\n            while (c.charAt(0) === " ") {\r\n                c = c.substring(1);\r\n            }\r\n            if (c.indexOf(name) === 0) {\r\n                return c.substring(name.length, c.length);\r\n            }\r\n        }\r\n        return "";\r\n    };\r\n    Storage.prototype.getCookieExpirationTime = function (cookieLifeDays) {\r\n        var today = new Date();\r\n        var expr = new Date(today.getTime() + cookieLifeDays * 24 * 60 * 60 * 1000);\r\n        return expr.toUTCString();\r\n    };\r\n    Storage.prototype.clearCookie = function () {\r\n        this.setItemCookie(Constants.nonceIdToken, "", -1);\r\n        this.setItemCookie(Constants.stateLogin, "", -1);\r\n        this.setItemCookie(Constants.loginRequest, "", -1);\r\n        this.setItemCookie(Constants.stateAcquireToken, "", -1);\r\n    };\r\n    /**\r\n     * Create acquireTokenAccountKey to cache account object\r\n     * @param accountId\r\n     * @param state\r\n     */\r\n    Storage.generateAcquireTokenAccountKey = function (accountId, state) {\r\n        return CacheKeys.ACQUIRE_TOKEN_ACCOUNT + Constants.resourceDelimiter +\r\n            ("" + accountId) + Constants.resourceDelimiter + ("" + state);\r\n    };\r\n    /**\r\n     * Create authorityKey to cache authority\r\n     * @param state\r\n     */\r\n    Storage.generateAuthorityKey = function (state) {\r\n        return CacheKeys.AUTHORITY + Constants.resourceDelimiter + ("" + state);\r\n    };\r\n    return Storage;\r\n}());\r\n\r\n//# sourceMappingURL=Storage.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/Account.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n/**\r\n * accountIdentifier       combination of idToken.uid and idToken.utid\r\n * homeAccountIdentifier   combination of clientInfo.uid and clientInfo.utid\r\n * userName                idToken.preferred_username\r\n * name                    idToken.name\r\n * idToken                 idToken\r\n * sid                     idToken.sid - session identifier\r\n * environment             idtoken.issuer (the authority that issues the token)\r\n */\r\nvar Account_Account = /** @class */ (function () {\r\n    /**\r\n     * Creates an Account Object\r\n     * @praram accountIdentifier\r\n     * @param homeAccountIdentifier\r\n     * @param userName\r\n     * @param name\r\n     * @param idToken\r\n     * @param sid\r\n     * @param environment\r\n     */\r\n    function Account(accountIdentifier, homeAccountIdentifier, userName, name, idTokenClaims, sid, environment) {\r\n        this.accountIdentifier = accountIdentifier;\r\n        this.homeAccountIdentifier = homeAccountIdentifier;\r\n        this.userName = userName;\r\n        this.name = name;\r\n        // will be deprecated soon\r\n        this.idToken = idTokenClaims;\r\n        this.idTokenClaims = idTokenClaims;\r\n        this.sid = sid;\r\n        this.environment = environment;\r\n    }\r\n    /**\r\n     * @hidden\r\n     * @param idToken\r\n     * @param clientInfo\r\n     */\r\n    Account.createAccount = function (idToken, clientInfo) {\r\n        // create accountIdentifier\r\n        var accountIdentifier = idToken.objectId || idToken.subject;\r\n        // create homeAccountIdentifier\r\n        var uid = clientInfo ? clientInfo.uid : "";\r\n        var utid = clientInfo ? clientInfo.utid : "";\r\n        var homeAccountIdentifier;\r\n        if (!StringUtils.isEmpty(uid) && !StringUtils.isEmpty(utid)) {\r\n            homeAccountIdentifier = CryptoUtils.base64Encode(uid) + "." + CryptoUtils.base64Encode(utid);\r\n        }\r\n        return new Account(accountIdentifier, homeAccountIdentifier, idToken.preferredName, idToken.name, idToken.claims, idToken.sid, idToken.issuer);\r\n    };\r\n    /**\r\n     * Utils function to compare two Account objects - used to check if the same user account is logged in\r\n     *\r\n     * @param a1: Account object\r\n     * @param a2: Account object\r\n     */\r\n    Account.compareAccounts = function (a1, a2) {\r\n        if (!a1 || !a2) {\r\n            return false;\r\n        }\r\n        if (a1.homeAccountIdentifier && a2.homeAccountIdentifier) {\r\n            if (a1.homeAccountIdentifier === a2.homeAccountIdentifier) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    return Account;\r\n}());\r\n\r\n//# sourceMappingURL=Account.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/utils/TimeUtils.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n */\r\nvar TimeUtils = /** @class */ (function () {\r\n    function TimeUtils() {\r\n    }\r\n    /**\r\n     * Returns time in seconds for expiration based on string value passed in.\r\n     *\r\n     * @param expiresIn\r\n     */\r\n    TimeUtils.parseExpiresIn = function (expiresIn) {\r\n        // if AAD did not send "expires_in" property, use default expiration of 3599 seconds, for some reason AAD sends 3599 as "expires_in" value instead of 3600\r\n        if (!expiresIn) {\r\n            expiresIn = "3599";\r\n        }\r\n        return parseInt(expiresIn, 10);\r\n    };\r\n    /**\r\n     * return the current time in Unix time. Date.getTime() returns in milliseconds.\r\n     */\r\n    TimeUtils.now = function () {\r\n        return Math.round(new Date().getTime() / 1000.0);\r\n    };\r\n    return TimeUtils;\r\n}());\r\n\r\n//# sourceMappingURL=TimeUtils.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/utils/ResponseUtils.js\n\r\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n */\r\nvar ResponseUtils_ResponseUtils = /** @class */ (function () {\r\n    function ResponseUtils() {\r\n    }\r\n    ResponseUtils.setResponseIdToken = function (originalResponse, idTokenObj) {\r\n        if (!originalResponse) {\r\n            return null;\r\n        }\r\n        else if (!idTokenObj) {\r\n            return originalResponse;\r\n        }\r\n        var exp = Number(idTokenObj.expiration);\r\n        if (exp && !originalResponse.expiresOn) {\r\n            originalResponse.expiresOn = new Date(exp * 1000);\r\n        }\r\n        return __assign({}, originalResponse, { idToken: idTokenObj, idTokenClaims: idTokenObj.claims, uniqueId: idTokenObj.objectId || idTokenObj.subject, tenantId: idTokenObj.tenantId });\r\n    };\r\n    return ResponseUtils;\r\n}());\r\n\r\n//# sourceMappingURL=ResponseUtils.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/XHRClient.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * XHR client for JSON endpoints\r\n * https://www.npmjs.com/package/async-promise\r\n * @hidden\r\n */\r\nvar XhrClient = /** @class */ (function () {\r\n    function XhrClient() {\r\n    }\r\n    XhrClient.prototype.sendRequestAsync = function (url, method, enableCaching) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr.open(method, url, /*async: */ true);\r\n            if (enableCaching) {\r\n                // TODO: (shivb) ensure that this can be cached\r\n                // xhr.setRequestHeader("Cache-Control", "Public");\r\n            }\r\n            xhr.onload = function (ev) {\r\n                if (xhr.status < 200 || xhr.status >= 300) {\r\n                    reject(_this.handleError(xhr.responseText));\r\n                }\r\n                try {\r\n                    var jsonResponse = JSON.parse(xhr.responseText);\r\n                }\r\n                catch (e) {\r\n                    reject(_this.handleError(xhr.responseText));\r\n                }\r\n                resolve(jsonResponse);\r\n            };\r\n            xhr.onerror = function (ev) {\r\n                reject(xhr.status);\r\n            };\r\n            if (method === "GET") {\r\n                xhr.send();\r\n            }\r\n            else {\r\n                throw "not implemented";\r\n            }\r\n        });\r\n    };\r\n    XhrClient.prototype.handleError = function (responseText) {\r\n        var jsonResponse;\r\n        try {\r\n            jsonResponse = JSON.parse(responseText);\r\n            if (jsonResponse.error) {\r\n                return jsonResponse.error;\r\n            }\r\n            else {\r\n                throw responseText;\r\n            }\r\n        }\r\n        catch (e) {\r\n            return responseText;\r\n        }\r\n    };\r\n    return XhrClient;\r\n}());\r\n\r\n//# sourceMappingURL=XHRClient.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/Authority.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar AuthorityType;\r\n(function (AuthorityType) {\r\n    AuthorityType[AuthorityType["Aad"] = 0] = "Aad";\r\n    AuthorityType[AuthorityType["Adfs"] = 1] = "Adfs";\r\n    AuthorityType[AuthorityType["B2C"] = 2] = "B2C";\r\n})(AuthorityType || (AuthorityType = {}));\r\n/**\r\n * @hidden\r\n */\r\nvar Authority_Authority = /** @class */ (function () {\r\n    function Authority(authority, validateAuthority) {\r\n        this.IsValidationEnabled = validateAuthority;\r\n        this.CanonicalAuthority = authority;\r\n        this.validateAsUri();\r\n    }\r\n    Object.defineProperty(Authority.prototype, "Tenant", {\r\n        get: function () {\r\n            return this.CanonicalAuthorityUrlComponents.PathSegments[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Authority.prototype, "AuthorizationEndpoint", {\r\n        get: function () {\r\n            this.validateResolved();\r\n            return this.tenantDiscoveryResponse.AuthorizationEndpoint.replace("{tenant}", this.Tenant);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Authority.prototype, "EndSessionEndpoint", {\r\n        get: function () {\r\n            this.validateResolved();\r\n            return this.tenantDiscoveryResponse.EndSessionEndpoint.replace("{tenant}", this.Tenant);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Authority.prototype, "SelfSignedJwtAudience", {\r\n        get: function () {\r\n            this.validateResolved();\r\n            return this.tenantDiscoveryResponse.Issuer.replace("{tenant}", this.Tenant);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Authority.prototype.validateResolved = function () {\r\n        if (!this.tenantDiscoveryResponse) {\r\n            throw "Please call ResolveEndpointsAsync first";\r\n        }\r\n    };\r\n    Object.defineProperty(Authority.prototype, "CanonicalAuthority", {\r\n        /**\r\n         * A URL that is the authority set by the developer\r\n         */\r\n        get: function () {\r\n            return this.canonicalAuthority;\r\n        },\r\n        set: function (url) {\r\n            this.canonicalAuthority = UrlUtils_UrlUtils.CanonicalizeUri(url);\r\n            this.canonicalAuthorityUrlComponents = null;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Authority.prototype, "CanonicalAuthorityUrlComponents", {\r\n        get: function () {\r\n            if (!this.canonicalAuthorityUrlComponents) {\r\n                this.canonicalAuthorityUrlComponents = UrlUtils_UrlUtils.GetUrlComponents(this.CanonicalAuthority);\r\n            }\r\n            return this.canonicalAuthorityUrlComponents;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Authority.prototype, "DefaultOpenIdConfigurationEndpoint", {\r\n        /**\r\n         * // http://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata\r\n         */\r\n        get: function () {\r\n            return this.CanonicalAuthority + "v2.0/.well-known/openid-configuration";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Given a string, validate that it is of the form https://domain/path\r\n     */\r\n    Authority.prototype.validateAsUri = function () {\r\n        var components;\r\n        try {\r\n            components = this.CanonicalAuthorityUrlComponents;\r\n        }\r\n        catch (e) {\r\n            throw ClientConfigurationErrorMessage.invalidAuthorityType;\r\n        }\r\n        if (!components.Protocol || components.Protocol.toLowerCase() !== "https:") {\r\n            throw ClientConfigurationErrorMessage.authorityUriInsecure;\r\n        }\r\n        if (!components.PathSegments || components.PathSegments.length < 1) {\r\n            throw ClientConfigurationErrorMessage.authorityUriInvalidPath;\r\n        }\r\n    };\r\n    /**\r\n     * Calls the OIDC endpoint and returns the response\r\n     */\r\n    Authority.prototype.DiscoverEndpoints = function (openIdConfigurationEndpoint) {\r\n        var client = new XhrClient();\r\n        return client.sendRequestAsync(openIdConfigurationEndpoint, "GET", /*enableCaching: */ true)\r\n            .then(function (response) {\r\n            return {\r\n                AuthorizationEndpoint: response.authorization_endpoint,\r\n                EndSessionEndpoint: response.end_session_endpoint,\r\n                Issuer: response.issuer\r\n            };\r\n        });\r\n    };\r\n    /**\r\n     * Returns a promise.\r\n     * Checks to see if the authority is in the cache\r\n     * Discover endpoints via openid-configuration\r\n     * If successful, caches the endpoint for later use in OIDC\r\n     */\r\n    Authority.prototype.resolveEndpointsAsync = function () {\r\n        var _this = this;\r\n        var openIdConfigurationEndpoint = "";\r\n        return this.GetOpenIdConfigurationEndpointAsync().then(function (openIdConfigurationEndpointResponse) {\r\n            openIdConfigurationEndpoint = openIdConfigurationEndpointResponse;\r\n            return _this.DiscoverEndpoints(openIdConfigurationEndpoint);\r\n        }).then(function (tenantDiscoveryResponse) {\r\n            _this.tenantDiscoveryResponse = tenantDiscoveryResponse;\r\n            return _this;\r\n        });\r\n    };\r\n    return Authority;\r\n}());\r\n\r\n//# sourceMappingURL=Authority.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/AadAuthority.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar AadAuthority_AadAuthority = /** @class */ (function (_super) {\r\n    __extends(AadAuthority, _super);\r\n    function AadAuthority(authority, validateAuthority) {\r\n        return _super.call(this, authority, validateAuthority) || this;\r\n    }\r\n    Object.defineProperty(AadAuthority.prototype, "AadInstanceDiscoveryEndpointUrl", {\r\n        get: function () {\r\n            return AadAuthority.AadInstanceDiscoveryEndpoint + "?api-version=1.0&authorization_endpoint=" + this.CanonicalAuthority + "oauth2/v2.0/authorize";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AadAuthority.prototype, "AuthorityType", {\r\n        get: function () {\r\n            return AuthorityType.Aad;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns a promise which resolves to the OIDC endpoint\r\n     * Only responds with the endpoint\r\n     */\r\n    AadAuthority.prototype.GetOpenIdConfigurationEndpointAsync = function () {\r\n        var _this = this;\r\n        var resultPromise = new Promise(function (resolve, reject) {\r\n            return resolve(_this.DefaultOpenIdConfigurationEndpoint);\r\n        });\r\n        if (!this.IsValidationEnabled) {\r\n            return resultPromise;\r\n        }\r\n        var host = this.CanonicalAuthorityUrlComponents.HostNameAndPort;\r\n        if (this.IsInTrustedHostList(host)) {\r\n            return resultPromise;\r\n        }\r\n        var client = new XhrClient();\r\n        return client.sendRequestAsync(this.AadInstanceDiscoveryEndpointUrl, "GET", true)\r\n            .then(function (response) {\r\n            return response.tenant_discovery_endpoint;\r\n        });\r\n    };\r\n    /**\r\n     * Checks to see if the host is in a list of trusted hosts\r\n     * @param {string} The host to look up\r\n     */\r\n    AadAuthority.prototype.IsInTrustedHostList = function (host) {\r\n        return AADTrustedHostList[host.toLowerCase()];\r\n    };\r\n    AadAuthority.AadInstanceDiscoveryEndpoint = "https://login.microsoftonline.com/common/discovery/instance";\r\n    return AadAuthority;\r\n}(Authority_Authority));\r\n\r\n//# sourceMappingURL=AadAuthority.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/B2cAuthority.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @hidden\r\n */\r\nvar B2cAuthority_B2cAuthority = /** @class */ (function (_super) {\r\n    __extends(B2cAuthority, _super);\r\n    function B2cAuthority(authority, validateAuthority) {\r\n        var _this = _super.call(this, authority, validateAuthority) || this;\r\n        var urlComponents = UrlUtils_UrlUtils.GetUrlComponents(authority);\r\n        var pathSegments = urlComponents.PathSegments;\r\n        if (pathSegments.length < 3) {\r\n            throw ClientConfigurationErrorMessage.b2cAuthorityUriInvalidPath;\r\n        }\r\n        _this.CanonicalAuthority = "https://" + urlComponents.HostNameAndPort + "/" + pathSegments[0] + "/" + pathSegments[1] + "/" + pathSegments[2] + "/";\r\n        return _this;\r\n    }\r\n    Object.defineProperty(B2cAuthority.prototype, "AuthorityType", {\r\n        get: function () {\r\n            return AuthorityType.B2C;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns a promise with the TenantDiscoveryEndpoint\r\n     */\r\n    B2cAuthority.prototype.GetOpenIdConfigurationEndpointAsync = function () {\r\n        var _this = this;\r\n        var resultPromise = new Promise(function (resolve, reject) {\r\n            return resolve(_this.DefaultOpenIdConfigurationEndpoint);\r\n        });\r\n        if (!this.IsValidationEnabled) {\r\n            return resultPromise;\r\n        }\r\n        if (this.IsInTrustedHostList(this.CanonicalAuthorityUrlComponents.HostNameAndPort)) {\r\n            return resultPromise;\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            return reject(ClientConfigurationErrorMessage.unsupportedAuthorityValidation);\r\n        });\r\n    };\r\n    B2cAuthority.B2C_PREFIX = "tfp";\r\n    return B2cAuthority;\r\n}(AadAuthority_AadAuthority));\r\n\r\n//# sourceMappingURL=B2cAuthority.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/AuthorityFactory.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n/**\r\n * @hidden\r\n */\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar AuthorityFactory_AuthorityFactory = /** @class */ (function () {\r\n    function AuthorityFactory() {\r\n    }\r\n    /**\r\n    * Parse the url and determine the type of authority\r\n    */\r\n    AuthorityFactory.DetectAuthorityFromUrl = function (authorityUrl) {\r\n        authorityUrl = UrlUtils_UrlUtils.CanonicalizeUri(authorityUrl);\r\n        var components = UrlUtils_UrlUtils.GetUrlComponents(authorityUrl);\r\n        var pathSegments = components.PathSegments;\r\n        switch (pathSegments[0]) {\r\n            case "tfp":\r\n                return AuthorityType.B2C;\r\n            case "adfs":\r\n                return AuthorityType.Adfs;\r\n            default:\r\n                return AuthorityType.Aad;\r\n        }\r\n    };\r\n    /**\r\n    * Create an authority object of the correct type based on the url\r\n    * Performs basic authority validation - checks to see if the authority is of a valid type (eg aad, b2c)\r\n    */\r\n    AuthorityFactory.CreateInstance = function (authorityUrl, validateAuthority) {\r\n        if (StringUtils.isEmpty(authorityUrl)) {\r\n            return null;\r\n        }\r\n        var type = AuthorityFactory.DetectAuthorityFromUrl(authorityUrl);\r\n        // Depending on above detection, create the right type.\r\n        switch (type) {\r\n            case AuthorityType.B2C:\r\n                return new B2cAuthority_B2cAuthority(authorityUrl, validateAuthority);\r\n            case AuthorityType.Aad:\r\n                return new AadAuthority_AadAuthority(authorityUrl, validateAuthority);\r\n            default:\r\n                throw ClientConfigurationErrorMessage.invalidAuthorityType;\r\n        }\r\n    };\r\n    return AuthorityFactory;\r\n}());\r\n\r\n//# sourceMappingURL=AuthorityFactory.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/Logger.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\nvar LogLevel;\r\n(function (LogLevel) {\r\n    LogLevel[LogLevel["Error"] = 0] = "Error";\r\n    LogLevel[LogLevel["Warning"] = 1] = "Warning";\r\n    LogLevel[LogLevel["Info"] = 2] = "Info";\r\n    LogLevel[LogLevel["Verbose"] = 3] = "Verbose";\r\n})(LogLevel || (LogLevel = {}));\r\nvar Logger_Logger = /** @class */ (function () {\r\n    function Logger(localCallback, options) {\r\n        if (options === void 0) { options = {}; }\r\n        /**\r\n         * @hidden\r\n         */\r\n        this.level = LogLevel.Info;\r\n        var _a = options.correlationId, correlationId = _a === void 0 ? "" : _a, _b = options.level, level = _b === void 0 ? LogLevel.Info : _b, _c = options.piiLoggingEnabled, piiLoggingEnabled = _c === void 0 ? false : _c;\r\n        this.localCallback = localCallback;\r\n        this.correlationId = correlationId;\r\n        this.level = level;\r\n        this.piiLoggingEnabled = piiLoggingEnabled;\r\n    }\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.logMessage = function (logLevel, logMessage, containsPii) {\r\n        if ((logLevel > this.level) || (!this.piiLoggingEnabled && containsPii)) {\r\n            return;\r\n        }\r\n        var timestamp = new Date().toUTCString();\r\n        var log;\r\n        if (!StringUtils.isEmpty(this.correlationId)) {\r\n            log = timestamp + ":" + this.correlationId + "-" + libraryVersion() + "-" + LogLevel[logLevel] + " " + logMessage;\r\n        }\r\n        else {\r\n            log = timestamp + ":" + libraryVersion() + "-" + LogLevel[logLevel] + " " + logMessage;\r\n        }\r\n        this.executeCallback(logLevel, log, containsPii);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.executeCallback = function (level, message, containsPii) {\r\n        if (this.localCallback) {\r\n            this.localCallback(level, message, containsPii);\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.error = function (message) {\r\n        this.logMessage(LogLevel.Error, message, false);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.errorPii = function (message) {\r\n        this.logMessage(LogLevel.Error, message, true);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.warning = function (message) {\r\n        this.logMessage(LogLevel.Warning, message, false);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.warningPii = function (message) {\r\n        this.logMessage(LogLevel.Warning, message, true);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.info = function (message) {\r\n        this.logMessage(LogLevel.Info, message, false);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.infoPii = function (message) {\r\n        this.logMessage(LogLevel.Info, message, true);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.verbose = function (message) {\r\n        this.logMessage(LogLevel.Verbose, message, false);\r\n    };\r\n    /**\r\n     * @hidden\r\n     */\r\n    Logger.prototype.verbosePii = function (message) {\r\n        this.logMessage(LogLevel.Verbose, message, true);\r\n    };\r\n    Logger.prototype.isPiiLoggingEnabled = function () {\r\n        return this.piiLoggingEnabled;\r\n    };\r\n    return Logger;\r\n}());\r\n\r\n//# sourceMappingURL=Logger.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/Configuration.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n/**\r\n * Defaults for the Configuration Options\r\n */\r\nvar FRAME_TIMEOUT = 6000;\r\nvar OFFSET = 300;\r\nvar NAVIGATE_FRAME_WAIT = 500;\r\nvar DEFAULT_AUTH_OPTIONS = {\r\n    clientId: "",\r\n    authority: null,\r\n    validateAuthority: true,\r\n    redirectUri: function () { return UrlUtils_UrlUtils.getDefaultRedirectUri(); },\r\n    postLogoutRedirectUri: function () { return UrlUtils_UrlUtils.getDefaultRedirectUri(); },\r\n    navigateToLoginRequestUrl: true\r\n};\r\nvar DEFAULT_CACHE_OPTIONS = {\r\n    cacheLocation: "sessionStorage",\r\n    storeAuthStateInCookie: false\r\n};\r\nvar DEFAULT_SYSTEM_OPTIONS = {\r\n    logger: new Logger_Logger(null),\r\n    loadFrameTimeout: FRAME_TIMEOUT,\r\n    tokenRenewalOffsetSeconds: OFFSET,\r\n    navigateFrameWait: NAVIGATE_FRAME_WAIT\r\n};\r\nvar DEFAULT_FRAMEWORK_OPTIONS = {\r\n    isAngular: false,\r\n    unprotectedResources: new Array(),\r\n    protectedResourceMap: new Map()\r\n};\r\n/**\r\n * MSAL function that sets the default options when not explicitly configured from app developer\r\n *\r\n * @param TAuthOptions\r\n * @param TCacheOptions\r\n * @param TSystemOptions\r\n * @param TFrameworkOptions\r\n *\r\n * @returns TConfiguration object\r\n */\r\nfunction buildConfiguration(_a) {\r\n    var auth = _a.auth, _b = _a.cache, cache = _b === void 0 ? {} : _b, _c = _a.system, system = _c === void 0 ? {} : _c, _d = _a.framework, framework = _d === void 0 ? {} : _d;\r\n    var overlayedConfig = {\r\n        auth: __assign({}, DEFAULT_AUTH_OPTIONS, auth),\r\n        cache: __assign({}, DEFAULT_CACHE_OPTIONS, cache),\r\n        system: __assign({}, DEFAULT_SYSTEM_OPTIONS, system),\r\n        framework: __assign({}, DEFAULT_FRAMEWORK_OPTIONS, framework)\r\n    };\r\n    return overlayedConfig;\r\n}\r\n//# sourceMappingURL=Configuration.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/error/ServerError.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\nvar ServerErrorMessage = {\r\n    serverUnavailable: {\r\n        code: "server_unavailable",\r\n        desc: "Server is temporarily unavailable."\r\n    },\r\n    unknownServerError: {\r\n        code: "unknown_server_error"\r\n    },\r\n};\r\n/**\r\n * Error thrown when there is an error with the server code, for example, unavailability.\r\n */\r\nvar ServerError_ServerError = /** @class */ (function (_super) {\r\n    __extends(ServerError, _super);\r\n    function ServerError(errorCode, errorMessage) {\r\n        var _this = _super.call(this, errorCode, errorMessage) || this;\r\n        _this.name = "ServerError";\r\n        Object.setPrototypeOf(_this, ServerError.prototype);\r\n        return _this;\r\n    }\r\n    ServerError.createServerUnavailableError = function () {\r\n        return new ServerError(ServerErrorMessage.serverUnavailable.code, ServerErrorMessage.serverUnavailable.desc);\r\n    };\r\n    ServerError.createUnknownServerError = function (errorDesc) {\r\n        return new ServerError(ServerErrorMessage.unknownServerError.code, errorDesc);\r\n    };\r\n    return ServerError;\r\n}(AuthError_AuthError));\r\n\r\n//# sourceMappingURL=ServerError.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/error/InteractionRequiredAuthError.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\nvar InteractionRequiredAuthErrorMessage = {\r\n    interactionRequired: {\r\n        code: "interaction_required"\r\n    },\r\n    consentRequired: {\r\n        code: "consent_required"\r\n    },\r\n    loginRequired: {\r\n        code: "login_required"\r\n    },\r\n};\r\n/**\r\n * Error thrown when the user is required to perform an interactive token request.\r\n */\r\nvar InteractionRequiredAuthError_InteractionRequiredAuthError = /** @class */ (function (_super) {\r\n    __extends(InteractionRequiredAuthError, _super);\r\n    function InteractionRequiredAuthError(errorCode, errorMessage) {\r\n        var _this = _super.call(this, errorCode, errorMessage) || this;\r\n        _this.name = "InteractionRequiredAuthError";\r\n        Object.setPrototypeOf(_this, InteractionRequiredAuthError.prototype);\r\n        return _this;\r\n    }\r\n    InteractionRequiredAuthError.isInteractionRequiredError = function (errorString) {\r\n        var interactionRequiredCodes = [\r\n            InteractionRequiredAuthErrorMessage.interactionRequired.code,\r\n            InteractionRequiredAuthErrorMessage.consentRequired.code,\r\n            InteractionRequiredAuthErrorMessage.loginRequired.code\r\n        ];\r\n        return errorString && interactionRequiredCodes.indexOf(errorString) > -1;\r\n    };\r\n    InteractionRequiredAuthError.createLoginRequiredAuthError = function (errorDesc) {\r\n        return new InteractionRequiredAuthError(InteractionRequiredAuthErrorMessage.loginRequired.code, errorDesc);\r\n    };\r\n    InteractionRequiredAuthError.createInteractionRequiredAuthError = function (errorDesc) {\r\n        return new InteractionRequiredAuthError(InteractionRequiredAuthErrorMessage.interactionRequired.code, errorDesc);\r\n    };\r\n    InteractionRequiredAuthError.createConsentRequiredAuthError = function (errorDesc) {\r\n        return new InteractionRequiredAuthError(InteractionRequiredAuthErrorMessage.consentRequired.code, errorDesc);\r\n    };\r\n    return InteractionRequiredAuthError;\r\n}(ServerError_ServerError));\r\n\r\n//# sourceMappingURL=InteractionRequiredAuthError.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/AuthResponse.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\nfunction buildResponseStateOnly(state) {\r\n    return {\r\n        uniqueId: "",\r\n        tenantId: "",\r\n        tokenType: "",\r\n        idToken: null,\r\n        idTokenClaims: null,\r\n        accessToken: "",\r\n        scopes: null,\r\n        expiresOn: null,\r\n        account: null,\r\n        accountState: state\r\n    };\r\n}\r\n//# sourceMappingURL=AuthResponse.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/telemetry/TelemetryConstants.js\nvar EVENT_NAME_PREFIX = "msal.";\r\nvar EVENT_NAME_KEY = "event_name";\r\nvar START_TIME_KEY = "start_time";\r\nvar ELAPSED_TIME_KEY = "elapsed_time";\r\nvar TELEMETRY_BLOB_EVENT_NAMES = {\r\n    MsalCorrelationIdConstStrKey: "Microsoft.MSAL.correlation_id",\r\n    ApiTelemIdConstStrKey: "msal.api_telem_id",\r\n    ApiIdConstStrKey: "msal.api_id",\r\n    BrokerAppConstStrKey: "Microsoft_MSAL_broker_app",\r\n    CacheEventCountConstStrKey: "Microsoft_MSAL_cache_event_count",\r\n    HttpEventCountTelemetryBatchKey: "Microsoft_MSAL_http_event_count",\r\n    IdpConstStrKey: "Microsoft_MSAL_idp",\r\n    IsSilentTelemetryBatchKey: "",\r\n    IsSuccessfulConstStrKey: "Microsoft_MSAL_is_successful",\r\n    ResponseTimeConstStrKey: "Microsoft_MSAL_response_time",\r\n    TenantIdConstStrKey: "Microsoft_MSAL_tenant_id",\r\n    UiEventCountTelemetryBatchKey: "Microsoft_MSAL_ui_event_count"\r\n};\r\n// This is used to replace the real tenant in telemetry info\r\nvar TENANT_PLACEHOLDER = "<tenant>";\r\n//# sourceMappingURL=TelemetryConstants.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/telemetry/TelemetryUtils.js\n\r\n\r\n\r\n\r\n\r\nvar scrubTenantFromUri = function (uri) {\r\n    var url = UrlUtils_UrlUtils.GetUrlComponents(uri);\r\n    // validate trusted host\r\n    if (!AADTrustedHostList[url.HostNameAndPort.toLocaleLowerCase()]) {\r\n        // Should this return null or what was passed?\r\n        return null;\r\n    }\r\n    var pathParams = url.PathSegments;\r\n    if (pathParams && pathParams.length >= 2) {\r\n        var tenantPosition = pathParams[1] === B2cAuthority_B2cAuthority.B2C_PREFIX ? 2 : 1;\r\n        if (tenantPosition < pathParams.length) {\r\n            pathParams[tenantPosition] = TENANT_PLACEHOLDER;\r\n        }\r\n    }\r\n    return url.Protocol + "//" + url.HostNameAndPort + "/" + pathParams.join("/");\r\n};\r\nvar hashPersonalIdentifier = function (valueToHash) {\r\n    // TODO sha256 this\r\n    // Current test runner is being funny with node libs that are webpacked anyway\r\n    // need a different solution\r\n    return CryptoUtils.base64Encode(valueToHash);\r\n};\r\nvar prependEventNamePrefix = function (suffix) { return "" + EVENT_NAME_PREFIX + (suffix || ""); };\r\n//# sourceMappingURL=TelemetryUtils.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/telemetry/TelemetryEvent.js\n\r\n\r\n\r\n\r\n\r\nvar TelemetryEvent_TelemetryEvent = /** @class */ (function () {\r\n    function TelemetryEvent(eventName, correlationId) {\r\n        var _a;\r\n        this.startTimestamp = Date.now();\r\n        this.eventId = CryptoUtils.createNewGuid();\r\n        this.event = (_a = {},\r\n            _a[prependEventNamePrefix(EVENT_NAME_KEY)] = eventName,\r\n            _a[prependEventNamePrefix(START_TIME_KEY)] = this.startTimestamp,\r\n            _a[prependEventNamePrefix(ELAPSED_TIME_KEY)] = -1,\r\n            _a["" + TELEMETRY_BLOB_EVENT_NAMES.MsalCorrelationIdConstStrKey] = correlationId,\r\n            _a);\r\n    }\r\n    TelemetryEvent.prototype.setElapsedTime = function (time) {\r\n        this.event[prependEventNamePrefix(ELAPSED_TIME_KEY)] = time;\r\n    };\r\n    TelemetryEvent.prototype.stop = function () {\r\n        // Set duration of event\r\n        this.setElapsedTime(+Date.now() - +this.startTimestamp);\r\n    };\r\n    Object.defineProperty(TelemetryEvent.prototype, "telemetryCorrelationId", {\r\n        get: function () {\r\n            return this.event["" + TELEMETRY_BLOB_EVENT_NAMES.MsalCorrelationIdConstStrKey];\r\n        },\r\n        set: function (value) {\r\n            this.event["" + TELEMETRY_BLOB_EVENT_NAMES.MsalCorrelationIdConstStrKey] = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(TelemetryEvent.prototype, "eventName", {\r\n        get: function () {\r\n            return this.event[prependEventNamePrefix(EVENT_NAME_KEY)];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    TelemetryEvent.prototype.get = function () {\r\n        return __assign({}, this.event, { eventId: this.eventId });\r\n    };\r\n    return TelemetryEvent;\r\n}());\r\n/* harmony default export */ var telemetry_TelemetryEvent = (TelemetryEvent_TelemetryEvent);\r\n//# sourceMappingURL=TelemetryEvent.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/telemetry/DefaultEvent.js\n\r\n\r\n\r\n\r\nvar DefaultEvent_DefaultEvent = /** @class */ (function (_super) {\r\n    __extends(DefaultEvent, _super);\r\n    // TODO Platform Type\r\n    function DefaultEvent(platform, correlationId, clientId, eventCount) {\r\n        var _this = _super.call(this, prependEventNamePrefix("default_event"), correlationId) || this;\r\n        _this.event[prependEventNamePrefix("client_id")] = clientId;\r\n        _this.event[prependEventNamePrefix("sdk_plaform")] = platform.sdk;\r\n        _this.event[prependEventNamePrefix("sdk_version")] = platform.sdkVersion;\r\n        _this.event[prependEventNamePrefix("application_name")] = platform.applicationName;\r\n        _this.event[prependEventNamePrefix("application_version")] = platform.applicationVersion;\r\n        _this.event["" + TELEMETRY_BLOB_EVENT_NAMES.UiEventCountTelemetryBatchKey] = _this.getEventCount(prependEventNamePrefix("ui_event"), eventCount);\r\n        _this.event["" + TELEMETRY_BLOB_EVENT_NAMES.HttpEventCountTelemetryBatchKey] = _this.getEventCount(prependEventNamePrefix("http_event"), eventCount);\r\n        _this.event["" + TELEMETRY_BLOB_EVENT_NAMES.CacheEventCountConstStrKey] = _this.getEventCount(prependEventNamePrefix("cache_event"), eventCount);\r\n        return _this;\r\n        /// Device id?\r\n    }\r\n    DefaultEvent.prototype.getEventCount = function (eventName, eventCount) {\r\n        if (!eventCount[eventName]) {\r\n            return 0;\r\n        }\r\n        return eventCount[eventName];\r\n    };\r\n    return DefaultEvent;\r\n}(telemetry_TelemetryEvent));\r\n/* harmony default export */ var telemetry_DefaultEvent = (DefaultEvent_DefaultEvent);\r\n//# sourceMappingURL=DefaultEvent.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/telemetry/TelemetryManager.js\n\r\n// for use in cache events\r\nvar MSAL_CACHE_EVENT_VALUE_PREFIX = "msal.token";\r\nvar MSAL_CACHE_EVENT_NAME = "msal.cache_event";\r\nvar createEventKey = function (event) { return (event.telemetryCorrelationId + "-" + event.eventId + "-" + event.eventName); };\r\nvar TelemetryManager_TelemetryManager = /** @class */ (function () {\r\n    function TelemetryManager(config, telemetryEmitter) {\r\n        // correlation Id to list of events\r\n        this.completedEvents = {};\r\n        // event key to event\r\n        this.inProgressEvents = {};\r\n        // correlation id to map of eventname to count\r\n        this.eventCountByCorrelationId = {};\r\n        //Implement after API EVENT\r\n        this.onlySendFailureTelemetry = false;\r\n        // TODO THROW if bad options\r\n        this.telemetryPlatform = config.platform;\r\n        this.clientId = config.clientId;\r\n        this.onlySendFailureTelemetry = config.onlySendFailureTelemetry;\r\n        // TODO, when i get to wiring this through, think about what it means if\r\n        // a developer does not implement telem at all, we still instrument, but telemetryEmitter can be\r\n        // optional?\r\n        this.telemetryEmitter = telemetryEmitter;\r\n    }\r\n    TelemetryManager.prototype.startEvent = function (event) {\r\n        if (!this.telemetryEmitter) {\r\n            return;\r\n        }\r\n        var eventKey = createEventKey(event);\r\n        this.inProgressEvents[eventKey] = event;\r\n    };\r\n    TelemetryManager.prototype.stopEvent = function (event) {\r\n        var eventKey = createEventKey(event);\r\n        if (!this.telemetryEmitter || !this.inProgressEvents[eventKey]) {\r\n            return;\r\n        }\r\n        event.stop();\r\n        this.incrementEventCount(event);\r\n        var completedEvents = this.completedEvents[event.telemetryCorrelationId];\r\n        this.completedEvents[event.telemetryCorrelationId] = (completedEvents || []).concat([event]);\r\n        delete this.inProgressEvents[eventKey];\r\n    };\r\n    TelemetryManager.prototype.flush = function (correlationId) {\r\n        var _this = this;\r\n        // If there is only unfinished events should this still return them?\r\n        if (!this.telemetryEmitter || !this.completedEvents[correlationId]) {\r\n            return;\r\n        }\r\n        var orphanedEvents = this.getOrphanedEvents(correlationId);\r\n        orphanedEvents.forEach(function (event) { return _this.incrementEventCount(event); });\r\n        var eventsToFlush = this.completedEvents[correlationId].concat(orphanedEvents);\r\n        delete this.completedEvents[correlationId];\r\n        var eventCountsToFlush = this.eventCountByCorrelationId[correlationId];\r\n        delete this.eventCountByCorrelationId[correlationId];\r\n        // TODO add funcitonality for onlyFlushFailures after implementing api event? ??\r\n        if (!eventsToFlush || !eventsToFlush.length) {\r\n            return;\r\n        }\r\n        var defaultEvent = new telemetry_DefaultEvent(this.telemetryPlatform, correlationId, this.clientId, eventCountsToFlush);\r\n        var eventsWithDefaultEvent = eventsToFlush.concat([defaultEvent]);\r\n        this.telemetryEmitter(eventsWithDefaultEvent.map(function (e) { return e.get(); }));\r\n    };\r\n    TelemetryManager.prototype.incrementEventCount = function (event) {\r\n        var _a;\r\n        // TODO, name cache event different?\r\n        // if type is cache event, change name\r\n        var eventName = event.eventName;\r\n        var eventCount = this.eventCountByCorrelationId[event.telemetryCorrelationId];\r\n        if (!eventCount) {\r\n            this.eventCountByCorrelationId[event.telemetryCorrelationId] = (_a = {},\r\n                _a[eventName] = 1,\r\n                _a);\r\n        }\r\n        else {\r\n            eventCount[eventName] = eventCount[eventName] ? eventCount[eventName] + 1 : 1;\r\n        }\r\n    };\r\n    TelemetryManager.prototype.getOrphanedEvents = function (correlationId) {\r\n        var _this = this;\r\n        return Object.keys(this.inProgressEvents)\r\n            .reduce(function (memo, eventKey) {\r\n            if (eventKey.indexOf(correlationId) !== -1) {\r\n                var event_1 = _this.inProgressEvents[eventKey];\r\n                delete _this.inProgressEvents[eventKey];\r\n                return memo.concat([event_1]);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    };\r\n    return TelemetryManager;\r\n}());\r\n/* harmony default export */ var telemetry_TelemetryManager = (TelemetryManager_TelemetryManager);\r\n//# sourceMappingURL=TelemetryManager.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/UserAgentApplication.js\n// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT License.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// default authority\r\nvar DEFAULT_AUTHORITY = "https://login.microsoftonline.com/common";\r\n/**\r\n * @hidden\r\n * @ignore\r\n * response_type from OpenIDConnect\r\n * References: https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html & https://tools.ietf.org/html/rfc6749#section-4.2.1\r\n * Since we support only implicit flow in this library, we restrict the response_type support to only \'token\' and \'id_token\'\r\n *\r\n */\r\nvar ResponseTypes = {\r\n    id_token: "id_token",\r\n    token: "token",\r\n    id_token_token: "id_token token"\r\n};\r\n/**\r\n * @hidden\r\n * @ignore\r\n * A wrapper to handle the token response/error within the iFrame always\r\n *\r\n * @param target\r\n * @param propertyKey\r\n * @param descriptor\r\n */\r\nvar resolveTokenOnlyIfOutOfIframe = function (target, propertyKey, descriptor) {\r\n    var tokenAcquisitionMethod = descriptor.value;\r\n    descriptor.value = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        return this.isInIframe()\r\n            ? new Promise(function () {\r\n                return;\r\n            })\r\n            : tokenAcquisitionMethod.apply(this, args);\r\n    };\r\n    return descriptor;\r\n};\r\n/**\r\n * UserAgentApplication class\r\n *\r\n * Object Instance that the developer can use to make loginXX OR acquireTokenXX functions\r\n */\r\nvar UserAgentApplication_UserAgentApplication = /** @class */ (function () {\r\n    /**\r\n     * @constructor\r\n     * Constructor for the UserAgentApplication used to instantiate the UserAgentApplication object\r\n     *\r\n     * Important attributes in the Configuration object for auth are:\r\n     * - clientID: the application ID of your application.\r\n     * You can obtain one by registering your application with our Application registration portal : https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredAppsPreview\r\n     * - authority: the authority URL for your application.\r\n     *\r\n     * In Azure AD, authority is a URL indicating the Azure active directory that MSAL uses to obtain tokens.\r\n     * It is of the form https://login.microsoftonline.com/&lt;Enter_the_Tenant_Info_Here&gt;.\r\n     * If your application supports Accounts in one organizational directory, replace "Enter_the_Tenant_Info_Here" value with the Tenant Id or Tenant name (for example, contoso.microsoft.com).\r\n     * If your application supports Accounts in any organizational directory, replace "Enter_the_Tenant_Info_Here" value with organizations.\r\n     * If your application supports Accounts in any organizational directory and personal Microsoft accounts, replace "Enter_the_Tenant_Info_Here" value with common.\r\n     * To restrict support to Personal Microsoft accounts only, replace "Enter_the_Tenant_Info_Here" value with consumers.\r\n     *\r\n     *\r\n     * In Azure B2C, authority is of the form https://&lt;instance&gt;/tfp/&lt;tenant&gt;/&lt;policyName&gt;/\r\n  \r\n     * @param {@link (Configuration:type)} configuration object for the MSAL UserAgentApplication instance\r\n     */\r\n    function UserAgentApplication(configuration) {\r\n        // callbacks for token/error\r\n        this.authResponseCallback = null;\r\n        this.tokenReceivedCallback = null;\r\n        this.errorReceivedCallback = null;\r\n        // Set the Configuration\r\n        this.config = buildConfiguration(configuration);\r\n        // Set the callback boolean\r\n        this.redirectCallbacksSet = false;\r\n        this.logger = this.config.system.logger;\r\n        this.clientId = this.config.auth.clientId;\r\n        this.inCookie = this.config.cache.storeAuthStateInCookie;\r\n        this.telemetryManager = this.getTelemetryManagerFromConfig(this.config.system.telemetry, this.clientId);\r\n        // if no authority is passed, set the default: "https://login.microsoftonline.com/common"\r\n        this.authority = this.config.auth.authority || DEFAULT_AUTHORITY;\r\n        // track login and acquireToken in progress\r\n        this.loginInProgress = false;\r\n        this.acquireTokenInProgress = false;\r\n        // cache keys msal - typescript throws an error if any value other than "localStorage" or "sessionStorage" is passed\r\n        try {\r\n            this.cacheStorage = new Storage_Storage(this.config.cache.cacheLocation);\r\n        }\r\n        catch (e) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createInvalidCacheLocationConfigError(this.config.cache.cacheLocation);\r\n        }\r\n        // Initialize window handling code\r\n        window.openedWindows = [];\r\n        window.activeRenewals = {};\r\n        window.renewStates = [];\r\n        window.callbackMappedToRenewStates = {};\r\n        window.promiseMappedToRenewStates = {};\r\n        window.msal = this;\r\n        var urlHash = window.location.hash;\r\n        var urlContainsHash = this.urlContainsHash(urlHash);\r\n        // On the server 302 - Redirect, handle this\r\n        if (!this.config.framework.isAngular) {\r\n            if (urlContainsHash) {\r\n                this.handleAuthenticationResponse(urlHash);\r\n            }\r\n        }\r\n    }\r\n    Object.defineProperty(UserAgentApplication.prototype, "authority", {\r\n        /**\r\n         * Method to manage the authority URL.\r\n         *\r\n         * @returns {string} authority\r\n         */\r\n        get: function () {\r\n            return this.authorityInstance.CanonicalAuthority;\r\n        },\r\n        /**\r\n         * setter for the authority URL\r\n         * @param {string} authority\r\n         */\r\n        // If the developer passes an authority, create an instance\r\n        set: function (val) {\r\n            this.authorityInstance = AuthorityFactory_AuthorityFactory.CreateInstance(val, this.config.auth.validateAuthority);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Get the current authority instance from the MSAL configuration object\r\n     *\r\n     * @returns {@link Authority} authority instance\r\n     */\r\n    UserAgentApplication.prototype.getAuthorityInstance = function () {\r\n        return this.authorityInstance;\r\n    };\r\n    UserAgentApplication.prototype.handleRedirectCallback = function (authOrTokenCallback, errorReceivedCallback) {\r\n        if (!authOrTokenCallback) {\r\n            this.redirectCallbacksSet = false;\r\n            throw ClientConfigurationError_ClientConfigurationError.createInvalidCallbackObjectError(authOrTokenCallback);\r\n        }\r\n        // Set callbacks\r\n        if (errorReceivedCallback) {\r\n            this.tokenReceivedCallback = authOrTokenCallback;\r\n            this.errorReceivedCallback = errorReceivedCallback;\r\n            this.logger.warning("This overload for callback is deprecated - please change the format of the callbacks to a single callback as shown: (err: AuthError, response: AuthResponse).");\r\n        }\r\n        else {\r\n            this.authResponseCallback = authOrTokenCallback;\r\n        }\r\n        this.redirectCallbacksSet = true;\r\n        // On the server 302 - Redirect, handle this\r\n        if (!this.config.framework.isAngular) {\r\n            var cachedHash = this.cacheStorage.getItem(Constants.urlHash);\r\n            if (cachedHash) {\r\n                this.processCallBack(cachedHash, null);\r\n            }\r\n        }\r\n    };\r\n    UserAgentApplication.prototype.authResponseHandler = function (interactionType, response, resolve) {\r\n        if (interactionType === Constants.interactionTypeRedirect) {\r\n            if (this.errorReceivedCallback) {\r\n                this.tokenReceivedCallback(response);\r\n            }\r\n            else if (this.authResponseCallback) {\r\n                this.authResponseCallback(null, response);\r\n            }\r\n        }\r\n        else if (interactionType === Constants.interactionTypePopup) {\r\n            resolve(response);\r\n        }\r\n        else {\r\n            throw ClientAuthError_ClientAuthError.createInvalidInteractionTypeError();\r\n        }\r\n    };\r\n    UserAgentApplication.prototype.authErrorHandler = function (interactionType, authErr, response, reject) {\r\n        if (interactionType === Constants.interactionTypeRedirect) {\r\n            if (this.errorReceivedCallback) {\r\n                this.errorReceivedCallback(authErr, response.accountState);\r\n            }\r\n            else {\r\n                this.authResponseCallback(authErr, response);\r\n            }\r\n        }\r\n        else if (interactionType === Constants.interactionTypePopup) {\r\n            reject(authErr);\r\n        }\r\n        else {\r\n            throw ClientAuthError_ClientAuthError.createInvalidInteractionTypeError();\r\n        }\r\n    };\r\n    //#endregion\r\n    /**\r\n     * Use when initiating the login process by redirecting the user\'s browser to the authorization endpoint.\r\n     * @param {@link (AuthenticationParameters:type)}\r\n     */\r\n    UserAgentApplication.prototype.loginRedirect = function (request) {\r\n        // Throw error if callbacks are not set before redirect\r\n        if (!this.redirectCallbacksSet) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createRedirectCallbacksNotSetError();\r\n        }\r\n        this.acquireTokenInteractive(Constants.interactionTypeRedirect, true, request);\r\n    };\r\n    /**\r\n     * Use when you want to obtain an access_token for your API by redirecting the user\'s browser window to the authorization endpoint.\r\n     * @param {@link (AuthenticationParameters:type)}\r\n     *\r\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\r\n     */\r\n    UserAgentApplication.prototype.acquireTokenRedirect = function (request) {\r\n        if (!request) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createEmptyRequestError();\r\n        }\r\n        // Throw error if callbacks are not set before redirect\r\n        if (!this.redirectCallbacksSet) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createRedirectCallbacksNotSetError();\r\n        }\r\n        this.acquireTokenInteractive(Constants.interactionTypeRedirect, false, request);\r\n    };\r\n    /**\r\n     * Use when initiating the login process via opening a popup window in the user\'s browser\r\n     *\r\n     * @param {@link (AuthenticationParameters:type)}\r\n     *\r\n     * @returns {Promise.<AuthResponse>} - a promise that is fulfilled when this function has completed, or rejected if an error was raised. Returns the {@link AuthResponse} object\r\n     */\r\n    UserAgentApplication.prototype.loginPopup = function (request) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.acquireTokenInteractive(Constants.interactionTypePopup, true, request, resolve, reject);\r\n        });\r\n    };\r\n    /**\r\n     * Use when you want to obtain an access_token for your API via opening a popup window in the user\'s browser\r\n     * @param {@link AuthenticationParameters}\r\n     *\r\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\r\n     * @returns {Promise.<AuthResponse>} - a promise that is fulfilled when this function has completed, or rejected if an error was raised. Returns the {@link AuthResponse} object\r\n     */\r\n    UserAgentApplication.prototype.acquireTokenPopup = function (request) {\r\n        var _this = this;\r\n        if (!request) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createEmptyRequestError();\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            _this.acquireTokenInteractive(Constants.interactionTypePopup, false, request, resolve, reject);\r\n        });\r\n    };\r\n    //#region Acquire Token\r\n    /**\r\n     * Use when initiating the login process or when you want to obtain an access_token for your API,\r\n     * either by redirecting the user\'s browser window to the authorization endpoint or via opening a popup window in the user\'s browser.\r\n     * @param {@link (AuthenticationParameters:type)}\r\n     *\r\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\r\n     */\r\n    UserAgentApplication.prototype.acquireTokenInteractive = function (interactionType, isLoginCall, request, resolve, reject) {\r\n        var _this = this;\r\n        // If already in progress, do not proceed\r\n        if (this.loginInProgress || this.acquireTokenInProgress) {\r\n            var thrownError = this.loginInProgress ? ClientAuthError_ClientAuthError.createLoginInProgressError() : ClientAuthError_ClientAuthError.createAcquireTokenInProgressError();\r\n            var stateOnlyResponse = buildResponseStateOnly(this.getAccountState(request && request.state));\r\n            this.authErrorHandler(interactionType, thrownError, stateOnlyResponse, reject);\r\n            return;\r\n        }\r\n        // if extraScopesToConsent is passed in loginCall, append them to the login request\r\n        var scopes = isLoginCall ? this.appendScopes(request) : request.scopes;\r\n        // Validate and filter scopes (the validate function will throw if validation fails)\r\n        this.validateInputScope(scopes, !isLoginCall);\r\n        // Get the account object if a session exists\r\n        var account = (request && request.account && !isLoginCall) ? request.account : this.getAccount();\r\n        // If no session exists, prompt the user to login.\r\n        if (!account && !ServerRequestParameters_ServerRequestParameters.isSSOParam(request)) {\r\n            if (isLoginCall) {\r\n                // extract ADAL id_token if exists\r\n                var adalIdToken = this.extractADALIdToken();\r\n                // silent login if ADAL id_token is retrieved successfully - SSO\r\n                if (adalIdToken && !scopes) {\r\n                    this.logger.info("ADAL\'s idToken exists. Extracting login information from ADAL\'s idToken ");\r\n                    var tokenRequest = this.buildIDTokenRequest(request);\r\n                    this.silentLogin = true;\r\n                    this.acquireTokenSilent(tokenRequest).then(function (response) {\r\n                        _this.silentLogin = false;\r\n                        _this.logger.info("Unified cache call is successful");\r\n                        _this.authResponseHandler(interactionType, response, resolve);\r\n                        return;\r\n                    }, function (error) {\r\n                        _this.silentLogin = false;\r\n                        _this.logger.error("Error occurred during unified cache ATS: " + error);\r\n                        // proceed to login since ATS failed\r\n                        _this.acquireTokenHelper(null, interactionType, isLoginCall, request, scopes, resolve, reject);\r\n                    });\r\n                }\r\n                // No ADAL token found, proceed to login\r\n                else {\r\n                    this.acquireTokenHelper(null, interactionType, isLoginCall, request, scopes, resolve, reject);\r\n                }\r\n            }\r\n            // AcquireToken call, but no account or context given, so throw error\r\n            else {\r\n                this.logger.info("User login is required");\r\n                throw ClientAuthError_ClientAuthError.createUserLoginRequiredError();\r\n            }\r\n        }\r\n        // User session exists\r\n        else {\r\n            this.acquireTokenHelper(account, interactionType, isLoginCall, request, scopes, resolve, reject);\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     * Helper function to acquireToken\r\n     *\r\n     */\r\n    UserAgentApplication.prototype.acquireTokenHelper = function (account, interactionType, isLoginCall, request, scopes, resolve, reject) {\r\n        var _this = this;\r\n        // Track the acquireToken progress\r\n        if (isLoginCall) {\r\n            this.loginInProgress = true;\r\n        }\r\n        else {\r\n            this.acquireTokenInProgress = true;\r\n        }\r\n        var scope = scopes ? scopes.join(" ").toLowerCase() : this.clientId.toLowerCase();\r\n        var serverAuthenticationRequest;\r\n        var acquireTokenAuthority = (!isLoginCall && request && request.authority) ? AuthorityFactory_AuthorityFactory.CreateInstance(request.authority, this.config.auth.validateAuthority) : this.authorityInstance;\r\n        var popUpWindow;\r\n        if (interactionType === Constants.interactionTypePopup) {\r\n            // Generate a popup window\r\n            popUpWindow = this.openWindow("about:blank", "_blank", 1, this, resolve, reject);\r\n            if (!popUpWindow) {\r\n                // We pass reject in openWindow, we reject there during an error\r\n                return;\r\n            }\r\n        }\r\n        acquireTokenAuthority.resolveEndpointsAsync().then(function () {\r\n            // On Fulfillment\r\n            var responseType = isLoginCall ? ResponseTypes.id_token : _this.getTokenType(account, scopes, false);\r\n            var loginStartPage;\r\n            if (isLoginCall) {\r\n                // if the user sets the login start page - angular only??\r\n                loginStartPage = _this.cacheStorage.getItem(Constants.angularLoginRequest);\r\n                if (!loginStartPage || loginStartPage === "") {\r\n                    loginStartPage = window.location.href;\r\n                }\r\n                else {\r\n                    _this.cacheStorage.setItem(Constants.angularLoginRequest, "");\r\n                }\r\n            }\r\n            serverAuthenticationRequest = new ServerRequestParameters_ServerRequestParameters(acquireTokenAuthority, _this.clientId, scopes, responseType, _this.getRedirectUri(), request && request.state);\r\n            _this.updateCacheEntries(serverAuthenticationRequest, account, loginStartPage);\r\n            // populate QueryParameters (sid/login_hint/domain_hint) and any other extraQueryParameters set by the developer\r\n            serverAuthenticationRequest.populateQueryParams(account, request);\r\n            // Construct urlNavigate\r\n            var urlNavigate = UrlUtils_UrlUtils.createNavigateUrl(serverAuthenticationRequest) + Constants.response_mode_fragment;\r\n            // set state in cache\r\n            if (interactionType === Constants.interactionTypeRedirect) {\r\n                if (!isLoginCall) {\r\n                    _this.cacheStorage.setItem(Constants.stateAcquireToken, serverAuthenticationRequest.state, _this.inCookie);\r\n                }\r\n            }\r\n            else if (interactionType === Constants.interactionTypePopup) {\r\n                window.renewStates.push(serverAuthenticationRequest.state);\r\n                window.requestType = isLoginCall ? Constants.login : Constants.renewToken;\r\n                // Register callback to capture results from server\r\n                _this.registerCallback(serverAuthenticationRequest.state, scope, resolve, reject);\r\n            }\r\n            else {\r\n                throw ClientAuthError_ClientAuthError.createInvalidInteractionTypeError();\r\n            }\r\n            // prompt user for interaction\r\n            _this.navigateWindow(urlNavigate, popUpWindow);\r\n        }).catch(function (err) {\r\n            _this.logger.warning("could not resolve endpoints");\r\n            _this.authErrorHandler(interactionType, ClientAuthError_ClientAuthError.createEndpointResolutionError(err.toString), buildResponseStateOnly(request.state), reject);\r\n            if (popUpWindow) {\r\n                popUpWindow.close();\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Use this function to obtain a token before every call to the API / resource provider\r\n     *\r\n     * MSAL return\'s a cached token when available\r\n     * Or it send\'s a request to the STS to obtain a new token using a hidden iframe.\r\n     *\r\n     * @param {@link AuthenticationParameters}\r\n     *\r\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\r\n     * @returns {Promise.<AuthResponse>} - a promise that is fulfilled when this function has completed, or rejected if an error was raised. Returns the {@link AuthResponse} object\r\n     *\r\n     */\r\n    UserAgentApplication.prototype.acquireTokenSilent = function (request) {\r\n        var _this = this;\r\n        if (!request) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createEmptyRequestError();\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            // Validate and filter scopes (the validate function will throw if validation fails)\r\n            _this.validateInputScope(request.scopes, true);\r\n            var scope = request.scopes.join(" ").toLowerCase();\r\n            // if the developer passes an account, give that account the priority\r\n            var account = request.account || _this.getAccount();\r\n            // extract if there is an adalIdToken stashed in the cache\r\n            var adalIdToken = _this.cacheStorage.getItem(Constants.adalIdToken);\r\n            //if there is no account logged in and no login_hint/sid is passed in the request\r\n            if (!account && !(request.sid || request.loginHint) && StringUtils.isEmpty(adalIdToken)) {\r\n                _this.logger.info("User login is required");\r\n                return reject(ClientAuthError_ClientAuthError.createUserLoginRequiredError());\r\n            }\r\n            var responseType = _this.getTokenType(account, request.scopes, true);\r\n            var serverAuthenticationRequest = new ServerRequestParameters_ServerRequestParameters(AuthorityFactory_AuthorityFactory.CreateInstance(request.authority, _this.config.auth.validateAuthority), _this.clientId, request.scopes, responseType, _this.getRedirectUri(), request && request.state);\r\n            // populate QueryParameters (sid/login_hint/domain_hint) and any other extraQueryParameters set by the developer\r\n            if (ServerRequestParameters_ServerRequestParameters.isSSOParam(request) || account) {\r\n                serverAuthenticationRequest.populateQueryParams(account, request);\r\n            }\r\n            //if user didn\'t pass login_hint/sid and adal\'s idtoken is present, extract the login_hint from the adalIdToken\r\n            else if (!account && !StringUtils.isEmpty(adalIdToken)) {\r\n                // if adalIdToken exists, extract the SSO info from the same\r\n                var adalIdTokenObject = TokenUtils_TokenUtils.extractIdToken(adalIdToken);\r\n                _this.logger.verbose("ADAL\'s idToken exists. Extracting login information from ADAL\'s idToken ");\r\n                serverAuthenticationRequest.populateQueryParams(account, null, adalIdTokenObject);\r\n            }\r\n            var userContainedClaims = request.claimsRequest || serverAuthenticationRequest.claimsValue;\r\n            var authErr;\r\n            var cacheResultResponse;\r\n            if (!userContainedClaims && !request.forceRefresh) {\r\n                try {\r\n                    cacheResultResponse = _this.getCachedToken(serverAuthenticationRequest, account);\r\n                }\r\n                catch (e) {\r\n                    authErr = e;\r\n                }\r\n            }\r\n            // resolve/reject based on cacheResult\r\n            if (cacheResultResponse) {\r\n                _this.logger.info("Token is already in cache for scope:" + scope);\r\n                resolve(cacheResultResponse);\r\n                return null;\r\n            }\r\n            else if (authErr) {\r\n                _this.logger.infoPii(authErr.errorCode + ":" + authErr.errorMessage);\r\n                reject(authErr);\r\n                return null;\r\n            }\r\n            // else proceed with login\r\n            else {\r\n                var logMessage = void 0;\r\n                if (userContainedClaims) {\r\n                    logMessage = "Skipped cache lookup since claims were given.";\r\n                }\r\n                else if (request.forceRefresh) {\r\n                    logMessage = "Skipped cache lookup since request.forceRefresh option was set to true";\r\n                }\r\n                else {\r\n                    logMessage = "Token is not in cache for scope:" + scope;\r\n                }\r\n                _this.logger.verbose(logMessage);\r\n                // Cache result can return null if cache is empty. In that case, set authority to default value if no authority is passed to the api.\r\n                if (!serverAuthenticationRequest.authorityInstance) {\r\n                    serverAuthenticationRequest.authorityInstance = request.authority ? AuthorityFactory_AuthorityFactory.CreateInstance(request.authority, _this.config.auth.validateAuthority) : _this.authorityInstance;\r\n                }\r\n                // cache miss\r\n                return serverAuthenticationRequest.authorityInstance.resolveEndpointsAsync()\r\n                    .then(function () {\r\n                    // refresh attempt with iframe\r\n                    // Already renewing for this scope, callback when we get the token.\r\n                    if (window.activeRenewals[scope]) {\r\n                        _this.logger.verbose("Renew token for scope: " + scope + " is in progress. Registering callback");\r\n                        // Active renewals contains the state for each renewal.\r\n                        _this.registerCallback(window.activeRenewals[scope], scope, resolve, reject);\r\n                    }\r\n                    else {\r\n                        if (request.scopes && request.scopes.indexOf(_this.clientId) > -1 && request.scopes.length === 1) {\r\n                            // App uses idToken to send to api endpoints\r\n                            // Default scope is tracked as clientId to store this token\r\n                            _this.logger.verbose("renewing idToken");\r\n                            _this.silentLogin = true;\r\n                            _this.renewIdToken(request.scopes, resolve, reject, account, serverAuthenticationRequest);\r\n                        }\r\n                        else {\r\n                            // renew access token\r\n                            _this.logger.verbose("renewing accesstoken");\r\n                            _this.renewToken(request.scopes, resolve, reject, account, serverAuthenticationRequest);\r\n                        }\r\n                    }\r\n                }).catch(function (err) {\r\n                    _this.logger.warning("could not resolve endpoints");\r\n                    reject(ClientAuthError_ClientAuthError.createEndpointResolutionError(err.toString()));\r\n                    return null;\r\n                });\r\n            }\r\n        });\r\n    };\r\n    //#endregion\r\n    //#region Popup Window Creation\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Used to send the user to the redirect_uri after authentication is complete. The user\'s bearer token is attached to the URI fragment as an id_token/access_token field.\r\n     * This function also closes the popup window after redirection.\r\n     *\r\n     * @param urlNavigate\r\n     * @param title\r\n     * @param interval\r\n     * @param instance\r\n     * @param resolve\r\n     * @param reject\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.openWindow = function (urlNavigate, title, interval, instance, resolve, reject) {\r\n        var _this = this;\r\n        // Generate a popup window\r\n        var popupWindow;\r\n        try {\r\n            popupWindow = this.openPopup(urlNavigate, title, Constants.popUpWidth, Constants.popUpHeight);\r\n        }\r\n        catch (e) {\r\n            instance.loginInProgress = false;\r\n            instance.acquireTokenInProgress = false;\r\n            this.logger.info(ClientAuthErrorMessage.popUpWindowError.code + ":" + ClientAuthErrorMessage.popUpWindowError.desc);\r\n            this.cacheStorage.setItem(Constants.msalError, ClientAuthErrorMessage.popUpWindowError.code);\r\n            this.cacheStorage.setItem(Constants.msalErrorDescription, ClientAuthErrorMessage.popUpWindowError.desc);\r\n            if (reject) {\r\n                reject(ClientAuthError_ClientAuthError.createPopupWindowError());\r\n            }\r\n            return null;\r\n        }\r\n        // Push popup window handle onto stack for tracking\r\n        window.openedWindows.push(popupWindow);\r\n        var pollTimer = window.setInterval(function () {\r\n            // If popup closed or login in progress, cancel login\r\n            if (popupWindow && popupWindow.closed && (instance.loginInProgress || instance.acquireTokenInProgress)) {\r\n                if (reject) {\r\n                    reject(ClientAuthError_ClientAuthError.createUserCancelledError());\r\n                }\r\n                window.clearInterval(pollTimer);\r\n                if (_this.config.framework.isAngular) {\r\n                    _this.broadcast("msal:popUpClosed", ClientAuthErrorMessage.userCancelledError.code + Constants.resourceDelimiter + ClientAuthErrorMessage.userCancelledError.desc);\r\n                    return;\r\n                }\r\n                instance.loginInProgress = false;\r\n                instance.acquireTokenInProgress = false;\r\n            }\r\n            try {\r\n                var popUpWindowLocation = popupWindow.location;\r\n                // If the popup hash changes, close the popup window\r\n                if (popUpWindowLocation.href.indexOf(_this.getRedirectUri()) !== -1) {\r\n                    window.clearInterval(pollTimer);\r\n                    instance.loginInProgress = false;\r\n                    instance.acquireTokenInProgress = false;\r\n                    _this.logger.info("Closing popup window");\r\n                    // TODO: Check how this can be extracted for any framework specific code?\r\n                    if (_this.config.framework.isAngular) {\r\n                        _this.broadcast("msal:popUpHashChanged", popUpWindowLocation.hash);\r\n                        for (var i = 0; i < window.openedWindows.length; i++) {\r\n                            window.openedWindows[i].close();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            catch (e) {\r\n                // Cross Domain url check error.\r\n                // Will be thrown until AAD redirects the user back to the app"s root page with the token.\r\n                // No need to log or throw this error as it will create unnecessary traffic.\r\n            }\r\n        }, interval);\r\n        return popupWindow;\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Configures popup window for login.\r\n     *\r\n     * @param urlNavigate\r\n     * @param title\r\n     * @param popUpWidth\r\n     * @param popUpHeight\r\n     * @ignore\r\n     * @hidden\r\n     */\r\n    UserAgentApplication.prototype.openPopup = function (urlNavigate, title, popUpWidth, popUpHeight) {\r\n        try {\r\n            /**\r\n             * adding winLeft and winTop to account for dual monitor\r\n             * using screenLeft and screenTop for IE8 and earlier\r\n             */\r\n            var winLeft = window.screenLeft ? window.screenLeft : window.screenX;\r\n            var winTop = window.screenTop ? window.screenTop : window.screenY;\r\n            /**\r\n             * window.innerWidth displays browser window"s height and width excluding toolbars\r\n             * using document.documentElement.clientWidth for IE8 and earlier\r\n             */\r\n            var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\r\n            var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n            var left = ((width / 2) - (popUpWidth / 2)) + winLeft;\r\n            var top_1 = ((height / 2) - (popUpHeight / 2)) + winTop;\r\n            // open the window\r\n            var popupWindow = window.open(urlNavigate, title, "width=" + popUpWidth + ", height=" + popUpHeight + ", top=" + top_1 + ", left=" + left);\r\n            if (!popupWindow) {\r\n                throw ClientAuthError_ClientAuthError.createPopupWindowError();\r\n            }\r\n            if (popupWindow.focus) {\r\n                popupWindow.focus();\r\n            }\r\n            return popupWindow;\r\n        }\r\n        catch (e) {\r\n            this.logger.error("error opening popup " + e.message);\r\n            this.loginInProgress = false;\r\n            this.acquireTokenInProgress = false;\r\n            throw ClientAuthError_ClientAuthError.createPopupWindowError(e.toString());\r\n        }\r\n    };\r\n    //#endregion\r\n    //#region Iframe Management\r\n    /**\r\n     * @hidden\r\n     * Returns whether current window is in ifram for token renewal\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.isInIframe = function () {\r\n        return window.parent !== window;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Returns whether parent window exists and has msal\r\n     */\r\n    UserAgentApplication.prototype.parentIsMsal = function () {\r\n        return window.parent !== window && window.parent.msal;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Calling _loadFrame but with a timeout to signal failure in loadframeStatus. Callbacks are left.\r\n     * registered when network errors occur and subsequent token requests for same resource are registered to the pending request.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.loadIframeTimeout = function (urlNavigate, frameName, scope) {\r\n        var _this = this;\r\n        //set iframe session to pending\r\n        var expectedState = window.activeRenewals[scope];\r\n        this.logger.verbose("Set loading state to pending for: " + scope + ":" + expectedState);\r\n        this.cacheStorage.setItem(Constants.renewStatus + expectedState, Constants.tokenRenewStatusInProgress);\r\n        this.loadFrame(urlNavigate, frameName);\r\n        setTimeout(function () {\r\n            if (_this.cacheStorage.getItem(Constants.renewStatus + expectedState) === Constants.tokenRenewStatusInProgress) {\r\n                // fail the iframe session if it"s in pending state\r\n                _this.logger.verbose("Loading frame has timed out after: " + (_this.config.system.loadFrameTimeout / 1000) + " seconds for scope " + scope + ":" + expectedState);\r\n                // Error after timeout\r\n                if (expectedState && window.callbackMappedToRenewStates[expectedState]) {\r\n                    window.callbackMappedToRenewStates[expectedState](null, ClientAuthError_ClientAuthError.createTokenRenewalTimeoutError());\r\n                }\r\n                _this.cacheStorage.setItem(Constants.renewStatus + expectedState, Constants.tokenRenewStatusCancelled);\r\n            }\r\n        }, this.config.system.loadFrameTimeout);\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Loads iframe with authorization endpoint URL\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.loadFrame = function (urlNavigate, frameName) {\r\n        var _this = this;\r\n        // This trick overcomes iframe navigation in IE\r\n        // IE does not load the page consistently in iframe\r\n        this.logger.info("LoadFrame: " + frameName);\r\n        var frameCheck = frameName;\r\n        setTimeout(function () {\r\n            var frameHandle = _this.addHiddenIFrame(frameCheck);\r\n            if (frameHandle.src === "" || frameHandle.src === "about:blank") {\r\n                frameHandle.src = urlNavigate;\r\n                _this.logger.infoPii("Frame Name : " + frameName + " Navigated to: " + urlNavigate);\r\n            }\r\n        }, this.config.system.navigateFrameWait);\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Adds the hidden iframe for silent token renewal.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.addHiddenIFrame = function (iframeId) {\r\n        if (typeof iframeId === "undefined") {\r\n            return null;\r\n        }\r\n        this.logger.info("Add msal frame to document:" + iframeId);\r\n        var adalFrame = document.getElementById(iframeId);\r\n        if (!adalFrame) {\r\n            if (document.createElement &&\r\n                document.documentElement &&\r\n                (window.navigator.userAgent.indexOf("MSIE 5.0") === -1)) {\r\n                var ifr = document.createElement("iframe");\r\n                ifr.setAttribute("id", iframeId);\r\n                ifr.style.visibility = "hidden";\r\n                ifr.style.position = "absolute";\r\n                ifr.style.width = ifr.style.height = "0";\r\n                ifr.style.border = "0";\r\n                adalFrame = document.getElementsByTagName("body")[0].appendChild(ifr);\r\n            }\r\n            else if (document.body && document.body.insertAdjacentHTML) {\r\n                document.body.insertAdjacentHTML("beforeend", "<iframe name=\'" + iframeId + "\' id=\'" + iframeId + "\' style=\'display:none\'></iframe>");\r\n            }\r\n            if (window.frames && window.frames[iframeId]) {\r\n                adalFrame = window.frames[iframeId];\r\n            }\r\n        }\r\n        return adalFrame;\r\n    };\r\n    //#endregion\r\n    //#region General Helpers\r\n    /**\r\n     * @hidden\r\n     * Used to redirect the browser to the STS authorization endpoint\r\n     * @param {string} urlNavigate - URL of the authorization endpoint\r\n     */\r\n    UserAgentApplication.prototype.navigateWindow = function (urlNavigate, popupWindow) {\r\n        // Navigate if valid URL\r\n        if (urlNavigate && !StringUtils.isEmpty(urlNavigate)) {\r\n            var navigateWindow = popupWindow ? popupWindow : window;\r\n            var logMessage = popupWindow ? "Navigated Popup window to:" + urlNavigate : "Navigate to:" + urlNavigate;\r\n            this.logger.infoPii(logMessage);\r\n            navigateWindow.location.replace(urlNavigate);\r\n        }\r\n        else {\r\n            this.logger.info("Navigate url is empty");\r\n            throw AuthError_AuthError.createUnexpectedError("Navigate url is empty");\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Used to add the developer requested callback to the array of callbacks for the specified scopes. The updated array is stored on the window object\r\n     * @param {string} expectedState - Unique state identifier (guid).\r\n     * @param {string} scope - Developer requested permissions. Not all scopes are guaranteed to be included in the access token returned.\r\n     * @param {Function} resolve - The resolve function of the promise object.\r\n     * @param {Function} reject - The reject function of the promise object.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.registerCallback = function (expectedState, scope, resolve, reject) {\r\n        var _this = this;\r\n        // track active renewals\r\n        window.activeRenewals[scope] = expectedState;\r\n        // initialize callbacks mapped array\r\n        if (!window.promiseMappedToRenewStates[expectedState]) {\r\n            window.promiseMappedToRenewStates[expectedState] = [];\r\n        }\r\n        // indexing on the current state, push the callback params to callbacks mapped\r\n        window.promiseMappedToRenewStates[expectedState].push({ resolve: resolve, reject: reject });\r\n        // Store the server esponse in the current window??\r\n        if (!window.callbackMappedToRenewStates[expectedState]) {\r\n            window.callbackMappedToRenewStates[expectedState] =\r\n                function (response, error) {\r\n                    // reset active renewals\r\n                    window.activeRenewals[scope] = null;\r\n                    // for all promiseMappedtoRenewStates for a given \'state\' - call the reject/resolve with error/token respectively\r\n                    for (var i = 0; i < window.promiseMappedToRenewStates[expectedState].length; ++i) {\r\n                        try {\r\n                            if (error) {\r\n                                window.promiseMappedToRenewStates[expectedState][i].reject(error);\r\n                            }\r\n                            else if (response) {\r\n                                window.promiseMappedToRenewStates[expectedState][i].resolve(response);\r\n                            }\r\n                            else {\r\n                                throw AuthError_AuthError.createUnexpectedError("Error and response are both null");\r\n                            }\r\n                        }\r\n                        catch (e) {\r\n                            _this.logger.warning(e);\r\n                        }\r\n                    }\r\n                    // reset\r\n                    window.promiseMappedToRenewStates[expectedState] = null;\r\n                    window.callbackMappedToRenewStates[expectedState] = null;\r\n                };\r\n        }\r\n    };\r\n    //#endregion\r\n    //#region Logout\r\n    /**\r\n     * Use to log out the current user, and redirect the user to the postLogoutRedirectUri.\r\n     * Default behaviour is to redirect the user to `window.location.href`.\r\n     */\r\n    UserAgentApplication.prototype.logout = function () {\r\n        var _this = this;\r\n        this.clearCache();\r\n        this.account = null;\r\n        var logout = "";\r\n        if (this.getPostLogoutRedirectUri()) {\r\n            logout = "post_logout_redirect_uri=" + encodeURIComponent(this.getPostLogoutRedirectUri());\r\n        }\r\n        this.authorityInstance.resolveEndpointsAsync().then(function (authority) {\r\n            var urlNavigate = authority.EndSessionEndpoint\r\n                ? authority.EndSessionEndpoint + "?" + logout\r\n                : _this.authority + "oauth2/v2.0/logout?" + logout;\r\n            _this.navigateWindow(urlNavigate);\r\n        });\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Clear all access tokens in the cache.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.clearCache = function () {\r\n        window.renewStates = [];\r\n        var accessTokenItems = this.cacheStorage.getAllAccessTokens(Constants.clientId, Constants.homeAccountIdentifier);\r\n        for (var i = 0; i < accessTokenItems.length; i++) {\r\n            this.cacheStorage.removeItem(JSON.stringify(accessTokenItems[i].key));\r\n        }\r\n        this.cacheStorage.resetCacheItems();\r\n        this.cacheStorage.clearCookie();\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Clear a given access token from the cache.\r\n     *\r\n     * @param accessToken\r\n     */\r\n    UserAgentApplication.prototype.clearCacheForScope = function (accessToken) {\r\n        var accessTokenItems = this.cacheStorage.getAllAccessTokens(Constants.clientId, Constants.homeAccountIdentifier);\r\n        for (var i = 0; i < accessTokenItems.length; i++) {\r\n            var token = accessTokenItems[i];\r\n            if (token.value.accessToken === accessToken) {\r\n                this.cacheStorage.removeItem(JSON.stringify(token.key));\r\n            }\r\n        }\r\n    };\r\n    //#endregion\r\n    //#region Response\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     * Checks if the redirect response is received from the STS. In case of redirect, the url fragment has either id_token, access_token or error.\r\n     * @param {string} hash - Hash passed from redirect page.\r\n     * @returns {Boolean} - true if response contains id_token, access_token or error, false otherwise.\r\n     */\r\n    UserAgentApplication.prototype.isCallback = function (hash) {\r\n        this.logger.info("isCallback will be deprecated in favor of urlContainsHash in MSAL.js v2.0.");\r\n        return this.urlContainsHash(hash);\r\n    };\r\n    UserAgentApplication.prototype.urlContainsHash = function (urlString) {\r\n        var parameters = this.deserializeHash(urlString);\r\n        return (parameters.hasOwnProperty(Constants.errorDescription) ||\r\n            parameters.hasOwnProperty(Constants.error) ||\r\n            parameters.hasOwnProperty(Constants.accessToken) ||\r\n            parameters.hasOwnProperty(Constants.idToken));\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Used to call the constructor callback with the token/error\r\n     * @param {string} [hash=window.location.hash] - Hash fragment of Url.\r\n     */\r\n    UserAgentApplication.prototype.processCallBack = function (hash, stateInfo, parentCallback) {\r\n        this.logger.info("Processing the callback from redirect response");\r\n        // get the state info from the hash\r\n        if (!stateInfo) {\r\n            stateInfo = this.getResponseState(hash);\r\n        }\r\n        var response;\r\n        var authErr;\r\n        // Save the token info from the hash\r\n        try {\r\n            response = this.saveTokenFromHash(hash, stateInfo);\r\n        }\r\n        catch (err) {\r\n            authErr = err;\r\n        }\r\n        // remove hash from the cache\r\n        this.cacheStorage.removeItem(Constants.urlHash);\r\n        try {\r\n            // Clear the cookie in the hash\r\n            this.cacheStorage.clearCookie();\r\n            var accountState = this.getAccountState(stateInfo.state);\r\n            if (response) {\r\n                if ((stateInfo.requestType === Constants.renewToken) || response.accessToken) {\r\n                    if (window.parent !== window) {\r\n                        this.logger.verbose("Window is in iframe, acquiring token silently");\r\n                    }\r\n                    else {\r\n                        this.logger.verbose("acquiring token interactive in progress");\r\n                    }\r\n                    response.tokenType = Constants.accessToken;\r\n                }\r\n                else if (stateInfo.requestType === Constants.login) {\r\n                    response.tokenType = Constants.idToken;\r\n                }\r\n                if (!parentCallback) {\r\n                    this.authResponseHandler(Constants.interactionTypeRedirect, response);\r\n                    return;\r\n                }\r\n            }\r\n            else if (!parentCallback) {\r\n                this.authErrorHandler(Constants.interactionTypeRedirect, authErr, buildResponseStateOnly(accountState));\r\n                return;\r\n            }\r\n            parentCallback(response, authErr);\r\n        }\r\n        catch (err) {\r\n            this.logger.error("Error occurred in token received callback function: " + err);\r\n            throw ClientAuthError_ClientAuthError.createErrorInCallbackFunction(err.toString());\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     * This method must be called for processing the response received from the STS. It extracts the hash, processes the token or error information and saves it in the cache. It then\r\n     * calls the registered callbacks in case of redirect or resolves the promises with the result.\r\n     * @param {string} [hash=window.location.hash] - Hash fragment of Url.\r\n     */\r\n    UserAgentApplication.prototype.handleAuthenticationResponse = function (hash) {\r\n        // retrieve the hash\r\n        if (hash == null) {\r\n            hash = window.location.hash;\r\n        }\r\n        var self = null;\r\n        var isPopup = false;\r\n        var isWindowOpenerMsal = false;\r\n        // Check if the current window opened the iFrame/popup\r\n        try {\r\n            isWindowOpenerMsal = window.opener && window.opener.msal && window.opener.msal !== window.msal;\r\n        }\r\n        catch (err) {\r\n            // err = SecurityError: Blocked a frame with origin "[url]" from accessing a cross-origin frame.\r\n            isWindowOpenerMsal = false;\r\n        }\r\n        // Set the self to the window that created the popup/iframe\r\n        if (isWindowOpenerMsal) {\r\n            self = window.opener.msal;\r\n            isPopup = true;\r\n        }\r\n        else if (window.parent && window.parent.msal) {\r\n            self = window.parent.msal;\r\n        }\r\n        // if (window.parent !== window), by using self, window.parent becomes equal to window in getResponseState method specifically\r\n        var stateInfo = self.getResponseState(hash);\r\n        var tokenResponseCallback = null;\r\n        self.logger.info("Returned from redirect url");\r\n        // If parent window is the msal instance which opened the current window (iframe)\r\n        if (this.parentIsMsal()) {\r\n            tokenResponseCallback = window.parent.callbackMappedToRenewStates[stateInfo.state];\r\n        }\r\n        // Current window is window opener (popup)\r\n        else if (isWindowOpenerMsal) {\r\n            tokenResponseCallback = window.opener.callbackMappedToRenewStates[stateInfo.state];\r\n        }\r\n        // Redirect cases\r\n        else {\r\n            tokenResponseCallback = null;\r\n            // if set to navigate to loginRequest page post login\r\n            if (self.config.auth.navigateToLoginRequestUrl) {\r\n                self.cacheStorage.setItem(Constants.urlHash, hash);\r\n                if (window.parent === window && !isPopup) {\r\n                    window.location.href = self.cacheStorage.getItem(Constants.loginRequest, self.inCookie);\r\n                }\r\n                return;\r\n            }\r\n            else {\r\n                window.location.hash = "";\r\n            }\r\n            if (!this.redirectCallbacksSet) {\r\n                // We reached this point too early - cache hash, return and process in handleRedirectCallbacks\r\n                self.cacheStorage.setItem(Constants.urlHash, hash);\r\n                return;\r\n            }\r\n        }\r\n        self.processCallBack(hash, stateInfo, tokenResponseCallback);\r\n        // If current window is opener, close all windows\r\n        if (isWindowOpenerMsal) {\r\n            for (var i = 0; i < window.opener.openedWindows.length; i++) {\r\n                window.opener.openedWindows[i].close();\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Returns deserialized portion of URL hash\r\n     * @param hash\r\n     */\r\n    UserAgentApplication.prototype.deserializeHash = function (urlFragment) {\r\n        var hash = UrlUtils_UrlUtils.getHashFromUrl(urlFragment);\r\n        return CryptoUtils.deserialize(hash);\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Creates a stateInfo object from the URL fragment and returns it.\r\n     * @param {string} hash  -  Hash passed from redirect page\r\n     * @returns {TokenResponse} an object created from the redirect response from AAD comprising of the keys - parameters, requestType, stateMatch, stateResponse and valid.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.getResponseState = function (hash) {\r\n        var parameters = this.deserializeHash(hash);\r\n        var stateResponse;\r\n        if (!parameters) {\r\n            throw AuthError_AuthError.createUnexpectedError("Hash was not parsed correctly.");\r\n        }\r\n        if (parameters.hasOwnProperty("state")) {\r\n            stateResponse = {\r\n                requestType: Constants.unknown,\r\n                state: parameters.state,\r\n                stateMatch: false\r\n            };\r\n        }\r\n        else {\r\n            throw AuthError_AuthError.createUnexpectedError("Hash does not contain state.");\r\n        }\r\n        // async calls can fire iframe and login request at the same time if developer does not use the API as expected\r\n        // incoming callback needs to be looked up to find the request type\r\n        // loginRedirect\r\n        if (stateResponse.state === this.cacheStorage.getItem(Constants.stateLogin, this.inCookie) || stateResponse.state === this.silentAuthenticationState) { // loginRedirect\r\n            stateResponse.requestType = Constants.login;\r\n            stateResponse.stateMatch = true;\r\n            return stateResponse;\r\n        }\r\n        // acquireTokenRedirect\r\n        else if (stateResponse.state === this.cacheStorage.getItem(Constants.stateAcquireToken, this.inCookie)) { //acquireTokenRedirect\r\n            stateResponse.requestType = Constants.renewToken;\r\n            stateResponse.stateMatch = true;\r\n            return stateResponse;\r\n        }\r\n        // external api requests may have many renewtoken requests for different resource\r\n        if (!stateResponse.stateMatch) {\r\n            stateResponse.requestType = window.requestType;\r\n            var statesInParentContext = window.renewStates;\r\n            for (var i = 0; i < statesInParentContext.length; i++) {\r\n                if (statesInParentContext[i] === stateResponse.state) {\r\n                    stateResponse.stateMatch = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return stateResponse;\r\n    };\r\n    //#endregion\r\n    //#region Token Processing (Extract to TokenProcessing.ts)\r\n    /**\r\n     * @hidden\r\n     * Used to get token for the specified set of scopes from the cache\r\n     * @param {@link ServerRequestParameters} - Request sent to the STS to obtain an id_token/access_token\r\n     * @param {Account} account - Account for which the scopes were requested\r\n     */\r\n    UserAgentApplication.prototype.getCachedToken = function (serverAuthenticationRequest, account) {\r\n        var accessTokenCacheItem = null;\r\n        var scopes = serverAuthenticationRequest.scopes;\r\n        // filter by clientId and account\r\n        var tokenCacheItems = this.cacheStorage.getAllAccessTokens(this.clientId, account ? account.homeAccountIdentifier : null);\r\n        // No match found after initial filtering\r\n        if (tokenCacheItems.length === 0) {\r\n            return null;\r\n        }\r\n        var filteredItems = [];\r\n        // if no authority passed\r\n        if (!serverAuthenticationRequest.authority) {\r\n            // filter by scope\r\n            for (var i = 0; i < tokenCacheItems.length; i++) {\r\n                var cacheItem = tokenCacheItems[i];\r\n                var cachedScopes = cacheItem.key.scopes.split(" ");\r\n                if (ScopeSet.containsScope(cachedScopes, scopes)) {\r\n                    filteredItems.push(cacheItem);\r\n                }\r\n            }\r\n            // if only one cached token found\r\n            if (filteredItems.length === 1) {\r\n                accessTokenCacheItem = filteredItems[0];\r\n                serverAuthenticationRequest.authorityInstance = AuthorityFactory_AuthorityFactory.CreateInstance(accessTokenCacheItem.key.authority, this.config.auth.validateAuthority);\r\n            }\r\n            // if more than one cached token is found\r\n            else if (filteredItems.length > 1) {\r\n                throw ClientAuthError_ClientAuthError.createMultipleMatchingTokensInCacheError(scopes.toString());\r\n            }\r\n            // if no match found, check if there was a single authority used\r\n            else {\r\n                var authorityList = this.getUniqueAuthority(tokenCacheItems, "authority");\r\n                if (authorityList.length > 1) {\r\n                    throw ClientAuthError_ClientAuthError.createMultipleAuthoritiesInCacheError(scopes.toString());\r\n                }\r\n                serverAuthenticationRequest.authorityInstance = AuthorityFactory_AuthorityFactory.CreateInstance(authorityList[0], this.config.auth.validateAuthority);\r\n            }\r\n        }\r\n        // if an authority is passed in the API\r\n        else {\r\n            // filter by authority and scope\r\n            for (var i = 0; i < tokenCacheItems.length; i++) {\r\n                var cacheItem = tokenCacheItems[i];\r\n                var cachedScopes = cacheItem.key.scopes.split(" ");\r\n                if (ScopeSet.containsScope(cachedScopes, scopes) && UrlUtils_UrlUtils.CanonicalizeUri(cacheItem.key.authority) === serverAuthenticationRequest.authority) {\r\n                    filteredItems.push(cacheItem);\r\n                }\r\n            }\r\n            // no match\r\n            if (filteredItems.length === 0) {\r\n                return null;\r\n            }\r\n            // if only one cachedToken Found\r\n            else if (filteredItems.length === 1) {\r\n                accessTokenCacheItem = filteredItems[0];\r\n            }\r\n            else {\r\n                // if more than cached token is found\r\n                throw ClientAuthError_ClientAuthError.createMultipleMatchingTokensInCacheError(scopes.toString());\r\n            }\r\n        }\r\n        if (accessTokenCacheItem != null) {\r\n            var expired = Number(accessTokenCacheItem.value.expiresIn);\r\n            // If expiration is within offset, it will force renew\r\n            var offset = this.config.system.tokenRenewalOffsetSeconds || 300;\r\n            if (expired && (expired > TimeUtils.now() + offset)) {\r\n                var idTokenObj = new IdToken_IdToken(accessTokenCacheItem.value.idToken);\r\n                if (!account) {\r\n                    account = this.getAccount();\r\n                    if (!account) {\r\n                        throw AuthError_AuthError.createUnexpectedError("Account should not be null here.");\r\n                    }\r\n                }\r\n                var aState = this.getAccountState(serverAuthenticationRequest.state);\r\n                var response = {\r\n                    uniqueId: "",\r\n                    tenantId: "",\r\n                    tokenType: (accessTokenCacheItem.value.idToken === accessTokenCacheItem.value.accessToken) ? Constants.idToken : Constants.accessToken,\r\n                    idToken: idTokenObj,\r\n                    idTokenClaims: idTokenObj.claims,\r\n                    accessToken: accessTokenCacheItem.value.accessToken,\r\n                    scopes: accessTokenCacheItem.key.scopes.split(" "),\r\n                    expiresOn: new Date(expired * 1000),\r\n                    account: account,\r\n                    accountState: aState,\r\n                };\r\n                ResponseUtils_ResponseUtils.setResponseIdToken(response, idTokenObj);\r\n                return response;\r\n            }\r\n            else {\r\n                this.cacheStorage.removeItem(JSON.stringify(filteredItems[0].key));\r\n                return null;\r\n            }\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Used to get a unique list of authoritues from the cache\r\n     * @param {Array<AccessTokenCacheItem>}  accessTokenCacheItems - accessTokenCacheItems saved in the cache\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.getUniqueAuthority = function (accessTokenCacheItems, property) {\r\n        var authorityList = [];\r\n        var flags = [];\r\n        accessTokenCacheItems.forEach(function (element) {\r\n            if (element.key.hasOwnProperty(property) && (flags.indexOf(element.key[property]) === -1)) {\r\n                flags.push(element.key[property]);\r\n                authorityList.push(element.key[property]);\r\n            }\r\n        });\r\n        return authorityList;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Check if ADAL id_token exists and return if exists.\r\n     *\r\n     */\r\n    UserAgentApplication.prototype.extractADALIdToken = function () {\r\n        var adalIdToken = this.cacheStorage.getItem(Constants.adalIdToken);\r\n        if (!StringUtils.isEmpty(adalIdToken)) {\r\n            return TokenUtils_TokenUtils.extractIdToken(adalIdToken);\r\n        }\r\n        return null;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Acquires access token using a hidden iframe.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.renewToken = function (scopes, resolve, reject, account, serverAuthenticationRequest) {\r\n        var scope = scopes.join(" ").toLowerCase();\r\n        this.logger.verbose("renewToken is called for scope:" + scope);\r\n        var frameHandle = this.addHiddenIFrame("msalRenewFrame" + scope);\r\n        this.updateCacheEntries(serverAuthenticationRequest, account);\r\n        this.logger.verbose("Renew token Expected state: " + serverAuthenticationRequest.state);\r\n        // Build urlNavigate with "prompt=none" and navigate to URL in hidden iFrame\r\n        var urlNavigate = UrlUtils_UrlUtils.urlRemoveQueryStringParameter(UrlUtils_UrlUtils.createNavigateUrl(serverAuthenticationRequest), Constants.prompt) + Constants.prompt_none;\r\n        window.renewStates.push(serverAuthenticationRequest.state);\r\n        window.requestType = Constants.renewToken;\r\n        this.registerCallback(serverAuthenticationRequest.state, scope, resolve, reject);\r\n        this.logger.infoPii("Navigate to:" + urlNavigate);\r\n        frameHandle.src = "about:blank";\r\n        this.loadIframeTimeout(urlNavigate, "msalRenewFrame" + scope, scope);\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Renews idtoken for app"s own backend when clientId is passed as a single scope in the scopes array.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.renewIdToken = function (scopes, resolve, reject, account, serverAuthenticationRequest) {\r\n        this.logger.info("renewidToken is called");\r\n        var frameHandle = this.addHiddenIFrame("msalIdTokenFrame");\r\n        this.updateCacheEntries(serverAuthenticationRequest, account);\r\n        this.logger.verbose("Renew Idtoken Expected state: " + serverAuthenticationRequest.state);\r\n        // Build urlNavigate with "prompt=none" and navigate to URL in hidden iFrame\r\n        var urlNavigate = UrlUtils_UrlUtils.urlRemoveQueryStringParameter(UrlUtils_UrlUtils.createNavigateUrl(serverAuthenticationRequest), Constants.prompt) + Constants.prompt_none;\r\n        if (this.silentLogin) {\r\n            window.requestType = Constants.login;\r\n            this.silentAuthenticationState = serverAuthenticationRequest.state;\r\n        }\r\n        else {\r\n            window.requestType = Constants.renewToken;\r\n            window.renewStates.push(serverAuthenticationRequest.state);\r\n        }\r\n        // note: scope here is clientId\r\n        this.registerCallback(serverAuthenticationRequest.state, this.clientId, resolve, reject);\r\n        this.logger.infoPii("Navigate to:" + urlNavigate);\r\n        frameHandle.src = "about:blank";\r\n        this.loadIframeTimeout(urlNavigate, "msalIdTokenFrame", this.clientId);\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * This method must be called for processing the response received from AAD. It extracts the hash, processes the token or error, saves it in the cache and calls the registered callbacks with the result.\r\n     * @param {string} authority authority received in the redirect response from AAD.\r\n     * @param {TokenResponse} requestInfo an object created from the redirect response from AAD comprising of the keys - parameters, requestType, stateMatch, stateResponse and valid.\r\n     * @param {Account} account account object for which scopes are consented for. The default account is the logged in account.\r\n     * @param {ClientInfo} clientInfo clientInfo received as part of the response comprising of fields uid and utid.\r\n     * @param {IdToken} idToken idToken received as part of the response.\r\n     * @ignore\r\n     * @private\r\n     */\r\n    /* tslint:disable:no-string-literal */\r\n    UserAgentApplication.prototype.saveAccessToken = function (response, authority, parameters, clientInfo, idTokenObj) {\r\n        var scope;\r\n        var accessTokenResponse = __assign({}, response);\r\n        var clientObj = new ClientInfo_ClientInfo(clientInfo);\r\n        var expiration;\r\n        // if the response contains "scope"\r\n        if (parameters.hasOwnProperty("scope")) {\r\n            // read the scopes\r\n            scope = parameters["scope"];\r\n            var consentedScopes = scope.split(" ");\r\n            // retrieve all access tokens from the cache, remove the dup scores\r\n            var accessTokenCacheItems = this.cacheStorage.getAllAccessTokens(this.clientId, authority);\r\n            for (var i = 0; i < accessTokenCacheItems.length; i++) {\r\n                var accessTokenCacheItem = accessTokenCacheItems[i];\r\n                if (accessTokenCacheItem.key.homeAccountIdentifier === response.account.homeAccountIdentifier) {\r\n                    var cachedScopes = accessTokenCacheItem.key.scopes.split(" ");\r\n                    if (ScopeSet.isIntersectingScopes(cachedScopes, consentedScopes)) {\r\n                        this.cacheStorage.removeItem(JSON.stringify(accessTokenCacheItem.key));\r\n                    }\r\n                }\r\n            }\r\n            // Generate and cache accessTokenKey and accessTokenValue\r\n            var expiresIn = TimeUtils.parseExpiresIn(parameters[Constants.expiresIn]);\r\n            expiration = TimeUtils.now() + expiresIn;\r\n            var accessTokenKey = new AccessTokenKey_AccessTokenKey(authority, this.clientId, scope, clientObj.uid, clientObj.utid);\r\n            var accessTokenValue = new AccessTokenValue(parameters[Constants.accessToken], idTokenObj.rawIdToken, expiration.toString(), clientInfo);\r\n            this.cacheStorage.setItem(JSON.stringify(accessTokenKey), JSON.stringify(accessTokenValue));\r\n            accessTokenResponse.accessToken = parameters[Constants.accessToken];\r\n            accessTokenResponse.scopes = consentedScopes;\r\n        }\r\n        // if the response does not contain "scope" - scope is usually client_id and the token will be id_token\r\n        else {\r\n            scope = this.clientId;\r\n            // Generate and cache accessTokenKey and accessTokenValue\r\n            var accessTokenKey = new AccessTokenKey_AccessTokenKey(authority, this.clientId, scope, clientObj.uid, clientObj.utid);\r\n            expiration = Number(idTokenObj.expiration);\r\n            var accessTokenValue = new AccessTokenValue(parameters[Constants.idToken], parameters[Constants.idToken], expiration.toString(), clientInfo);\r\n            this.cacheStorage.setItem(JSON.stringify(accessTokenKey), JSON.stringify(accessTokenValue));\r\n            accessTokenResponse.scopes = [scope];\r\n            accessTokenResponse.accessToken = parameters[Constants.idToken];\r\n        }\r\n        if (expiration) {\r\n            accessTokenResponse.expiresOn = new Date(expiration * 1000);\r\n        }\r\n        else {\r\n            this.logger.error("Could not parse expiresIn parameter");\r\n        }\r\n        return accessTokenResponse;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * Saves token or error received in the response from AAD in the cache. In case of id_token, it also creates the account object.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.saveTokenFromHash = function (hash, stateInfo) {\r\n        this.logger.info("State status:" + stateInfo.stateMatch + "; Request type:" + stateInfo.requestType);\r\n        this.cacheStorage.setItem(Constants.msalError, "");\r\n        this.cacheStorage.setItem(Constants.msalErrorDescription, "");\r\n        var response = {\r\n            uniqueId: "",\r\n            tenantId: "",\r\n            tokenType: "",\r\n            idToken: null,\r\n            idTokenClaims: null,\r\n            accessToken: null,\r\n            scopes: [],\r\n            expiresOn: null,\r\n            account: null,\r\n            accountState: "",\r\n        };\r\n        var error;\r\n        var hashParams = this.deserializeHash(hash);\r\n        var authorityKey = "";\r\n        var acquireTokenAccountKey = "";\r\n        var idTokenObj = null;\r\n        // If server returns an error\r\n        if (hashParams.hasOwnProperty(Constants.errorDescription) || hashParams.hasOwnProperty(Constants.error)) {\r\n            this.logger.infoPii("Error :" + hashParams[Constants.error] + "; Error description:" + hashParams[Constants.errorDescription]);\r\n            this.cacheStorage.setItem(Constants.msalError, hashParams[Constants.error]);\r\n            this.cacheStorage.setItem(Constants.msalErrorDescription, hashParams[Constants.errorDescription]);\r\n            // login\r\n            if (stateInfo.requestType === Constants.login) {\r\n                this.loginInProgress = false;\r\n                this.cacheStorage.setItem(Constants.loginError, hashParams[Constants.errorDescription] + ":" + hashParams[Constants.error]);\r\n                authorityKey = Storage_Storage.generateAuthorityKey(stateInfo.state);\r\n            }\r\n            // acquireToken\r\n            if (stateInfo.requestType === Constants.renewToken) {\r\n                this.acquireTokenInProgress = false;\r\n                authorityKey = Storage_Storage.generateAuthorityKey(stateInfo.state);\r\n                var account = this.getAccount();\r\n                var accountId = void 0;\r\n                if (account && !StringUtils.isEmpty(account.homeAccountIdentifier)) {\r\n                    accountId = account.homeAccountIdentifier;\r\n                }\r\n                else {\r\n                    accountId = Constants.no_account;\r\n                }\r\n                acquireTokenAccountKey = Storage_Storage.generateAcquireTokenAccountKey(accountId, stateInfo.state);\r\n            }\r\n            var _a = Constants.error, hashErr = hashParams[_a], _b = Constants.errorDescription, hashErrDesc = hashParams[_b];\r\n            if (InteractionRequiredAuthError_InteractionRequiredAuthError.isInteractionRequiredError(hashErr) ||\r\n                InteractionRequiredAuthError_InteractionRequiredAuthError.isInteractionRequiredError(hashErrDesc)) {\r\n                error = new InteractionRequiredAuthError_InteractionRequiredAuthError(hashParams[Constants.error], hashParams[Constants.errorDescription]);\r\n            }\r\n            else {\r\n                error = new ServerError_ServerError(hashParams[Constants.error], hashParams[Constants.errorDescription]);\r\n            }\r\n        }\r\n        // If the server returns "Success"\r\n        else {\r\n            // Verify the state from redirect and record tokens to storage if exists\r\n            if (stateInfo.stateMatch) {\r\n                this.logger.info("State is right");\r\n                if (hashParams.hasOwnProperty(Constants.sessionState)) {\r\n                    this.cacheStorage.setItem(Constants.msalSessionState, hashParams[Constants.sessionState]);\r\n                }\r\n                response.accountState = this.getAccountState(stateInfo.state);\r\n                var clientInfo = "";\r\n                // Process access_token\r\n                if (hashParams.hasOwnProperty(Constants.accessToken)) {\r\n                    this.logger.info("Fragment has access token");\r\n                    this.acquireTokenInProgress = false;\r\n                    // retrieve the id_token from response if present\r\n                    if (hashParams.hasOwnProperty(Constants.idToken)) {\r\n                        idTokenObj = new IdToken_IdToken(hashParams[Constants.idToken]);\r\n                        response.idToken = idTokenObj;\r\n                        response.idTokenClaims = idTokenObj.claims;\r\n                    }\r\n                    else {\r\n                        idTokenObj = new IdToken_IdToken(this.cacheStorage.getItem(Constants.idTokenKey));\r\n                        response = ResponseUtils_ResponseUtils.setResponseIdToken(response, idTokenObj);\r\n                    }\r\n                    // retrieve the authority from cache and replace with tenantID\r\n                    var authorityKey_1 = Storage_Storage.generateAuthorityKey(stateInfo.state);\r\n                    var authority = this.cacheStorage.getItem(authorityKey_1, this.inCookie);\r\n                    if (!StringUtils.isEmpty(authority)) {\r\n                        authority = UrlUtils_UrlUtils.replaceTenantPath(authority, response.tenantId);\r\n                    }\r\n                    // retrieve client_info - if it is not found, generate the uid and utid from idToken\r\n                    if (hashParams.hasOwnProperty(Constants.clientInfo)) {\r\n                        clientInfo = hashParams[Constants.clientInfo];\r\n                    }\r\n                    else {\r\n                        this.logger.warning("ClientInfo not received in the response from AAD");\r\n                        throw ClientAuthError_ClientAuthError.createClientInfoNotPopulatedError("ClientInfo not received in the response from the server");\r\n                    }\r\n                    response.account = Account_Account.createAccount(idTokenObj, new ClientInfo_ClientInfo(clientInfo));\r\n                    var accountKey = void 0;\r\n                    if (response.account && !StringUtils.isEmpty(response.account.homeAccountIdentifier)) {\r\n                        accountKey = response.account.homeAccountIdentifier;\r\n                    }\r\n                    else {\r\n                        accountKey = Constants.no_account;\r\n                    }\r\n                    acquireTokenAccountKey = Storage_Storage.generateAcquireTokenAccountKey(accountKey, stateInfo.state);\r\n                    var acquireTokenAccountKey_noaccount = Storage_Storage.generateAcquireTokenAccountKey(Constants.no_account, stateInfo.state);\r\n                    var cachedAccount = this.cacheStorage.getItem(acquireTokenAccountKey);\r\n                    var acquireTokenAccount = void 0;\r\n                    // Check with the account in the Cache\r\n                    if (!StringUtils.isEmpty(cachedAccount)) {\r\n                        acquireTokenAccount = JSON.parse(cachedAccount);\r\n                        if (response.account && acquireTokenAccount && Account_Account.compareAccounts(response.account, acquireTokenAccount)) {\r\n                            response = this.saveAccessToken(response, authority, hashParams, clientInfo, idTokenObj);\r\n                            this.logger.info("The user object received in the response is the same as the one passed in the acquireToken request");\r\n                        }\r\n                        else {\r\n                            this.logger.warning("The account object created from the response is not the same as the one passed in the acquireToken request");\r\n                        }\r\n                    }\r\n                    else if (!StringUtils.isEmpty(this.cacheStorage.getItem(acquireTokenAccountKey_noaccount))) {\r\n                        response = this.saveAccessToken(response, authority, hashParams, clientInfo, idTokenObj);\r\n                    }\r\n                }\r\n                // Process id_token\r\n                if (hashParams.hasOwnProperty(Constants.idToken)) {\r\n                    this.logger.info("Fragment has id token");\r\n                    // login no longer in progress\r\n                    this.loginInProgress = false;\r\n                    // set the idToken\r\n                    idTokenObj = new IdToken_IdToken(hashParams[Constants.idToken]);\r\n                    response = ResponseUtils_ResponseUtils.setResponseIdToken(response, idTokenObj);\r\n                    if (hashParams.hasOwnProperty(Constants.clientInfo)) {\r\n                        clientInfo = hashParams[Constants.clientInfo];\r\n                    }\r\n                    else {\r\n                        this.logger.warning("ClientInfo not received in the response from AAD");\r\n                    }\r\n                    authorityKey = Storage_Storage.generateAuthorityKey(stateInfo.state);\r\n                    var authority = this.cacheStorage.getItem(authorityKey, this.inCookie);\r\n                    if (!StringUtils.isEmpty(authority)) {\r\n                        authority = UrlUtils_UrlUtils.replaceTenantPath(authority, idTokenObj.tenantId);\r\n                    }\r\n                    this.account = Account_Account.createAccount(idTokenObj, new ClientInfo_ClientInfo(clientInfo));\r\n                    response.account = this.account;\r\n                    if (idTokenObj && idTokenObj.nonce) {\r\n                        // check nonce integrity if idToken has nonce - throw an error if not matched\r\n                        if (idTokenObj.nonce !== this.cacheStorage.getItem(Constants.nonceIdToken, this.inCookie)) {\r\n                            this.account = null;\r\n                            this.cacheStorage.setItem(Constants.loginError, "Nonce Mismatch. Expected Nonce: " + this.cacheStorage.getItem(Constants.nonceIdToken, this.inCookie) + "," + "Actual Nonce: " + idTokenObj.nonce);\r\n                            this.logger.error("Nonce Mismatch.Expected Nonce: " + this.cacheStorage.getItem(Constants.nonceIdToken, this.inCookie) + "," + "Actual Nonce: " + idTokenObj.nonce);\r\n                            error = ClientAuthError_ClientAuthError.createNonceMismatchError(this.cacheStorage.getItem(Constants.nonceIdToken, this.inCookie), idTokenObj.nonce);\r\n                        }\r\n                        // Save the token\r\n                        else {\r\n                            this.cacheStorage.setItem(Constants.idTokenKey, hashParams[Constants.idToken]);\r\n                            this.cacheStorage.setItem(Constants.msalClientInfo, clientInfo);\r\n                            // Save idToken as access token for app itself\r\n                            this.saveAccessToken(response, authority, hashParams, clientInfo, idTokenObj);\r\n                        }\r\n                    }\r\n                    else {\r\n                        authorityKey = stateInfo.state;\r\n                        acquireTokenAccountKey = stateInfo.state;\r\n                        this.logger.error("Invalid id_token received in the response");\r\n                        error = ClientAuthError_ClientAuthError.createInvalidIdTokenError(idTokenObj);\r\n                        this.cacheStorage.setItem(Constants.msalError, error.errorCode);\r\n                        this.cacheStorage.setItem(Constants.msalErrorDescription, error.errorMessage);\r\n                    }\r\n                }\r\n            }\r\n            // State mismatch - unexpected/invalid state\r\n            else {\r\n                authorityKey = stateInfo.state;\r\n                acquireTokenAccountKey = stateInfo.state;\r\n                var expectedState = this.cacheStorage.getItem(Constants.stateLogin, this.inCookie);\r\n                this.logger.error("State Mismatch.Expected State: " + expectedState + "," + "Actual State: " + stateInfo.state);\r\n                error = ClientAuthError_ClientAuthError.createInvalidStateError(stateInfo.state, expectedState);\r\n                this.cacheStorage.setItem(Constants.msalError, error.errorCode);\r\n                this.cacheStorage.setItem(Constants.msalErrorDescription, error.errorMessage);\r\n            }\r\n        }\r\n        this.cacheStorage.setItem(Constants.renewStatus + stateInfo.state, Constants.tokenRenewStatusCompleted);\r\n        this.cacheStorage.removeAcquireTokenEntries(stateInfo.state);\r\n        // this is required if navigateToLoginRequestUrl=false\r\n        if (this.inCookie) {\r\n            this.cacheStorage.setItemCookie(authorityKey, "", -1);\r\n            this.cacheStorage.clearCookie();\r\n        }\r\n        if (error) {\r\n            throw error;\r\n        }\r\n        if (!response) {\r\n            throw AuthError_AuthError.createUnexpectedError("Response is null");\r\n        }\r\n        return response;\r\n    };\r\n    /* tslint:enable:no-string-literal */\r\n    //#endregion\r\n    //#region Account\r\n    /**\r\n     * Returns the signed in account\r\n     * (the account object is created at the time of successful login)\r\n     * or null when no state is found\r\n     * @returns {@link Account} - the account object stored in MSAL\r\n     */\r\n    UserAgentApplication.prototype.getAccount = function () {\r\n        // if a session already exists, get the account from the session\r\n        if (this.account) {\r\n            return this.account;\r\n        }\r\n        // frame is used to get idToken and populate the account for the given session\r\n        var rawIdToken = this.cacheStorage.getItem(Constants.idTokenKey);\r\n        var rawClientInfo = this.cacheStorage.getItem(Constants.msalClientInfo);\r\n        if (!StringUtils.isEmpty(rawIdToken) && !StringUtils.isEmpty(rawClientInfo)) {\r\n            var idToken = new IdToken_IdToken(rawIdToken);\r\n            var clientInfo = new ClientInfo_ClientInfo(rawClientInfo);\r\n            this.account = Account_Account.createAccount(idToken, clientInfo);\r\n            return this.account;\r\n        }\r\n        // if login not yet done, return null\r\n        return null;\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Extracts state value from the accountState sent with the authentication request.\r\n     * @returns {string} scope.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.getAccountState = function (state) {\r\n        if (state) {\r\n            var splitIndex = state.indexOf("|");\r\n            if (splitIndex > -1 && splitIndex + 1 < state.length) {\r\n                return state.substring(splitIndex + 1);\r\n            }\r\n        }\r\n        return state;\r\n    };\r\n    /**\r\n     * Use to get a list of unique accounts in MSAL cache based on homeAccountIdentifier.\r\n     *\r\n     * @param {@link Array<Account>} Account - all unique accounts in MSAL cache.\r\n     */\r\n    UserAgentApplication.prototype.getAllAccounts = function () {\r\n        var accounts = [];\r\n        var accessTokenCacheItems = this.cacheStorage.getAllAccessTokens(Constants.clientId, Constants.homeAccountIdentifier);\r\n        for (var i = 0; i < accessTokenCacheItems.length; i++) {\r\n            var idToken = new IdToken_IdToken(accessTokenCacheItems[i].value.idToken);\r\n            var clientInfo = new ClientInfo_ClientInfo(accessTokenCacheItems[i].value.homeAccountIdentifier);\r\n            var account = Account_Account.createAccount(idToken, clientInfo);\r\n            accounts.push(account);\r\n        }\r\n        return this.getUniqueAccounts(accounts);\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Used to filter accounts based on homeAccountIdentifier\r\n     * @param {Array<Account>}  Accounts - accounts saved in the cache\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.getUniqueAccounts = function (accounts) {\r\n        if (!accounts || accounts.length <= 1) {\r\n            return accounts;\r\n        }\r\n        var flags = [];\r\n        var uniqueAccounts = [];\r\n        for (var index = 0; index < accounts.length; ++index) {\r\n            if (accounts[index].homeAccountIdentifier && flags.indexOf(accounts[index].homeAccountIdentifier) === -1) {\r\n                flags.push(accounts[index].homeAccountIdentifier);\r\n                uniqueAccounts.push(accounts[index]);\r\n            }\r\n        }\r\n        return uniqueAccounts;\r\n    };\r\n    //#endregion\r\n    //#region Scopes (Extract to Scopes.ts)\r\n    // Note: "this" dependency in this section is minimal.\r\n    // If pCacheStorage is separated from the class object, or passed as a fn param, scopesUtils.ts can be created\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Used to validate the scopes input parameter requested  by the developer.\r\n     * @param {Array<string>} scopes - Developer requested permissions. Not all scopes are guaranteed to be included in the access token returned.\r\n     * @param {boolean} scopesRequired - Boolean indicating whether the scopes array is required or not\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.validateInputScope = function (scopes, scopesRequired) {\r\n        if (!scopes) {\r\n            if (scopesRequired) {\r\n                throw ClientConfigurationError_ClientConfigurationError.createScopesRequiredError(scopes);\r\n            }\r\n            else {\r\n                return;\r\n            }\r\n        }\r\n        // Check that scopes is an array object (also throws error if scopes == null)\r\n        if (!Array.isArray(scopes)) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createScopesNonArrayError(scopes);\r\n        }\r\n        // Check that scopes is not an empty array\r\n        if (scopes.length < 1) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createEmptyScopesArrayError(scopes.toString());\r\n        }\r\n        // Check that clientId is passed as single scope\r\n        if (scopes.indexOf(this.clientId) > -1) {\r\n            if (scopes.length > 1) {\r\n                throw ClientConfigurationError_ClientConfigurationError.createClientIdSingleScopeError(scopes.toString());\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Extracts scope value from the state sent with the authentication request.\r\n     * @param {string} state\r\n     * @returns {string} scope.\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.getScopeFromState = function (state) {\r\n        if (state) {\r\n            var splitIndex = state.indexOf("|");\r\n            if (splitIndex > -1 && splitIndex + 1 < state.length) {\r\n                return state.substring(splitIndex + 1);\r\n            }\r\n        }\r\n        return "";\r\n    };\r\n    /**\r\n     * @ignore\r\n     * Appends extraScopesToConsent if passed\r\n     * @param {@link AuthenticationParameters}\r\n     */\r\n    UserAgentApplication.prototype.appendScopes = function (request) {\r\n        var scopes;\r\n        if (request && request.scopes) {\r\n            if (request.extraScopesToConsent) {\r\n                scopes = request.scopes.concat(request.extraScopesToConsent);\r\n            }\r\n            else {\r\n                scopes = request.scopes;\r\n            }\r\n        }\r\n        return scopes;\r\n    };\r\n    //#endregion\r\n    //#region Angular\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Broadcast messages - Used only for Angular?  *\r\n     * @param eventName\r\n     * @param data\r\n     */\r\n    UserAgentApplication.prototype.broadcast = function (eventName, data) {\r\n        var evt = new CustomEvent(eventName, { detail: data });\r\n        window.dispatchEvent(evt);\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Helper function to retrieve the cached token\r\n     *\r\n     * @param scopes\r\n     * @param {@link Account} account\r\n     * @param state\r\n     * @return {@link AuthResponse} AuthResponse\r\n     */\r\n    UserAgentApplication.prototype.getCachedTokenInternal = function (scopes, account, state) {\r\n        // Get the current session\'s account object\r\n        var accountObject = account || this.getAccount();\r\n        if (!accountObject) {\r\n            return null;\r\n        }\r\n        // Construct AuthenticationRequest based on response type\r\n        var newAuthority = this.authorityInstance ? this.authorityInstance : AuthorityFactory_AuthorityFactory.CreateInstance(this.authority, this.config.auth.validateAuthority);\r\n        var responseType = this.getTokenType(accountObject, scopes, true);\r\n        var serverAuthenticationRequest = new ServerRequestParameters_ServerRequestParameters(newAuthority, this.clientId, scopes, responseType, this.getRedirectUri(), state);\r\n        // get cached token\r\n        return this.getCachedToken(serverAuthenticationRequest, account);\r\n    };\r\n    /**\r\n     * @hidden\r\n     *\r\n     * Get scopes for the Endpoint - Used in Angular to track protected and unprotected resources without interaction from the developer app\r\n     *\r\n     * @param endpoint\r\n     */\r\n    UserAgentApplication.prototype.getScopesForEndpoint = function (endpoint) {\r\n        // if user specified list of unprotectedResources, no need to send token to these endpoints, return null.\r\n        if (this.config.framework.unprotectedResources.length > 0) {\r\n            for (var i = 0; i < this.config.framework.unprotectedResources.length; i++) {\r\n                if (endpoint.indexOf(this.config.framework.unprotectedResources[i]) > -1) {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n        // process all protected resources and send the matched one\r\n        if (this.config.framework.protectedResourceMap.size > 0) {\r\n            for (var _i = 0, _a = Array.from(this.config.framework.protectedResourceMap.keys()); _i < _a.length; _i++) {\r\n                var key = _a[_i];\r\n                // configEndpoint is like /api/Todo requested endpoint can be /api/Todo/1\r\n                if (endpoint.indexOf(key) > -1) {\r\n                    return this.config.framework.protectedResourceMap.get(key);\r\n                }\r\n            }\r\n        }\r\n        // default resource will be clientid if nothing specified\r\n        // App will use idtoken for calls to itself\r\n        // check if it\'s staring from http or https, needs to match with app host\r\n        if (endpoint.indexOf("http://") > -1 || endpoint.indexOf("https://") > -1) {\r\n            if (this.getHostFromUri(endpoint) === this.getHostFromUri(this.getRedirectUri())) {\r\n                return new Array(this.clientId);\r\n            }\r\n        }\r\n        else {\r\n            // in angular level, the url for $http interceptor call could be relative url,\r\n            // if it\'s relative call, we\'ll treat it as app backend call.\r\n            return new Array(this.clientId);\r\n        }\r\n        // if not the app\'s own backend or not a domain listed in the endpoints structure\r\n        return null;\r\n    };\r\n    /**\r\n     * Return boolean flag to developer to help inform if login is in progress\r\n     * @returns {boolean} true/false\r\n     */\r\n    UserAgentApplication.prototype.getLoginInProgress = function () {\r\n        var pendingCallback = this.cacheStorage.getItem(Constants.urlHash);\r\n        if (pendingCallback) {\r\n            return true;\r\n        }\r\n        return this.loginInProgress;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * @param loginInProgress\r\n     */\r\n    UserAgentApplication.prototype.setloginInProgress = function (loginInProgress) {\r\n        this.loginInProgress = loginInProgress;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * returns the status of acquireTokenInProgress\r\n     */\r\n    UserAgentApplication.prototype.getAcquireTokenInProgress = function () {\r\n        return this.acquireTokenInProgress;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * @param acquireTokenInProgress\r\n     */\r\n    UserAgentApplication.prototype.setAcquireTokenInProgress = function (acquireTokenInProgress) {\r\n        this.acquireTokenInProgress = acquireTokenInProgress;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * returns the logger handle\r\n     */\r\n    UserAgentApplication.prototype.getLogger = function () {\r\n        return this.config.system.logger;\r\n    };\r\n    //#endregion\r\n    //#region Getters and Setters\r\n    /**\r\n     *\r\n     * Use to get the redirect uri configured in MSAL or null.\r\n     * Evaluates redirectUri if its a function, otherwise simply returns its value.\r\n     * @returns {string} redirect URL\r\n     *\r\n     */\r\n    UserAgentApplication.prototype.getRedirectUri = function () {\r\n        if (typeof this.config.auth.redirectUri === "function") {\r\n            return this.config.auth.redirectUri();\r\n        }\r\n        return this.config.auth.redirectUri;\r\n    };\r\n    /**\r\n     * Use to get the post logout redirect uri configured in MSAL or null.\r\n     * Evaluates postLogoutredirectUri if its a function, otherwise simply returns its value.\r\n     *\r\n     * @returns {string} post logout redirect URL\r\n     */\r\n    UserAgentApplication.prototype.getPostLogoutRedirectUri = function () {\r\n        if (typeof this.config.auth.postLogoutRedirectUri === "function") {\r\n            return this.config.auth.postLogoutRedirectUri();\r\n        }\r\n        return this.config.auth.postLogoutRedirectUri;\r\n    };\r\n    /**\r\n     * Use to get the current {@link Configuration} object in MSAL\r\n     *\r\n     * @returns {@link Configuration}\r\n     */\r\n    UserAgentApplication.prototype.getCurrentConfiguration = function () {\r\n        if (!this.config) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createNoSetConfigurationError();\r\n        }\r\n        return this.config;\r\n    };\r\n    //#endregion\r\n    //#region String Util (Should be extracted to Utils.ts)\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * extract URI from the host\r\n     *\r\n     * @param {string} URI\r\n     * @returns {string} host from the URI\r\n     */\r\n    UserAgentApplication.prototype.getHostFromUri = function (uri) {\r\n        // remove http:// or https:// from uri\r\n        var extractedUri = String(uri).replace(/^(https?:)\\/\\//, "");\r\n        extractedUri = extractedUri.split("/")[0];\r\n        return extractedUri;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * Utils function to create the Authentication\r\n     * @param {@link account} account object\r\n     * @param scopes\r\n     * @param silentCall\r\n     *\r\n     * @returns {string} token type: id_token or access_token\r\n     *\r\n     */\r\n    UserAgentApplication.prototype.getTokenType = function (accountObject, scopes, silentCall) {\r\n        // if account is passed and matches the account object/or set to getAccount() from cache\r\n        // if client-id is passed as scope, get id_token else token/id_token_token (in case no session exists)\r\n        var tokenType;\r\n        // acquireTokenSilent\r\n        if (silentCall) {\r\n            if (Account_Account.compareAccounts(accountObject, this.getAccount())) {\r\n                tokenType = (scopes.indexOf(this.config.auth.clientId) > -1) ? ResponseTypes.id_token : ResponseTypes.token;\r\n            }\r\n            else {\r\n                tokenType = (scopes.indexOf(this.config.auth.clientId) > -1) ? ResponseTypes.id_token : ResponseTypes.id_token_token;\r\n            }\r\n            return tokenType;\r\n        }\r\n        // all other cases\r\n        else {\r\n            if (!Account_Account.compareAccounts(accountObject, this.getAccount())) {\r\n                tokenType = ResponseTypes.id_token_token;\r\n            }\r\n            else {\r\n                tokenType = (scopes.indexOf(this.clientId) > -1) ? ResponseTypes.id_token : ResponseTypes.token;\r\n            }\r\n            return tokenType;\r\n        }\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * Sets the cachekeys for and stores the account information in cache\r\n     * @param account\r\n     * @param state\r\n     * @hidden\r\n     */\r\n    UserAgentApplication.prototype.setAccountCache = function (account, state) {\r\n        // Cache acquireTokenAccountKey\r\n        var accountId = account ? this.getAccountId(account) : Constants.no_account;\r\n        var acquireTokenAccountKey = Storage_Storage.generateAcquireTokenAccountKey(accountId, state);\r\n        this.cacheStorage.setItem(acquireTokenAccountKey, JSON.stringify(account));\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * Sets the cacheKey for and stores the authority information in cache\r\n     * @param state\r\n     * @param authority\r\n     * @hidden\r\n     */\r\n    UserAgentApplication.prototype.setAuthorityCache = function (state, authority) {\r\n        // Cache authorityKey\r\n        var authorityKey = Storage_Storage.generateAuthorityKey(state);\r\n        this.cacheStorage.setItem(authorityKey, UrlUtils_UrlUtils.CanonicalizeUri(authority), this.inCookie);\r\n    };\r\n    /**\r\n     * Updates account, authority, and nonce in cache\r\n     * @param serverAuthenticationRequest\r\n     * @param account\r\n     * @hidden\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.updateCacheEntries = function (serverAuthenticationRequest, account, loginStartPage) {\r\n        // Cache account and authority\r\n        if (loginStartPage) {\r\n            // Cache the state, nonce, and login request data\r\n            this.cacheStorage.setItem(Constants.loginRequest, loginStartPage, this.inCookie);\r\n            this.cacheStorage.setItem(Constants.loginError, "");\r\n            this.cacheStorage.setItem(Constants.stateLogin, serverAuthenticationRequest.state, this.inCookie);\r\n            this.cacheStorage.setItem(Constants.msalError, "");\r\n            this.cacheStorage.setItem(Constants.msalErrorDescription, "");\r\n        }\r\n        else {\r\n            this.setAccountCache(account, serverAuthenticationRequest.state);\r\n        }\r\n        // Cache authorityKey\r\n        this.setAuthorityCache(serverAuthenticationRequest.state, serverAuthenticationRequest.authority);\r\n        // Cache nonce\r\n        this.cacheStorage.setItem(Constants.nonceIdToken, serverAuthenticationRequest.nonce, this.inCookie);\r\n    };\r\n    /**\r\n     * Returns the unique identifier for the logged in account\r\n     * @param account\r\n     * @hidden\r\n     * @ignore\r\n     */\r\n    UserAgentApplication.prototype.getAccountId = function (account) {\r\n        //return `${account.accountIdentifier}` + Constants.resourceDelimiter + `${account.homeAccountIdentifier}`;\r\n        var accountId;\r\n        if (!StringUtils.isEmpty(account.homeAccountIdentifier)) {\r\n            accountId = account.homeAccountIdentifier;\r\n        }\r\n        else {\r\n            accountId = Constants.no_account;\r\n        }\r\n        return accountId;\r\n    };\r\n    /**\r\n     * @hidden\r\n     * @ignore\r\n     *\r\n     * Construct \'tokenRequest\' from the available data in adalIdToken\r\n     * @param extraQueryParameters\r\n     * @hidden\r\n     */\r\n    UserAgentApplication.prototype.buildIDTokenRequest = function (request) {\r\n        var tokenRequest = {\r\n            scopes: [this.clientId],\r\n            authority: this.authority,\r\n            account: this.getAccount(),\r\n            extraQueryParameters: request.extraQueryParameters\r\n        };\r\n        return tokenRequest;\r\n    };\r\n    //#endregion\r\n    UserAgentApplication.prototype.getTelemetryManagerFromConfig = function (config, clientId) {\r\n        if (!config) { // if unset\r\n            return null;\r\n        }\r\n        // if set then validate\r\n        var applicationName = config.applicationName, applicationVersion = config.applicationVersion, telemetryEmitter = config.telemetryEmitter;\r\n        if (!applicationName || !applicationVersion || !telemetryEmitter) {\r\n            throw ClientConfigurationError_ClientConfigurationError.createTelemetryConfigError(config);\r\n        }\r\n        // if valid then construct\r\n        var telemetryPlatform = {\r\n            sdk: "msal.js",\r\n            sdkVersion: libraryVersion(),\r\n            applicationName: applicationName,\r\n            applicationVersion: applicationVersion\r\n        };\r\n        var telemetryManagerConfig = {\r\n            platform: telemetryPlatform,\r\n            clientId: clientId\r\n        };\r\n        return new telemetry_TelemetryManager(telemetryManagerConfig, telemetryEmitter);\r\n    };\r\n    __decorate([\r\n        resolveTokenOnlyIfOutOfIframe\r\n    ], UserAgentApplication.prototype, "acquireTokenSilent", null);\r\n    return UserAgentApplication;\r\n}());\r\n\r\n//# sourceMappingURL=UserAgentApplication.js.map\n// CONCATENATED MODULE: ./node_modules/msal/lib-es6/index.js\n/* concated harmony reexport UserAgentApplication */__webpack_require__.d(__webpack_exports__, "UserAgentApplication", function() { return UserAgentApplication_UserAgentApplication; });\n/* concated harmony reexport Logger */__webpack_require__.d(__webpack_exports__, "Logger", function() { return Logger_Logger; });\n/* concated harmony reexport LogLevel */__webpack_require__.d(__webpack_exports__, "LogLevel", function() { return LogLevel; });\n/* concated harmony reexport Account */__webpack_require__.d(__webpack_exports__, "Account", function() { return Account_Account; });\n/* concated harmony reexport Constants */__webpack_require__.d(__webpack_exports__, "Constants", function() { return Constants; });\n/* concated harmony reexport Authority */__webpack_require__.d(__webpack_exports__, "Authority", function() { return Authority_Authority; });\n/* concated harmony reexport AuthError */__webpack_require__.d(__webpack_exports__, "AuthError", function() { return AuthError_AuthError; });\n/* concated harmony reexport ClientAuthError */__webpack_require__.d(__webpack_exports__, "ClientAuthError", function() { return ClientAuthError_ClientAuthError; });\n/* concated harmony reexport ServerError */__webpack_require__.d(__webpack_exports__, "ServerError", function() { return ServerError_ServerError; });\n/* concated harmony reexport ClientConfigurationError */__webpack_require__.d(__webpack_exports__, "ClientConfigurationError", function() { return ClientConfigurationError_ClientConfigurationError; });\n/* concated harmony reexport InteractionRequiredAuthError */__webpack_require__.d(__webpack_exports__, "InteractionRequiredAuthError", function() { return InteractionRequiredAuthError_InteractionRequiredAuthError; });\n\r\n\r\n\r\n\r\n\r\n\r\n// Errors\r\n\r\n\r\n\r\n\r\n\r\n//# sourceMappingURL=index.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy90c2xpYi90c2xpYi5lczYuanM/OWFiNCIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvdXRpbHMvQ3J5cHRvVXRpbHMuanM/OGQ0NSIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvdXRpbHMvQ29uc3RhbnRzLmpzP2MyNjgiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L1Njb3BlU2V0LmpzP2YwODkiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L3V0aWxzL1N0cmluZ1V0aWxzLmpzPzEyNmEiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L3V0aWxzL1VybFV0aWxzLmpzPzI0MWUiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L0FjY2Vzc1Rva2VuS2V5LmpzP2IyOTAiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L0FjY2Vzc1Rva2VuVmFsdWUuanM/YjI3ZSIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvZXJyb3IvQXV0aEVycm9yLmpzPzRmNDYiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L2Vycm9yL0NsaWVudEF1dGhFcnJvci5qcz9lZDk0Iiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9lcnJvci9DbGllbnRDb25maWd1cmF0aW9uRXJyb3IuanM/NjQ0MiIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvQXV0aGVudGljYXRpb25QYXJhbWV0ZXJzLmpzPzMxYTMiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L1NlcnZlclJlcXVlc3RQYXJhbWV0ZXJzLmpzP2NmNjIiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L0NsaWVudEluZm8uanM/ZDhiYiIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvdXRpbHMvVG9rZW5VdGlscy5qcz8yNmZkIiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9JZFRva2VuLmpzP2M5MWIiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L0FjY2Vzc1Rva2VuQ2FjaGVJdGVtLmpzPzllZTkiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L1N0b3JhZ2UuanM/MzZiYyIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvQWNjb3VudC5qcz9kOTJhIiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi91dGlscy9UaW1lVXRpbHMuanM/MWI1NiIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvdXRpbHMvUmVzcG9uc2VVdGlscy5qcz85YTlmIiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9YSFJDbGllbnQuanM/ZTcwNiIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvQXV0aG9yaXR5LmpzP2JhMmYiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L0FhZEF1dGhvcml0eS5qcz83YTU1Iiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9CMmNBdXRob3JpdHkuanM/NzRkNCIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvQXV0aG9yaXR5RmFjdG9yeS5qcz8yODA1Iiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9Mb2dnZXIuanM/MWM4NiIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvQ29uZmlndXJhdGlvbi5qcz81OTE0Iiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9lcnJvci9TZXJ2ZXJFcnJvci5qcz8yNGExIiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9lcnJvci9JbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yLmpzP2RjYTciLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L0F1dGhSZXNwb25zZS5qcz83NzZmIiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi90ZWxlbWV0cnkvVGVsZW1ldHJ5Q29uc3RhbnRzLmpzPzllOTgiLCJ3ZWJwYWNrOi8vTXNhbFdyYXBwZXIvLi9ub2RlX21vZHVsZXMvbXNhbC9saWItZXM2L3RlbGVtZXRyeS9UZWxlbWV0cnlVdGlscy5qcz82YTRlIiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi90ZWxlbWV0cnkvVGVsZW1ldHJ5RXZlbnQuanM/YzRlNiIsIndlYnBhY2s6Ly9Nc2FsV3JhcHBlci8uL25vZGVfbW9kdWxlcy9tc2FsL2xpYi1lczYvdGVsZW1ldHJ5L0RlZmF1bHRFdmVudC5qcz82MGU0Iiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi90ZWxlbWV0cnkvVGVsZW1ldHJ5TWFuYWdlci5qcz9kMzcxIiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9Vc2VyQWdlbnRBcHBsaWNhdGlvbi5qcz82NDQ0Iiwid2VicGFjazovL01zYWxXcmFwcGVyLy4vbm9kZV9tb2R1bGVzL21zYWwvbGliLWVzNi9pbmRleC5qcz82MjMzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBO0FBQ0E7QUFDQSwrREFBK0Q7QUFDL0Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBVSxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ25GLHlCQUF5Qix1REFBdUQ7QUFDaEY7QUFDQTs7QUFFTztBQUNQO0FBQ0EsbUJBQW1CLHNCQUFzQjtBQUN6QztBQUNBOztBQUVPO0FBQ1A7QUFDQSxnREFBZ0QsT0FBTztBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELGNBQWM7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFTztBQUNQO0FBQ0E7QUFDQSw0Q0FBNEMsUUFBUTtBQUNwRDtBQUNBOztBQUVPO0FBQ1AsbUNBQW1DLG9DQUFvQztBQUN2RTs7QUFFTztBQUNQO0FBQ0E7O0FBRU87QUFDUDtBQUNBLG1DQUFtQyxNQUFNLDZCQUE2QixFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ2pHLGtDQUFrQyxNQUFNLGlDQUFpQyxFQUFFLFlBQVksV0FBVyxFQUFFO0FBQ3BHLCtCQUErQixpRUFBaUUsdUJBQXVCLEVBQUUsNEJBQTRCO0FBQ3JKO0FBQ0EsS0FBSztBQUNMOztBQUVPO0FBQ1AsYUFBYSw2QkFBNkIsMEJBQTBCLGFBQWEsRUFBRSxxQkFBcUI7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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ29CO0FBQ3JCLHFDOztBQzVCQTtBQUNBO0FBQ2lDO0FBQ087QUFDVztBQUM1QztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLCtCQUFlO0FBQ25CLElBQUksU0FBaUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixXQUFXO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixXQUFXO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyxDQUFDLG1CQUFTO0FBQ2dCO0FBQzNCLDJDOztBQzVLQTtBQUNBO0FBQ2lDO0FBQ2M7QUFDSztBQUM3QztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLGlEQUF3QjtBQUM1QixJQUFJLFNBQWlCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsME9BQTBPLFNBQVMsNkJBQTZCLFNBQVM7QUFDelI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDBCQUEwQixxQ0FBcUMsOEJBQThCO0FBQ2pIO0FBQ0EsYUFBYSxXQUFXO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixTQUFTO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsaURBQXdCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGNBQWM7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsMEJBQWdCO0FBQ25DO0FBQ0EsSUFBSSxVQUFrQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQytCO0FBQ2hDLGdEOztBQzU3REE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUE4RDtBQUM1QjtBQUNFO0FBQ0E7QUFDVTtBQUNOO0FBQ3hDO0FBQzhDO0FBQ1k7QUFDUjtBQUMwQjtBQUNRO0FBQ3BGIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxyXG50aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxyXG5MaWNlbnNlIGF0IGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxyXG5LSU5ELCBFSVRIRVIgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgV0lUSE9VVCBMSU1JVEFUSU9OIEFOWSBJTVBMSUVEXHJcbldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsXHJcbk1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuXHJcblxyXG5TZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcclxuYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX19hc3NpZ24uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fcmVzdChzLCBlKSB7XHJcbiAgICB2YXIgdCA9IHt9O1xyXG4gICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXHJcbiAgICAgICAgdFtwXSA9IHNbcF07XHJcbiAgICBpZiAocyAhPSBudWxsICYmIHR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMCAmJiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocywgcFtpXSkpXHJcbiAgICAgICAgICAgICAgICB0W3BbaV1dID0gc1twW2ldXTtcclxuICAgICAgICB9XHJcbiAgICByZXR1cm4gdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3BhcmFtKHBhcmFtSW5kZXgsIGRlY29yYXRvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX21ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fZXhwb3J0U3RhcihtLCBleHBvcnRzKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7XHJcbiAgICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0sIGkgPSAwO1xyXG4gICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3JlYWQobywgbikge1xyXG4gICAgdmFyIG0gPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdO1xyXG4gICAgaWYgKCFtKSByZXR1cm4gbztcclxuICAgIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgYXIucHVzaChyLnZhbHVlKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikgeyBlID0geyBlcnJvcjogZXJyb3IgfTsgfVxyXG4gICAgZmluYWxseSB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKHIgJiYgIXIuZG9uZSAmJiAobSA9IGlbXCJyZXR1cm5cIl0pKSBtLmNhbGwoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XHJcbiAgICBmb3IgKHZhciBhciA9IFtdLCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKylcclxuICAgICAgICBhciA9IGFyLmNvbmNhdChfX3JlYWQoYXJndW1lbnRzW2ldKSk7XHJcbiAgICByZXR1cm4gYXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcclxuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XHJcbiAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgcmVzdWx0W2tdID0gbW9kW2tdO1xyXG4gICAgcmVzdWx0LmRlZmF1bHQgPSBtb2Q7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xyXG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBkZWZhdWx0OiBtb2QgfTtcclxufVxyXG4iLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIENyeXB0b1V0aWxzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ3J5cHRvVXRpbHMoKSB7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZXMgYSBuZXcgcmFuZG9tIEdVSUQgLSB1c2VkIHRvIHBvcHVsYXRlIHN0YXRlP1xyXG4gICAgICogQHJldHVybnMgc3RyaW5nIChHVUlEKVxyXG4gICAgICovXHJcbiAgICBDcnlwdG9VdGlscy5jcmVhdGVOZXdHdWlkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIFJGQzQxMjI6IFRoZSB2ZXJzaW9uIDQgVVVJRCBpcyBtZWFudCBmb3IgZ2VuZXJhdGluZyBVVUlEcyBmcm9tIHRydWx5LXJhbmRvbSBvclxyXG4gICAgICAgIC8vIHBzZXVkby1yYW5kb20gbnVtYmVycy5cclxuICAgICAgICAvLyBUaGUgYWxnb3JpdGhtIGlzIGFzIGZvbGxvd3M6XHJcbiAgICAgICAgLy8gICAgIFNldCB0aGUgdHdvIG1vc3Qgc2lnbmlmaWNhbnQgYml0cyAoYml0cyA2IGFuZCA3KSBvZiB0aGVcclxuICAgICAgICAvLyAgICAgICAgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZCB0byB6ZXJvIGFuZCBvbmUsIHJlc3BlY3RpdmVseS5cclxuICAgICAgICAvLyAgICAgU2V0IHRoZSBmb3VyIG1vc3Qgc2lnbmlmaWNhbnQgYml0cyAoYml0cyAxMiB0aHJvdWdoIDE1KSBvZiB0aGVcclxuICAgICAgICAvLyAgICAgICAgdGltZV9oaV9hbmRfdmVyc2lvbiBmaWVsZCB0byB0aGUgNC1iaXQgdmVyc2lvbiBudW1iZXIgZnJvbVxyXG4gICAgICAgIC8vICAgICAgICBTZWN0aW9uIDQuMS4zLiBWZXJzaW9uNFxyXG4gICAgICAgIC8vICAgICBTZXQgYWxsIHRoZSBvdGhlciBiaXRzIHRvIHJhbmRvbWx5IChvciBwc2V1ZG8tcmFuZG9tbHkpIGNob3NlblxyXG4gICAgICAgIC8vICAgICB2YWx1ZXMuXHJcbiAgICAgICAgLy8gVVVJRCAgICAgICAgICAgICAgICAgICA9IHRpbWUtbG93IFwiLVwiIHRpbWUtbWlkIFwiLVwidGltZS1oaWdoLWFuZC12ZXJzaW9uIFwiLVwiY2xvY2stc2VxLXJlc2VydmVkIGFuZCBsb3coMmhleE9jdGV0KVwiLVwiIG5vZGVcclxuICAgICAgICAvLyB0aW1lLWxvdyAgICAgICAgICAgICAgID0gNGhleE9jdGV0XHJcbiAgICAgICAgLy8gdGltZS1taWQgICAgICAgICAgICAgICA9IDJoZXhPY3RldFxyXG4gICAgICAgIC8vIHRpbWUtaGlnaC1hbmQtdmVyc2lvbiAgPSAyaGV4T2N0ZXRcclxuICAgICAgICAvLyBjbG9jay1zZXEtYW5kLXJlc2VydmVkID0gaGV4T2N0ZXQ6XHJcbiAgICAgICAgLy8gY2xvY2stc2VxLWxvdyAgICAgICAgICA9IGhleE9jdGV0XHJcbiAgICAgICAgLy8gbm9kZSAgICAgICAgICAgICAgICAgICA9IDZoZXhPY3RldFxyXG4gICAgICAgIC8vIEZvcm1hdDogeHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4XHJcbiAgICAgICAgLy8geSBjb3VsZCBiZSAxMDAwLCAxMDAxLCAxMDEwLCAxMDExIHNpbmNlIG1vc3Qgc2lnbmlmaWNhbnQgdHdvIGJpdHMgbmVlZHMgdG8gYmUgMTBcclxuICAgICAgICAvLyB5IHZhbHVlcyBhcmUgOCwgOSwgQSwgQlxyXG4gICAgICAgIHZhciBjcnlwdG9PYmogPSB3aW5kb3cuY3J5cHRvOyAvLyBmb3IgSUUgMTFcclxuICAgICAgICBpZiAoY3J5cHRvT2JqICYmIGNyeXB0b09iai5nZXRSYW5kb21WYWx1ZXMpIHtcclxuICAgICAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDE2KTtcclxuICAgICAgICAgICAgY3J5cHRvT2JqLmdldFJhbmRvbVZhbHVlcyhidWZmZXIpO1xyXG4gICAgICAgICAgICAvL2J1ZmZlcls2XSBhbmQgYnVmZmVyWzddIHJlcHJlc2VudHMgdGhlIHRpbWVfaGlfYW5kX3ZlcnNpb24gZmllbGQuIFdlIHdpbGwgc2V0IHRoZSBmb3VyIG1vc3Qgc2lnbmlmaWNhbnQgYml0cyAoNCB0aHJvdWdoIDcpIG9mIGJ1ZmZlcls2XSB0byByZXByZXNlbnQgZGVjaW1hbCBudW1iZXIgNCAoVVVJRCB2ZXJzaW9uIG51bWJlcikuXHJcbiAgICAgICAgICAgIGJ1ZmZlcls2XSB8PSAweDQwOyAvL2J1ZmZlcls2XSB8IDAxMDAwMDAwIHdpbGwgc2V0IHRoZSA2IGJpdCB0byAxLlxyXG4gICAgICAgICAgICBidWZmZXJbNl0gJj0gMHg0ZjsgLy9idWZmZXJbNl0gJiAwMTAwMTExMSB3aWxsIHNldCB0aGUgNCwgNSwgYW5kIDcgYml0IHRvIDAgc3VjaCB0aGF0IGJpdHMgNC03ID09IDAxMDAgPSBcIjRcIi5cclxuICAgICAgICAgICAgLy9idWZmZXJbOF0gcmVwcmVzZW50cyB0aGUgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZCBmaWVsZC4gV2Ugd2lsbCBzZXQgdGhlIHR3byBtb3N0IHNpZ25pZmljYW50IGJpdHMgKDYgYW5kIDcpIG9mIHRoZSBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkIHRvIHplcm8gYW5kIG9uZSwgcmVzcGVjdGl2ZWx5LlxyXG4gICAgICAgICAgICBidWZmZXJbOF0gfD0gMHg4MDsgLy9idWZmZXJbOF0gfCAxMDAwMDAwMCB3aWxsIHNldCB0aGUgNyBiaXQgdG8gMS5cclxuICAgICAgICAgICAgYnVmZmVyWzhdICY9IDB4YmY7IC8vYnVmZmVyWzhdICYgMTAxMTExMTEgd2lsbCBzZXQgdGhlIDYgYml0IHRvIDAuXHJcbiAgICAgICAgICAgIHJldHVybiBDcnlwdG9VdGlscy5kZWNpbWFsVG9IZXgoYnVmZmVyWzBdKSArIENyeXB0b1V0aWxzLmRlY2ltYWxUb0hleChidWZmZXJbMV0pXHJcbiAgICAgICAgICAgICAgICArIENyeXB0b1V0aWxzLmRlY2ltYWxUb0hleChidWZmZXJbMl0pICsgQ3J5cHRvVXRpbHMuZGVjaW1hbFRvSGV4KGJ1ZmZlclszXSlcclxuICAgICAgICAgICAgICAgICsgXCItXCIgKyBDcnlwdG9VdGlscy5kZWNpbWFsVG9IZXgoYnVmZmVyWzRdKSArIENyeXB0b1V0aWxzLmRlY2ltYWxUb0hleChidWZmZXJbNV0pXHJcbiAgICAgICAgICAgICAgICArIFwiLVwiICsgQ3J5cHRvVXRpbHMuZGVjaW1hbFRvSGV4KGJ1ZmZlcls2XSkgKyBDcnlwdG9VdGlscy5kZWNpbWFsVG9IZXgoYnVmZmVyWzddKVxyXG4gICAgICAgICAgICAgICAgKyBcIi1cIiArIENyeXB0b1V0aWxzLmRlY2ltYWxUb0hleChidWZmZXJbOF0pICsgQ3J5cHRvVXRpbHMuZGVjaW1hbFRvSGV4KGJ1ZmZlcls5XSlcclxuICAgICAgICAgICAgICAgICsgXCItXCIgKyBDcnlwdG9VdGlscy5kZWNpbWFsVG9IZXgoYnVmZmVyWzEwXSkgKyBDcnlwdG9VdGlscy5kZWNpbWFsVG9IZXgoYnVmZmVyWzExXSlcclxuICAgICAgICAgICAgICAgICsgQ3J5cHRvVXRpbHMuZGVjaW1hbFRvSGV4KGJ1ZmZlclsxMl0pICsgQ3J5cHRvVXRpbHMuZGVjaW1hbFRvSGV4KGJ1ZmZlclsxM10pXHJcbiAgICAgICAgICAgICAgICArIENyeXB0b1V0aWxzLmRlY2ltYWxUb0hleChidWZmZXJbMTRdKSArIENyeXB0b1V0aWxzLmRlY2ltYWxUb0hleChidWZmZXJbMTVdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBndWlkSG9sZGVyID0gXCJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHhcIjtcclxuICAgICAgICAgICAgdmFyIGhleCA9IFwiMDEyMzQ1Njc4OWFiY2RlZlwiO1xyXG4gICAgICAgICAgICB2YXIgciA9IDA7XHJcbiAgICAgICAgICAgIHZhciBndWlkUmVzcG9uc2UgPSBcIlwiO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDM2OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChndWlkSG9sZGVyW2ldICE9PSBcIi1cIiAmJiBndWlkSG9sZGVyW2ldICE9PSBcIjRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGVhY2ggeCBhbmQgeSBuZWVkcyB0byBiZSByYW5kb21cclxuICAgICAgICAgICAgICAgICAgICByID0gTWF0aC5yYW5kb20oKSAqIDE2IHwgMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChndWlkSG9sZGVyW2ldID09PSBcInhcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGd1aWRSZXNwb25zZSArPSBoZXhbcl07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChndWlkSG9sZGVyW2ldID09PSBcInlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsb2NrLXNlcS1hbmQtcmVzZXJ2ZWQgZmlyc3QgaGV4IGlzIGZpbHRlcmVkIGFuZCByZW1haW5pbmcgaGV4IHZhbHVlcyBhcmUgcmFuZG9tXHJcbiAgICAgICAgICAgICAgICAgICAgciAmPSAweDM7IC8vIGJpdCBhbmQgd2l0aCAwMDExIHRvIHNldCBwb3MgMiB0byB6ZXJvID8wPz9cclxuICAgICAgICAgICAgICAgICAgICByIHw9IDB4ODsgLy8gc2V0IHBvcyAzIHRvIDEgYXMgMT8/P1xyXG4gICAgICAgICAgICAgICAgICAgIGd1aWRSZXNwb25zZSArPSBoZXhbcl07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBndWlkUmVzcG9uc2UgKz0gZ3VpZEhvbGRlcltpXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZ3VpZFJlc3BvbnNlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIERlY2ltYWwgdG8gSGV4XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIG51bVxyXG4gICAgICovXHJcbiAgICBDcnlwdG9VdGlscy5kZWNpbWFsVG9IZXggPSBmdW5jdGlvbiAobnVtKSB7XHJcbiAgICAgICAgdmFyIGhleCA9IG51bS50b1N0cmluZygxNik7XHJcbiAgICAgICAgd2hpbGUgKGhleC5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgIGhleCA9IFwiMFwiICsgaGV4O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaGV4O1xyXG4gICAgfTtcclxuICAgIC8vIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dpbmRvd0Jhc2U2NC9CYXNlNjRfZW5jb2RpbmdfYW5kX2RlY29kaW5nI1NvbHV0aW9uXzRfJUUyJTgwJTkzX2VzY2FwaW5nX3RoZV9zdHJpbmdfYmVmb3JlX2VuY29kaW5nX2l0XHJcbiAgICAvKipcclxuICAgICAqIGVuY29kaW5nIHN0cmluZyB0byBiYXNlNjQgLSBwbGF0Zm9ybSBzcGVjaWZpYyBjaGVja1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbnB1dFxyXG4gICAgICovXHJcbiAgICBDcnlwdG9VdGlscy5iYXNlNjRFbmNvZGUgPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICByZXR1cm4gYnRvYShlbmNvZGVVUklDb21wb25lbnQoaW5wdXQpLnJlcGxhY2UoLyUoWzAtOUEtRl17Mn0pL2csIGZ1bmN0aW9uIHRvU29saWRCeXRlcyhtYXRjaCwgcDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoTnVtYmVyKFwiMHhcIiArIHAxKSk7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogZGVjb2RpbmcgYmFzZTY0IHRva2VuIC0gcGxhdGZvcm0gc3BlY2lmaWMgY2hlY2tcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gYmFzZTY0SWRUb2tlblxyXG4gICAgICovXHJcbiAgICBDcnlwdG9VdGlscy5iYXNlNjREZWNvZGUgPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGF0b2IoaW5wdXQpLnNwbGl0KFwiXCIpLm1hcChmdW5jdGlvbiAoYykge1xyXG4gICAgICAgICAgICByZXR1cm4gXCIlXCIgKyAoXCIwMFwiICsgYy5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xyXG4gICAgICAgIH0pLmpvaW4oXCJcIikpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogZGVzZXJpYWxpemUgYSBzdHJpbmdcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcXVlcnlcclxuICAgICAqL1xyXG4gICAgQ3J5cHRvVXRpbHMuZGVzZXJpYWxpemUgPSBmdW5jdGlvbiAocXVlcnkpIHtcclxuICAgICAgICB2YXIgbWF0Y2g7IC8vIFJlZ2V4IGZvciByZXBsYWNpbmcgYWRkaXRpb24gc3ltYm9sIHdpdGggYSBzcGFjZVxyXG4gICAgICAgIHZhciBwbCA9IC9cXCsvZztcclxuICAgICAgICB2YXIgc2VhcmNoID0gLyhbXiY9XSspPShbXiZdKikvZztcclxuICAgICAgICB2YXIgZGVjb2RlID0gZnVuY3Rpb24gKHMpIHsgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzLnJlcGxhY2UocGwsIFwiIFwiKSk7IH07XHJcbiAgICAgICAgdmFyIG9iaiA9IHt9O1xyXG4gICAgICAgIG1hdGNoID0gc2VhcmNoLmV4ZWMocXVlcnkpO1xyXG4gICAgICAgIHdoaWxlIChtYXRjaCkge1xyXG4gICAgICAgICAgICBvYmpbZGVjb2RlKG1hdGNoWzFdKV0gPSBkZWNvZGUobWF0Y2hbMl0pO1xyXG4gICAgICAgICAgICBtYXRjaCA9IHNlYXJjaC5leGVjKHF1ZXJ5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG9iajtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ3J5cHRvVXRpbHM7XHJcbn0oKSk7XHJcbmV4cG9ydCB7IENyeXB0b1V0aWxzIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNyeXB0b1V0aWxzLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqIENvbnN0YW50c1xyXG4gKi9cclxudmFyIENvbnN0YW50cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbnN0YW50cygpIHtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwiZXJyb3JEZXNjcmlwdGlvblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcImVycm9yX2Rlc2NyaXB0aW9uXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJlcnJvclwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcImVycm9yXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJzY29wZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcInNjb3BlXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJjbGllbnRJbmZvXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiY2xpZW50X2luZm9cIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcImNsaWVudElkXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiY2xpZW50SWRcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcImlkVG9rZW5cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJpZF90b2tlblwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwiYWRhbElkVG9rZW5cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJhZGFsLmlkdG9rZW5cIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcImFjY2Vzc1Rva2VuXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiYWNjZXNzX3Rva2VuXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJleHBpcmVzSW5cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJleHBpcmVzX2luXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJzZXNzaW9uU3RhdGVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJzZXNzaW9uX3N0YXRlXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJjbGFpbXNcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJjbGFpbXNcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcIm1zYWxDbGllbnRJbmZvXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5jbGllbnQuaW5mb1wiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwibXNhbEVycm9yXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5lcnJvclwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwibXNhbEVycm9yRGVzY3JpcHRpb25cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJtc2FsLmVycm9yLmRlc2NyaXB0aW9uXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJtc2FsU2Vzc2lvblN0YXRlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5zZXNzaW9uLnN0YXRlXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJ0b2tlbktleXNcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJtc2FsLnRva2VuLmtleXNcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcImFjY2Vzc1Rva2VuS2V5XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5hY2Nlc3MudG9rZW4ua2V5XCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJleHBpcmF0aW9uS2V5XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5leHBpcmF0aW9uLmtleVwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwic3RhdGVMb2dpblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIm1zYWwuc3RhdGUubG9naW5cIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInN0YXRlQWNxdWlyZVRva2VuXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5zdGF0ZS5hY3F1aXJlVG9rZW5cIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInN0YXRlUmVuZXdcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJtc2FsLnN0YXRlLnJlbmV3XCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJub25jZUlkVG9rZW5cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJtc2FsLm5vbmNlLmlkdG9rZW5cIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInVzZXJOYW1lXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC51c2VybmFtZVwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwiaWRUb2tlbktleVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIm1zYWwuaWR0b2tlblwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwibG9naW5SZXF1ZXN0XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5sb2dpbi5yZXF1ZXN0XCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJsb2dpbkVycm9yXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbC5sb2dpbi5lcnJvclwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwicmVuZXdTdGF0dXNcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJtc2FsLnRva2VuLnJlbmV3LnN0YXR1c1wiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwidXJsSGFzaFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIm1zYWwudXJsSGFzaFwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwiYW5ndWxhckxvZ2luUmVxdWVzdFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIm1zYWwuYW5ndWxhci5sb2dpbi5yZXF1ZXN0XCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJtc2FsXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwibXNhbFwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwibm9fYWNjb3VudFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIk5PX0FDQ09VTlRcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcImNvbnN1bWVyc1V0aWRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCI5MTg4MDQwZC02YzY3LTRjNWItYjExMi0zNmEzMDRiNjZkYWRcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInVwblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcInVwblwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwicHJvbXB0X3NlbGVjdF9hY2NvdW50XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiJnByb21wdD1zZWxlY3RfYWNjb3VudFwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwicHJvbXB0X25vbmVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCImcHJvbXB0PW5vbmVcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInByb21wdFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcInByb21wdFwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwicmVzcG9uc2VfbW9kZV9mcmFnbWVudFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIiZyZXNwb25zZV9tb2RlPWZyYWdtZW50XCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJyZXNvdXJjZURlbGltaXRlclwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcInxcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInRva2VuUmVuZXdTdGF0dXNDYW5jZWxsZWRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJDYW5jZWxlZFwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwidG9rZW5SZW5ld1N0YXR1c0NvbXBsZXRlZFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIkNvbXBsZXRlZFwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwidG9rZW5SZW5ld1N0YXR1c0luUHJvZ3Jlc3NcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJJbiBQcm9ncmVzc1wiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwicG9wVXBXaWR0aFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9wb3BVcFdpZHRoOyB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHdpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcFVwV2lkdGggPSB3aWR0aDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwicG9wVXBIZWlnaHRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fcG9wVXBIZWlnaHQ7IH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAoaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3BvcFVwSGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJsb2dpblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcIkxPR0lOXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJyZW5ld1Rva2VuXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFwiUkVORVdfVE9LRU5cIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInVua25vd25cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJVTktOT1dOXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJob21lQWNjb3VudElkZW50aWZpZXJcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJob21lQWNjb3VudElkZW50aWZpZXJcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcImNvbW1vblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcImNvbW1vblwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwib3BlbmlkU2NvcGVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJvcGVuaWRcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcInByb2ZpbGVTY29wZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcInByb2ZpbGVcIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RhbnRzLCBcImNhY2hlTG9jYXRpb25Mb2NhbFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcImxvY2FsU3RvcmFnZVwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwiY2FjaGVMb2NhdGlvblNlc3Npb25cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJzZXNzaW9uU3RvcmFnZVwiOyB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdGFudHMsIFwiaW50ZXJhY3Rpb25UeXBlUmVkaXJlY3RcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gXCJyZWRpcmVjdEludGVyYWN0aW9uXCI7IH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0YW50cywgXCJpbnRlcmFjdGlvblR5cGVQb3B1cFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBcInBvcHVwSW50ZXJhY3Rpb25cIjsgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBDb25zdGFudHMuX3BvcFVwV2lkdGggPSA0ODM7XHJcbiAgICBDb25zdGFudHMuX3BvcFVwSGVpZ2h0ID0gNjAwO1xyXG4gICAgcmV0dXJuIENvbnN0YW50cztcclxufSgpKTtcclxuZXhwb3J0IHsgQ29uc3RhbnRzIH07XHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqIENhY2hlS2V5cyBmb3IgJ2F1dGhvcml0eScgYW5kICdhY2NvdW50J1xyXG4gKi9cclxuZXhwb3J0IHZhciBDYWNoZUtleXMgPSB7XHJcbiAgICBBVVRIT1JJVFk6IFwibXNhbC5hdXRob3JpdHlcIixcclxuICAgIEFDUVVJUkVfVE9LRU5fQUNDT1VOVDogXCJtc2FsLmFjcXVpcmVUb2tlbkFjY291bnRcIlxyXG59O1xyXG5leHBvcnQgdmFyIEFBRFRydXN0ZWRIb3N0TGlzdCA9IHtcclxuICAgIFwibG9naW4ud2luZG93cy5uZXRcIjogXCJsb2dpbi53aW5kb3dzLm5ldFwiLFxyXG4gICAgXCJsb2dpbi5jaGluYWNsb3VkYXBpLmNuXCI6IFwibG9naW4uY2hpbmFjbG91ZGFwaS5jblwiLFxyXG4gICAgXCJsb2dpbi5jbG91ZGdvdmFwaS51c1wiOiBcImxvZ2luLmNsb3VkZ292YXBpLnVzXCIsXHJcbiAgICBcImxvZ2luLm1pY3Jvc29mdG9ubGluZS5jb21cIjogXCJsb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tXCIsXHJcbiAgICBcImxvZ2luLm1pY3Jvc29mdG9ubGluZS5kZVwiOiBcImxvZ2luLm1pY3Jvc29mdG9ubGluZS5kZVwiLFxyXG4gICAgXCJsb2dpbi5taWNyb3NvZnRvbmxpbmUudXNcIjogXCJsb2dpbi5taWNyb3NvZnRvbmxpbmUudXNcIlxyXG59O1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKiBTU08gVHlwZXMgLSBnZW5lcmF0ZWQgdG8gcG9wdWxhdGUgaGludHNcclxuICovXHJcbmV4cG9ydCB2YXIgU1NPVHlwZXMgPSB7XHJcbiAgICBBQ0NPVU5UOiBcImFjY291bnRcIixcclxuICAgIFNJRDogXCJzaWRcIixcclxuICAgIExPR0lOX0hJTlQ6IFwibG9naW5faGludFwiLFxyXG4gICAgSURfVE9LRU46IFwiaWRfdG9rZW5cIixcclxuICAgIERPTUFJTl9ISU5UOiBcImRvbWFpbl9oaW50XCIsXHJcbiAgICBPUkdBTklaQVRJT05TOiBcIm9yZ2FuaXphdGlvbnNcIixcclxuICAgIENPTlNVTUVSUzogXCJjb25zdW1lcnNcIixcclxuICAgIEFDQ09VTlRfSUQ6IFwiYWNjb3VudElkZW50aWZpZXJcIixcclxuICAgIEhPTUVBQ0NPVU5UX0lEOiBcImhvbWVBY2NvdW50SWRlbnRpZmllclwiLFxyXG4gICAgTE9HSU5fUkVROiBcImxvZ2luX3JlcVwiLFxyXG4gICAgRE9NQUlOX1JFUTogXCJkb21haW5fcmVxXCJcclxufTtcclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbmV4cG9ydCB2YXIgQmxhY2tsaXN0ZWRFUVBhcmFtcyA9IFtcclxuICAgIFNTT1R5cGVzLlNJRCxcclxuICAgIFNTT1R5cGVzLkxPR0lOX0hJTlRcclxuXTtcclxuLyoqXHJcbiAqIHdlIGNvbnNpZGVyZWQgbWFraW5nIHRoaXMgXCJlbnVtXCIgaW4gdGhlIHJlcXVlc3QgaW5zdGVhZCBvZiBzdHJpbmcsIGhvd2V2ZXIgaXQgbG9va3MgbGlrZSB0aGUgYWxsb3dlZCBsaXN0IG9mXHJcbiAqIHByb21wdCB2YWx1ZXMga2VwdCBjaGFuZ2luZyBvdmVyIHBhc3QgY291cGxlIG9mIHllYXJzLiBUaGVyZSBhcmUgc29tZSB1bmRvY3VtZW50ZWQgcHJvbXB0IHZhbHVlcyBmb3Igc29tZVxyXG4gKiBpbnRlcm5hbCBwYXJ0bmVycyB0b28sIGhlbmNlIHRoZSBjaG9pY2Ugb2YgZ2VuZXJpYyBcInN0cmluZ1wiIHR5cGUgaW5zdGVhZCBvZiB0aGUgXCJlbnVtXCJcclxuICogQGhpZGRlblxyXG4gKi9cclxuZXhwb3J0IHZhciBQcm9tcHRTdGF0ZSA9IHtcclxuICAgIExPR0lOOiBcImxvZ2luXCIsXHJcbiAgICBTRUxFQ1RfQUNDT1VOVDogXCJzZWxlY3RfYWNjb3VudFwiLFxyXG4gICAgQ09OU0VOVDogXCJjb25zZW50XCIsXHJcbiAgICBOT05FOiBcIm5vbmVcIixcclxufTtcclxuLyoqXHJcbiAqIE1TQUwgSlMgTGlicmFyeSBWZXJzaW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbGlicmFyeVZlcnNpb24oKSB7XHJcbiAgICByZXR1cm4gXCIxLjEuM1wiO1xyXG59XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNvbnN0YW50cy5qcy5tYXAiLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgU2NvcGVTZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTY29wZVNldCgpIHtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAqIENoZWNrIGlmIHRoZXJlIGFyZSBkdXAgc2NvcGVzIGluIGEgZ2l2ZW4gcmVxdWVzdFxyXG4gICAqXHJcbiAgICogQHBhcmFtIGNhY2hlZFNjb3Blc1xyXG4gICAqIEBwYXJhbSBzY29wZXNcclxuICAgKi9cclxuICAgIC8vIFRPRE86IFJlbmFtZSB0aGlzLCBpbnRlcnNlY3Rpbmcgc2NvcGVzIGlzbid0IGEgZ3JlYXQgbmFtZSBmb3IgZHVwbGljYXRlIGNoZWNrZXJcclxuICAgIFNjb3BlU2V0LmlzSW50ZXJzZWN0aW5nU2NvcGVzID0gZnVuY3Rpb24gKGNhY2hlZFNjb3Blcywgc2NvcGVzKSB7XHJcbiAgICAgICAgY2FjaGVkU2NvcGVzID0gdGhpcy5jb252ZXJ0VG9Mb3dlckNhc2UoY2FjaGVkU2NvcGVzKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjb3Blcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiAoY2FjaGVkU2NvcGVzLmluZGV4T2Yoc2NvcGVzW2ldLnRvTG93ZXJDYXNlKCkpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENoZWNrIGlmIGEgZ2l2ZW4gc2NvcGUgaXMgcHJlc2VudCBpbiB0aGUgcmVxdWVzdFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjYWNoZWRTY29wZXNcclxuICAgICAqIEBwYXJhbSBzY29wZXNcclxuICAgICAqL1xyXG4gICAgU2NvcGVTZXQuY29udGFpbnNTY29wZSA9IGZ1bmN0aW9uIChjYWNoZWRTY29wZXMsIHNjb3Blcykge1xyXG4gICAgICAgIGNhY2hlZFNjb3BlcyA9IHRoaXMuY29udmVydFRvTG93ZXJDYXNlKGNhY2hlZFNjb3Blcyk7XHJcbiAgICAgICAgcmV0dXJuIHNjb3Blcy5ldmVyeShmdW5jdGlvbiAodmFsdWUpIHsgcmV0dXJuIGNhY2hlZFNjb3Blcy5pbmRleE9mKHZhbHVlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSkgPj0gMDsgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiB0b0xvd2VyXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNjb3Blc1xyXG4gICAgICovXHJcbiAgICAvLyBUT0RPOiBSZW5hbWUgdGhpcywgdG9vIGdlbmVyaWMgbmFtZSBmb3IgYSBmdW5jdGlvbiB0aGF0IG9ubHkgZGVhbHMgd2l0aCBzY29wZXNcclxuICAgIFNjb3BlU2V0LmNvbnZlcnRUb0xvd2VyQ2FzZSA9IGZ1bmN0aW9uIChzY29wZXMpIHtcclxuICAgICAgICByZXR1cm4gc2NvcGVzLm1hcChmdW5jdGlvbiAoc2NvcGUpIHsgcmV0dXJuIHNjb3BlLnRvTG93ZXJDYXNlKCk7IH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogcmVtb3ZlIG9uZSBlbGVtZW50IGZyb20gYSBzY29wZSBhcnJheVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzY29wZXNcclxuICAgICAqIEBwYXJhbSBzY29wZVxyXG4gICAgICovXHJcbiAgICAvLyBUT0RPOiBSZW5hbWUgdGhpcywgdG9vIGdlbmVyaWMgbmFtZSBmb3IgYSBmdW5jdGlvbiB0aGF0IG9ubHkgZGVhbHMgd2l0aCBzY29wZXNcclxuICAgIFNjb3BlU2V0LnJlbW92ZUVsZW1lbnQgPSBmdW5jdGlvbiAoc2NvcGVzLCBzY29wZSkge1xyXG4gICAgICAgIHJldHVybiBzY29wZXMuZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgIT09IHNjb3BlOyB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFBhcnNlIHRoZSBzY29wZXMgaW50byBhIGZvcm1hdHRlZCBzY29wZUxpc3RcclxuICAgICAqIEBwYXJhbSBzY29wZXNcclxuICAgICAqL1xyXG4gICAgU2NvcGVTZXQucGFyc2VTY29wZSA9IGZ1bmN0aW9uIChzY29wZXMpIHtcclxuICAgICAgICB2YXIgc2NvcGVMaXN0ID0gXCJcIjtcclxuICAgICAgICBpZiAoc2NvcGVzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcGVzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZUxpc3QgKz0gKGkgIT09IHNjb3Blcy5sZW5ndGggLSAxKSA/IHNjb3Blc1tpXSArIFwiIFwiIDogc2NvcGVzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzY29wZUxpc3Q7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFNjb3BlU2V0O1xyXG59KCkpO1xyXG5leHBvcnQgeyBTY29wZVNldCB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1TY29wZVNldC5qcy5tYXAiLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIFN0cmluZ1V0aWxzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENoZWNrIGlmIGEgc3RyaW5nIGlzIGVtcHR5XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHN0clxyXG4gICAgICovXHJcbiAgICBTdHJpbmdVdGlscy5pc0VtcHR5ID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgICAgIHJldHVybiAodHlwZW9mIHN0ciA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhc3RyIHx8IDAgPT09IHN0ci5sZW5ndGgpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTdHJpbmdVdGlscztcclxufSgpKTtcclxuZXhwb3J0IHsgU3RyaW5nVXRpbHMgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U3RyaW5nVXRpbHMuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0IHsgQ29uc3RhbnRzLCBTU09UeXBlcyB9IGZyb20gXCIuL0NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBTY29wZVNldCB9IGZyb20gXCIuLi9TY29wZVNldFwiO1xyXG5pbXBvcnQgeyBTdHJpbmdVdGlscyB9IGZyb20gJy4vU3RyaW5nVXRpbHMnO1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIFVybFV0aWxzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVXJsVXRpbHMoKSB7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIGdlbmVyYXRlcyB0aGUgVVJMIHdpdGggUXVlcnlTdHJpbmcgUGFyYW1ldGVyc1xyXG4gICAgICogQHBhcmFtIHNjb3Blc1xyXG4gICAgICovXHJcbiAgICBVcmxVdGlscy5jcmVhdGVOYXZpZ2F0ZVVybCA9IGZ1bmN0aW9uIChzZXJ2ZXJSZXF1ZXN0UGFyYW1zKSB7XHJcbiAgICAgICAgdmFyIHN0ciA9IHRoaXMuY3JlYXRlTmF2aWdhdGlvblVybFN0cmluZyhzZXJ2ZXJSZXF1ZXN0UGFyYW1zKTtcclxuICAgICAgICB2YXIgYXV0aEVuZHBvaW50ID0gc2VydmVyUmVxdWVzdFBhcmFtcy5hdXRob3JpdHlJbnN0YW5jZS5BdXRob3JpemF0aW9uRW5kcG9pbnQ7XHJcbiAgICAgICAgLy8gaWYgdGhlIGVuZHBvaW50IGFscmVhZHkgaGFzIHF1ZXJ5cGFyYW1zLCBsZXRzIGFkZCB0byBpdCwgb3RoZXJ3aXNlIGFkZCB0aGUgZmlyc3Qgb25lXHJcbiAgICAgICAgaWYgKGF1dGhFbmRwb2ludC5pbmRleE9mKFwiP1wiKSA8IDApIHtcclxuICAgICAgICAgICAgYXV0aEVuZHBvaW50ICs9IFwiP1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYXV0aEVuZHBvaW50ICs9IFwiJlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVxdWVzdFVybCA9IFwiXCIgKyBhdXRoRW5kcG9pbnQgKyBzdHIuam9pbihcIiZcIik7XHJcbiAgICAgICAgcmV0dXJuIHJlcXVlc3RVcmw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZW5lcmF0ZSB0aGUgYXJyYXkgb2YgYWxsIFF1ZXJ5U3RyaW5nUGFyYW1zIHRvIGJlIHNlbnQgdG8gdGhlIHNlcnZlclxyXG4gICAgICogQHBhcmFtIHNjb3Blc1xyXG4gICAgICovXHJcbiAgICBVcmxVdGlscy5jcmVhdGVOYXZpZ2F0aW9uVXJsU3RyaW5nID0gZnVuY3Rpb24gKHNlcnZlclJlcXVlc3RQYXJhbXMpIHtcclxuICAgICAgICB2YXIgc2NvcGVzID0gc2VydmVyUmVxdWVzdFBhcmFtcy5zY29wZXM7XHJcbiAgICAgICAgaWYgKHNjb3Blcy5pbmRleE9mKHNlcnZlclJlcXVlc3RQYXJhbXMuY2xpZW50SWQpID09PSAtMSkge1xyXG4gICAgICAgICAgICBzY29wZXMucHVzaChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLmNsaWVudElkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHN0ciA9IFtdO1xyXG4gICAgICAgIHN0ci5wdXNoKFwicmVzcG9uc2VfdHlwZT1cIiArIHNlcnZlclJlcXVlc3RQYXJhbXMucmVzcG9uc2VUeXBlKTtcclxuICAgICAgICB0aGlzLnRyYW5zbGF0ZWNsaWVudElkVXNlZEluU2NvcGUoc2NvcGVzLCBzZXJ2ZXJSZXF1ZXN0UGFyYW1zLmNsaWVudElkKTtcclxuICAgICAgICBzdHIucHVzaChcInNjb3BlPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KFNjb3BlU2V0LnBhcnNlU2NvcGUoc2NvcGVzKSkpO1xyXG4gICAgICAgIHN0ci5wdXNoKFwiY2xpZW50X2lkPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHNlcnZlclJlcXVlc3RQYXJhbXMuY2xpZW50SWQpKTtcclxuICAgICAgICBzdHIucHVzaChcInJlZGlyZWN0X3VyaT1cIiArIGVuY29kZVVSSUNvbXBvbmVudChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLnJlZGlyZWN0VXJpKSk7XHJcbiAgICAgICAgc3RyLnB1c2goXCJzdGF0ZT1cIiArIGVuY29kZVVSSUNvbXBvbmVudChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLnN0YXRlKSk7XHJcbiAgICAgICAgc3RyLnB1c2goXCJub25jZT1cIiArIGVuY29kZVVSSUNvbXBvbmVudChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLm5vbmNlKSk7XHJcbiAgICAgICAgc3RyLnB1c2goXCJjbGllbnRfaW5mbz0xXCIpO1xyXG4gICAgICAgIHN0ci5wdXNoKFwieC1jbGllbnQtU0tVPVwiICsgc2VydmVyUmVxdWVzdFBhcmFtcy54Q2xpZW50U2t1KTtcclxuICAgICAgICBzdHIucHVzaChcIngtY2xpZW50LVZlcj1cIiArIHNlcnZlclJlcXVlc3RQYXJhbXMueENsaWVudFZlcik7XHJcbiAgICAgICAgaWYgKHNlcnZlclJlcXVlc3RQYXJhbXMucHJvbXB0VmFsdWUpIHtcclxuICAgICAgICAgICAgc3RyLnB1c2goXCJwcm9tcHQ9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoc2VydmVyUmVxdWVzdFBhcmFtcy5wcm9tcHRWYWx1ZSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2VydmVyUmVxdWVzdFBhcmFtcy5jbGFpbXNWYWx1ZSkge1xyXG4gICAgICAgICAgICBzdHIucHVzaChcImNsYWltcz1cIiArIGVuY29kZVVSSUNvbXBvbmVudChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLmNsYWltc1ZhbHVlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLnF1ZXJ5UGFyYW1ldGVycykge1xyXG4gICAgICAgICAgICBzdHIucHVzaChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLnF1ZXJ5UGFyYW1ldGVycyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzZXJ2ZXJSZXF1ZXN0UGFyYW1zLmV4dHJhUXVlcnlQYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgIHN0ci5wdXNoKHNlcnZlclJlcXVlc3RQYXJhbXMuZXh0cmFRdWVyeVBhcmFtZXRlcnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzdHIucHVzaChcImNsaWVudC1yZXF1ZXN0LWlkPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHNlcnZlclJlcXVlc3RQYXJhbXMuY29ycmVsYXRpb25JZCkpO1xyXG4gICAgICAgIHJldHVybiBzdHI7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBhcHBlbmQgdGhlIHJlcXVpcmVkIHNjb3BlczogaHR0cHM6Ly9vcGVuaWQubmV0L3NwZWNzL29wZW5pZC1jb25uZWN0LWJhc2ljLTFfMC5odG1sI1Njb3Blc1xyXG4gICAgICogQHBhcmFtIHNjb3Blc1xyXG4gICAgICovXHJcbiAgICBVcmxVdGlscy50cmFuc2xhdGVjbGllbnRJZFVzZWRJblNjb3BlID0gZnVuY3Rpb24gKHNjb3BlcywgY2xpZW50SWQpIHtcclxuICAgICAgICB2YXIgY2xpZW50SWRJbmRleCA9IHNjb3Blcy5pbmRleE9mKGNsaWVudElkKTtcclxuICAgICAgICBpZiAoY2xpZW50SWRJbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgIHNjb3Blcy5zcGxpY2UoY2xpZW50SWRJbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGlmIChzY29wZXMuaW5kZXhPZihcIm9wZW5pZFwiKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHNjb3Blcy5wdXNoKFwib3BlbmlkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzY29wZXMuaW5kZXhPZihcInByb2ZpbGVcIikgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZXMucHVzaChcInByb2ZpbGVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGN1cnJlbnQgd2luZG93IFVSTCBhcyByZWRpcmVjdCB1cmlcclxuICAgICAqL1xyXG4gICAgVXJsVXRpbHMuZ2V0RGVmYXVsdFJlZGlyZWN0VXJpID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdChcIj9cIilbMF0uc3BsaXQoXCIjXCIpWzBdO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogR2l2ZW4gYSB1cmwgbGlrZSBodHRwczovL2E6Yi9jb21tb24vZD9lPWYjZywgYW5kIGEgdGVuYW50SWQsIHJldHVybnMgaHR0cHM6Ly9hOmIvdGVuYW50SWQvZFxyXG4gICAgICogQHBhcmFtIGhyZWYgVGhlIHVybFxyXG4gICAgICogQHBhcmFtIHRlbmFudElkIFRoZSB0ZW5hbnQgaWQgdG8gcmVwbGFjZVxyXG4gICAgICovXHJcbiAgICBVcmxVdGlscy5yZXBsYWNlVGVuYW50UGF0aCA9IGZ1bmN0aW9uICh1cmwsIHRlbmFudElkKSB7XHJcbiAgICAgICAgdXJsID0gdXJsLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgdmFyIHVybE9iamVjdCA9IHRoaXMuR2V0VXJsQ29tcG9uZW50cyh1cmwpO1xyXG4gICAgICAgIHZhciBwYXRoQXJyYXkgPSB1cmxPYmplY3QuUGF0aFNlZ21lbnRzO1xyXG4gICAgICAgIGlmICh0ZW5hbnRJZCAmJiAocGF0aEFycmF5Lmxlbmd0aCAhPT0gMCAmJiAocGF0aEFycmF5WzBdID09PSBDb25zdGFudHMuY29tbW9uIHx8IHBhdGhBcnJheVswXSA9PT0gU1NPVHlwZXMuT1JHQU5JWkFUSU9OUykpKSB7XHJcbiAgICAgICAgICAgIHBhdGhBcnJheVswXSA9IHRlbmFudElkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RBdXRob3JpdHlVcmlGcm9tT2JqZWN0KHVybE9iamVjdCwgcGF0aEFycmF5KTtcclxuICAgIH07XHJcbiAgICBVcmxVdGlscy5jb25zdHJ1Y3RBdXRob3JpdHlVcmlGcm9tT2JqZWN0ID0gZnVuY3Rpb24gKHVybE9iamVjdCwgcGF0aEFycmF5KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuQ2Fub25pY2FsaXplVXJpKHVybE9iamVjdC5Qcm90b2NvbCArIFwiLy9cIiArIHVybE9iamVjdC5Ib3N0TmFtZUFuZFBvcnQgKyBcIi9cIiArIHBhdGhBcnJheS5qb2luKFwiL1wiKSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBQYXJzZXMgb3V0IHRoZSBjb21wb25lbnRzIGZyb20gYSB1cmwgc3RyaW5nLlxyXG4gICAgICogQHJldHVybnMgQW4gb2JqZWN0IHdpdGggdGhlIHZhcmlvdXMgY29tcG9uZW50cy4gUGxlYXNlIGNhY2hlIHRoaXMgdmFsdWUgaW5zdGVkIG9mIGNhbGxpbmcgdGhpcyBtdWx0aXBsZSB0aW1lcyBvbiB0aGUgc2FtZSB1cmwuXHJcbiAgICAgKi9cclxuICAgIFVybFV0aWxzLkdldFVybENvbXBvbmVudHMgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgaWYgKCF1cmwpIHtcclxuICAgICAgICAgICAgdGhyb3cgXCJVcmwgcmVxdWlyZWRcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vY3VydGlzei8xMTEzOWIyY2ZjYWVmNGEyNjFlMFxyXG4gICAgICAgIHZhciByZWdFeCA9IFJlZ0V4cChcIl4oKFteOi8/I10rKTopPygvLyhbXi8/I10qKSk/KFtePyNdKikoXFxcXD8oW14jXSopKT8oIyguKikpP1wiKTtcclxuICAgICAgICB2YXIgbWF0Y2ggPSB1cmwubWF0Y2gocmVnRXgpO1xyXG4gICAgICAgIGlmICghbWF0Y2ggfHwgbWF0Y2gubGVuZ3RoIDwgNikge1xyXG4gICAgICAgICAgICB0aHJvdyBcIlZhbGlkIHVybCByZXF1aXJlZFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgdXJsQ29tcG9uZW50cyA9IHtcclxuICAgICAgICAgICAgUHJvdG9jb2w6IG1hdGNoWzFdLFxyXG4gICAgICAgICAgICBIb3N0TmFtZUFuZFBvcnQ6IG1hdGNoWzRdLFxyXG4gICAgICAgICAgICBBYnNvbHV0ZVBhdGg6IG1hdGNoWzVdXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgcGF0aFNlZ21lbnRzID0gdXJsQ29tcG9uZW50cy5BYnNvbHV0ZVBhdGguc3BsaXQoXCIvXCIpO1xyXG4gICAgICAgIHBhdGhTZWdtZW50cyA9IHBhdGhTZWdtZW50cy5maWx0ZXIoZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gdmFsICYmIHZhbC5sZW5ndGggPiAwOyB9KTsgLy8gcmVtb3ZlIGVtcHR5IGVsZW1lbnRzXHJcbiAgICAgICAgdXJsQ29tcG9uZW50cy5QYXRoU2VnbWVudHMgPSBwYXRoU2VnbWVudHM7XHJcbiAgICAgICAgcmV0dXJuIHVybENvbXBvbmVudHM7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBHaXZlbiBhIHVybCBvciBwYXRoLCBhcHBlbmQgYSB0cmFpbGluZyBzbGFzaCBpZiBvbmUgZG9lc250IGV4aXN0XHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVybFxyXG4gICAgICovXHJcbiAgICBVcmxVdGlscy5DYW5vbmljYWxpemVVcmkgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgaWYgKHVybCkge1xyXG4gICAgICAgICAgICB1cmwgPSB1cmwudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHVybCAmJiAhVXJsVXRpbHMuZW5kc1dpdGgodXJsLCBcIi9cIikpIHtcclxuICAgICAgICAgICAgdXJsICs9IFwiL1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdXJsO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2tzIHRvIHNlZSBpZiB0aGUgdXJsIGVuZHMgd2l0aCB0aGUgc3VmZml4XHJcbiAgICAgKiBSZXF1aXJlZCBiZWNhdXNlIHdlIGFyZSBjb21waWxpbmcgZm9yIGVzNSBpbnN0ZWFkIG9mIGVzNlxyXG4gICAgICogQHBhcmFtIHVybFxyXG4gICAgICogQHBhcmFtIHN0clxyXG4gICAgICovXHJcbiAgICAvLyBUT0RPOiBSZW5hbWUgdGhpcywgbm90IGNsZWFyIHdoYXQgaXQgaXMgc3VwcG9zZWQgdG8gZG9cclxuICAgIFVybFV0aWxzLmVuZHNXaXRoID0gZnVuY3Rpb24gKHVybCwgc3VmZml4KSB7XHJcbiAgICAgICAgaWYgKCF1cmwgfHwgIXN1ZmZpeCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1cmwuaW5kZXhPZihzdWZmaXgsIHVybC5sZW5ndGggLSBzdWZmaXgubGVuZ3RoKSAhPT0gLTE7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVdGlscyBmdW5jdGlvbiB0byByZW1vdmUgdGhlIGxvZ2luX2hpbnQgYW5kIGRvbWFpbl9oaW50IGZyb20gdGhlIGkvcCBleHRyYVF1ZXJ5UGFyYW1ldGVyc1xyXG4gICAgICogQHBhcmFtIHVybFxyXG4gICAgICogQHBhcmFtIG5hbWVcclxuICAgICAqL1xyXG4gICAgVXJsVXRpbHMudXJsUmVtb3ZlUXVlcnlTdHJpbmdQYXJhbWV0ZXIgPSBmdW5jdGlvbiAodXJsLCBuYW1lKSB7XHJcbiAgICAgICAgaWYgKFN0cmluZ1V0aWxzLmlzRW1wdHkodXJsKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdXJsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKFwiKFxcXFwmXCIgKyBuYW1lICsgXCI9KVteXFwmXStcIik7XHJcbiAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UocmVnZXgsIFwiXCIpO1xyXG4gICAgICAgIC8vIG5hbWU9dmFsdWUmXHJcbiAgICAgICAgcmVnZXggPSBuZXcgUmVnRXhwKFwiKFwiICsgbmFtZSArIFwiPSlbXlxcJl0rJlwiKTtcclxuICAgICAgICB1cmwgPSB1cmwucmVwbGFjZShyZWdleCwgXCJcIik7XHJcbiAgICAgICAgLy8gbmFtZT12YWx1ZVxyXG4gICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cChcIihcIiArIG5hbWUgKyBcIj0pW15cXCZdK1wiKTtcclxuICAgICAgICB1cmwgPSB1cmwucmVwbGFjZShyZWdleCwgXCJcIik7XHJcbiAgICAgICAgcmV0dXJuIHVybDtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqXHJcbiAgICAgKiBSZXR1cm5zIHRoZSBhbmNob3IgcGFydCgjKSBvZiB0aGUgVVJMXHJcbiAgICAgKi9cclxuICAgIFVybFV0aWxzLmdldEhhc2hGcm9tVXJsID0gZnVuY3Rpb24gKHVybFN0cmluZ09yRnJhZ21lbnQpIHtcclxuICAgICAgICB2YXIgaGFzaEluZGV4MSA9IHVybFN0cmluZ09yRnJhZ21lbnQuaW5kZXhPZihcIiNcIik7XHJcbiAgICAgICAgdmFyIGhhc2hJbmRleDIgPSB1cmxTdHJpbmdPckZyYWdtZW50LmluZGV4T2YoXCIjL1wiKTtcclxuICAgICAgICBpZiAoaGFzaEluZGV4MiA+IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1cmxTdHJpbmdPckZyYWdtZW50LnN1YnN0cmluZyhoYXNoSW5kZXgyICsgMik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGhhc2hJbmRleDEgPiAtMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdXJsU3RyaW5nT3JGcmFnbWVudC5zdWJzdHJpbmcoaGFzaEluZGV4MSArIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdXJsU3RyaW5nT3JGcmFnbWVudDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVXJsVXRpbHM7XHJcbn0oKSk7XHJcbmV4cG9ydCB7IFVybFV0aWxzIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVVybFV0aWxzLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCB7IENyeXB0b1V0aWxzIH0gZnJvbSBcIi4vdXRpbHMvQ3J5cHRvVXRpbHNcIjtcclxuaW1wb3J0IHsgVXJsVXRpbHMgfSBmcm9tIFwiLi91dGlscy9VcmxVdGlsc1wiO1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIEFjY2Vzc1Rva2VuS2V5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQWNjZXNzVG9rZW5LZXkoYXV0aG9yaXR5LCBjbGllbnRJZCwgc2NvcGVzLCB1aWQsIHV0aWQpIHtcclxuICAgICAgICB0aGlzLmF1dGhvcml0eSA9IFVybFV0aWxzLkNhbm9uaWNhbGl6ZVVyaShhdXRob3JpdHkpO1xyXG4gICAgICAgIHRoaXMuY2xpZW50SWQgPSBjbGllbnRJZDtcclxuICAgICAgICB0aGlzLnNjb3BlcyA9IHNjb3BlcztcclxuICAgICAgICB0aGlzLmhvbWVBY2NvdW50SWRlbnRpZmllciA9IENyeXB0b1V0aWxzLmJhc2U2NEVuY29kZSh1aWQpICsgXCIuXCIgKyBDcnlwdG9VdGlscy5iYXNlNjRFbmNvZGUodXRpZCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQWNjZXNzVG9rZW5LZXk7XHJcbn0oKSk7XHJcbmV4cG9ydCB7IEFjY2Vzc1Rva2VuS2V5IH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUFjY2Vzc1Rva2VuS2V5LmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG52YXIgQWNjZXNzVG9rZW5WYWx1ZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEFjY2Vzc1Rva2VuVmFsdWUoYWNjZXNzVG9rZW4sIGlkVG9rZW4sIGV4cGlyZXNJbiwgaG9tZUFjY291bnRJZGVudGlmaWVyKSB7XHJcbiAgICAgICAgdGhpcy5hY2Nlc3NUb2tlbiA9IGFjY2Vzc1Rva2VuO1xyXG4gICAgICAgIHRoaXMuaWRUb2tlbiA9IGlkVG9rZW47XHJcbiAgICAgICAgdGhpcy5leHBpcmVzSW4gPSBleHBpcmVzSW47XHJcbiAgICAgICAgdGhpcy5ob21lQWNjb3VudElkZW50aWZpZXIgPSBob21lQWNjb3VudElkZW50aWZpZXI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQWNjZXNzVG9rZW5WYWx1ZTtcclxufSgpKTtcclxuZXhwb3J0IHsgQWNjZXNzVG9rZW5WYWx1ZSB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BY2Nlc3NUb2tlblZhbHVlLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmV4cG9ydCB2YXIgQXV0aEVycm9yTWVzc2FnZSA9IHtcclxuICAgIHVuZXhwZWN0ZWRFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwidW5leHBlY3RlZF9lcnJvclwiLFxyXG4gICAgICAgIGRlc2M6IFwiVW5leHBlY3RlZCBlcnJvciBpbiBhdXRoZW50aWNhdGlvbi5cIlxyXG4gICAgfVxyXG59O1xyXG4vKipcclxuKiBHZW5lcmFsIGVycm9yIGNsYXNzIHRocm93biBieSB0aGUgTVNBTC5qcyBsaWJyYXJ5LlxyXG4qL1xyXG52YXIgQXV0aEVycm9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoQXV0aEVycm9yLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQXV0aEVycm9yKGVycm9yQ29kZSwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZXJyb3JNZXNzYWdlKSB8fCB0aGlzO1xyXG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihfdGhpcywgQXV0aEVycm9yLnByb3RvdHlwZSk7XHJcbiAgICAgICAgX3RoaXMuZXJyb3JDb2RlID0gZXJyb3JDb2RlO1xyXG4gICAgICAgIF90aGlzLmVycm9yTWVzc2FnZSA9IGVycm9yTWVzc2FnZTtcclxuICAgICAgICBfdGhpcy5uYW1lID0gXCJBdXRoRXJyb3JcIjtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBBdXRoRXJyb3IuY3JlYXRlVW5leHBlY3RlZEVycm9yID0gZnVuY3Rpb24gKGVyckRlc2MpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEF1dGhFcnJvcihBdXRoRXJyb3JNZXNzYWdlLnVuZXhwZWN0ZWRFcnJvci5jb2RlLCBBdXRoRXJyb3JNZXNzYWdlLnVuZXhwZWN0ZWRFcnJvci5kZXNjICsgXCI6IFwiICsgZXJyRGVzYyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEF1dGhFcnJvcjtcclxufShFcnJvcikpO1xyXG5leHBvcnQgeyBBdXRoRXJyb3IgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QXV0aEVycm9yLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IEF1dGhFcnJvciB9IGZyb20gXCIuL0F1dGhFcnJvclwiO1xyXG5pbXBvcnQgeyBTdHJpbmdVdGlscyB9IGZyb20gXCIuLi91dGlscy9TdHJpbmdVdGlsc1wiO1xyXG5leHBvcnQgdmFyIENsaWVudEF1dGhFcnJvck1lc3NhZ2UgPSB7XHJcbiAgICBtdWx0aXBsZU1hdGNoaW5nVG9rZW5zOiB7XHJcbiAgICAgICAgY29kZTogXCJtdWx0aXBsZV9tYXRjaGluZ190b2tlbnNcIixcclxuICAgICAgICBkZXNjOiBcIlRoZSBjYWNoZSBjb250YWlucyBtdWx0aXBsZSB0b2tlbnMgc2F0aXNmeWluZyB0aGUgcmVxdWlyZW1lbnRzLiBcIiArXHJcbiAgICAgICAgICAgIFwiQ2FsbCBBY3F1aXJlVG9rZW4gYWdhaW4gcHJvdmlkaW5nIG1vcmUgcmVxdWlyZW1lbnRzIGxpa2UgYXV0aG9yaXR5LlwiXHJcbiAgICB9LFxyXG4gICAgbXVsdGlwbGVDYWNoZUF1dGhvcml0aWVzOiB7XHJcbiAgICAgICAgY29kZTogXCJtdWx0aXBsZV9hdXRob3JpdGllc1wiLFxyXG4gICAgICAgIGRlc2M6IFwiTXVsdGlwbGUgYXV0aG9yaXRpZXMgZm91bmQgaW4gdGhlIGNhY2hlLiBQYXNzIGF1dGhvcml0eSBpbiB0aGUgQVBJIG92ZXJsb2FkLlwiXHJcbiAgICB9LFxyXG4gICAgZW5kcG9pbnRSZXNvbHV0aW9uRXJyb3I6IHtcclxuICAgICAgICBjb2RlOiBcImVuZHBvaW50c19yZXNvbHV0aW9uX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJFcnJvcjogY291bGQgbm90IHJlc29sdmUgZW5kcG9pbnRzLiBQbGVhc2UgY2hlY2sgbmV0d29yayBhbmQgdHJ5IGFnYWluLlwiXHJcbiAgICB9LFxyXG4gICAgcG9wVXBXaW5kb3dFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwicG9wdXBfd2luZG93X2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJFcnJvciBvcGVuaW5nIHBvcHVwIHdpbmRvdy4gVGhpcyBjYW4gaGFwcGVuIGlmIHlvdSBhcmUgdXNpbmcgSUUgb3IgaWYgcG9wdXBzIGFyZSBibG9ja2VkIGluIHRoZSBicm93c2VyLlwiXHJcbiAgICB9LFxyXG4gICAgdG9rZW5SZW5ld2FsRXJyb3I6IHtcclxuICAgICAgICBjb2RlOiBcInRva2VuX3JlbmV3YWxfZXJyb3JcIixcclxuICAgICAgICBkZXNjOiBcIlRva2VuIHJlbmV3YWwgb3BlcmF0aW9uIGZhaWxlZCBkdWUgdG8gdGltZW91dC5cIlxyXG4gICAgfSxcclxuICAgIGludmFsaWRJZFRva2VuOiB7XHJcbiAgICAgICAgY29kZTogXCJpbnZhbGlkX2lkX3Rva2VuXCIsXHJcbiAgICAgICAgZGVzYzogXCJJbnZhbGlkIElEIHRva2VuIGZvcm1hdC5cIlxyXG4gICAgfSxcclxuICAgIGludmFsaWRTdGF0ZUVycm9yOiB7XHJcbiAgICAgICAgY29kZTogXCJpbnZhbGlkX3N0YXRlX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJJbnZhbGlkIHN0YXRlLlwiXHJcbiAgICB9LFxyXG4gICAgbm9uY2VNaXNtYXRjaEVycm9yOiB7XHJcbiAgICAgICAgY29kZTogXCJub25jZV9taXNtYXRjaF9lcnJvclwiLFxyXG4gICAgICAgIGRlc2M6IFwiTm9uY2UgaXMgbm90IG1hdGNoaW5nLCBOb25jZSByZWNlaXZlZDogXCJcclxuICAgIH0sXHJcbiAgICBsb2dpblByb2dyZXNzRXJyb3I6IHtcclxuICAgICAgICBjb2RlOiBcImxvZ2luX3Byb2dyZXNzX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJMb2dpbl9Jbl9Qcm9ncmVzczogRXJyb3IgZHVyaW5nIGxvZ2luIGNhbGwgLSBsb2dpbiBpcyBhbHJlYWR5IGluIHByb2dyZXNzLlwiXHJcbiAgICB9LFxyXG4gICAgYWNxdWlyZVRva2VuUHJvZ3Jlc3NFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwiYWNxdWlyZXRva2VuX3Byb2dyZXNzX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJBY3F1aXJlVG9rZW5fSW5fUHJvZ3Jlc3M6IEVycm9yIGR1cmluZyBsb2dpbiBjYWxsIC0gbG9naW4gaXMgYWxyZWFkeSBpbiBwcm9ncmVzcy5cIlxyXG4gICAgfSxcclxuICAgIHVzZXJDYW5jZWxsZWRFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwidXNlcl9jYW5jZWxsZWRcIixcclxuICAgICAgICBkZXNjOiBcIlVzZXIgY2FuY2VsbGVkIHRoZSBmbG93LlwiXHJcbiAgICB9LFxyXG4gICAgY2FsbGJhY2tFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwiY2FsbGJhY2tfZXJyb3JcIixcclxuICAgICAgICBkZXNjOiBcIkVycm9yIG9jY3VycmVkIGluIHRva2VuIHJlY2VpdmVkIGNhbGxiYWNrIGZ1bmN0aW9uLlwiXHJcbiAgICB9LFxyXG4gICAgdXNlckxvZ2luUmVxdWlyZWRFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwidXNlcl9sb2dpbl9lcnJvclwiLFxyXG4gICAgICAgIGRlc2M6IFwiVXNlciBsb2dpbiBpcyByZXF1aXJlZC5cIlxyXG4gICAgfSxcclxuICAgIHVzZXJEb2VzTm90RXhpc3RFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwidXNlcl9ub25fZXhpc3RlbnRcIixcclxuICAgICAgICBkZXNjOiBcIlVzZXIgb2JqZWN0IGRvZXMgbm90IGV4aXN0LiBQbGVhc2UgY2FsbCBhIGxvZ2luIEFQSS5cIlxyXG4gICAgfSxcclxuICAgIGNsaWVudEluZm9EZWNvZGluZ0Vycm9yOiB7XHJcbiAgICAgICAgY29kZTogXCJjbGllbnRfaW5mb19kZWNvZGluZ19lcnJvclwiLFxyXG4gICAgICAgIGRlc2M6IFwiVGhlIGNsaWVudCBpbmZvIGNvdWxkIG5vdCBiZSBwYXJzZWQvZGVjb2RlZCBjb3JyZWN0bHkuIFBsZWFzZSByZXZpZXcgdGhlIHRyYWNlIHRvIGRldGVybWluZSB0aGUgcm9vdCBjYXVzZS5cIlxyXG4gICAgfSxcclxuICAgIGNsaWVudEluZm9Ob3RQb3B1bGF0ZWRFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwiY2xpZW50X2luZm9fbm90X3BvcHVsYXRlZF9lcnJvclwiLFxyXG4gICAgICAgIGRlc2M6IFwiVGhlIHNlcnZpY2UgZGlkIG5vdCBwb3B1bGF0ZSBjbGllbnRfaW5mbyBpbiB0aGUgcmVzcG9uc2UsIFBsZWFzZSB2ZXJpZnkgd2l0aCB0aGUgc2VydmljZSB0ZWFtXCJcclxuICAgIH0sXHJcbiAgICBudWxsT3JFbXB0eUlkVG9rZW46IHtcclxuICAgICAgICBjb2RlOiBcIm51bGxfb3JfZW1wdHlfaWRfdG9rZW5cIixcclxuICAgICAgICBkZXNjOiBcIlRoZSBpZFRva2VuIGlzIG51bGwgb3IgZW1wdHkuIFBsZWFzZSByZXZpZXcgdGhlIHRyYWNlIHRvIGRldGVybWluZSB0aGUgcm9vdCBjYXVzZS5cIlxyXG4gICAgfSxcclxuICAgIGlkVG9rZW5Ob3RQYXJzZWQ6IHtcclxuICAgICAgICBjb2RlOiBcImlkX3Rva2VuX3BhcnNpbmdfZXJyb3JcIixcclxuICAgICAgICBkZXNjOiBcIklEIHRva2VuIGNhbm5vdCBiZSBwYXJzZWQuIFBsZWFzZSByZXZpZXcgc3RhY2sgdHJhY2UgdG8gZGV0ZXJtaW5lIHJvb3QgY2F1c2UuXCJcclxuICAgIH0sXHJcbiAgICB0b2tlbkVuY29kaW5nRXJyb3I6IHtcclxuICAgICAgICBjb2RlOiBcInRva2VuX2VuY29kaW5nX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJUaGUgdG9rZW4gdG8gYmUgZGVjb2RlZCBpcyBub3QgZW5jb2RlZCBjb3JyZWN0bHkuXCJcclxuICAgIH0sXHJcbiAgICBpbnZhbGlkSW50ZXJhY3Rpb25UeXBlOiB7XHJcbiAgICAgICAgY29kZTogXCJpbnZhbGlkX2ludGVyYWN0aW9uX3R5cGVcIixcclxuICAgICAgICBkZXNjOiBcIlRoZSBpbnRlcmFjdGlvbiB0eXBlIHBhc3NlZCB0byB0aGUgaGFuZGxlciB3YXMgaW5jb3JyZWN0IG9yIHVua25vd25cIlxyXG4gICAgfVxyXG59O1xyXG4vKipcclxuICogRXJyb3IgdGhyb3duIHdoZW4gdGhlcmUgaXMgYW4gZXJyb3IgaW4gdGhlIGNsaWVudCBjb2RlIHJ1bm5pbmcgb24gdGhlIGJyb3dzZXIuXHJcbiAqL1xyXG52YXIgQ2xpZW50QXV0aEVycm9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoQ2xpZW50QXV0aEVycm9yLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2xpZW50QXV0aEVycm9yKGVycm9yQ29kZSwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZXJyb3JDb2RlLCBlcnJvck1lc3NhZ2UpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMubmFtZSA9IFwiQ2xpZW50QXV0aEVycm9yXCI7XHJcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKF90aGlzLCBDbGllbnRBdXRoRXJyb3IucHJvdG90eXBlKTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBDbGllbnRBdXRoRXJyb3IuY3JlYXRlRW5kcG9pbnRSZXNvbHV0aW9uRXJyb3IgPSBmdW5jdGlvbiAoZXJyRGV0YWlsKSB7XHJcbiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IENsaWVudEF1dGhFcnJvck1lc3NhZ2UuZW5kcG9pbnRSZXNvbHV0aW9uRXJyb3IuZGVzYztcclxuICAgICAgICBpZiAoZXJyRGV0YWlsICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGVyckRldGFpbCkpIHtcclxuICAgICAgICAgICAgZXJyb3JNZXNzYWdlICs9IFwiIERldGFpbHM6IFwiICsgZXJyRGV0YWlsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudEF1dGhFcnJvcihDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmVuZHBvaW50UmVzb2x1dGlvbkVycm9yLmNvZGUsIGVycm9yTWVzc2FnZSk7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZU11bHRpcGxlTWF0Y2hpbmdUb2tlbnNJbkNhY2hlRXJyb3IgPSBmdW5jdGlvbiAoc2NvcGUpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudEF1dGhFcnJvcihDbGllbnRBdXRoRXJyb3JNZXNzYWdlLm11bHRpcGxlTWF0Y2hpbmdUb2tlbnMuY29kZSwgXCJDYWNoZSBlcnJvciBmb3Igc2NvcGUgXCIgKyBzY29wZSArIFwiOiBcIiArIENsaWVudEF1dGhFcnJvck1lc3NhZ2UubXVsdGlwbGVNYXRjaGluZ1Rva2Vucy5kZXNjICsgXCIuXCIpO1xyXG4gICAgfTtcclxuICAgIENsaWVudEF1dGhFcnJvci5jcmVhdGVNdWx0aXBsZUF1dGhvcml0aWVzSW5DYWNoZUVycm9yID0gZnVuY3Rpb24gKHNjb3BlKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5tdWx0aXBsZUNhY2hlQXV0aG9yaXRpZXMuY29kZSwgXCJDYWNoZSBlcnJvciBmb3Igc2NvcGUgXCIgKyBzY29wZSArIFwiOiBcIiArIENsaWVudEF1dGhFcnJvck1lc3NhZ2UubXVsdGlwbGVDYWNoZUF1dGhvcml0aWVzLmRlc2MgKyBcIi5cIik7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZVBvcHVwV2luZG93RXJyb3IgPSBmdW5jdGlvbiAoZXJyRGV0YWlsKSB7XHJcbiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IENsaWVudEF1dGhFcnJvck1lc3NhZ2UucG9wVXBXaW5kb3dFcnJvci5kZXNjO1xyXG4gICAgICAgIGlmIChlcnJEZXRhaWwgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoZXJyRGV0YWlsKSkge1xyXG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgKz0gXCIgRGV0YWlsczogXCIgKyBlcnJEZXRhaWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50QXV0aEVycm9yKENsaWVudEF1dGhFcnJvck1lc3NhZ2UucG9wVXBXaW5kb3dFcnJvci5jb2RlLCBlcnJvck1lc3NhZ2UpO1xyXG4gICAgfTtcclxuICAgIENsaWVudEF1dGhFcnJvci5jcmVhdGVUb2tlblJlbmV3YWxUaW1lb3V0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS50b2tlblJlbmV3YWxFcnJvci5jb2RlLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLnRva2VuUmVuZXdhbEVycm9yLmRlc2MpO1xyXG4gICAgfTtcclxuICAgIENsaWVudEF1dGhFcnJvci5jcmVhdGVJbnZhbGlkSWRUb2tlbkVycm9yID0gZnVuY3Rpb24gKGlkVG9rZW4pIHtcclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudEF1dGhFcnJvcihDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmludmFsaWRJZFRva2VuLmNvZGUsIENsaWVudEF1dGhFcnJvck1lc3NhZ2UuaW52YWxpZElkVG9rZW4uZGVzYyArIFwiIEdpdmVuIHRva2VuOiBcIiArIGlkVG9rZW4pO1xyXG4gICAgfTtcclxuICAgIC8vVE9ETzogSXMgdGhpcyBub3QgYSBzZWN1cml0eSBmbGF3IHRvIHNlbmQgdGhlIHVzZXIgdGhlIHN0YXRlIGV4cGVjdGVkPz9cclxuICAgIENsaWVudEF1dGhFcnJvci5jcmVhdGVJbnZhbGlkU3RhdGVFcnJvciA9IGZ1bmN0aW9uIChpbnZhbGlkU3RhdGUsIGFjdHVhbFN0YXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5pbnZhbGlkU3RhdGVFcnJvci5jb2RlLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmludmFsaWRTdGF0ZUVycm9yLmRlc2MgKyBcIiBcIiArIGludmFsaWRTdGF0ZSArIFwiLCBzdGF0ZSBleHBlY3RlZCA6IFwiICsgYWN0dWFsU3RhdGUgKyBcIi5cIik7XHJcbiAgICB9O1xyXG4gICAgLy9UT0RPOiBJcyB0aGlzIG5vdCBhIHNlY3VyaXR5IGZsYXcgdG8gc2VuZCB0aGUgdXNlciB0aGUgTm9uY2UgZXhwZWN0ZWQ/P1xyXG4gICAgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZU5vbmNlTWlzbWF0Y2hFcnJvciA9IGZ1bmN0aW9uIChpbnZhbGlkTm9uY2UsIGFjdHVhbE5vbmNlKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5ub25jZU1pc21hdGNoRXJyb3IuY29kZSwgQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5ub25jZU1pc21hdGNoRXJyb3IuZGVzYyArIFwiIFwiICsgaW52YWxpZE5vbmNlICsgXCIsIG5vbmNlIGV4cGVjdGVkIDogXCIgKyBhY3R1YWxOb25jZSArIFwiLlwiKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRBdXRoRXJyb3IuY3JlYXRlTG9naW5JblByb2dyZXNzRXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5sb2dpblByb2dyZXNzRXJyb3IuY29kZSwgQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5sb2dpblByb2dyZXNzRXJyb3IuZGVzYyk7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZUFjcXVpcmVUb2tlbkluUHJvZ3Jlc3NFcnJvciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudEF1dGhFcnJvcihDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmFjcXVpcmVUb2tlblByb2dyZXNzRXJyb3IuY29kZSwgQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5hY3F1aXJlVG9rZW5Qcm9ncmVzc0Vycm9yLmRlc2MpO1xyXG4gICAgfTtcclxuICAgIENsaWVudEF1dGhFcnJvci5jcmVhdGVVc2VyQ2FuY2VsbGVkRXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS51c2VyQ2FuY2VsbGVkRXJyb3IuY29kZSwgQ2xpZW50QXV0aEVycm9yTWVzc2FnZS51c2VyQ2FuY2VsbGVkRXJyb3IuZGVzYyk7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZUVycm9ySW5DYWxsYmFja0Z1bmN0aW9uID0gZnVuY3Rpb24gKGVycm9yRGVzYykge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50QXV0aEVycm9yKENsaWVudEF1dGhFcnJvck1lc3NhZ2UuY2FsbGJhY2tFcnJvci5jb2RlLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmNhbGxiYWNrRXJyb3IuZGVzYyArIFwiIFwiICsgZXJyb3JEZXNjICsgXCIuXCIpO1xyXG4gICAgfTtcclxuICAgIENsaWVudEF1dGhFcnJvci5jcmVhdGVVc2VyTG9naW5SZXF1aXJlZEVycm9yID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50QXV0aEVycm9yKENsaWVudEF1dGhFcnJvck1lc3NhZ2UudXNlckxvZ2luUmVxdWlyZWRFcnJvci5jb2RlLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLnVzZXJMb2dpblJlcXVpcmVkRXJyb3IuZGVzYyk7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZVVzZXJEb2VzTm90RXhpc3RFcnJvciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudEF1dGhFcnJvcihDbGllbnRBdXRoRXJyb3JNZXNzYWdlLnVzZXJEb2VzTm90RXhpc3RFcnJvci5jb2RlLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLnVzZXJEb2VzTm90RXhpc3RFcnJvci5kZXNjKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRBdXRoRXJyb3IuY3JlYXRlQ2xpZW50SW5mb0RlY29kaW5nRXJyb3IgPSBmdW5jdGlvbiAoY2F1Z2h0RXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudEF1dGhFcnJvcihDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmNsaWVudEluZm9EZWNvZGluZ0Vycm9yLmNvZGUsIENsaWVudEF1dGhFcnJvck1lc3NhZ2UuY2xpZW50SW5mb0RlY29kaW5nRXJyb3IuZGVzYyArIFwiIEZhaWxlZCB3aXRoIGVycm9yOiBcIiArIGNhdWdodEVycm9yKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRBdXRoRXJyb3IuY3JlYXRlQ2xpZW50SW5mb05vdFBvcHVsYXRlZEVycm9yID0gZnVuY3Rpb24gKGNhdWdodEVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5jbGllbnRJbmZvTm90UG9wdWxhdGVkRXJyb3IuY29kZSwgQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5jbGllbnRJbmZvTm90UG9wdWxhdGVkRXJyb3IuZGVzYyArIFwiIEZhaWxlZCB3aXRoIGVycm9yOiBcIiArIGNhdWdodEVycm9yKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRBdXRoRXJyb3IuY3JlYXRlSWRUb2tlbk51bGxPckVtcHR5RXJyb3IgPSBmdW5jdGlvbiAoaW52YWxpZFJhd1Rva2VuU3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRBdXRoRXJyb3IoQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5udWxsT3JFbXB0eUlkVG9rZW4uY29kZSwgQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5udWxsT3JFbXB0eUlkVG9rZW4uZGVzYyArIFwiIFJhdyBJRCBUb2tlbiBWYWx1ZTogXCIgKyBpbnZhbGlkUmF3VG9rZW5TdHJpbmcpO1xyXG4gICAgfTtcclxuICAgIENsaWVudEF1dGhFcnJvci5jcmVhdGVJZFRva2VuUGFyc2luZ0Vycm9yID0gZnVuY3Rpb24gKGNhdWdodFBhcnNpbmdFcnJvcikge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50QXV0aEVycm9yKENsaWVudEF1dGhFcnJvck1lc3NhZ2UuaWRUb2tlbk5vdFBhcnNlZC5jb2RlLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmlkVG9rZW5Ob3RQYXJzZWQuZGVzYyArIFwiIEZhaWxlZCB3aXRoIGVycm9yOiBcIiArIGNhdWdodFBhcnNpbmdFcnJvcik7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZVRva2VuRW5jb2RpbmdFcnJvciA9IGZ1bmN0aW9uIChpbmNvcnJlY3RseUVuY29kZWRUb2tlbikge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50QXV0aEVycm9yKENsaWVudEF1dGhFcnJvck1lc3NhZ2UudG9rZW5FbmNvZGluZ0Vycm9yLmNvZGUsIENsaWVudEF1dGhFcnJvck1lc3NhZ2UudG9rZW5FbmNvZGluZ0Vycm9yLmRlc2MgKyBcIiBBdHRlbXB0ZWQgdG8gZGVjb2RlOiBcIiArIGluY29ycmVjdGx5RW5jb2RlZFRva2VuKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRBdXRoRXJyb3IuY3JlYXRlSW52YWxpZEludGVyYWN0aW9uVHlwZUVycm9yID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50QXV0aEVycm9yKENsaWVudEF1dGhFcnJvck1lc3NhZ2UuaW52YWxpZEludGVyYWN0aW9uVHlwZS5jb2RlLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLmludmFsaWRJbnRlcmFjdGlvblR5cGUuZGVzYyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENsaWVudEF1dGhFcnJvcjtcclxufShBdXRoRXJyb3IpKTtcclxuZXhwb3J0IHsgQ2xpZW50QXV0aEVycm9yIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNsaWVudEF1dGhFcnJvci5qcy5tYXAiLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5pbXBvcnQgKiBhcyB0c2xpYl8xIGZyb20gXCJ0c2xpYlwiO1xyXG5pbXBvcnQgeyBDb25zdGFudHMgfSBmcm9tIFwiLi4vdXRpbHMvQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IENsaWVudEF1dGhFcnJvciB9IGZyb20gXCIuL0NsaWVudEF1dGhFcnJvclwiO1xyXG5leHBvcnQgdmFyIENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UgPSB7XHJcbiAgICBjb25maWd1cmF0aW9uTm90U2V0OiB7XHJcbiAgICAgICAgY29kZTogXCJub19jb25maWdfc2V0XCIsXHJcbiAgICAgICAgZGVzYzogXCJDb25maWd1cmF0aW9uIGhhcyBub3QgYmVlbiBzZXQuIFBsZWFzZSBjYWxsIHRoZSBVc2VyQWdlbnRBcHBsaWNhdGlvbiBjb25zdHJ1Y3RvciB3aXRoIGEgdmFsaWQgQ29uZmlndXJhdGlvbiBvYmplY3QuXCJcclxuICAgIH0sXHJcbiAgICBpbnZhbGlkQ2FjaGVMb2NhdGlvbjoge1xyXG4gICAgICAgIGNvZGU6IFwiaW52YWxpZF9jYWNoZV9sb2NhdGlvblwiLFxyXG4gICAgICAgIGRlc2M6IFwiVGhlIGNhY2hlIGxvY2F0aW9uIHByb3ZpZGVkIGlzIG5vdCB2YWxpZC5cIlxyXG4gICAgfSxcclxuICAgIG5vU3RvcmFnZVN1cHBvcnRlZDoge1xyXG4gICAgICAgIGNvZGU6IFwiYnJvd3Nlcl9zdG9yYWdlX25vdF9zdXBwb3J0ZWRcIixcclxuICAgICAgICBkZXNjOiBcImxvY2FsU3RvcmFnZSBhbmQgc2Vzc2lvblN0b3JhZ2UgYXJlIG5vdCBzdXBwb3J0ZWQuXCJcclxuICAgIH0sXHJcbiAgICBub1JlZGlyZWN0Q2FsbGJhY2tzU2V0OiB7XHJcbiAgICAgICAgY29kZTogXCJub19yZWRpcmVjdF9jYWxsYmFja3NcIixcclxuICAgICAgICBkZXNjOiBcIk5vIHJlZGlyZWN0IGNhbGxiYWNrcyBoYXZlIGJlZW4gc2V0LiBQbGVhc2UgY2FsbCBzZXRSZWRpcmVjdENhbGxiYWNrcygpIHdpdGggdGhlIGFwcHJvcHJpYXRlIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWZvcmUgY29udGludWluZy4gXCIgK1xyXG4gICAgICAgICAgICBcIk1vcmUgaW5mb3JtYXRpb24gaXMgYXZhaWxhYmxlIGhlcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9BenVyZUFEL21pY3Jvc29mdC1hdXRoZW50aWNhdGlvbi1saWJyYXJ5LWZvci1qcy93aWtpL01TQUwtYmFzaWNzLlwiXHJcbiAgICB9LFxyXG4gICAgaW52YWxpZENhbGxiYWNrT2JqZWN0OiB7XHJcbiAgICAgICAgY29kZTogXCJpbnZhbGlkX2NhbGxiYWNrX29iamVjdFwiLFxyXG4gICAgICAgIGRlc2M6IFwiVGhlIG9iamVjdCBwYXNzZWQgZm9yIHRoZSBjYWxsYmFjayB3YXMgaW52YWxpZC4gXCIgK1xyXG4gICAgICAgICAgICBcIk1vcmUgaW5mb3JtYXRpb24gaXMgYXZhaWxhYmxlIGhlcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9BenVyZUFEL21pY3Jvc29mdC1hdXRoZW50aWNhdGlvbi1saWJyYXJ5LWZvci1qcy93aWtpL01TQUwtYmFzaWNzLlwiXHJcbiAgICB9LFxyXG4gICAgc2NvcGVzUmVxdWlyZWQ6IHtcclxuICAgICAgICBjb2RlOiBcInNjb3Blc19yZXF1aXJlZFwiLFxyXG4gICAgICAgIGRlc2M6IFwiU2NvcGVzIGFyZSByZXF1aXJlZCB0byBvYnRhaW4gYW4gYWNjZXNzIHRva2VuLlwiXHJcbiAgICB9LFxyXG4gICAgZW1wdHlTY29wZXM6IHtcclxuICAgICAgICBjb2RlOiBcImVtcHR5X2lucHV0X3Njb3Blc19lcnJvclwiLFxyXG4gICAgICAgIGRlc2M6IFwiU2NvcGVzIGNhbm5vdCBiZSBwYXNzZWQgYXMgZW1wdHkgYXJyYXkuXCJcclxuICAgIH0sXHJcbiAgICBub25BcnJheVNjb3Blczoge1xyXG4gICAgICAgIGNvZGU6IFwibm9uYXJyYXlfaW5wdXRfc2NvcGVzX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJTY29wZXMgY2Fubm90IGJlIHBhc3NlZCBhcyBub24tYXJyYXkuXCJcclxuICAgIH0sXHJcbiAgICBjbGllbnRTY29wZToge1xyXG4gICAgICAgIGNvZGU6IFwiY2xpZW50aWRfaW5wdXRfc2NvcGVzX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJDbGllbnQgSUQgY2FuIG9ubHkgYmUgcHJvdmlkZWQgYXMgYSBzaW5nbGUgc2NvcGUuXCJcclxuICAgIH0sXHJcbiAgICBpbnZhbGlkUHJvbXB0OiB7XHJcbiAgICAgICAgY29kZTogXCJpbnZhbGlkX3Byb21wdF92YWx1ZVwiLFxyXG4gICAgICAgIGRlc2M6IFwiU3VwcG9ydGVkIHByb21wdCB2YWx1ZXMgYXJlICdsb2dpbicsICdzZWxlY3RfYWNjb3VudCcsICdjb25zZW50JyBhbmQgJ25vbmUnXCIsXHJcbiAgICB9LFxyXG4gICAgaW52YWxpZEF1dGhvcml0eVR5cGU6IHtcclxuICAgICAgICBjb2RlOiBcImludmFsaWRfYXV0aG9yaXR5X3R5cGVcIixcclxuICAgICAgICBkZXNjOiBcIlRoZSBnaXZlbiBhdXRob3JpdHkgaXMgbm90IGEgdmFsaWQgdHlwZSBvZiBhdXRob3JpdHkgc3VwcG9ydGVkIGJ5IE1TQUwuIFBsZWFzZSBzZWUgaGVyZSBmb3IgdmFsaWQgYXV0aG9yaXRpZXM6IDxpbnNlcnQgVVJMIGhlcmU+LlwiXHJcbiAgICB9LFxyXG4gICAgYXV0aG9yaXR5VXJpSW5zZWN1cmU6IHtcclxuICAgICAgICBjb2RlOiBcImF1dGhvcml0eV91cmlfaW5zZWN1cmVcIixcclxuICAgICAgICBkZXNjOiBcIkF1dGhvcml0eSBVUklzIG11c3QgdXNlIGh0dHBzLlwiXHJcbiAgICB9LFxyXG4gICAgYXV0aG9yaXR5VXJpSW52YWxpZFBhdGg6IHtcclxuICAgICAgICBjb2RlOiBcImF1dGhvcml0eV91cmlfaW52YWxpZF9wYXRoXCIsXHJcbiAgICAgICAgZGVzYzogXCJHaXZlbiBhdXRob3JpdHkgVVJJIGlzIGludmFsaWQuXCJcclxuICAgIH0sXHJcbiAgICB1bnN1cHBvcnRlZEF1dGhvcml0eVZhbGlkYXRpb246IHtcclxuICAgICAgICBjb2RlOiBcInVuc3VwcG9ydGVkX2F1dGhvcml0eV92YWxpZGF0aW9uXCIsXHJcbiAgICAgICAgZGVzYzogXCJUaGUgYXV0aG9yaXR5IHZhbGlkYXRpb24gaXMgbm90IHN1cHBvcnRlZCBmb3IgdGhpcyBhdXRob3JpdHkgdHlwZS5cIlxyXG4gICAgfSxcclxuICAgIGIyY0F1dGhvcml0eVVyaUludmFsaWRQYXRoOiB7XHJcbiAgICAgICAgY29kZTogXCJiMmNfYXV0aG9yaXR5X3VyaV9pbnZhbGlkX3BhdGhcIixcclxuICAgICAgICBkZXNjOiBcIlRoZSBnaXZlbiBVUkkgZm9yIHRoZSBCMkMgYXV0aG9yaXR5IGlzIGludmFsaWQuXCJcclxuICAgIH0sXHJcbiAgICBjbGFpbXNSZXF1ZXN0UGFyc2luZ0Vycm9yOiB7XHJcbiAgICAgICAgY29kZTogXCJjbGFpbXNfcmVxdWVzdF9wYXJzaW5nX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJDb3VsZCBub3QgcGFyc2UgdGhlIGdpdmVuIGNsYWltcyByZXF1ZXN0IG9iamVjdC5cIlxyXG4gICAgfSxcclxuICAgIGVtcHR5UmVxdWVzdEVycm9yOiB7XHJcbiAgICAgICAgY29kZTogXCJlbXB0eV9yZXF1ZXN0X2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJSZXF1ZXN0IG9iamVjdCBpcyByZXF1aXJlZC5cIlxyXG4gICAgfSxcclxuICAgIHRlbGVtZXRyeUNvbmZpZ0Vycm9yOiB7XHJcbiAgICAgICAgY29kZTogXCJ0ZWxlbWV0cnlfY29uZmlnX2Vycm9yXCIsXHJcbiAgICAgICAgZGVzYzogXCJUZWxlbWV0cnkgY29uZmlnIGlzIG5vdCBjb25maWd1cmVkIHdpdGggcmVxdWlyZWQgdmFsdWVzXCJcclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIEVycm9yIHRocm93biB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIGluIGNvbmZpZ3VyYXRpb24gb2YgdGhlIC5qcyBsaWJyYXJ5LlxyXG4gKi9cclxudmFyIENsaWVudENvbmZpZ3VyYXRpb25FcnJvciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIHRzbGliXzEuX19leHRlbmRzKENsaWVudENvbmZpZ3VyYXRpb25FcnJvciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENsaWVudENvbmZpZ3VyYXRpb25FcnJvcihlcnJvckNvZGUsIGVycm9yTWVzc2FnZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGVycm9yQ29kZSwgZXJyb3JNZXNzYWdlKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLm5hbWUgPSBcIkNsaWVudENvbmZpZ3VyYXRpb25FcnJvclwiO1xyXG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihfdGhpcywgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLnByb3RvdHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZU5vU2V0Q29uZmlndXJhdGlvbkVycm9yID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yKENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UuY29uZmlndXJhdGlvbk5vdFNldC5jb2RlLCBcIlwiICsgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5jb25maWd1cmF0aW9uTm90U2V0LmRlc2MpO1xyXG4gICAgfTtcclxuICAgIENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVJbnZhbGlkQ2FjaGVMb2NhdGlvbkNvbmZpZ0Vycm9yID0gZnVuY3Rpb24gKGdpdmVuQ2FjaGVMb2NhdGlvbikge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yKENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UuaW52YWxpZENhY2hlTG9jYXRpb24uY29kZSwgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5pbnZhbGlkQ2FjaGVMb2NhdGlvbi5kZXNjICsgXCIgUHJvdmlkZWQgdmFsdWU6IFwiICsgZ2l2ZW5DYWNoZUxvY2F0aW9uICsgXCIuIFBvc3NpYmxlIHZhbHVlcyBhcmU6IFwiICsgQ29uc3RhbnRzLmNhY2hlTG9jYXRpb25Mb2NhbCArIFwiLCBcIiArIENvbnN0YW50cy5jYWNoZUxvY2F0aW9uU2Vzc2lvbiArIFwiLlwiKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlTm9TdG9yYWdlU3VwcG9ydGVkRXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IoQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5ub1N0b3JhZ2VTdXBwb3J0ZWQuY29kZSwgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5ub1N0b3JhZ2VTdXBwb3J0ZWQuZGVzYyk7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZVJlZGlyZWN0Q2FsbGJhY2tzTm90U2V0RXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IoQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5ub1JlZGlyZWN0Q2FsbGJhY2tzU2V0LmNvZGUsIENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2Uubm9SZWRpcmVjdENhbGxiYWNrc1NldC5kZXNjKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlSW52YWxpZENhbGxiYWNrT2JqZWN0RXJyb3IgPSBmdW5jdGlvbiAoY2FsbGJhY2tPYmplY3QpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudENvbmZpZ3VyYXRpb25FcnJvcihDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlLmludmFsaWRDYWxsYmFja09iamVjdC5jb2RlLCBDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlLmludmFsaWRDYWxsYmFja09iamVjdC5kZXNjICsgXCIgR2l2ZW4gdmFsdWUgZm9yIGNhbGxiYWNrIGZ1bmN0aW9uOiBcIiArIGNhbGxiYWNrT2JqZWN0KTtcclxuICAgIH07XHJcbiAgICBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlRW1wdHlTY29wZXNBcnJheUVycm9yID0gZnVuY3Rpb24gKHNjb3Blc1ZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IoQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5lbXB0eVNjb3Blcy5jb2RlLCBDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlLmVtcHR5U2NvcGVzLmRlc2MgKyBcIiBHaXZlbiB2YWx1ZTogXCIgKyBzY29wZXNWYWx1ZSArIFwiLlwiKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlU2NvcGVzTm9uQXJyYXlFcnJvciA9IGZ1bmN0aW9uIChzY29wZXNWYWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yKENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2Uubm9uQXJyYXlTY29wZXMuY29kZSwgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5ub25BcnJheVNjb3Blcy5kZXNjICsgXCIgR2l2ZW4gdmFsdWU6IFwiICsgc2NvcGVzVmFsdWUgKyBcIi5cIik7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZUNsaWVudElkU2luZ2xlU2NvcGVFcnJvciA9IGZ1bmN0aW9uIChzY29wZXNWYWx1ZSkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yKENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UuY2xpZW50U2NvcGUuY29kZSwgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5jbGllbnRTY29wZS5kZXNjICsgXCIgR2l2ZW4gdmFsdWU6IFwiICsgc2NvcGVzVmFsdWUgKyBcIi5cIik7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZVNjb3Blc1JlcXVpcmVkRXJyb3IgPSBmdW5jdGlvbiAoc2NvcGVzVmFsdWUpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENsaWVudENvbmZpZ3VyYXRpb25FcnJvcihDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlLnNjb3Blc1JlcXVpcmVkLmNvZGUsIENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2Uuc2NvcGVzUmVxdWlyZWQuZGVzYyArIFwiIEdpdmVuIHZhbHVlOiBcIiArIHNjb3Blc1ZhbHVlKTtcclxuICAgIH07XHJcbiAgICBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlSW52YWxpZFByb21wdEVycm9yID0gZnVuY3Rpb24gKHByb21wdFZhbHVlKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IoQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5pbnZhbGlkUHJvbXB0LmNvZGUsIENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UuaW52YWxpZFByb21wdC5kZXNjICsgXCIgR2l2ZW4gdmFsdWU6IFwiICsgcHJvbXB0VmFsdWUpO1xyXG4gICAgfTtcclxuICAgIENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVDbGFpbXNSZXF1ZXN0UGFyc2luZ0Vycm9yID0gZnVuY3Rpb24gKGNsYWltc1JlcXVlc3RQYXJzZUVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IoQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5jbGFpbXNSZXF1ZXN0UGFyc2luZ0Vycm9yLmNvZGUsIENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UuY2xhaW1zUmVxdWVzdFBhcnNpbmdFcnJvci5kZXNjICsgXCIgR2l2ZW4gdmFsdWU6IFwiICsgY2xhaW1zUmVxdWVzdFBhcnNlRXJyb3IpO1xyXG4gICAgfTtcclxuICAgIENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVFbXB0eVJlcXVlc3RFcnJvciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX2EgPSBDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlLmVtcHR5UmVxdWVzdEVycm9yLCBjb2RlID0gX2EuY29kZSwgZGVzYyA9IF9hLmRlc2M7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IoY29kZSwgZGVzYyk7XHJcbiAgICB9O1xyXG4gICAgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZVRlbGVtZXRyeUNvbmZpZ0Vycm9yID0gZnVuY3Rpb24gKGNvbmZpZykge1xyXG4gICAgICAgIHZhciBfYSA9IENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UudGVsZW1ldHJ5Q29uZmlnRXJyb3IsIGNvZGUgPSBfYS5jb2RlLCBkZXNjID0gX2EuZGVzYztcclxuICAgICAgICB2YXIgcmVxdWlyZWRLZXlzID0ge1xyXG4gICAgICAgICAgICBhcHBsaWNhdGlvbk5hbWU6IFwic3RyaW5nXCIsXHJcbiAgICAgICAgICAgIGFwcGxpY2F0aW9uVmVyc2lvbjogXCJzdHJpbmdcIixcclxuICAgICAgICAgICAgdGVsZW1ldHJ5RW1pdHRlcjogXCJmdW5jdGlvblwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgbWlzc2luZ0tleXMgPSBPYmplY3Qua2V5cyhyZXF1aXJlZEtleXMpXHJcbiAgICAgICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGtleXMsIGtleSkge1xyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnW2tleV0gPyBrZXlzIDoga2V5cy5jb25jYXQoW2tleSArIFwiIChcIiArIHJlcXVpcmVkS2V5c1trZXldICsgXCIpXCJdKTtcclxuICAgICAgICB9LCBbXSk7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IoY29kZSwgZGVzYyArIFwiIG1pc2luZyB2YWx1ZXM6IFwiICsgbWlzc2luZ0tleXMuam9pbihcIixcIikpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDbGllbnRDb25maWd1cmF0aW9uRXJyb3I7XHJcbn0oQ2xpZW50QXV0aEVycm9yKSk7XHJcbmV4cG9ydCB7IENsaWVudENvbmZpZ3VyYXRpb25FcnJvciB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1DbGllbnRDb25maWd1cmF0aW9uRXJyb3IuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0IHsgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yIH0gZnJvbSBcIi4vZXJyb3IvQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yXCI7XHJcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUNsYWltc1JlcXVlc3QocmVxdWVzdCkge1xyXG4gICAgaWYgKCFyZXF1ZXN0LmNsYWltc1JlcXVlc3QpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgY2xhaW1zO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjbGFpbXMgPSBKU09OLnBhcnNlKHJlcXVlc3QuY2xhaW1zUmVxdWVzdCk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIHRocm93IENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVDbGFpbXNSZXF1ZXN0UGFyc2luZ0Vycm9yKGUpO1xyXG4gICAgfVxyXG4gICAgLy8gVE9ETzogTW9yZSB2YWxpZGF0aW9uIHdpbGwgYmUgYWRkZWQgd2hlbiB0aGUgc2VydmVyIHRlYW0gdGVsbHMgdXMgaG93IHRoZXkgaGF2ZSBhY3R1YWxseSBpbXBsZW1lbnRlZCBjbGFpbXNcclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BdXRoZW50aWNhdGlvblBhcmFtZXRlcnMuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0IHsgQ3J5cHRvVXRpbHMgfSBmcm9tIFwiLi91dGlscy9DcnlwdG9VdGlsc1wiO1xyXG5pbXBvcnQgeyB2YWxpZGF0ZUNsYWltc1JlcXVlc3QgfSBmcm9tIFwiLi9BdXRoZW50aWNhdGlvblBhcmFtZXRlcnNcIjtcclxuaW1wb3J0IHsgU1NPVHlwZXMsIENvbnN0YW50cywgUHJvbXB0U3RhdGUsIEJsYWNrbGlzdGVkRVFQYXJhbXMsIGxpYnJhcnlWZXJzaW9uIH0gZnJvbSBcIi4vdXRpbHMvQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IENsaWVudENvbmZpZ3VyYXRpb25FcnJvciB9IGZyb20gXCIuL2Vycm9yL0NsaWVudENvbmZpZ3VyYXRpb25FcnJvclwiO1xyXG5pbXBvcnQgeyBTdHJpbmdVdGlscyB9IGZyb20gXCIuL3V0aWxzL1N0cmluZ1V0aWxzXCI7XHJcbi8qKlxyXG4gKiBOb25jZTogT0lEQyBOb25jZSBkZWZpbml0aW9uOiBodHRwczovL29wZW5pZC5uZXQvc3BlY3Mvb3BlbmlkLWNvbm5lY3QtY29yZS0xXzAuaHRtbCNJRFRva2VuXHJcbiAqIFN0YXRlOiBPQXV0aCBTcGVjOiBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNjc0OSNzZWN0aW9uLTEwLjEyXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbnZhciBTZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVycyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIC8qKlxyXG4gICAgICogQ29uc3RydWN0b3JcclxuICAgICAqIEBwYXJhbSBhdXRob3JpdHlcclxuICAgICAqIEBwYXJhbSBjbGllbnRJZFxyXG4gICAgICogQHBhcmFtIHNjb3BlXHJcbiAgICAgKiBAcGFyYW0gcmVzcG9uc2VUeXBlXHJcbiAgICAgKiBAcGFyYW0gcmVkaXJlY3RVcmlcclxuICAgICAqIEBwYXJhbSBzdGF0ZVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBTZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVycyhhdXRob3JpdHksIGNsaWVudElkLCBzY29wZSwgcmVzcG9uc2VUeXBlLCByZWRpcmVjdFVyaSwgc3RhdGUpIHtcclxuICAgICAgICB0aGlzLmF1dGhvcml0eUluc3RhbmNlID0gYXV0aG9yaXR5O1xyXG4gICAgICAgIHRoaXMuY2xpZW50SWQgPSBjbGllbnRJZDtcclxuICAgICAgICBpZiAoIXNjb3BlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NvcGVzID0gW2NsaWVudElkXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NvcGVzID0gc2NvcGUuc2xpY2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ub25jZSA9IENyeXB0b1V0aWxzLmNyZWF0ZU5ld0d1aWQoKTtcclxuICAgICAgICB0aGlzLnN0YXRlID0gc3RhdGUgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoc3RhdGUpID8gQ3J5cHRvVXRpbHMuY3JlYXRlTmV3R3VpZCgpICsgXCJ8XCIgKyBzdGF0ZSA6IENyeXB0b1V0aWxzLmNyZWF0ZU5ld0d1aWQoKTtcclxuICAgICAgICAvLyBUT0RPOiBDaGFuZ2UgdGhpcyB0byB1c2VyIHBhc3NlZCB2cyBnZW5lcmF0ZWQgd2l0aCB0aGUgbmV3IFBSXHJcbiAgICAgICAgdGhpcy5jb3JyZWxhdGlvbklkID0gQ3J5cHRvVXRpbHMuY3JlYXRlTmV3R3VpZCgpO1xyXG4gICAgICAgIC8vIHRlbGVtZXRyeSBpbmZvcm1hdGlvblxyXG4gICAgICAgIHRoaXMueENsaWVudFNrdSA9IFwiTVNBTC5KU1wiO1xyXG4gICAgICAgIHRoaXMueENsaWVudFZlciA9IGxpYnJhcnlWZXJzaW9uKCk7XHJcbiAgICAgICAgdGhpcy5yZXNwb25zZVR5cGUgPSByZXNwb25zZVR5cGU7XHJcbiAgICAgICAgdGhpcy5yZWRpcmVjdFVyaSA9IHJlZGlyZWN0VXJpO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlcnZlclJlcXVlc3RQYXJhbWV0ZXJzLnByb3RvdHlwZSwgXCJhdXRob3JpdHlcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hdXRob3JpdHlJbnN0YW5jZSA/IHRoaXMuYXV0aG9yaXR5SW5zdGFuY2UuQ2Fub25pY2FsQXV0aG9yaXR5IDogbnVsbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICpcclxuICAgICAqIFV0aWxpdHkgdG8gcG9wdWxhdGUgUXVlcnlQYXJhbWV0ZXJzIGFuZCBFeHRyYVF1ZXJ5UGFyYW1ldGVycyB0byBTZXJ2ZXJSZXF1ZXN0UGFyYW1lcmVyc1xyXG4gICAgICogQHBhcmFtIHJlcXVlc3RcclxuICAgICAqIEBwYXJhbSBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3RcclxuICAgICAqL1xyXG4gICAgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMucHJvdG90eXBlLnBvcHVsYXRlUXVlcnlQYXJhbXMgPSBmdW5jdGlvbiAoYWNjb3VudCwgcmVxdWVzdCwgYWRhbElkVG9rZW5PYmplY3QpIHtcclxuICAgICAgICB2YXIgcXVlcnlQYXJhbWV0ZXJzID0ge307XHJcbiAgICAgICAgaWYgKHJlcXVlc3QpIHtcclxuICAgICAgICAgICAgLy8gYWRkIHRoZSBwcm9tcHQgcGFyYW1ldGVyIHRvIHNlcnZlclJlcXVlc3RQYXJhbWV0ZXJzIGlmIHBhc3NlZFxyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC5wcm9tcHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmFsaWRhdGVQcm9tcHRQYXJhbWV0ZXIocmVxdWVzdC5wcm9tcHQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcm9tcHRWYWx1ZSA9IHJlcXVlc3QucHJvbXB0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIEFkZCBjbGFpbXMgY2hhbGxlbmdlIHRvIHNlcnZlclJlcXVlc3RQYXJhbWV0ZXJzIGlmIHBhc3NlZFxyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC5jbGFpbXNSZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZUNsYWltc1JlcXVlc3QocmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsYWltc1ZhbHVlID0gcmVxdWVzdC5jbGFpbXNSZXF1ZXN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGlmIHRoZSBkZXZlbG9wZXIgcHJvdmlkZXMgb25lIG9mIHRoZXNlLCBnaXZlIHByZWZlcmVuY2UgdG8gZGV2ZWxvcGVyIGNob2ljZVxyXG4gICAgICAgICAgICBpZiAoU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMuaXNTU09QYXJhbShyZXF1ZXN0KSkge1xyXG4gICAgICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5jb25zdHJ1Y3RVbmlmaWVkQ2FjaGVRdWVyeVBhcmFtZXRlcihyZXF1ZXN0LCBudWxsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYWRhbElkVG9rZW5PYmplY3QpIHtcclxuICAgICAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5jb25zdHJ1Y3RVbmlmaWVkQ2FjaGVRdWVyeVBhcmFtZXRlcihudWxsLCBhZGFsSWRUb2tlbk9iamVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGFkZHMgc2lkL2xvZ2luX2hpbnQgaWYgbm90IHBvcHVsYXRlZDsgcG9wdWxhdGVzIGRvbWFpbl9yZXEsIGxvZ2luX3JlcSBhbmQgZG9tYWluX2hpbnRcclxuICAgICAgICAvLyB0aGlzLmxvZ2dlci52ZXJib3NlKFwiQ2FsbGluZyBhZGRIaW50IHBhcmFtZXRlcnNcIik7XHJcbiAgICAgICAgcXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5hZGRIaW50UGFyYW1ldGVycyhhY2NvdW50LCBxdWVyeVBhcmFtZXRlcnMpO1xyXG4gICAgICAgIC8vIHNhbml0eSBjaGVjayBmb3IgZGV2ZWxvcGVyIHBhc3NlZCBleHRyYVF1ZXJ5UGFyYW1ldGVyc1xyXG4gICAgICAgIHZhciBlUVBhcmFtcztcclxuICAgICAgICBpZiAocmVxdWVzdCkge1xyXG4gICAgICAgICAgICBlUVBhcmFtcyA9IHRoaXMuc2FuaXRpemVFUVBhcmFtcyhyZXF1ZXN0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUG9wdWxhdGUgdGhlIGV4dHJhUXVlcnlQYXJhbWV0ZXJzIHRvIGJlIHNlbnQgdG8gdGhlIHNlcnZlclxyXG4gICAgICAgIHRoaXMucXVlcnlQYXJhbWV0ZXJzID0gU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMuZ2VuZXJhdGVRdWVyeVBhcmFtZXRlcnNTdHJpbmcocXVlcnlQYXJhbWV0ZXJzKTtcclxuICAgICAgICB0aGlzLmV4dHJhUXVlcnlQYXJhbWV0ZXJzID0gU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMuZ2VuZXJhdGVRdWVyeVBhcmFtZXRlcnNTdHJpbmcoZVFQYXJhbXMpO1xyXG4gICAgfTtcclxuICAgIC8vI3JlZ2lvbiBRdWVyeVBhcmFtIGhlbHBlcnNcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICpcclxuICAgICAqIFV0aWxpdHkgdG8gdGVzdCBpZiB2YWxpZCBwcm9tcHQgdmFsdWUgaXMgcGFzc2VkIGluIHRoZSByZXF1ZXN0XHJcbiAgICAgKiBAcGFyYW0gcmVxdWVzdFxyXG4gICAgICovXHJcbiAgICBTZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVycy5wcm90b3R5cGUudmFsaWRhdGVQcm9tcHRQYXJhbWV0ZXIgPSBmdW5jdGlvbiAocHJvbXB0KSB7XHJcbiAgICAgICAgaWYgKCEoW1Byb21wdFN0YXRlLkxPR0lOLCBQcm9tcHRTdGF0ZS5TRUxFQ1RfQUNDT1VOVCwgUHJvbXB0U3RhdGUuQ09OU0VOVCwgUHJvbXB0U3RhdGUuTk9ORV0uaW5kZXhPZihwcm9tcHQpID49IDApKSB7XHJcbiAgICAgICAgICAgIHRocm93IENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVJbnZhbGlkUHJvbXB0RXJyb3IocHJvbXB0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDb25zdHJ1Y3RzIGV4dHJhUXVlcnlQYXJhbWV0ZXJzIHRvIGJlIHNlbnQgdG8gdGhlIHNlcnZlciBmb3IgdGhlIEF1dGhlbnRpY2F0aW9uUGFyYW1ldGVycyBzZXQgYnkgdGhlIGRldmVsb3BlclxyXG4gICAgICogaW4gYW55IGxvZ2luKCkgb3IgYWNxdWlyZVRva2VuKCkgY2FsbHNcclxuICAgICAqIEBwYXJhbSBpZFRva2VuT2JqZWN0XHJcbiAgICAgKiBAcGFyYW0gZXh0cmFRdWVyeVBhcmFtZXRlcnNcclxuICAgICAqIEBwYXJhbSBzaWRcclxuICAgICAqIEBwYXJhbSBsb2dpbkhpbnRcclxuICAgICAqL1xyXG4gICAgLy9UT0RPOiBjaGVjayBob3cgdGhpcyBiZWhhdmVzIHdoZW4gZG9tYWluX2hpbnQgb25seSBpcyBzZW50IGluIGV4dHJhcGFyYW1ldGVycyBhbmQgaWRUb2tlbiBoYXMgbm8gdXBuLlxyXG4gICAgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMucHJvdG90eXBlLmNvbnN0cnVjdFVuaWZpZWRDYWNoZVF1ZXJ5UGFyYW1ldGVyID0gZnVuY3Rpb24gKHJlcXVlc3QsIGlkVG9rZW5PYmplY3QpIHtcclxuICAgICAgICAvLyBwcmVmZXJlbmNlIG9yZGVyOiBhY2NvdW50ID4gc2lkID4gbG9naW5faGludFxyXG4gICAgICAgIHZhciBzc29UeXBlO1xyXG4gICAgICAgIHZhciBzc29EYXRhO1xyXG4gICAgICAgIHZhciBzZXJ2ZXJSZXFQYXJhbSA9IHt9O1xyXG4gICAgICAgIC8vIGlmIGFjY291bnQgaW5mbyBpcyBwYXNzZWQsIGFjY291bnQuc2lkID4gYWNjb3VudC5sb2dpbl9oaW50XHJcbiAgICAgICAgaWYgKHJlcXVlc3QpIHtcclxuICAgICAgICAgICAgaWYgKHJlcXVlc3QuYWNjb3VudCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjY291bnQgPSByZXF1ZXN0LmFjY291bnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWNjb3VudC5zaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzc29UeXBlID0gU1NPVHlwZXMuU0lEO1xyXG4gICAgICAgICAgICAgICAgICAgIHNzb0RhdGEgPSBhY2NvdW50LnNpZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFjY291bnQudXNlck5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzc29UeXBlID0gU1NPVHlwZXMuTE9HSU5fSElOVDtcclxuICAgICAgICAgICAgICAgICAgICBzc29EYXRhID0gYWNjb3VudC51c2VyTmFtZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBzaWQgZnJvbSByZXF1ZXN0XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVlc3Quc2lkKSB7XHJcbiAgICAgICAgICAgICAgICBzc29UeXBlID0gU1NPVHlwZXMuU0lEO1xyXG4gICAgICAgICAgICAgICAgc3NvRGF0YSA9IHJlcXVlc3Quc2lkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGxvZ2luSGludCBmcm9tIHJlcXVlc3RcclxuICAgICAgICAgICAgZWxzZSBpZiAocmVxdWVzdC5sb2dpbkhpbnQpIHtcclxuICAgICAgICAgICAgICAgIHNzb1R5cGUgPSBTU09UeXBlcy5MT0dJTl9ISU5UO1xyXG4gICAgICAgICAgICAgICAgc3NvRGF0YSA9IHJlcXVlc3QubG9naW5IaW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGFkYWxJZFRva2VuIHJldHJpZXZlZCBmcm9tIGNhY2hlXHJcbiAgICAgICAgZWxzZSBpZiAoaWRUb2tlbk9iamVjdCkge1xyXG4gICAgICAgICAgICBpZiAoaWRUb2tlbk9iamVjdC5oYXNPd25Qcm9wZXJ0eShDb25zdGFudHMudXBuKSkge1xyXG4gICAgICAgICAgICAgICAgc3NvVHlwZSA9IFNTT1R5cGVzLklEX1RPS0VOO1xyXG4gICAgICAgICAgICAgICAgc3NvRGF0YSA9IGlkVG9rZW5PYmplY3QudXBuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc3NvVHlwZSA9IFNTT1R5cGVzLk9SR0FOSVpBVElPTlM7XHJcbiAgICAgICAgICAgICAgICBzc29EYXRhID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBzZXJ2ZXJSZXFQYXJhbSA9IHRoaXMuYWRkU1NPUGFyYW1ldGVyKHNzb1R5cGUsIHNzb0RhdGEpO1xyXG4gICAgICAgIC8vIGFkZCB0aGUgSG9tZUFjY291bnRJZGVudGlmaWVyIGluZm8vIGRvbWFpbl9oaW50XHJcbiAgICAgICAgaWYgKHJlcXVlc3QgJiYgcmVxdWVzdC5hY2NvdW50ICYmIHJlcXVlc3QuYWNjb3VudC5ob21lQWNjb3VudElkZW50aWZpZXIpIHtcclxuICAgICAgICAgICAgc2VydmVyUmVxUGFyYW0gPSB0aGlzLmFkZFNTT1BhcmFtZXRlcihTU09UeXBlcy5IT01FQUNDT1VOVF9JRCwgcmVxdWVzdC5hY2NvdW50LmhvbWVBY2NvdW50SWRlbnRpZmllciwgc2VydmVyUmVxUGFyYW0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2VydmVyUmVxUGFyYW07XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKlxyXG4gICAgICogQWRkcyBsb2dpbl9oaW50IHRvIGF1dGhvcml6YXRpb24gVVJMIHdoaWNoIGlzIHVzZWQgdG8gcHJlLWZpbGwgdGhlIHVzZXJuYW1lIGZpZWxkIG9mIHNpZ24gaW4gcGFnZSBmb3IgdGhlIHVzZXIgaWYga25vd24gYWhlYWQgb2YgdGltZVxyXG4gICAgICogZG9tYWluX2hpbnQgY2FuIGJlIG9uZSBvZiB1c2Vycy9vcmdhbml6YXRpb25zIHdoaWNoIHdoZW4gYWRkZWQgc2tpcHMgdGhlIGVtYWlsIGJhc2VkIGRpc2NvdmVyeSBwcm9jZXNzIG9mIHRoZSB1c2VyXHJcbiAgICAgKiBkb21haW5fcmVxIHV0aWQgcmVjZWl2ZWQgYXMgcGFydCBvZiB0aGUgY2xpZW50SW5mb1xyXG4gICAgICogbG9naW5fcmVxIHVpZCByZWNlaXZlZCBhcyBwYXJ0IG9mIGNsaWVudEluZm9cclxuICAgICAqIEFsc28gZG9lcyBhIHNhbml0eSBjaGVjayBmb3IgZXh0cmFRdWVyeVBhcmFtZXRlcnMgcGFzc2VkIGJ5IHRoZSB1c2VyIHRvIGVuc3VyZSBubyByZXBlYXQgcXVlcnlQYXJhbWV0ZXJzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtAbGluayBBY2NvdW50fSBhY2NvdW50IC0gQWNjb3VudCBmb3Igd2hpY2ggdGhlIHRva2VuIGlzIHJlcXVlc3RlZFxyXG4gICAgICogQHBhcmFtIHF1ZXJ5cGFyYW1zXHJcbiAgICAgKiBAcGFyYW0ge0BsaW5rIFNlcnZlclJlcXVlc3RQYXJhbWV0ZXJzfVxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBTZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVycy5wcm90b3R5cGUuYWRkSGludFBhcmFtZXRlcnMgPSBmdW5jdGlvbiAoYWNjb3VudCwgcVBhcmFtcykge1xyXG4gICAgICAgIC8vIFRoaXMgaXMgYSBmaW5hbCBjaGVjayBmb3IgYWxsIHF1ZXJ5UGFyYW1zIGFkZGVkIHNvIGZhcjsgcHJlZmVyZW5jZSBvcmRlcjogc2lkID4gbG9naW5faGludFxyXG4gICAgICAgIC8vIHNpZCBjYW5ub3QgYmUgcGFzc2VkIGFsb25nIHdpdGggbG9naW5faGludCBvciBkb21haW5faGludCwgaGVuY2Ugd2UgY2hlY2sgYm90aCBhcmUgbm90IHBvcHVsYXRlZCB5ZXQgaW4gcXVlcnlQYXJhbWV0ZXJzXHJcbiAgICAgICAgaWYgKGFjY291bnQgJiYgIXFQYXJhbXNbU1NPVHlwZXMuU0lEXSkge1xyXG4gICAgICAgICAgICAvLyBzaWQgLSBwb3B1bGF0ZSBvbmx5IGlmIGxvZ2luX2hpbnQgaXMgbm90IGFscmVhZHkgcG9wdWxhdGVkIGFuZCB0aGUgYWNjb3VudCBoYXMgc2lkXHJcbiAgICAgICAgICAgIHZhciBwb3B1bGF0ZVNJRCA9ICFxUGFyYW1zW1NTT1R5cGVzLkxPR0lOX0hJTlRdICYmIGFjY291bnQuc2lkICYmIHRoaXMucHJvbXB0VmFsdWUgPT09IFByb21wdFN0YXRlLk5PTkU7XHJcbiAgICAgICAgICAgIGlmIChwb3B1bGF0ZVNJRCkge1xyXG4gICAgICAgICAgICAgICAgcVBhcmFtcyA9IHRoaXMuYWRkU1NPUGFyYW1ldGVyKFNTT1R5cGVzLlNJRCwgYWNjb3VudC5zaWQsIHFQYXJhbXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGxvZ2luX2hpbnQgLSBhY2NvdW50LnVzZXJOYW1lXHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBvcHVsYXRlTG9naW5IaW50ID0gIXFQYXJhbXNbU1NPVHlwZXMuTE9HSU5fSElOVF0gJiYgYWNjb3VudC51c2VyTmFtZSAmJiAhU3RyaW5nVXRpbHMuaXNFbXB0eShhY2NvdW50LnVzZXJOYW1lKTtcclxuICAgICAgICAgICAgICAgIGlmIChwb3B1bGF0ZUxvZ2luSGludCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHFQYXJhbXMgPSB0aGlzLmFkZFNTT1BhcmFtZXRlcihTU09UeXBlcy5MT0dJTl9ISU5ULCBhY2NvdW50LnVzZXJOYW1lLCBxUGFyYW1zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcG9wdWxhdGVSZXFQYXJhbXMgPSAhcVBhcmFtc1tTU09UeXBlcy5ET01BSU5fUkVRXSAmJiAhcVBhcmFtc1tTU09UeXBlcy5MT0dJTl9SRVFdO1xyXG4gICAgICAgICAgICBpZiAocG9wdWxhdGVSZXFQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgIHFQYXJhbXMgPSB0aGlzLmFkZFNTT1BhcmFtZXRlcihTU09UeXBlcy5IT01FQUNDT1VOVF9JRCwgYWNjb3VudC5ob21lQWNjb3VudElkZW50aWZpZXIsIHFQYXJhbXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBxUGFyYW1zO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQWRkIFNJRCB0byBleHRyYVF1ZXJ5UGFyYW1ldGVyc1xyXG4gICAgICogQHBhcmFtIHNpZFxyXG4gICAgICovXHJcbiAgICBTZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVycy5wcm90b3R5cGUuYWRkU1NPUGFyYW1ldGVyID0gZnVuY3Rpb24gKHNzb1R5cGUsIHNzb0RhdGEsIHNzb1BhcmFtKSB7XHJcbiAgICAgICAgaWYgKCFzc29QYXJhbSkge1xyXG4gICAgICAgICAgICBzc29QYXJhbSA9IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXNzb0RhdGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNzb1BhcmFtO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzd2l0Y2ggKHNzb1R5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBTU09UeXBlcy5TSUQ6IHtcclxuICAgICAgICAgICAgICAgIHNzb1BhcmFtW1NTT1R5cGVzLlNJRF0gPSBzc29EYXRhO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBTU09UeXBlcy5JRF9UT0tFTjoge1xyXG4gICAgICAgICAgICAgICAgc3NvUGFyYW1bU1NPVHlwZXMuTE9HSU5fSElOVF0gPSBzc29EYXRhO1xyXG4gICAgICAgICAgICAgICAgc3NvUGFyYW1bU1NPVHlwZXMuRE9NQUlOX0hJTlRdID0gU1NPVHlwZXMuT1JHQU5JWkFUSU9OUztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgU1NPVHlwZXMuTE9HSU5fSElOVDoge1xyXG4gICAgICAgICAgICAgICAgc3NvUGFyYW1bU1NPVHlwZXMuTE9HSU5fSElOVF0gPSBzc29EYXRhO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBTU09UeXBlcy5PUkdBTklaQVRJT05TOiB7XHJcbiAgICAgICAgICAgICAgICBzc29QYXJhbVtTU09UeXBlcy5ET01BSU5fSElOVF0gPSBTU09UeXBlcy5PUkdBTklaQVRJT05TO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBTU09UeXBlcy5DT05TVU1FUlM6IHtcclxuICAgICAgICAgICAgICAgIHNzb1BhcmFtW1NTT1R5cGVzLkRPTUFJTl9ISU5UXSA9IFNTT1R5cGVzLkNPTlNVTUVSUztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgU1NPVHlwZXMuSE9NRUFDQ09VTlRfSUQ6IHtcclxuICAgICAgICAgICAgICAgIHZhciBob21lQWNjb3VudElkID0gc3NvRGF0YS5zcGxpdChcIi5cIik7XHJcbiAgICAgICAgICAgICAgICB2YXIgdWlkID0gQ3J5cHRvVXRpbHMuYmFzZTY0RGVjb2RlKGhvbWVBY2NvdW50SWRbMF0pO1xyXG4gICAgICAgICAgICAgICAgdmFyIHV0aWQgPSBDcnlwdG9VdGlscy5iYXNlNjREZWNvZGUoaG9tZUFjY291bnRJZFsxXSk7XHJcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBkb21haW5fcmVxIGFuZCBsb2dpbl9yZXEgYXJlIG5vdCBuZWVkZWQgYWNjb3JkaW5nIHRvIGVTVFMgdGVhbVxyXG4gICAgICAgICAgICAgICAgc3NvUGFyYW1bU1NPVHlwZXMuTE9HSU5fUkVRXSA9IHVpZDtcclxuICAgICAgICAgICAgICAgIHNzb1BhcmFtW1NTT1R5cGVzLkRPTUFJTl9SRVFdID0gdXRpZDtcclxuICAgICAgICAgICAgICAgIGlmICh1dGlkID09PSBDb25zdGFudHMuY29uc3VtZXJzVXRpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNzb1BhcmFtW1NTT1R5cGVzLkRPTUFJTl9ISU5UXSA9IFNTT1R5cGVzLkNPTlNVTUVSUztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNzb1BhcmFtW1NTT1R5cGVzLkRPTUFJTl9ISU5UXSA9IFNTT1R5cGVzLk9SR0FOSVpBVElPTlM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIFNTT1R5cGVzLkxPR0lOX1JFUToge1xyXG4gICAgICAgICAgICAgICAgc3NvUGFyYW1bU1NPVHlwZXMuTE9HSU5fUkVRXSA9IHNzb0RhdGE7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIFNTT1R5cGVzLkRPTUFJTl9SRVE6IHtcclxuICAgICAgICAgICAgICAgIHNzb1BhcmFtW1NTT1R5cGVzLkRPTUFJTl9SRVFdID0gc3NvRGF0YTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzc29QYXJhbTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIFJlbW92ZXMgdW5uZWNlc3Nhcnkgb3IgZHVwbGljYXRlIHF1ZXJ5IHBhcmFtZXRlcnMgZnJvbSBleHRyYVF1ZXJ5UGFyYW1ldGVyc1xyXG4gICAgICogQHBhcmFtIHJlcXVlc3RcclxuICAgICAqL1xyXG4gICAgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMucHJvdG90eXBlLnNhbml0aXplRVFQYXJhbXMgPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIHZhciBlUVBhcmFtcyA9IHJlcXVlc3QuZXh0cmFRdWVyeVBhcmFtZXRlcnM7XHJcbiAgICAgICAgaWYgKCFlUVBhcmFtcykge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlcXVlc3QuY2xhaW1zUmVxdWVzdCkge1xyXG4gICAgICAgICAgICAvLyB0aGlzLmxvZ2dlci53YXJuaW5nKFwiUmVtb3ZlZCBkdXBsaWNhdGUgY2xhaW1zIGZyb20gZXh0cmFRdWVyeVBhcmFtZXRlcnMuIFBsZWFzZSB1c2UgZWl0aGVyIHRoZSBjbGFpbXNSZXF1ZXN0IGZpZWxkIE9SIHBhc3MgYXMgZXh0cmFRdWVyeVBhcmFtZXRlciAtIG5vdCBib3RoLlwiKTtcclxuICAgICAgICAgICAgZGVsZXRlIGVRUGFyYW1zW0NvbnN0YW50cy5jbGFpbXNdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBCbGFja2xpc3RlZEVRUGFyYW1zLmZvckVhY2goZnVuY3Rpb24gKHBhcmFtKSB7XHJcbiAgICAgICAgICAgIGlmIChlUVBhcmFtc1twYXJhbV0pIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMubG9nZ2VyLndhcm5pbmcoXCJSZW1vdmVkIGR1cGxpY2F0ZSBcIiArIHBhcmFtICsgXCIgZnJvbSBleHRyYVF1ZXJ5UGFyYW1ldGVycy4gUGxlYXNlIHVzZSB0aGUgXCIgKyBwYXJhbSArIFwiIGZpZWxkIGluIHJlcXVlc3Qgb2JqZWN0LlwiKTtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBlUVBhcmFtc1twYXJhbV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZVFQYXJhbXM7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVdGlsaXR5IHRvIGdlbmVyYXRlIGEgUXVlcnlQYXJhbWV0ZXJTdHJpbmcgZnJvbSBhIEtleS1WYWx1ZSBtYXBwaW5nIG9mIGV4dHJhUXVlcnlQYXJhbWV0ZXJzIHBhc3NlZFxyXG4gICAgICogQHBhcmFtIGV4dHJhUXVlcnlQYXJhbWV0ZXJzXHJcbiAgICAgKi9cclxuICAgIFNlcnZlclJlcXVlc3RQYXJhbWV0ZXJzLmdlbmVyYXRlUXVlcnlQYXJhbWV0ZXJzU3RyaW5nID0gZnVuY3Rpb24gKHF1ZXJ5UGFyYW1ldGVycykge1xyXG4gICAgICAgIHZhciBwYXJhbXNTdHJpbmcgPSBudWxsO1xyXG4gICAgICAgIGlmIChxdWVyeVBhcmFtZXRlcnMpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMocXVlcnlQYXJhbWV0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJhbXNTdHJpbmcgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1N0cmluZyA9IGtleSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5UGFyYW1ldGVyc1trZXldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtc1N0cmluZyArPSBcIiZcIiArIGtleSArIFwiPVwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5UGFyYW1ldGVyc1trZXldKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXJhbXNTdHJpbmc7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICAvKipcclxuICAgICAqIENoZWNrIHRvIHNlZSBpZiB0aGVyZSBhcmUgU1NPIHBhcmFtcyBzZXQgaW4gdGhlIFJlcXVlc3RcclxuICAgICAqIEBwYXJhbSByZXF1ZXN0XHJcbiAgICAgKi9cclxuICAgIFNlcnZlclJlcXVlc3RQYXJhbWV0ZXJzLmlzU1NPUGFyYW0gPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIHJldHVybiByZXF1ZXN0ICYmIChyZXF1ZXN0LmFjY291bnQgfHwgcmVxdWVzdC5zaWQgfHwgcmVxdWVzdC5sb2dpbkhpbnQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVycztcclxufSgpKTtcclxuZXhwb3J0IHsgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VydmVyUmVxdWVzdFBhcmFtZXRlcnMuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0IHsgQ3J5cHRvVXRpbHMgfSBmcm9tIFwiLi91dGlscy9DcnlwdG9VdGlsc1wiO1xyXG5pbXBvcnQgeyBDbGllbnRBdXRoRXJyb3IgfSBmcm9tIFwiLi9lcnJvci9DbGllbnRBdXRoRXJyb3JcIjtcclxuaW1wb3J0IHsgU3RyaW5nVXRpbHMgfSBmcm9tIFwiLi91dGlscy9TdHJpbmdVdGlsc1wiO1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIENsaWVudEluZm8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDbGllbnRJbmZvKHJhd0NsaWVudEluZm8pIHtcclxuICAgICAgICBpZiAoIXJhd0NsaWVudEluZm8gfHwgU3RyaW5nVXRpbHMuaXNFbXB0eShyYXdDbGllbnRJbmZvKSkge1xyXG4gICAgICAgICAgICB0aGlzLnVpZCA9IFwiXCI7XHJcbiAgICAgICAgICAgIHRoaXMudXRpZCA9IFwiXCI7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdmFyIGRlY29kZWRDbGllbnRJbmZvID0gQ3J5cHRvVXRpbHMuYmFzZTY0RGVjb2RlKHJhd0NsaWVudEluZm8pO1xyXG4gICAgICAgICAgICB2YXIgY2xpZW50SW5mbyA9IEpTT04ucGFyc2UoZGVjb2RlZENsaWVudEluZm8pO1xyXG4gICAgICAgICAgICBpZiAoY2xpZW50SW5mbykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNsaWVudEluZm8uaGFzT3duUHJvcGVydHkoXCJ1aWRcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVpZCA9IGNsaWVudEluZm8udWlkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNsaWVudEluZm8uaGFzT3duUHJvcGVydHkoXCJ1dGlkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51dGlkID0gY2xpZW50SW5mby51dGlkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIHRocm93IENsaWVudEF1dGhFcnJvci5jcmVhdGVDbGllbnRJbmZvRGVjb2RpbmdFcnJvcihlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2xpZW50SW5mby5wcm90b3R5cGUsIFwidWlkXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3VpZCA/IHRoaXMuX3VpZCA6IFwiXCI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh1aWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fdWlkID0gdWlkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENsaWVudEluZm8ucHJvdG90eXBlLCBcInV0aWRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdXRpZCA/IHRoaXMuX3V0aWQgOiBcIlwiO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodXRpZCkge1xyXG4gICAgICAgICAgICB0aGlzLl91dGlkID0gdXRpZDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBDbGllbnRJbmZvO1xyXG59KCkpO1xyXG5leHBvcnQgeyBDbGllbnRJbmZvIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNsaWVudEluZm8uanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0IHsgQ3J5cHRvVXRpbHMgfSBmcm9tIFwiLi9DcnlwdG9VdGlsc1wiO1xyXG5pbXBvcnQgeyBTdHJpbmdVdGlscyB9IGZyb20gJy4vU3RyaW5nVXRpbHMnO1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIFRva2VuVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUb2tlblV0aWxzKCkge1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBkZWNvZGUgYSBKV1RcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gand0VG9rZW5cclxuICAgICAqL1xyXG4gICAgVG9rZW5VdGlscy5kZWNvZGVKd3QgPSBmdW5jdGlvbiAoand0VG9rZW4pIHtcclxuICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShqd3RUb2tlbikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBpZFRva2VuUGFydHNSZWdleCA9IC9eKFteXFwuXFxzXSopXFwuKFteXFwuXFxzXSspXFwuKFteXFwuXFxzXSopJC87XHJcbiAgICAgICAgdmFyIG1hdGNoZXMgPSBpZFRva2VuUGFydHNSZWdleC5leGVjKGp3dFRva2VuKTtcclxuICAgICAgICBpZiAoIW1hdGNoZXMgfHwgbWF0Y2hlcy5sZW5ndGggPCA0KSB7XHJcbiAgICAgICAgICAgIC8vdGhpcy5fcmVxdWVzdENvbnRleHQubG9nZ2VyLndhcm4oXCJUaGUgcmV0dXJuZWQgaWRfdG9rZW4gaXMgbm90IHBhcnNlYWJsZS5cIik7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY3JhY2tlZFRva2VuID0ge1xyXG4gICAgICAgICAgICBoZWFkZXI6IG1hdGNoZXNbMV0sXHJcbiAgICAgICAgICAgIEpXU1BheWxvYWQ6IG1hdGNoZXNbMl0sXHJcbiAgICAgICAgICAgIEpXU1NpZzogbWF0Y2hlc1szXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGNyYWNrZWRUb2tlbjtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEV4dHJhY3QgSWRUb2tlbiBieSBkZWNvZGluZyB0aGUgUkFXSWRUb2tlblxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBlbmNvZGVkSWRUb2tlblxyXG4gICAgICovXHJcbiAgICBUb2tlblV0aWxzLmV4dHJhY3RJZFRva2VuID0gZnVuY3Rpb24gKGVuY29kZWRJZFRva2VuKSB7XHJcbiAgICAgICAgLy8gaWQgdG9rZW4gd2lsbCBiZSBkZWNvZGVkIHRvIGdldCB0aGUgdXNlcm5hbWVcclxuICAgICAgICB2YXIgZGVjb2RlZFRva2VuID0gdGhpcy5kZWNvZGVKd3QoZW5jb2RlZElkVG9rZW4pO1xyXG4gICAgICAgIGlmICghZGVjb2RlZFRva2VuKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0SWRUb2tlbiA9IGRlY29kZWRUb2tlbi5KV1NQYXlsb2FkO1xyXG4gICAgICAgICAgICB2YXIgYmFzZTY0RGVjb2RlZCA9IENyeXB0b1V0aWxzLmJhc2U2NERlY29kZShiYXNlNjRJZFRva2VuKTtcclxuICAgICAgICAgICAgaWYgKCFiYXNlNjREZWNvZGVkKSB7XHJcbiAgICAgICAgICAgICAgICAvL3RoaXMuX3JlcXVlc3RDb250ZXh0LmxvZ2dlci5pbmZvKFwiVGhlIHJldHVybmVkIGlkX3Rva2VuIGNvdWxkIG5vdCBiZSBiYXNlNjQgdXJsIHNhZmUgZGVjb2RlZC5cIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBFQ01BIHNjcmlwdCBoYXMgSlNPTiBidWlsdC1pbiBzdXBwb3J0XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGJhc2U2NERlY29kZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIC8vdGhpcy5fcmVxdWVzdENvbnRleHQubG9nZ2VyLmVycm9yKFwiVGhlIHJldHVybmVkIGlkX3Rva2VuIGNvdWxkIG5vdCBiZSBkZWNvZGVkXCIgKyBlcnIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVG9rZW5VdGlscztcclxufSgpKTtcclxuZXhwb3J0IHsgVG9rZW5VdGlscyB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Ub2tlblV0aWxzLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCB7IENsaWVudEF1dGhFcnJvciB9IGZyb20gXCIuL2Vycm9yL0NsaWVudEF1dGhFcnJvclwiO1xyXG5pbXBvcnQgeyBUb2tlblV0aWxzIH0gZnJvbSBcIi4vdXRpbHMvVG9rZW5VdGlsc1wiO1xyXG5pbXBvcnQgeyBTdHJpbmdVdGlscyB9IGZyb20gXCIuL3V0aWxzL1N0cmluZ1V0aWxzXCI7XHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG52YXIgSWRUb2tlbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIC8qIHRzbGludDpkaXNhYmxlOm5vLXN0cmluZy1saXRlcmFsICovXHJcbiAgICBmdW5jdGlvbiBJZFRva2VuKHJhd0lkVG9rZW4pIHtcclxuICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShyYXdJZFRva2VuKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRBdXRoRXJyb3IuY3JlYXRlSWRUb2tlbk51bGxPckVtcHR5RXJyb3IocmF3SWRUb2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHRoaXMucmF3SWRUb2tlbiA9IHJhd0lkVG9rZW47XHJcbiAgICAgICAgICAgIHRoaXMuY2xhaW1zID0gVG9rZW5VdGlscy5leHRyYWN0SWRUb2tlbihyYXdJZFRva2VuKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY2xhaW1zKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGFpbXMuaGFzT3duUHJvcGVydHkoXCJpc3NcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzc3VlciA9IHRoaXMuY2xhaW1zW1wiaXNzXCJdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xhaW1zLmhhc093blByb3BlcnR5KFwib2lkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmplY3RJZCA9IHRoaXMuY2xhaW1zW1wib2lkXCJdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xhaW1zLmhhc093blByb3BlcnR5KFwic3ViXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWJqZWN0ID0gdGhpcy5jbGFpbXNbXCJzdWJcIl07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGFpbXMuaGFzT3duUHJvcGVydHkoXCJ0aWRcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbmFudElkID0gdGhpcy5jbGFpbXNbXCJ0aWRcIl07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGFpbXMuaGFzT3duUHJvcGVydHkoXCJ2ZXJcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZlcnNpb24gPSB0aGlzLmNsYWltc1tcInZlclwiXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsYWltcy5oYXNPd25Qcm9wZXJ0eShcInByZWZlcnJlZF91c2VybmFtZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJlZmVycmVkTmFtZSA9IHRoaXMuY2xhaW1zW1wicHJlZmVycmVkX3VzZXJuYW1lXCJdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xhaW1zLmhhc093blByb3BlcnR5KFwibmFtZVwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmFtZSA9IHRoaXMuY2xhaW1zW1wibmFtZVwiXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsYWltcy5oYXNPd25Qcm9wZXJ0eShcIm5vbmNlXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub25jZSA9IHRoaXMuY2xhaW1zW1wibm9uY2VcIl07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jbGFpbXMuaGFzT3duUHJvcGVydHkoXCJleHBcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4cGlyYXRpb24gPSB0aGlzLmNsYWltc1tcImV4cFwiXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNsYWltcy5oYXNPd25Qcm9wZXJ0eShcImhvbWVfb2lkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ob21lT2JqZWN0SWQgPSB0aGlzLmNsYWltc1tcImhvbWVfb2lkXCJdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xhaW1zLmhhc093blByb3BlcnR5KFwic2lkXCIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaWQgPSB0aGlzLmNsYWltc1tcInNpZFwiXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8qIHRzbGludDplbmFibGU6bm8tc3RyaW5nLWxpdGVyYWwgKi9cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAvLyBUT0RPOiBUaGlzIGVycm9yIGhlcmUgd29uJ3QgcmVhbGx5IGV2ZXJ5IGJlIHRocm93biwgc2luY2UgZXh0cmFjdElkVG9rZW4oKSByZXR1cm5zIG51bGwgaWYgdGhlIGRlY29kZUp3dCgpIGZhaWxzLlxyXG4gICAgICAgICAgICAvLyBOZWVkIHRvIGFkZCBiZXR0ZXIgZXJyb3IgaGFuZGxpbmcgaGVyZSB0byBhY2NvdW50IGZvciBiZWluZyB1bmFibGUgdG8gZGVjb2RlIGp3dHMuXHJcbiAgICAgICAgICAgIHRocm93IENsaWVudEF1dGhFcnJvci5jcmVhdGVJZFRva2VuUGFyc2luZ0Vycm9yKGUpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBJZFRva2VuO1xyXG59KCkpO1xyXG5leHBvcnQgeyBJZFRva2VuIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUlkVG9rZW4uanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbnZhciBBY2Nlc3NUb2tlbkNhY2hlSXRlbSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEFjY2Vzc1Rva2VuQ2FjaGVJdGVtKGtleSwgdmFsdWUpIHtcclxuICAgICAgICB0aGlzLmtleSA9IGtleTtcclxuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQWNjZXNzVG9rZW5DYWNoZUl0ZW07XHJcbn0oKSk7XHJcbmV4cG9ydCB7IEFjY2Vzc1Rva2VuQ2FjaGVJdGVtIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUFjY2Vzc1Rva2VuQ2FjaGVJdGVtLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCB7IENvbnN0YW50cywgQ2FjaGVLZXlzIH0gZnJvbSBcIi4vdXRpbHMvQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IEFjY2Vzc1Rva2VuQ2FjaGVJdGVtIH0gZnJvbSBcIi4vQWNjZXNzVG9rZW5DYWNoZUl0ZW1cIjtcclxuaW1wb3J0IHsgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yIH0gZnJvbSBcIi4vZXJyb3IvQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yXCI7XHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG52YXIgU3RvcmFnZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFN0b3JhZ2UoY2FjaGVMb2NhdGlvbikge1xyXG4gICAgICAgIGlmIChTdG9yYWdlLmluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBTdG9yYWdlLmluc3RhbmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNhY2hlTG9jYXRpb24gPSBjYWNoZUxvY2F0aW9uO1xyXG4gICAgICAgIHRoaXMubG9jYWxTdG9yYWdlU3VwcG9ydGVkID0gdHlwZW9mIHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dICE9IG51bGw7XHJcbiAgICAgICAgdGhpcy5zZXNzaW9uU3RvcmFnZVN1cHBvcnRlZCA9IHR5cGVvZiB3aW5kb3dbY2FjaGVMb2NhdGlvbl0gIT09IFwidW5kZWZpbmVkXCIgJiYgd2luZG93W2NhY2hlTG9jYXRpb25dICE9IG51bGw7XHJcbiAgICAgICAgU3RvcmFnZS5pbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxvY2FsU3RvcmFnZVN1cHBvcnRlZCAmJiAhdGhpcy5zZXNzaW9uU3RvcmFnZVN1cHBvcnRlZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlTm9TdG9yYWdlU3VwcG9ydGVkRXJyb3IoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFN0b3JhZ2UuaW5zdGFuY2U7XHJcbiAgICB9XHJcbiAgICAvLyBhZGQgdmFsdWUgdG8gc3RvcmFnZVxyXG4gICAgU3RvcmFnZS5wcm90b3R5cGUuc2V0SXRlbSA9IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBlbmFibGVDb29raWVTdG9yYWdlKSB7XHJcbiAgICAgICAgaWYgKHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dKSB7XHJcbiAgICAgICAgICAgIHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlbmFibGVDb29raWVTdG9yYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SXRlbUNvb2tpZShrZXksIHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8gZ2V0IG9uZSBpdGVtIGJ5IGtleSBmcm9tIHN0b3JhZ2VcclxuICAgIFN0b3JhZ2UucHJvdG90eXBlLmdldEl0ZW0gPSBmdW5jdGlvbiAoa2V5LCBlbmFibGVDb29raWVTdG9yYWdlKSB7XHJcbiAgICAgICAgaWYgKGVuYWJsZUNvb2tpZVN0b3JhZ2UgJiYgdGhpcy5nZXRJdGVtQ29va2llKGtleSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SXRlbUNvb2tpZShrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAod2luZG93W3RoaXMuY2FjaGVMb2NhdGlvbl0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dLmdldEl0ZW0oa2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgLy8gcmVtb3ZlIHZhbHVlIGZyb20gc3RvcmFnZVxyXG4gICAgU3RvcmFnZS5wcm90b3R5cGUucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICBpZiAod2luZG93W3RoaXMuY2FjaGVMb2NhdGlvbl0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8gY2xlYXIgc3RvcmFnZSAocmVtb3ZlIGFsbCBpdGVtcyBmcm9tIGl0KVxyXG4gICAgU3RvcmFnZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3dbdGhpcy5jYWNoZUxvY2F0aW9uXS5jbGVhcigpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTdG9yYWdlLnByb3RvdHlwZS5nZXRBbGxBY2Nlc3NUb2tlbnMgPSBmdW5jdGlvbiAoY2xpZW50SWQsIGhvbWVBY2NvdW50SWRlbnRpZmllcikge1xyXG4gICAgICAgIHZhciByZXN1bHRzID0gW107XHJcbiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuQ2FjaGVJdGVtO1xyXG4gICAgICAgIHZhciBzdG9yYWdlID0gd2luZG93W3RoaXMuY2FjaGVMb2NhdGlvbl07XHJcbiAgICAgICAgaWYgKHN0b3JhZ2UpIHtcclxuICAgICAgICAgICAgdmFyIGtleSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgZm9yIChrZXkgaW4gc3RvcmFnZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0b3JhZ2UuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChrZXkubWF0Y2goY2xpZW50SWQpICYmIGtleS5tYXRjaChob21lQWNjb3VudElkZW50aWZpZXIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0SXRlbShrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuQ2FjaGVJdGVtID0gbmV3IEFjY2Vzc1Rva2VuQ2FjaGVJdGVtKEpTT04ucGFyc2Uoa2V5KSwgSlNPTi5wYXJzZSh2YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGFjY2Vzc1Rva2VuQ2FjaGVJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0cztcclxuICAgIH07XHJcbiAgICBTdG9yYWdlLnByb3RvdHlwZS5yZW1vdmVBY3F1aXJlVG9rZW5FbnRyaWVzID0gZnVuY3Rpb24gKHN0YXRlKSB7XHJcbiAgICAgICAgdmFyIHN0b3JhZ2UgPSB3aW5kb3dbdGhpcy5jYWNoZUxvY2F0aW9uXTtcclxuICAgICAgICBpZiAoc3RvcmFnZSkge1xyXG4gICAgICAgICAgICB2YXIga2V5ID0gdm9pZCAwO1xyXG4gICAgICAgICAgICBmb3IgKGtleSBpbiBzdG9yYWdlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RvcmFnZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKChrZXkuaW5kZXhPZihDYWNoZUtleXMuQVVUSE9SSVRZKSAhPT0gLTEgfHwga2V5LmluZGV4T2YoQ2FjaGVLZXlzLkFDUVVJUkVfVE9LRU5fQUNDT1VOVCkgIT09IDEpICYmICghc3RhdGUgfHwga2V5LmluZGV4T2Yoc3RhdGUpICE9PSAtMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwbGl0S2V5ID0ga2V5LnNwbGl0KENvbnN0YW50cy5yZXNvdXJjZURlbGltaXRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGF0ZV8xID0gdm9pZCAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRLZXkubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVfMSA9IHNwbGl0S2V5WzFdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZV8xICYmICF0aGlzLnRva2VuUmVuZXdhbEluUHJvZ3Jlc3Moc3RhdGVfMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSXRlbShrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJdGVtKENvbnN0YW50cy5yZW5ld1N0YXR1cyArIHN0YXRlXzEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJdGVtKENvbnN0YW50cy5zdGF0ZUxvZ2luKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlSXRlbShDb25zdGFudHMuc3RhdGVBY3F1aXJlVG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJdGVtQ29va2llKGtleSwgXCJcIiwgLTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2xlYXJDb29raWUoKTtcclxuICAgIH07XHJcbiAgICBTdG9yYWdlLnByb3RvdHlwZS50b2tlblJlbmV3YWxJblByb2dyZXNzID0gZnVuY3Rpb24gKHN0YXRlVmFsdWUpIHtcclxuICAgICAgICB2YXIgc3RvcmFnZSA9IHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dO1xyXG4gICAgICAgIHZhciByZW5ld1N0YXR1cyA9IHN0b3JhZ2VbQ29uc3RhbnRzLnJlbmV3U3RhdHVzICsgc3RhdGVWYWx1ZV07XHJcbiAgICAgICAgcmV0dXJuICEoIXJlbmV3U3RhdHVzIHx8IHJlbmV3U3RhdHVzICE9PSBDb25zdGFudHMudG9rZW5SZW5ld1N0YXR1c0luUHJvZ3Jlc3MpO1xyXG4gICAgfTtcclxuICAgIFN0b3JhZ2UucHJvdG90eXBlLnJlc2V0Q2FjaGVJdGVtcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc3RvcmFnZSA9IHdpbmRvd1t0aGlzLmNhY2hlTG9jYXRpb25dO1xyXG4gICAgICAgIGlmIChzdG9yYWdlKSB7XHJcbiAgICAgICAgICAgIHZhciBrZXkgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIGZvciAoa2V5IGluIHN0b3JhZ2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdG9yYWdlLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YoQ29uc3RhbnRzLm1zYWwpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUl0ZW0oa2V5KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVBY3F1aXJlVG9rZW5FbnRyaWVzKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFN0b3JhZ2UucHJvdG90eXBlLnNldEl0ZW1Db29raWUgPSBmdW5jdGlvbiAoY05hbWUsIGNWYWx1ZSwgZXhwaXJlcykge1xyXG4gICAgICAgIHZhciBjb29raWVTdHIgPSBjTmFtZSArIFwiPVwiICsgY1ZhbHVlICsgXCI7XCI7XHJcbiAgICAgICAgaWYgKGV4cGlyZXMpIHtcclxuICAgICAgICAgICAgdmFyIGV4cGlyZVRpbWUgPSB0aGlzLmdldENvb2tpZUV4cGlyYXRpb25UaW1lKGV4cGlyZXMpO1xyXG4gICAgICAgICAgICBjb29raWVTdHIgKz0gXCJleHBpcmVzPVwiICsgZXhwaXJlVGltZSArIFwiO1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkb2N1bWVudC5jb29raWUgPSBjb29raWVTdHI7XHJcbiAgICB9O1xyXG4gICAgU3RvcmFnZS5wcm90b3R5cGUuZ2V0SXRlbUNvb2tpZSA9IGZ1bmN0aW9uIChjTmFtZSkge1xyXG4gICAgICAgIHZhciBuYW1lID0gY05hbWUgKyBcIj1cIjtcclxuICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoXCI7XCIpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2EubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGMgPSBjYVtpXTtcclxuICAgICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09PSBcIiBcIikge1xyXG4gICAgICAgICAgICAgICAgYyA9IGMuc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjLmluZGV4T2YobmFtZSkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjLnN1YnN0cmluZyhuYW1lLmxlbmd0aCwgYy5sZW5ndGgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgfTtcclxuICAgIFN0b3JhZ2UucHJvdG90eXBlLmdldENvb2tpZUV4cGlyYXRpb25UaW1lID0gZnVuY3Rpb24gKGNvb2tpZUxpZmVEYXlzKSB7XHJcbiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgICAgICB2YXIgZXhwciA9IG5ldyBEYXRlKHRvZGF5LmdldFRpbWUoKSArIGNvb2tpZUxpZmVEYXlzICogMjQgKiA2MCAqIDYwICogMTAwMCk7XHJcbiAgICAgICAgcmV0dXJuIGV4cHIudG9VVENTdHJpbmcoKTtcclxuICAgIH07XHJcbiAgICBTdG9yYWdlLnByb3RvdHlwZS5jbGVhckNvb2tpZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnNldEl0ZW1Db29raWUoQ29uc3RhbnRzLm5vbmNlSWRUb2tlbiwgXCJcIiwgLTEpO1xyXG4gICAgICAgIHRoaXMuc2V0SXRlbUNvb2tpZShDb25zdGFudHMuc3RhdGVMb2dpbiwgXCJcIiwgLTEpO1xyXG4gICAgICAgIHRoaXMuc2V0SXRlbUNvb2tpZShDb25zdGFudHMubG9naW5SZXF1ZXN0LCBcIlwiLCAtMSk7XHJcbiAgICAgICAgdGhpcy5zZXRJdGVtQ29va2llKENvbnN0YW50cy5zdGF0ZUFjcXVpcmVUb2tlbiwgXCJcIiwgLTEpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlIGFjcXVpcmVUb2tlbkFjY291bnRLZXkgdG8gY2FjaGUgYWNjb3VudCBvYmplY3RcclxuICAgICAqIEBwYXJhbSBhY2NvdW50SWRcclxuICAgICAqIEBwYXJhbSBzdGF0ZVxyXG4gICAgICovXHJcbiAgICBTdG9yYWdlLmdlbmVyYXRlQWNxdWlyZVRva2VuQWNjb3VudEtleSA9IGZ1bmN0aW9uIChhY2NvdW50SWQsIHN0YXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIENhY2hlS2V5cy5BQ1FVSVJFX1RPS0VOX0FDQ09VTlQgKyBDb25zdGFudHMucmVzb3VyY2VEZWxpbWl0ZXIgK1xyXG4gICAgICAgICAgICAoXCJcIiArIGFjY291bnRJZCkgKyBDb25zdGFudHMucmVzb3VyY2VEZWxpbWl0ZXIgKyAoXCJcIiArIHN0YXRlKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIENyZWF0ZSBhdXRob3JpdHlLZXkgdG8gY2FjaGUgYXV0aG9yaXR5XHJcbiAgICAgKiBAcGFyYW0gc3RhdGVcclxuICAgICAqL1xyXG4gICAgU3RvcmFnZS5nZW5lcmF0ZUF1dGhvcml0eUtleSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xyXG4gICAgICAgIHJldHVybiBDYWNoZUtleXMuQVVUSE9SSVRZICsgQ29uc3RhbnRzLnJlc291cmNlRGVsaW1pdGVyICsgKFwiXCIgKyBzdGF0ZSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFN0b3JhZ2U7XHJcbn0oKSk7XHJcbmV4cG9ydCB7IFN0b3JhZ2UgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U3RvcmFnZS5qcy5tYXAiLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5pbXBvcnQgeyBDcnlwdG9VdGlscyB9IGZyb20gXCIuL3V0aWxzL0NyeXB0b1V0aWxzXCI7XHJcbmltcG9ydCB7IFN0cmluZ1V0aWxzIH0gZnJvbSBcIi4vdXRpbHMvU3RyaW5nVXRpbHNcIjtcclxuLyoqXHJcbiAqIGFjY291bnRJZGVudGlmaWVyICAgICAgIGNvbWJpbmF0aW9uIG9mIGlkVG9rZW4udWlkIGFuZCBpZFRva2VuLnV0aWRcclxuICogaG9tZUFjY291bnRJZGVudGlmaWVyICAgY29tYmluYXRpb24gb2YgY2xpZW50SW5mby51aWQgYW5kIGNsaWVudEluZm8udXRpZFxyXG4gKiB1c2VyTmFtZSAgICAgICAgICAgICAgICBpZFRva2VuLnByZWZlcnJlZF91c2VybmFtZVxyXG4gKiBuYW1lICAgICAgICAgICAgICAgICAgICBpZFRva2VuLm5hbWVcclxuICogaWRUb2tlbiAgICAgICAgICAgICAgICAgaWRUb2tlblxyXG4gKiBzaWQgICAgICAgICAgICAgICAgICAgICBpZFRva2VuLnNpZCAtIHNlc3Npb24gaWRlbnRpZmllclxyXG4gKiBlbnZpcm9ubWVudCAgICAgICAgICAgICBpZHRva2VuLmlzc3VlciAodGhlIGF1dGhvcml0eSB0aGF0IGlzc3VlcyB0aGUgdG9rZW4pXHJcbiAqL1xyXG52YXIgQWNjb3VudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhbiBBY2NvdW50IE9iamVjdFxyXG4gICAgICogQHByYXJhbSBhY2NvdW50SWRlbnRpZmllclxyXG4gICAgICogQHBhcmFtIGhvbWVBY2NvdW50SWRlbnRpZmllclxyXG4gICAgICogQHBhcmFtIHVzZXJOYW1lXHJcbiAgICAgKiBAcGFyYW0gbmFtZVxyXG4gICAgICogQHBhcmFtIGlkVG9rZW5cclxuICAgICAqIEBwYXJhbSBzaWRcclxuICAgICAqIEBwYXJhbSBlbnZpcm9ubWVudFxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBBY2NvdW50KGFjY291bnRJZGVudGlmaWVyLCBob21lQWNjb3VudElkZW50aWZpZXIsIHVzZXJOYW1lLCBuYW1lLCBpZFRva2VuQ2xhaW1zLCBzaWQsIGVudmlyb25tZW50KSB7XHJcbiAgICAgICAgdGhpcy5hY2NvdW50SWRlbnRpZmllciA9IGFjY291bnRJZGVudGlmaWVyO1xyXG4gICAgICAgIHRoaXMuaG9tZUFjY291bnRJZGVudGlmaWVyID0gaG9tZUFjY291bnRJZGVudGlmaWVyO1xyXG4gICAgICAgIHRoaXMudXNlck5hbWUgPSB1c2VyTmFtZTtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIC8vIHdpbGwgYmUgZGVwcmVjYXRlZCBzb29uXHJcbiAgICAgICAgdGhpcy5pZFRva2VuID0gaWRUb2tlbkNsYWltcztcclxuICAgICAgICB0aGlzLmlkVG9rZW5DbGFpbXMgPSBpZFRva2VuQ2xhaW1zO1xyXG4gICAgICAgIHRoaXMuc2lkID0gc2lkO1xyXG4gICAgICAgIHRoaXMuZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQHBhcmFtIGlkVG9rZW5cclxuICAgICAqIEBwYXJhbSBjbGllbnRJbmZvXHJcbiAgICAgKi9cclxuICAgIEFjY291bnQuY3JlYXRlQWNjb3VudCA9IGZ1bmN0aW9uIChpZFRva2VuLCBjbGllbnRJbmZvKSB7XHJcbiAgICAgICAgLy8gY3JlYXRlIGFjY291bnRJZGVudGlmaWVyXHJcbiAgICAgICAgdmFyIGFjY291bnRJZGVudGlmaWVyID0gaWRUb2tlbi5vYmplY3RJZCB8fCBpZFRva2VuLnN1YmplY3Q7XHJcbiAgICAgICAgLy8gY3JlYXRlIGhvbWVBY2NvdW50SWRlbnRpZmllclxyXG4gICAgICAgIHZhciB1aWQgPSBjbGllbnRJbmZvID8gY2xpZW50SW5mby51aWQgOiBcIlwiO1xyXG4gICAgICAgIHZhciB1dGlkID0gY2xpZW50SW5mbyA/IGNsaWVudEluZm8udXRpZCA6IFwiXCI7XHJcbiAgICAgICAgdmFyIGhvbWVBY2NvdW50SWRlbnRpZmllcjtcclxuICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkodWlkKSAmJiAhU3RyaW5nVXRpbHMuaXNFbXB0eSh1dGlkKSkge1xyXG4gICAgICAgICAgICBob21lQWNjb3VudElkZW50aWZpZXIgPSBDcnlwdG9VdGlscy5iYXNlNjRFbmNvZGUodWlkKSArIFwiLlwiICsgQ3J5cHRvVXRpbHMuYmFzZTY0RW5jb2RlKHV0aWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IEFjY291bnQoYWNjb3VudElkZW50aWZpZXIsIGhvbWVBY2NvdW50SWRlbnRpZmllciwgaWRUb2tlbi5wcmVmZXJyZWROYW1lLCBpZFRva2VuLm5hbWUsIGlkVG9rZW4uY2xhaW1zLCBpZFRva2VuLnNpZCwgaWRUb2tlbi5pc3N1ZXIpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXRpbHMgZnVuY3Rpb24gdG8gY29tcGFyZSB0d28gQWNjb3VudCBvYmplY3RzIC0gdXNlZCB0byBjaGVjayBpZiB0aGUgc2FtZSB1c2VyIGFjY291bnQgaXMgbG9nZ2VkIGluXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGExOiBBY2NvdW50IG9iamVjdFxyXG4gICAgICogQHBhcmFtIGEyOiBBY2NvdW50IG9iamVjdFxyXG4gICAgICovXHJcbiAgICBBY2NvdW50LmNvbXBhcmVBY2NvdW50cyA9IGZ1bmN0aW9uIChhMSwgYTIpIHtcclxuICAgICAgICBpZiAoIWExIHx8ICFhMikge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhMS5ob21lQWNjb3VudElkZW50aWZpZXIgJiYgYTIuaG9tZUFjY291bnRJZGVudGlmaWVyKSB7XHJcbiAgICAgICAgICAgIGlmIChhMS5ob21lQWNjb3VudElkZW50aWZpZXIgPT09IGEyLmhvbWVBY2NvdW50SWRlbnRpZmllcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBBY2NvdW50O1xyXG59KCkpO1xyXG5leHBvcnQgeyBBY2NvdW50IH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUFjY291bnQuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbnZhciBUaW1lVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUaW1lVXRpbHMoKSB7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGltZSBpbiBzZWNvbmRzIGZvciBleHBpcmF0aW9uIGJhc2VkIG9uIHN0cmluZyB2YWx1ZSBwYXNzZWQgaW4uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGV4cGlyZXNJblxyXG4gICAgICovXHJcbiAgICBUaW1lVXRpbHMucGFyc2VFeHBpcmVzSW4gPSBmdW5jdGlvbiAoZXhwaXJlc0luKSB7XHJcbiAgICAgICAgLy8gaWYgQUFEIGRpZCBub3Qgc2VuZCBcImV4cGlyZXNfaW5cIiBwcm9wZXJ0eSwgdXNlIGRlZmF1bHQgZXhwaXJhdGlvbiBvZiAzNTk5IHNlY29uZHMsIGZvciBzb21lIHJlYXNvbiBBQUQgc2VuZHMgMzU5OSBhcyBcImV4cGlyZXNfaW5cIiB2YWx1ZSBpbnN0ZWFkIG9mIDM2MDBcclxuICAgICAgICBpZiAoIWV4cGlyZXNJbikge1xyXG4gICAgICAgICAgICBleHBpcmVzSW4gPSBcIjM1OTlcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGV4cGlyZXNJbiwgMTApO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogcmV0dXJuIHRoZSBjdXJyZW50IHRpbWUgaW4gVW5peCB0aW1lLiBEYXRlLmdldFRpbWUoKSByZXR1cm5zIGluIG1pbGxpc2Vjb25kcy5cclxuICAgICAqL1xyXG4gICAgVGltZVV0aWxzLm5vdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDAuMCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFRpbWVVdGlscztcclxufSgpKTtcclxuZXhwb3J0IHsgVGltZVV0aWxzIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVRpbWVVdGlscy5qcy5tYXAiLCJpbXBvcnQgKiBhcyB0c2xpYl8xIGZyb20gXCJ0c2xpYlwiO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIFJlc3BvbnNlVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSZXNwb25zZVV0aWxzKCkge1xyXG4gICAgfVxyXG4gICAgUmVzcG9uc2VVdGlscy5zZXRSZXNwb25zZUlkVG9rZW4gPSBmdW5jdGlvbiAob3JpZ2luYWxSZXNwb25zZSwgaWRUb2tlbk9iaikge1xyXG4gICAgICAgIGlmICghb3JpZ2luYWxSZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIWlkVG9rZW5PYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsUmVzcG9uc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBleHAgPSBOdW1iZXIoaWRUb2tlbk9iai5leHBpcmF0aW9uKTtcclxuICAgICAgICBpZiAoZXhwICYmICFvcmlnaW5hbFJlc3BvbnNlLmV4cGlyZXNPbikge1xyXG4gICAgICAgICAgICBvcmlnaW5hbFJlc3BvbnNlLmV4cGlyZXNPbiA9IG5ldyBEYXRlKGV4cCAqIDEwMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHNsaWJfMS5fX2Fzc2lnbih7fSwgb3JpZ2luYWxSZXNwb25zZSwgeyBpZFRva2VuOiBpZFRva2VuT2JqLCBpZFRva2VuQ2xhaW1zOiBpZFRva2VuT2JqLmNsYWltcywgdW5pcXVlSWQ6IGlkVG9rZW5PYmoub2JqZWN0SWQgfHwgaWRUb2tlbk9iai5zdWJqZWN0LCB0ZW5hbnRJZDogaWRUb2tlbk9iai50ZW5hbnRJZCB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUmVzcG9uc2VVdGlscztcclxufSgpKTtcclxuZXhwb3J0IHsgUmVzcG9uc2VVdGlscyB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1SZXNwb25zZVV0aWxzLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbi8qKlxyXG4gKiBYSFIgY2xpZW50IGZvciBKU09OIGVuZHBvaW50c1xyXG4gKiBodHRwczovL3d3dy5ucG1qcy5jb20vcGFja2FnZS9hc3luYy1wcm9taXNlXHJcbiAqIEBoaWRkZW5cclxuICovXHJcbnZhciBYaHJDbGllbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBYaHJDbGllbnQoKSB7XHJcbiAgICB9XHJcbiAgICBYaHJDbGllbnQucHJvdG90eXBlLnNlbmRSZXF1ZXN0QXN5bmMgPSBmdW5jdGlvbiAodXJsLCBtZXRob2QsIGVuYWJsZUNhY2hpbmcpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICAgICAgeGhyLm9wZW4obWV0aG9kLCB1cmwsIC8qYXN5bmM6ICovIHRydWUpO1xyXG4gICAgICAgICAgICBpZiAoZW5hYmxlQ2FjaGluZykge1xyXG4gICAgICAgICAgICAgICAgLy8gVE9ETzogKHNoaXZiKSBlbnN1cmUgdGhhdCB0aGlzIGNhbiBiZSBjYWNoZWRcclxuICAgICAgICAgICAgICAgIC8vIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ2FjaGUtQ29udHJvbFwiLCBcIlB1YmxpY1wiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKGV2KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA8IDIwMCB8fCB4aHIuc3RhdHVzID49IDMwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChfdGhpcy5oYW5kbGVFcnJvcih4aHIucmVzcG9uc2VUZXh0KSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBqc29uUmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QoX3RoaXMuaGFuZGxlRXJyb3IoeGhyLnJlc3BvbnNlVGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShqc29uUmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIChldikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KHhoci5zdGF0dXMpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAobWV0aG9kID09PSBcIkdFVFwiKSB7XHJcbiAgICAgICAgICAgICAgICB4aHIuc2VuZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgXCJub3QgaW1wbGVtZW50ZWRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFhockNsaWVudC5wcm90b3R5cGUuaGFuZGxlRXJyb3IgPSBmdW5jdGlvbiAocmVzcG9uc2VUZXh0KSB7XHJcbiAgICAgICAgdmFyIGpzb25SZXNwb25zZTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBqc29uUmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgIGlmIChqc29uUmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBqc29uUmVzcG9uc2UuZXJyb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyByZXNwb25zZVRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlVGV4dDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFhockNsaWVudDtcclxufSgpKTtcclxuZXhwb3J0IHsgWGhyQ2xpZW50IH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVhIUkNsaWVudC5qcy5tYXAiLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5pbXBvcnQgeyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlIH0gZnJvbSBcIi4vZXJyb3IvQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yXCI7XHJcbmltcG9ydCB7IFhockNsaWVudCB9IGZyb20gXCIuL1hIUkNsaWVudFwiO1xyXG5pbXBvcnQgeyBVcmxVdGlscyB9IGZyb20gXCIuL3V0aWxzL1VybFV0aWxzXCI7XHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG5leHBvcnQgdmFyIEF1dGhvcml0eVR5cGU7XHJcbihmdW5jdGlvbiAoQXV0aG9yaXR5VHlwZSkge1xyXG4gICAgQXV0aG9yaXR5VHlwZVtBdXRob3JpdHlUeXBlW1wiQWFkXCJdID0gMF0gPSBcIkFhZFwiO1xyXG4gICAgQXV0aG9yaXR5VHlwZVtBdXRob3JpdHlUeXBlW1wiQWRmc1wiXSA9IDFdID0gXCJBZGZzXCI7XHJcbiAgICBBdXRob3JpdHlUeXBlW0F1dGhvcml0eVR5cGVbXCJCMkNcIl0gPSAyXSA9IFwiQjJDXCI7XHJcbn0pKEF1dGhvcml0eVR5cGUgfHwgKEF1dGhvcml0eVR5cGUgPSB7fSkpO1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIEF1dGhvcml0eSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEF1dGhvcml0eShhdXRob3JpdHksIHZhbGlkYXRlQXV0aG9yaXR5KSB7XHJcbiAgICAgICAgdGhpcy5Jc1ZhbGlkYXRpb25FbmFibGVkID0gdmFsaWRhdGVBdXRob3JpdHk7XHJcbiAgICAgICAgdGhpcy5DYW5vbmljYWxBdXRob3JpdHkgPSBhdXRob3JpdHk7XHJcbiAgICAgICAgdGhpcy52YWxpZGF0ZUFzVXJpKCk7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQXV0aG9yaXR5LnByb3RvdHlwZSwgXCJUZW5hbnRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5DYW5vbmljYWxBdXRob3JpdHlVcmxDb21wb25lbnRzLlBhdGhTZWdtZW50c1swXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBdXRob3JpdHkucHJvdG90eXBlLCBcIkF1dGhvcml6YXRpb25FbmRwb2ludFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVSZXNvbHZlZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50ZW5hbnREaXNjb3ZlcnlSZXNwb25zZS5BdXRob3JpemF0aW9uRW5kcG9pbnQucmVwbGFjZShcInt0ZW5hbnR9XCIsIHRoaXMuVGVuYW50KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBdXRob3JpdHkucHJvdG90eXBlLCBcIkVuZFNlc3Npb25FbmRwb2ludFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVSZXNvbHZlZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50ZW5hbnREaXNjb3ZlcnlSZXNwb25zZS5FbmRTZXNzaW9uRW5kcG9pbnQucmVwbGFjZShcInt0ZW5hbnR9XCIsIHRoaXMuVGVuYW50KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBdXRob3JpdHkucHJvdG90eXBlLCBcIlNlbGZTaWduZWRKd3RBdWRpZW5jZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsaWRhdGVSZXNvbHZlZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy50ZW5hbnREaXNjb3ZlcnlSZXNwb25zZS5Jc3N1ZXIucmVwbGFjZShcInt0ZW5hbnR9XCIsIHRoaXMuVGVuYW50KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIEF1dGhvcml0eS5wcm90b3R5cGUudmFsaWRhdGVSZXNvbHZlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMudGVuYW50RGlzY292ZXJ5UmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdGhyb3cgXCJQbGVhc2UgY2FsbCBSZXNvbHZlRW5kcG9pbnRzQXN5bmMgZmlyc3RcIjtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEF1dGhvcml0eS5wcm90b3R5cGUsIFwiQ2Fub25pY2FsQXV0aG9yaXR5XCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBBIFVSTCB0aGF0IGlzIHRoZSBhdXRob3JpdHkgc2V0IGJ5IHRoZSBkZXZlbG9wZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2Fub25pY2FsQXV0aG9yaXR5O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2Fub25pY2FsQXV0aG9yaXR5ID0gVXJsVXRpbHMuQ2Fub25pY2FsaXplVXJpKHVybCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2Fub25pY2FsQXV0aG9yaXR5VXJsQ29tcG9uZW50cyA9IG51bGw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQXV0aG9yaXR5LnByb3RvdHlwZSwgXCJDYW5vbmljYWxBdXRob3JpdHlVcmxDb21wb25lbnRzXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmNhbm9uaWNhbEF1dGhvcml0eVVybENvbXBvbmVudHMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2Fub25pY2FsQXV0aG9yaXR5VXJsQ29tcG9uZW50cyA9IFVybFV0aWxzLkdldFVybENvbXBvbmVudHModGhpcy5DYW5vbmljYWxBdXRob3JpdHkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhbm9uaWNhbEF1dGhvcml0eVVybENvbXBvbmVudHM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQXV0aG9yaXR5LnByb3RvdHlwZSwgXCJEZWZhdWx0T3BlbklkQ29uZmlndXJhdGlvbkVuZHBvaW50XCIsIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAvLyBodHRwOi8vb3BlbmlkLm5ldC9zcGVjcy9vcGVuaWQtY29ubmVjdC1kaXNjb3ZlcnktMV8wLmh0bWwjUHJvdmlkZXJNZXRhZGF0YVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5DYW5vbmljYWxBdXRob3JpdHkgKyBcInYyLjAvLndlbGwta25vd24vb3BlbmlkLWNvbmZpZ3VyYXRpb25cIjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogR2l2ZW4gYSBzdHJpbmcsIHZhbGlkYXRlIHRoYXQgaXQgaXMgb2YgdGhlIGZvcm0gaHR0cHM6Ly9kb21haW4vcGF0aFxyXG4gICAgICovXHJcbiAgICBBdXRob3JpdHkucHJvdG90eXBlLnZhbGlkYXRlQXNVcmkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNvbXBvbmVudHM7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29tcG9uZW50cyA9IHRoaXMuQ2Fub25pY2FsQXV0aG9yaXR5VXJsQ29tcG9uZW50cztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5pbnZhbGlkQXV0aG9yaXR5VHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFjb21wb25lbnRzLlByb3RvY29sIHx8IGNvbXBvbmVudHMuUHJvdG9jb2wudG9Mb3dlckNhc2UoKSAhPT0gXCJodHRwczpcIikge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlLmF1dGhvcml0eVVyaUluc2VjdXJlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWNvbXBvbmVudHMuUGF0aFNlZ21lbnRzIHx8IGNvbXBvbmVudHMuUGF0aFNlZ21lbnRzLmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgdGhyb3cgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5hdXRob3JpdHlVcmlJbnZhbGlkUGF0aDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxscyB0aGUgT0lEQyBlbmRwb2ludCBhbmQgcmV0dXJucyB0aGUgcmVzcG9uc2VcclxuICAgICAqL1xyXG4gICAgQXV0aG9yaXR5LnByb3RvdHlwZS5EaXNjb3ZlckVuZHBvaW50cyA9IGZ1bmN0aW9uIChvcGVuSWRDb25maWd1cmF0aW9uRW5kcG9pbnQpIHtcclxuICAgICAgICB2YXIgY2xpZW50ID0gbmV3IFhockNsaWVudCgpO1xyXG4gICAgICAgIHJldHVybiBjbGllbnQuc2VuZFJlcXVlc3RBc3luYyhvcGVuSWRDb25maWd1cmF0aW9uRW5kcG9pbnQsIFwiR0VUXCIsIC8qZW5hYmxlQ2FjaGluZzogKi8gdHJ1ZSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uRW5kcG9pbnQ6IHJlc3BvbnNlLmF1dGhvcml6YXRpb25fZW5kcG9pbnQsXHJcbiAgICAgICAgICAgICAgICBFbmRTZXNzaW9uRW5kcG9pbnQ6IHJlc3BvbnNlLmVuZF9zZXNzaW9uX2VuZHBvaW50LFxyXG4gICAgICAgICAgICAgICAgSXNzdWVyOiByZXNwb25zZS5pc3N1ZXJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgYSBwcm9taXNlLlxyXG4gICAgICogQ2hlY2tzIHRvIHNlZSBpZiB0aGUgYXV0aG9yaXR5IGlzIGluIHRoZSBjYWNoZVxyXG4gICAgICogRGlzY292ZXIgZW5kcG9pbnRzIHZpYSBvcGVuaWQtY29uZmlndXJhdGlvblxyXG4gICAgICogSWYgc3VjY2Vzc2Z1bCwgY2FjaGVzIHRoZSBlbmRwb2ludCBmb3IgbGF0ZXIgdXNlIGluIE9JRENcclxuICAgICAqL1xyXG4gICAgQXV0aG9yaXR5LnByb3RvdHlwZS5yZXNvbHZlRW5kcG9pbnRzQXN5bmMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgb3BlbklkQ29uZmlndXJhdGlvbkVuZHBvaW50ID0gXCJcIjtcclxuICAgICAgICByZXR1cm4gdGhpcy5HZXRPcGVuSWRDb25maWd1cmF0aW9uRW5kcG9pbnRBc3luYygpLnRoZW4oZnVuY3Rpb24gKG9wZW5JZENvbmZpZ3VyYXRpb25FbmRwb2ludFJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIG9wZW5JZENvbmZpZ3VyYXRpb25FbmRwb2ludCA9IG9wZW5JZENvbmZpZ3VyYXRpb25FbmRwb2ludFJlc3BvbnNlO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuRGlzY292ZXJFbmRwb2ludHMob3BlbklkQ29uZmlndXJhdGlvbkVuZHBvaW50KTtcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh0ZW5hbnREaXNjb3ZlcnlSZXNwb25zZSkge1xyXG4gICAgICAgICAgICBfdGhpcy50ZW5hbnREaXNjb3ZlcnlSZXNwb25zZSA9IHRlbmFudERpc2NvdmVyeVJlc3BvbnNlO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEF1dGhvcml0eTtcclxufSgpKTtcclxuZXhwb3J0IHsgQXV0aG9yaXR5IH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUF1dGhvcml0eS5qcy5tYXAiLCIvLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5pbXBvcnQgKiBhcyB0c2xpYl8xIGZyb20gXCJ0c2xpYlwiO1xyXG5pbXBvcnQgeyBBdXRob3JpdHksIEF1dGhvcml0eVR5cGUgfSBmcm9tIFwiLi9BdXRob3JpdHlcIjtcclxuaW1wb3J0IHsgWGhyQ2xpZW50IH0gZnJvbSBcIi4vWEhSQ2xpZW50XCI7XHJcbmltcG9ydCB7IEFBRFRydXN0ZWRIb3N0TGlzdCB9IGZyb20gXCIuL3V0aWxzL0NvbnN0YW50c1wiO1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKi9cclxudmFyIEFhZEF1dGhvcml0eSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIHRzbGliXzEuX19leHRlbmRzKEFhZEF1dGhvcml0eSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEFhZEF1dGhvcml0eShhdXRob3JpdHksIHZhbGlkYXRlQXV0aG9yaXR5KSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIGF1dGhvcml0eSwgdmFsaWRhdGVBdXRob3JpdHkpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFkQXV0aG9yaXR5LnByb3RvdHlwZSwgXCJBYWRJbnN0YW5jZURpc2NvdmVyeUVuZHBvaW50VXJsXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEFhZEF1dGhvcml0eS5BYWRJbnN0YW5jZURpc2NvdmVyeUVuZHBvaW50ICsgXCI/YXBpLXZlcnNpb249MS4wJmF1dGhvcml6YXRpb25fZW5kcG9pbnQ9XCIgKyB0aGlzLkNhbm9uaWNhbEF1dGhvcml0eSArIFwib2F1dGgyL3YyLjAvYXV0aG9yaXplXCI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFkQXV0aG9yaXR5LnByb3RvdHlwZSwgXCJBdXRob3JpdHlUeXBlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEF1dGhvcml0eVR5cGUuQWFkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB3aGljaCByZXNvbHZlcyB0byB0aGUgT0lEQyBlbmRwb2ludFxyXG4gICAgICogT25seSByZXNwb25kcyB3aXRoIHRoZSBlbmRwb2ludFxyXG4gICAgICovXHJcbiAgICBBYWRBdXRob3JpdHkucHJvdG90eXBlLkdldE9wZW5JZENvbmZpZ3VyYXRpb25FbmRwb2ludEFzeW5jID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHJlc3VsdFByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKF90aGlzLkRlZmF1bHRPcGVuSWRDb25maWd1cmF0aW9uRW5kcG9pbnQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICghdGhpcy5Jc1ZhbGlkYXRpb25FbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRQcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaG9zdCA9IHRoaXMuQ2Fub25pY2FsQXV0aG9yaXR5VXJsQ29tcG9uZW50cy5Ib3N0TmFtZUFuZFBvcnQ7XHJcbiAgICAgICAgaWYgKHRoaXMuSXNJblRydXN0ZWRIb3N0TGlzdChob3N0KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0UHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNsaWVudCA9IG5ldyBYaHJDbGllbnQoKTtcclxuICAgICAgICByZXR1cm4gY2xpZW50LnNlbmRSZXF1ZXN0QXN5bmModGhpcy5BYWRJbnN0YW5jZURpc2NvdmVyeUVuZHBvaW50VXJsLCBcIkdFVFwiLCB0cnVlKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRlbmFudF9kaXNjb3ZlcnlfZW5kcG9pbnQ7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBDaGVja3MgdG8gc2VlIGlmIHRoZSBob3N0IGlzIGluIGEgbGlzdCBvZiB0cnVzdGVkIGhvc3RzXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gVGhlIGhvc3QgdG8gbG9vayB1cFxyXG4gICAgICovXHJcbiAgICBBYWRBdXRob3JpdHkucHJvdG90eXBlLklzSW5UcnVzdGVkSG9zdExpc3QgPSBmdW5jdGlvbiAoaG9zdCkge1xyXG4gICAgICAgIHJldHVybiBBQURUcnVzdGVkSG9zdExpc3RbaG9zdC50b0xvd2VyQ2FzZSgpXTtcclxuICAgIH07XHJcbiAgICBBYWRBdXRob3JpdHkuQWFkSW5zdGFuY2VEaXNjb3ZlcnlFbmRwb2ludCA9IFwiaHR0cHM6Ly9sb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tL2NvbW1vbi9kaXNjb3ZlcnkvaW5zdGFuY2VcIjtcclxuICAgIHJldHVybiBBYWRBdXRob3JpdHk7XHJcbn0oQXV0aG9yaXR5KSk7XHJcbmV4cG9ydCB7IEFhZEF1dGhvcml0eSB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BYWRBdXRob3JpdHkuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tIFwidHNsaWJcIjtcclxuaW1wb3J0IHsgQWFkQXV0aG9yaXR5IH0gZnJvbSBcIi4vQWFkQXV0aG9yaXR5XCI7XHJcbmltcG9ydCB7IEF1dGhvcml0eVR5cGUgfSBmcm9tIFwiLi9BdXRob3JpdHlcIjtcclxuaW1wb3J0IHsgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZSB9IGZyb20gXCIuL2Vycm9yL0NsaWVudENvbmZpZ3VyYXRpb25FcnJvclwiO1xyXG5pbXBvcnQgeyBVcmxVdGlscyB9IGZyb20gXCIuL3V0aWxzL1VybFV0aWxzXCI7XHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG52YXIgQjJjQXV0aG9yaXR5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoQjJjQXV0aG9yaXR5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQjJjQXV0aG9yaXR5KGF1dGhvcml0eSwgdmFsaWRhdGVBdXRob3JpdHkpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBhdXRob3JpdHksIHZhbGlkYXRlQXV0aG9yaXR5KSB8fCB0aGlzO1xyXG4gICAgICAgIHZhciB1cmxDb21wb25lbnRzID0gVXJsVXRpbHMuR2V0VXJsQ29tcG9uZW50cyhhdXRob3JpdHkpO1xyXG4gICAgICAgIHZhciBwYXRoU2VnbWVudHMgPSB1cmxDb21wb25lbnRzLlBhdGhTZWdtZW50cztcclxuICAgICAgICBpZiAocGF0aFNlZ21lbnRzLmxlbmd0aCA8IDMpIHtcclxuICAgICAgICAgICAgdGhyb3cgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZS5iMmNBdXRob3JpdHlVcmlJbnZhbGlkUGF0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgX3RoaXMuQ2Fub25pY2FsQXV0aG9yaXR5ID0gXCJodHRwczovL1wiICsgdXJsQ29tcG9uZW50cy5Ib3N0TmFtZUFuZFBvcnQgKyBcIi9cIiArIHBhdGhTZWdtZW50c1swXSArIFwiL1wiICsgcGF0aFNlZ21lbnRzWzFdICsgXCIvXCIgKyBwYXRoU2VnbWVudHNbMl0gKyBcIi9cIjtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQjJjQXV0aG9yaXR5LnByb3RvdHlwZSwgXCJBdXRob3JpdHlUeXBlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEF1dGhvcml0eVR5cGUuQjJDO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB3aXRoIHRoZSBUZW5hbnREaXNjb3ZlcnlFbmRwb2ludFxyXG4gICAgICovXHJcbiAgICBCMmNBdXRob3JpdHkucHJvdG90eXBlLkdldE9wZW5JZENvbmZpZ3VyYXRpb25FbmRwb2ludEFzeW5jID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHJlc3VsdFByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKF90aGlzLkRlZmF1bHRPcGVuSWRDb25maWd1cmF0aW9uRW5kcG9pbnQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmICghdGhpcy5Jc1ZhbGlkYXRpb25FbmFibGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRQcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5Jc0luVHJ1c3RlZEhvc3RMaXN0KHRoaXMuQ2Fub25pY2FsQXV0aG9yaXR5VXJsQ29tcG9uZW50cy5Ib3N0TmFtZUFuZFBvcnQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRQcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KENsaWVudENvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UudW5zdXBwb3J0ZWRBdXRob3JpdHlWYWxpZGF0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCMmNBdXRob3JpdHkuQjJDX1BSRUZJWCA9IFwidGZwXCI7XHJcbiAgICByZXR1cm4gQjJjQXV0aG9yaXR5O1xyXG59KEFhZEF1dGhvcml0eSkpO1xyXG5leHBvcnQgeyBCMmNBdXRob3JpdHkgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QjJjQXV0aG9yaXR5LmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbi8qKlxyXG4gKiBAaGlkZGVuXHJcbiAqL1xyXG5pbXBvcnQgeyBBYWRBdXRob3JpdHkgfSBmcm9tIFwiLi9BYWRBdXRob3JpdHlcIjtcclxuaW1wb3J0IHsgQjJjQXV0aG9yaXR5IH0gZnJvbSBcIi4vQjJjQXV0aG9yaXR5XCI7XHJcbmltcG9ydCB7IEF1dGhvcml0eVR5cGUgfSBmcm9tIFwiLi9BdXRob3JpdHlcIjtcclxuaW1wb3J0IHsgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yTWVzc2FnZSB9IGZyb20gXCIuL2Vycm9yL0NsaWVudENvbmZpZ3VyYXRpb25FcnJvclwiO1xyXG5pbXBvcnQgeyBVcmxVdGlscyB9IGZyb20gXCIuL3V0aWxzL1VybFV0aWxzXCI7XHJcbmltcG9ydCB7IFN0cmluZ1V0aWxzIH0gZnJvbSBcIi4vdXRpbHMvU3RyaW5nVXRpbHNcIjtcclxudmFyIEF1dGhvcml0eUZhY3RvcnkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBdXRob3JpdHlGYWN0b3J5KCkge1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAqIFBhcnNlIHRoZSB1cmwgYW5kIGRldGVybWluZSB0aGUgdHlwZSBvZiBhdXRob3JpdHlcclxuICAgICovXHJcbiAgICBBdXRob3JpdHlGYWN0b3J5LkRldGVjdEF1dGhvcml0eUZyb21VcmwgPSBmdW5jdGlvbiAoYXV0aG9yaXR5VXJsKSB7XHJcbiAgICAgICAgYXV0aG9yaXR5VXJsID0gVXJsVXRpbHMuQ2Fub25pY2FsaXplVXJpKGF1dGhvcml0eVVybCk7XHJcbiAgICAgICAgdmFyIGNvbXBvbmVudHMgPSBVcmxVdGlscy5HZXRVcmxDb21wb25lbnRzKGF1dGhvcml0eVVybCk7XHJcbiAgICAgICAgdmFyIHBhdGhTZWdtZW50cyA9IGNvbXBvbmVudHMuUGF0aFNlZ21lbnRzO1xyXG4gICAgICAgIHN3aXRjaCAocGF0aFNlZ21lbnRzWzBdKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJ0ZnBcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBBdXRob3JpdHlUeXBlLkIyQztcclxuICAgICAgICAgICAgY2FzZSBcImFkZnNcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBBdXRob3JpdHlUeXBlLkFkZnM7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gQXV0aG9yaXR5VHlwZS5BYWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgKiBDcmVhdGUgYW4gYXV0aG9yaXR5IG9iamVjdCBvZiB0aGUgY29ycmVjdCB0eXBlIGJhc2VkIG9uIHRoZSB1cmxcclxuICAgICogUGVyZm9ybXMgYmFzaWMgYXV0aG9yaXR5IHZhbGlkYXRpb24gLSBjaGVja3MgdG8gc2VlIGlmIHRoZSBhdXRob3JpdHkgaXMgb2YgYSB2YWxpZCB0eXBlIChlZyBhYWQsIGIyYylcclxuICAgICovXHJcbiAgICBBdXRob3JpdHlGYWN0b3J5LkNyZWF0ZUluc3RhbmNlID0gZnVuY3Rpb24gKGF1dGhvcml0eVVybCwgdmFsaWRhdGVBdXRob3JpdHkpIHtcclxuICAgICAgICBpZiAoU3RyaW5nVXRpbHMuaXNFbXB0eShhdXRob3JpdHlVcmwpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgdHlwZSA9IEF1dGhvcml0eUZhY3RvcnkuRGV0ZWN0QXV0aG9yaXR5RnJvbVVybChhdXRob3JpdHlVcmwpO1xyXG4gICAgICAgIC8vIERlcGVuZGluZyBvbiBhYm92ZSBkZXRlY3Rpb24sIGNyZWF0ZSB0aGUgcmlnaHQgdHlwZS5cclxuICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBBdXRob3JpdHlUeXBlLkIyQzpcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQjJjQXV0aG9yaXR5KGF1dGhvcml0eVVybCwgdmFsaWRhdGVBdXRob3JpdHkpO1xyXG4gICAgICAgICAgICBjYXNlIEF1dGhvcml0eVR5cGUuQWFkOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBYWRBdXRob3JpdHkoYXV0aG9yaXR5VXJsLCB2YWxpZGF0ZUF1dGhvcml0eSk7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3JNZXNzYWdlLmludmFsaWRBdXRob3JpdHlUeXBlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gQXV0aG9yaXR5RmFjdG9yeTtcclxufSgpKTtcclxuZXhwb3J0IHsgQXV0aG9yaXR5RmFjdG9yeSB9O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BdXRob3JpdHlGYWN0b3J5LmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCB7IFN0cmluZ1V0aWxzIH0gZnJvbSBcIi4vdXRpbHMvU3RyaW5nVXRpbHNcIjtcclxuaW1wb3J0IHsgbGlicmFyeVZlcnNpb24gfSBmcm9tIFwiLi91dGlscy9Db25zdGFudHNcIjtcclxuZXhwb3J0IHZhciBMb2dMZXZlbDtcclxuKGZ1bmN0aW9uIChMb2dMZXZlbCkge1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJFcnJvclwiXSA9IDBdID0gXCJFcnJvclwiO1xyXG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJXYXJuaW5nXCJdID0gMV0gPSBcIldhcm5pbmdcIjtcclxuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiSW5mb1wiXSA9IDJdID0gXCJJbmZvXCI7XHJcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIlZlcmJvc2VcIl0gPSAzXSA9IFwiVmVyYm9zZVwiO1xyXG59KShMb2dMZXZlbCB8fCAoTG9nTGV2ZWwgPSB7fSkpO1xyXG52YXIgTG9nZ2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTG9nZ2VyKGxvY2FsQ2FsbGJhY2ssIG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBoaWRkZW5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmxldmVsID0gTG9nTGV2ZWwuSW5mbztcclxuICAgICAgICB2YXIgX2EgPSBvcHRpb25zLmNvcnJlbGF0aW9uSWQsIGNvcnJlbGF0aW9uSWQgPSBfYSA9PT0gdm9pZCAwID8gXCJcIiA6IF9hLCBfYiA9IG9wdGlvbnMubGV2ZWwsIGxldmVsID0gX2IgPT09IHZvaWQgMCA/IExvZ0xldmVsLkluZm8gOiBfYiwgX2MgPSBvcHRpb25zLnBpaUxvZ2dpbmdFbmFibGVkLCBwaWlMb2dnaW5nRW5hYmxlZCA9IF9jID09PSB2b2lkIDAgPyBmYWxzZSA6IF9jO1xyXG4gICAgICAgIHRoaXMubG9jYWxDYWxsYmFjayA9IGxvY2FsQ2FsbGJhY2s7XHJcbiAgICAgICAgdGhpcy5jb3JyZWxhdGlvbklkID0gY29ycmVsYXRpb25JZDtcclxuICAgICAgICB0aGlzLmxldmVsID0gbGV2ZWw7XHJcbiAgICAgICAgdGhpcy5waWlMb2dnaW5nRW5hYmxlZCA9IHBpaUxvZ2dpbmdFbmFibGVkO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIExvZ2dlci5wcm90b3R5cGUubG9nTWVzc2FnZSA9IGZ1bmN0aW9uIChsb2dMZXZlbCwgbG9nTWVzc2FnZSwgY29udGFpbnNQaWkpIHtcclxuICAgICAgICBpZiAoKGxvZ0xldmVsID4gdGhpcy5sZXZlbCkgfHwgKCF0aGlzLnBpaUxvZ2dpbmdFbmFibGVkICYmIGNvbnRhaW5zUGlpKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvVVRDU3RyaW5nKCk7XHJcbiAgICAgICAgdmFyIGxvZztcclxuICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkodGhpcy5jb3JyZWxhdGlvbklkKSkge1xyXG4gICAgICAgICAgICBsb2cgPSB0aW1lc3RhbXAgKyBcIjpcIiArIHRoaXMuY29ycmVsYXRpb25JZCArIFwiLVwiICsgbGlicmFyeVZlcnNpb24oKSArIFwiLVwiICsgTG9nTGV2ZWxbbG9nTGV2ZWxdICsgXCIgXCIgKyBsb2dNZXNzYWdlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbG9nID0gdGltZXN0YW1wICsgXCI6XCIgKyBsaWJyYXJ5VmVyc2lvbigpICsgXCItXCIgKyBMb2dMZXZlbFtsb2dMZXZlbF0gKyBcIiBcIiArIGxvZ01lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZXhlY3V0ZUNhbGxiYWNrKGxvZ0xldmVsLCBsb2csIGNvbnRhaW5zUGlpKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqL1xyXG4gICAgTG9nZ2VyLnByb3RvdHlwZS5leGVjdXRlQ2FsbGJhY2sgPSBmdW5jdGlvbiAobGV2ZWwsIG1lc3NhZ2UsIGNvbnRhaW5zUGlpKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubG9jYWxDYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aGlzLmxvY2FsQ2FsbGJhY2sobGV2ZWwsIG1lc3NhZ2UsIGNvbnRhaW5zUGlpKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIExvZ2dlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgIHRoaXMubG9nTWVzc2FnZShMb2dMZXZlbC5FcnJvciwgbWVzc2FnZSwgZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICovXHJcbiAgICBMb2dnZXIucHJvdG90eXBlLmVycm9yUGlpID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcclxuICAgICAgICB0aGlzLmxvZ01lc3NhZ2UoTG9nTGV2ZWwuRXJyb3IsIG1lc3NhZ2UsIHRydWUpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICovXHJcbiAgICBMb2dnZXIucHJvdG90eXBlLndhcm5pbmcgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgIHRoaXMubG9nTWVzc2FnZShMb2dMZXZlbC5XYXJuaW5nLCBtZXNzYWdlLCBmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIExvZ2dlci5wcm90b3R5cGUud2FybmluZ1BpaSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhpcy5sb2dNZXNzYWdlKExvZ0xldmVsLldhcm5pbmcsIG1lc3NhZ2UsIHRydWUpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICovXHJcbiAgICBMb2dnZXIucHJvdG90eXBlLmluZm8gPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgIHRoaXMubG9nTWVzc2FnZShMb2dMZXZlbC5JbmZvLCBtZXNzYWdlLCBmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIExvZ2dlci5wcm90b3R5cGUuaW5mb1BpaSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhpcy5sb2dNZXNzYWdlKExvZ0xldmVsLkluZm8sIG1lc3NhZ2UsIHRydWUpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICovXHJcbiAgICBMb2dnZXIucHJvdG90eXBlLnZlcmJvc2UgPSBmdW5jdGlvbiAobWVzc2FnZSkge1xyXG4gICAgICAgIHRoaXMubG9nTWVzc2FnZShMb2dMZXZlbC5WZXJib3NlLCBtZXNzYWdlLCBmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIExvZ2dlci5wcm90b3R5cGUudmVyYm9zZVBpaSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhpcy5sb2dNZXNzYWdlKExvZ0xldmVsLlZlcmJvc2UsIG1lc3NhZ2UsIHRydWUpO1xyXG4gICAgfTtcclxuICAgIExvZ2dlci5wcm90b3R5cGUuaXNQaWlMb2dnaW5nRW5hYmxlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5waWlMb2dnaW5nRW5hYmxlZDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTG9nZ2VyO1xyXG59KCkpO1xyXG5leHBvcnQgeyBMb2dnZXIgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9TG9nZ2VyLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gXCIuL0xvZ2dlclwiO1xyXG5pbXBvcnQgeyBVcmxVdGlscyB9IGZyb20gXCIuL3V0aWxzL1VybFV0aWxzXCI7XHJcbi8qKlxyXG4gKiBEZWZhdWx0cyBmb3IgdGhlIENvbmZpZ3VyYXRpb24gT3B0aW9uc1xyXG4gKi9cclxudmFyIEZSQU1FX1RJTUVPVVQgPSA2MDAwO1xyXG52YXIgT0ZGU0VUID0gMzAwO1xyXG52YXIgTkFWSUdBVEVfRlJBTUVfV0FJVCA9IDUwMDtcclxudmFyIERFRkFVTFRfQVVUSF9PUFRJT05TID0ge1xyXG4gICAgY2xpZW50SWQ6IFwiXCIsXHJcbiAgICBhdXRob3JpdHk6IG51bGwsXHJcbiAgICB2YWxpZGF0ZUF1dGhvcml0eTogdHJ1ZSxcclxuICAgIHJlZGlyZWN0VXJpOiBmdW5jdGlvbiAoKSB7IHJldHVybiBVcmxVdGlscy5nZXREZWZhdWx0UmVkaXJlY3RVcmkoKTsgfSxcclxuICAgIHBvc3RMb2dvdXRSZWRpcmVjdFVyaTogZnVuY3Rpb24gKCkgeyByZXR1cm4gVXJsVXRpbHMuZ2V0RGVmYXVsdFJlZGlyZWN0VXJpKCk7IH0sXHJcbiAgICBuYXZpZ2F0ZVRvTG9naW5SZXF1ZXN0VXJsOiB0cnVlXHJcbn07XHJcbnZhciBERUZBVUxUX0NBQ0hFX09QVElPTlMgPSB7XHJcbiAgICBjYWNoZUxvY2F0aW9uOiBcInNlc3Npb25TdG9yYWdlXCIsXHJcbiAgICBzdG9yZUF1dGhTdGF0ZUluQ29va2llOiBmYWxzZVxyXG59O1xyXG52YXIgREVGQVVMVF9TWVNURU1fT1BUSU9OUyA9IHtcclxuICAgIGxvZ2dlcjogbmV3IExvZ2dlcihudWxsKSxcclxuICAgIGxvYWRGcmFtZVRpbWVvdXQ6IEZSQU1FX1RJTUVPVVQsXHJcbiAgICB0b2tlblJlbmV3YWxPZmZzZXRTZWNvbmRzOiBPRkZTRVQsXHJcbiAgICBuYXZpZ2F0ZUZyYW1lV2FpdDogTkFWSUdBVEVfRlJBTUVfV0FJVFxyXG59O1xyXG52YXIgREVGQVVMVF9GUkFNRVdPUktfT1BUSU9OUyA9IHtcclxuICAgIGlzQW5ndWxhcjogZmFsc2UsXHJcbiAgICB1bnByb3RlY3RlZFJlc291cmNlczogbmV3IEFycmF5KCksXHJcbiAgICBwcm90ZWN0ZWRSZXNvdXJjZU1hcDogbmV3IE1hcCgpXHJcbn07XHJcbi8qKlxyXG4gKiBNU0FMIGZ1bmN0aW9uIHRoYXQgc2V0cyB0aGUgZGVmYXVsdCBvcHRpb25zIHdoZW4gbm90IGV4cGxpY2l0bHkgY29uZmlndXJlZCBmcm9tIGFwcCBkZXZlbG9wZXJcclxuICpcclxuICogQHBhcmFtIFRBdXRoT3B0aW9uc1xyXG4gKiBAcGFyYW0gVENhY2hlT3B0aW9uc1xyXG4gKiBAcGFyYW0gVFN5c3RlbU9wdGlvbnNcclxuICogQHBhcmFtIFRGcmFtZXdvcmtPcHRpb25zXHJcbiAqXHJcbiAqIEByZXR1cm5zIFRDb25maWd1cmF0aW9uIG9iamVjdFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQ29uZmlndXJhdGlvbihfYSkge1xyXG4gICAgdmFyIGF1dGggPSBfYS5hdXRoLCBfYiA9IF9hLmNhY2hlLCBjYWNoZSA9IF9iID09PSB2b2lkIDAgPyB7fSA6IF9iLCBfYyA9IF9hLnN5c3RlbSwgc3lzdGVtID0gX2MgPT09IHZvaWQgMCA/IHt9IDogX2MsIF9kID0gX2EuZnJhbWV3b3JrLCBmcmFtZXdvcmsgPSBfZCA9PT0gdm9pZCAwID8ge30gOiBfZDtcclxuICAgIHZhciBvdmVybGF5ZWRDb25maWcgPSB7XHJcbiAgICAgICAgYXV0aDogdHNsaWJfMS5fX2Fzc2lnbih7fSwgREVGQVVMVF9BVVRIX09QVElPTlMsIGF1dGgpLFxyXG4gICAgICAgIGNhY2hlOiB0c2xpYl8xLl9fYXNzaWduKHt9LCBERUZBVUxUX0NBQ0hFX09QVElPTlMsIGNhY2hlKSxcclxuICAgICAgICBzeXN0ZW06IHRzbGliXzEuX19hc3NpZ24oe30sIERFRkFVTFRfU1lTVEVNX09QVElPTlMsIHN5c3RlbSksXHJcbiAgICAgICAgZnJhbWV3b3JrOiB0c2xpYl8xLl9fYXNzaWduKHt9LCBERUZBVUxUX0ZSQU1FV09SS19PUFRJT05TLCBmcmFtZXdvcmspXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG92ZXJsYXllZENvbmZpZztcclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1Db25maWd1cmF0aW9uLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IEF1dGhFcnJvciB9IGZyb20gXCIuL0F1dGhFcnJvclwiO1xyXG5leHBvcnQgdmFyIFNlcnZlckVycm9yTWVzc2FnZSA9IHtcclxuICAgIHNlcnZlclVuYXZhaWxhYmxlOiB7XHJcbiAgICAgICAgY29kZTogXCJzZXJ2ZXJfdW5hdmFpbGFibGVcIixcclxuICAgICAgICBkZXNjOiBcIlNlcnZlciBpcyB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZS5cIlxyXG4gICAgfSxcclxuICAgIHVua25vd25TZXJ2ZXJFcnJvcjoge1xyXG4gICAgICAgIGNvZGU6IFwidW5rbm93bl9zZXJ2ZXJfZXJyb3JcIlxyXG4gICAgfSxcclxufTtcclxuLyoqXHJcbiAqIEVycm9yIHRocm93biB3aGVuIHRoZXJlIGlzIGFuIGVycm9yIHdpdGggdGhlIHNlcnZlciBjb2RlLCBmb3IgZXhhbXBsZSwgdW5hdmFpbGFiaWxpdHkuXHJcbiAqL1xyXG52YXIgU2VydmVyRXJyb3IgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICB0c2xpYl8xLl9fZXh0ZW5kcyhTZXJ2ZXJFcnJvciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNlcnZlckVycm9yKGVycm9yQ29kZSwgZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZXJyb3JDb2RlLCBlcnJvck1lc3NhZ2UpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMubmFtZSA9IFwiU2VydmVyRXJyb3JcIjtcclxuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoX3RoaXMsIFNlcnZlckVycm9yLnByb3RvdHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgU2VydmVyRXJyb3IuY3JlYXRlU2VydmVyVW5hdmFpbGFibGVFcnJvciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFNlcnZlckVycm9yKFNlcnZlckVycm9yTWVzc2FnZS5zZXJ2ZXJVbmF2YWlsYWJsZS5jb2RlLCBTZXJ2ZXJFcnJvck1lc3NhZ2Uuc2VydmVyVW5hdmFpbGFibGUuZGVzYyk7XHJcbiAgICB9O1xyXG4gICAgU2VydmVyRXJyb3IuY3JlYXRlVW5rbm93blNlcnZlckVycm9yID0gZnVuY3Rpb24gKGVycm9yRGVzYykge1xyXG4gICAgICAgIHJldHVybiBuZXcgU2VydmVyRXJyb3IoU2VydmVyRXJyb3JNZXNzYWdlLnVua25vd25TZXJ2ZXJFcnJvci5jb2RlLCBlcnJvckRlc2MpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTZXJ2ZXJFcnJvcjtcclxufShBdXRoRXJyb3IpKTtcclxuZXhwb3J0IHsgU2VydmVyRXJyb3IgfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VydmVyRXJyb3IuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuaW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tIFwidHNsaWJcIjtcclxuaW1wb3J0IHsgU2VydmVyRXJyb3IgfSBmcm9tIFwiLi9TZXJ2ZXJFcnJvclwiO1xyXG5leHBvcnQgdmFyIEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3JNZXNzYWdlID0ge1xyXG4gICAgaW50ZXJhY3Rpb25SZXF1aXJlZDoge1xyXG4gICAgICAgIGNvZGU6IFwiaW50ZXJhY3Rpb25fcmVxdWlyZWRcIlxyXG4gICAgfSxcclxuICAgIGNvbnNlbnRSZXF1aXJlZDoge1xyXG4gICAgICAgIGNvZGU6IFwiY29uc2VudF9yZXF1aXJlZFwiXHJcbiAgICB9LFxyXG4gICAgbG9naW5SZXF1aXJlZDoge1xyXG4gICAgICAgIGNvZGU6IFwibG9naW5fcmVxdWlyZWRcIlxyXG4gICAgfSxcclxufTtcclxuLyoqXHJcbiAqIEVycm9yIHRocm93biB3aGVuIHRoZSB1c2VyIGlzIHJlcXVpcmVkIHRvIHBlcmZvcm0gYW4gaW50ZXJhY3RpdmUgdG9rZW4gcmVxdWVzdC5cclxuICovXHJcbnZhciBJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgdHNsaWJfMS5fX2V4dGVuZHMoSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IoZXJyb3JDb2RlLCBlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBlcnJvckNvZGUsIGVycm9yTWVzc2FnZSkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5uYW1lID0gXCJJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yXCI7XHJcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKF90aGlzLCBJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yLnByb3RvdHlwZSk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvci5pc0ludGVyYWN0aW9uUmVxdWlyZWRFcnJvciA9IGZ1bmN0aW9uIChlcnJvclN0cmluZykge1xyXG4gICAgICAgIHZhciBpbnRlcmFjdGlvblJlcXVpcmVkQ29kZXMgPSBbXHJcbiAgICAgICAgICAgIEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3JNZXNzYWdlLmludGVyYWN0aW9uUmVxdWlyZWQuY29kZSxcclxuICAgICAgICAgICAgSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvck1lc3NhZ2UuY29uc2VudFJlcXVpcmVkLmNvZGUsXHJcbiAgICAgICAgICAgIEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3JNZXNzYWdlLmxvZ2luUmVxdWlyZWQuY29kZVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgcmV0dXJuIGVycm9yU3RyaW5nICYmIGludGVyYWN0aW9uUmVxdWlyZWRDb2Rlcy5pbmRleE9mKGVycm9yU3RyaW5nKSA+IC0xO1xyXG4gICAgfTtcclxuICAgIEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IuY3JlYXRlTG9naW5SZXF1aXJlZEF1dGhFcnJvciA9IGZ1bmN0aW9uIChlcnJvckRlc2MpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IoSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvck1lc3NhZ2UubG9naW5SZXF1aXJlZC5jb2RlLCBlcnJvckRlc2MpO1xyXG4gICAgfTtcclxuICAgIEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IuY3JlYXRlSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvciA9IGZ1bmN0aW9uIChlcnJvckRlc2MpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IoSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvck1lc3NhZ2UuaW50ZXJhY3Rpb25SZXF1aXJlZC5jb2RlLCBlcnJvckRlc2MpO1xyXG4gICAgfTtcclxuICAgIEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IuY3JlYXRlQ29uc2VudFJlcXVpcmVkQXV0aEVycm9yID0gZnVuY3Rpb24gKGVycm9yRGVzYykge1xyXG4gICAgICAgIHJldHVybiBuZXcgSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvcihJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yTWVzc2FnZS5jb25zZW50UmVxdWlyZWQuY29kZSwgZXJyb3JEZXNjKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvcjtcclxufShTZXJ2ZXJFcnJvcikpO1xyXG5leHBvcnQgeyBJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yIH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IuanMubWFwIiwiLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkUmVzcG9uc2VTdGF0ZU9ubHkoc3RhdGUpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdW5pcXVlSWQ6IFwiXCIsXHJcbiAgICAgICAgdGVuYW50SWQ6IFwiXCIsXHJcbiAgICAgICAgdG9rZW5UeXBlOiBcIlwiLFxyXG4gICAgICAgIGlkVG9rZW46IG51bGwsXHJcbiAgICAgICAgaWRUb2tlbkNsYWltczogbnVsbCxcclxuICAgICAgICBhY2Nlc3NUb2tlbjogXCJcIixcclxuICAgICAgICBzY29wZXM6IG51bGwsXHJcbiAgICAgICAgZXhwaXJlc09uOiBudWxsLFxyXG4gICAgICAgIGFjY291bnQ6IG51bGwsXHJcbiAgICAgICAgYWNjb3VudFN0YXRlOiBzdGF0ZVxyXG4gICAgfTtcclxufVxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1BdXRoUmVzcG9uc2UuanMubWFwIiwiZXhwb3J0IHZhciBFVkVOVF9OQU1FX1BSRUZJWCA9IFwibXNhbC5cIjtcclxuZXhwb3J0IHZhciBFVkVOVF9OQU1FX0tFWSA9IFwiZXZlbnRfbmFtZVwiO1xyXG5leHBvcnQgdmFyIFNUQVJUX1RJTUVfS0VZID0gXCJzdGFydF90aW1lXCI7XHJcbmV4cG9ydCB2YXIgRUxBUFNFRF9USU1FX0tFWSA9IFwiZWxhcHNlZF90aW1lXCI7XHJcbmV4cG9ydCB2YXIgVEVMRU1FVFJZX0JMT0JfRVZFTlRfTkFNRVMgPSB7XHJcbiAgICBNc2FsQ29ycmVsYXRpb25JZENvbnN0U3RyS2V5OiBcIk1pY3Jvc29mdC5NU0FMLmNvcnJlbGF0aW9uX2lkXCIsXHJcbiAgICBBcGlUZWxlbUlkQ29uc3RTdHJLZXk6IFwibXNhbC5hcGlfdGVsZW1faWRcIixcclxuICAgIEFwaUlkQ29uc3RTdHJLZXk6IFwibXNhbC5hcGlfaWRcIixcclxuICAgIEJyb2tlckFwcENvbnN0U3RyS2V5OiBcIk1pY3Jvc29mdF9NU0FMX2Jyb2tlcl9hcHBcIixcclxuICAgIENhY2hlRXZlbnRDb3VudENvbnN0U3RyS2V5OiBcIk1pY3Jvc29mdF9NU0FMX2NhY2hlX2V2ZW50X2NvdW50XCIsXHJcbiAgICBIdHRwRXZlbnRDb3VudFRlbGVtZXRyeUJhdGNoS2V5OiBcIk1pY3Jvc29mdF9NU0FMX2h0dHBfZXZlbnRfY291bnRcIixcclxuICAgIElkcENvbnN0U3RyS2V5OiBcIk1pY3Jvc29mdF9NU0FMX2lkcFwiLFxyXG4gICAgSXNTaWxlbnRUZWxlbWV0cnlCYXRjaEtleTogXCJcIixcclxuICAgIElzU3VjY2Vzc2Z1bENvbnN0U3RyS2V5OiBcIk1pY3Jvc29mdF9NU0FMX2lzX3N1Y2Nlc3NmdWxcIixcclxuICAgIFJlc3BvbnNlVGltZUNvbnN0U3RyS2V5OiBcIk1pY3Jvc29mdF9NU0FMX3Jlc3BvbnNlX3RpbWVcIixcclxuICAgIFRlbmFudElkQ29uc3RTdHJLZXk6IFwiTWljcm9zb2Z0X01TQUxfdGVuYW50X2lkXCIsXHJcbiAgICBVaUV2ZW50Q291bnRUZWxlbWV0cnlCYXRjaEtleTogXCJNaWNyb3NvZnRfTVNBTF91aV9ldmVudF9jb3VudFwiXHJcbn07XHJcbi8vIFRoaXMgaXMgdXNlZCB0byByZXBsYWNlIHRoZSByZWFsIHRlbmFudCBpbiB0ZWxlbWV0cnkgaW5mb1xyXG5leHBvcnQgdmFyIFRFTkFOVF9QTEFDRUhPTERFUiA9IFwiPHRlbmFudD5cIjtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VGVsZW1ldHJ5Q29uc3RhbnRzLmpzLm1hcCIsImltcG9ydCB7IEIyY0F1dGhvcml0eSB9IGZyb20gXCIuLi9CMmNBdXRob3JpdHlcIjtcclxuaW1wb3J0IHsgQUFEVHJ1c3RlZEhvc3RMaXN0IH0gZnJvbSBcIi4uL3V0aWxzL0NvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBURU5BTlRfUExBQ0VIT0xERVIsIEVWRU5UX05BTUVfUFJFRklYIH0gZnJvbSBcIi4vVGVsZW1ldHJ5Q29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IENyeXB0b1V0aWxzIH0gZnJvbSBcIi4uL3V0aWxzL0NyeXB0b1V0aWxzXCI7XHJcbmltcG9ydCB7IFVybFV0aWxzIH0gZnJvbSBcIi4uL3V0aWxzL1VybFV0aWxzXCI7XHJcbmV4cG9ydCB2YXIgc2NydWJUZW5hbnRGcm9tVXJpID0gZnVuY3Rpb24gKHVyaSkge1xyXG4gICAgdmFyIHVybCA9IFVybFV0aWxzLkdldFVybENvbXBvbmVudHModXJpKTtcclxuICAgIC8vIHZhbGlkYXRlIHRydXN0ZWQgaG9zdFxyXG4gICAgaWYgKCFBQURUcnVzdGVkSG9zdExpc3RbdXJsLkhvc3ROYW1lQW5kUG9ydC50b0xvY2FsZUxvd2VyQ2FzZSgpXSkge1xyXG4gICAgICAgIC8vIFNob3VsZCB0aGlzIHJldHVybiBudWxsIG9yIHdoYXQgd2FzIHBhc3NlZD9cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHZhciBwYXRoUGFyYW1zID0gdXJsLlBhdGhTZWdtZW50cztcclxuICAgIGlmIChwYXRoUGFyYW1zICYmIHBhdGhQYXJhbXMubGVuZ3RoID49IDIpIHtcclxuICAgICAgICB2YXIgdGVuYW50UG9zaXRpb24gPSBwYXRoUGFyYW1zWzFdID09PSBCMmNBdXRob3JpdHkuQjJDX1BSRUZJWCA/IDIgOiAxO1xyXG4gICAgICAgIGlmICh0ZW5hbnRQb3NpdGlvbiA8IHBhdGhQYXJhbXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHBhdGhQYXJhbXNbdGVuYW50UG9zaXRpb25dID0gVEVOQU5UX1BMQUNFSE9MREVSO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiB1cmwuUHJvdG9jb2wgKyBcIi8vXCIgKyB1cmwuSG9zdE5hbWVBbmRQb3J0ICsgXCIvXCIgKyBwYXRoUGFyYW1zLmpvaW4oXCIvXCIpO1xyXG59O1xyXG5leHBvcnQgdmFyIGhhc2hQZXJzb25hbElkZW50aWZpZXIgPSBmdW5jdGlvbiAodmFsdWVUb0hhc2gpIHtcclxuICAgIC8vIFRPRE8gc2hhMjU2IHRoaXNcclxuICAgIC8vIEN1cnJlbnQgdGVzdCBydW5uZXIgaXMgYmVpbmcgZnVubnkgd2l0aCBub2RlIGxpYnMgdGhhdCBhcmUgd2VicGFja2VkIGFueXdheVxyXG4gICAgLy8gbmVlZCBhIGRpZmZlcmVudCBzb2x1dGlvblxyXG4gICAgcmV0dXJuIENyeXB0b1V0aWxzLmJhc2U2NEVuY29kZSh2YWx1ZVRvSGFzaCk7XHJcbn07XHJcbmV4cG9ydCB2YXIgcHJlcGVuZEV2ZW50TmFtZVByZWZpeCA9IGZ1bmN0aW9uIChzdWZmaXgpIHsgcmV0dXJuIFwiXCIgKyBFVkVOVF9OQU1FX1BSRUZJWCArIChzdWZmaXggfHwgXCJcIik7IH07XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVRlbGVtZXRyeVV0aWxzLmpzLm1hcCIsImltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IFRFTEVNRVRSWV9CTE9CX0VWRU5UX05BTUVTIH0gZnJvbSBcIi4vVGVsZW1ldHJ5Q29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IEVWRU5UX05BTUVfS0VZLCBTVEFSVF9USU1FX0tFWSwgRUxBUFNFRF9USU1FX0tFWSB9IGZyb20gXCIuL1RlbGVtZXRyeUNvbnN0YW50c1wiO1xyXG5pbXBvcnQgeyBwcmVwZW5kRXZlbnROYW1lUHJlZml4IH0gZnJvbSBcIi4vVGVsZW1ldHJ5VXRpbHNcIjtcclxuaW1wb3J0IHsgQ3J5cHRvVXRpbHMgfSBmcm9tIFwiLi4vdXRpbHMvQ3J5cHRvVXRpbHNcIjtcclxudmFyIFRlbGVtZXRyeUV2ZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVGVsZW1ldHJ5RXZlbnQoZXZlbnROYW1lLCBjb3JyZWxhdGlvbklkKSB7XHJcbiAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgIHRoaXMuc3RhcnRUaW1lc3RhbXAgPSBEYXRlLm5vdygpO1xyXG4gICAgICAgIHRoaXMuZXZlbnRJZCA9IENyeXB0b1V0aWxzLmNyZWF0ZU5ld0d1aWQoKTtcclxuICAgICAgICB0aGlzLmV2ZW50ID0gKF9hID0ge30sXHJcbiAgICAgICAgICAgIF9hW3ByZXBlbmRFdmVudE5hbWVQcmVmaXgoRVZFTlRfTkFNRV9LRVkpXSA9IGV2ZW50TmFtZSxcclxuICAgICAgICAgICAgX2FbcHJlcGVuZEV2ZW50TmFtZVByZWZpeChTVEFSVF9USU1FX0tFWSldID0gdGhpcy5zdGFydFRpbWVzdGFtcCxcclxuICAgICAgICAgICAgX2FbcHJlcGVuZEV2ZW50TmFtZVByZWZpeChFTEFQU0VEX1RJTUVfS0VZKV0gPSAtMSxcclxuICAgICAgICAgICAgX2FbXCJcIiArIFRFTEVNRVRSWV9CTE9CX0VWRU5UX05BTUVTLk1zYWxDb3JyZWxhdGlvbklkQ29uc3RTdHJLZXldID0gY29ycmVsYXRpb25JZCxcclxuICAgICAgICAgICAgX2EpO1xyXG4gICAgfVxyXG4gICAgVGVsZW1ldHJ5RXZlbnQucHJvdG90eXBlLnNldEVsYXBzZWRUaW1lID0gZnVuY3Rpb24gKHRpbWUpIHtcclxuICAgICAgICB0aGlzLmV2ZW50W3ByZXBlbmRFdmVudE5hbWVQcmVmaXgoRUxBUFNFRF9USU1FX0tFWSldID0gdGltZTtcclxuICAgIH07XHJcbiAgICBUZWxlbWV0cnlFdmVudC5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyBTZXQgZHVyYXRpb24gb2YgZXZlbnRcclxuICAgICAgICB0aGlzLnNldEVsYXBzZWRUaW1lKCtEYXRlLm5vdygpIC0gK3RoaXMuc3RhcnRUaW1lc3RhbXApO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZWxlbWV0cnlFdmVudC5wcm90b3R5cGUsIFwidGVsZW1ldHJ5Q29ycmVsYXRpb25JZFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV2ZW50W1wiXCIgKyBURUxFTUVUUllfQkxPQl9FVkVOVF9OQU1FUy5Nc2FsQ29ycmVsYXRpb25JZENvbnN0U3RyS2V5XTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRbXCJcIiArIFRFTEVNRVRSWV9CTE9CX0VWRU5UX05BTUVTLk1zYWxDb3JyZWxhdGlvbklkQ29uc3RTdHJLZXldID0gdmFsdWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVsZW1ldHJ5RXZlbnQucHJvdG90eXBlLCBcImV2ZW50TmFtZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV2ZW50W3ByZXBlbmRFdmVudE5hbWVQcmVmaXgoRVZFTlRfTkFNRV9LRVkpXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIFRlbGVtZXRyeUV2ZW50LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRzbGliXzEuX19hc3NpZ24oe30sIHRoaXMuZXZlbnQsIHsgZXZlbnRJZDogdGhpcy5ldmVudElkIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBUZWxlbWV0cnlFdmVudDtcclxufSgpKTtcclxuZXhwb3J0IGRlZmF1bHQgVGVsZW1ldHJ5RXZlbnQ7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVRlbGVtZXRyeUV2ZW50LmpzLm1hcCIsImltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IFRFTEVNRVRSWV9CTE9CX0VWRU5UX05BTUVTIH0gZnJvbSBcIi4vVGVsZW1ldHJ5Q29uc3RhbnRzXCI7XHJcbmltcG9ydCBUZWxlbWV0cnlFdmVudCBmcm9tIFwiLi9UZWxlbWV0cnlFdmVudFwiO1xyXG5pbXBvcnQgeyBwcmVwZW5kRXZlbnROYW1lUHJlZml4IH0gZnJvbSBcIi4vVGVsZW1ldHJ5VXRpbHNcIjtcclxudmFyIERlZmF1bHRFdmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIHRzbGliXzEuX19leHRlbmRzKERlZmF1bHRFdmVudCwgX3N1cGVyKTtcclxuICAgIC8vIFRPRE8gUGxhdGZvcm0gVHlwZVxyXG4gICAgZnVuY3Rpb24gRGVmYXVsdEV2ZW50KHBsYXRmb3JtLCBjb3JyZWxhdGlvbklkLCBjbGllbnRJZCwgZXZlbnRDb3VudCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHByZXBlbmRFdmVudE5hbWVQcmVmaXgoXCJkZWZhdWx0X2V2ZW50XCIpLCBjb3JyZWxhdGlvbklkKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmV2ZW50W3ByZXBlbmRFdmVudE5hbWVQcmVmaXgoXCJjbGllbnRfaWRcIildID0gY2xpZW50SWQ7XHJcbiAgICAgICAgX3RoaXMuZXZlbnRbcHJlcGVuZEV2ZW50TmFtZVByZWZpeChcInNka19wbGFmb3JtXCIpXSA9IHBsYXRmb3JtLnNkaztcclxuICAgICAgICBfdGhpcy5ldmVudFtwcmVwZW5kRXZlbnROYW1lUHJlZml4KFwic2RrX3ZlcnNpb25cIildID0gcGxhdGZvcm0uc2RrVmVyc2lvbjtcclxuICAgICAgICBfdGhpcy5ldmVudFtwcmVwZW5kRXZlbnROYW1lUHJlZml4KFwiYXBwbGljYXRpb25fbmFtZVwiKV0gPSBwbGF0Zm9ybS5hcHBsaWNhdGlvbk5hbWU7XHJcbiAgICAgICAgX3RoaXMuZXZlbnRbcHJlcGVuZEV2ZW50TmFtZVByZWZpeChcImFwcGxpY2F0aW9uX3ZlcnNpb25cIildID0gcGxhdGZvcm0uYXBwbGljYXRpb25WZXJzaW9uO1xyXG4gICAgICAgIF90aGlzLmV2ZW50W1wiXCIgKyBURUxFTUVUUllfQkxPQl9FVkVOVF9OQU1FUy5VaUV2ZW50Q291bnRUZWxlbWV0cnlCYXRjaEtleV0gPSBfdGhpcy5nZXRFdmVudENvdW50KHByZXBlbmRFdmVudE5hbWVQcmVmaXgoXCJ1aV9ldmVudFwiKSwgZXZlbnRDb3VudCk7XHJcbiAgICAgICAgX3RoaXMuZXZlbnRbXCJcIiArIFRFTEVNRVRSWV9CTE9CX0VWRU5UX05BTUVTLkh0dHBFdmVudENvdW50VGVsZW1ldHJ5QmF0Y2hLZXldID0gX3RoaXMuZ2V0RXZlbnRDb3VudChwcmVwZW5kRXZlbnROYW1lUHJlZml4KFwiaHR0cF9ldmVudFwiKSwgZXZlbnRDb3VudCk7XHJcbiAgICAgICAgX3RoaXMuZXZlbnRbXCJcIiArIFRFTEVNRVRSWV9CTE9CX0VWRU5UX05BTUVTLkNhY2hlRXZlbnRDb3VudENvbnN0U3RyS2V5XSA9IF90aGlzLmdldEV2ZW50Q291bnQocHJlcGVuZEV2ZW50TmFtZVByZWZpeChcImNhY2hlX2V2ZW50XCIpLCBldmVudENvdW50KTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICAgICAgLy8vIERldmljZSBpZD9cclxuICAgIH1cclxuICAgIERlZmF1bHRFdmVudC5wcm90b3R5cGUuZ2V0RXZlbnRDb3VudCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGV2ZW50Q291bnQpIHtcclxuICAgICAgICBpZiAoIWV2ZW50Q291bnRbZXZlbnROYW1lXSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGV2ZW50Q291bnRbZXZlbnROYW1lXTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRGVmYXVsdEV2ZW50O1xyXG59KFRlbGVtZXRyeUV2ZW50KSk7XHJcbmV4cG9ydCBkZWZhdWx0IERlZmF1bHRFdmVudDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RGVmYXVsdEV2ZW50LmpzLm1hcCIsImltcG9ydCBEZWZhdWx0RXZlbnQgZnJvbSBcIi4vRGVmYXVsdEV2ZW50XCI7XHJcbi8vIGZvciB1c2UgaW4gY2FjaGUgZXZlbnRzXHJcbnZhciBNU0FMX0NBQ0hFX0VWRU5UX1ZBTFVFX1BSRUZJWCA9IFwibXNhbC50b2tlblwiO1xyXG52YXIgTVNBTF9DQUNIRV9FVkVOVF9OQU1FID0gXCJtc2FsLmNhY2hlX2V2ZW50XCI7XHJcbnZhciBjcmVhdGVFdmVudEtleSA9IGZ1bmN0aW9uIChldmVudCkgeyByZXR1cm4gKGV2ZW50LnRlbGVtZXRyeUNvcnJlbGF0aW9uSWQgKyBcIi1cIiArIGV2ZW50LmV2ZW50SWQgKyBcIi1cIiArIGV2ZW50LmV2ZW50TmFtZSk7IH07XHJcbnZhciBUZWxlbWV0cnlNYW5hZ2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVGVsZW1ldHJ5TWFuYWdlcihjb25maWcsIHRlbGVtZXRyeUVtaXR0ZXIpIHtcclxuICAgICAgICAvLyBjb3JyZWxhdGlvbiBJZCB0byBsaXN0IG9mIGV2ZW50c1xyXG4gICAgICAgIHRoaXMuY29tcGxldGVkRXZlbnRzID0ge307XHJcbiAgICAgICAgLy8gZXZlbnQga2V5IHRvIGV2ZW50XHJcbiAgICAgICAgdGhpcy5pblByb2dyZXNzRXZlbnRzID0ge307XHJcbiAgICAgICAgLy8gY29ycmVsYXRpb24gaWQgdG8gbWFwIG9mIGV2ZW50bmFtZSB0byBjb3VudFxyXG4gICAgICAgIHRoaXMuZXZlbnRDb3VudEJ5Q29ycmVsYXRpb25JZCA9IHt9O1xyXG4gICAgICAgIC8vSW1wbGVtZW50IGFmdGVyIEFQSSBFVkVOVFxyXG4gICAgICAgIHRoaXMub25seVNlbmRGYWlsdXJlVGVsZW1ldHJ5ID0gZmFsc2U7XHJcbiAgICAgICAgLy8gVE9ETyBUSFJPVyBpZiBiYWQgb3B0aW9uc1xyXG4gICAgICAgIHRoaXMudGVsZW1ldHJ5UGxhdGZvcm0gPSBjb25maWcucGxhdGZvcm07XHJcbiAgICAgICAgdGhpcy5jbGllbnRJZCA9IGNvbmZpZy5jbGllbnRJZDtcclxuICAgICAgICB0aGlzLm9ubHlTZW5kRmFpbHVyZVRlbGVtZXRyeSA9IGNvbmZpZy5vbmx5U2VuZEZhaWx1cmVUZWxlbWV0cnk7XHJcbiAgICAgICAgLy8gVE9ETywgd2hlbiBpIGdldCB0byB3aXJpbmcgdGhpcyB0aHJvdWdoLCB0aGluayBhYm91dCB3aGF0IGl0IG1lYW5zIGlmXHJcbiAgICAgICAgLy8gYSBkZXZlbG9wZXIgZG9lcyBub3QgaW1wbGVtZW50IHRlbGVtIGF0IGFsbCwgd2Ugc3RpbGwgaW5zdHJ1bWVudCwgYnV0IHRlbGVtZXRyeUVtaXR0ZXIgY2FuIGJlXHJcbiAgICAgICAgLy8gb3B0aW9uYWw/XHJcbiAgICAgICAgdGhpcy50ZWxlbWV0cnlFbWl0dGVyID0gdGVsZW1ldHJ5RW1pdHRlcjtcclxuICAgIH1cclxuICAgIFRlbGVtZXRyeU1hbmFnZXIucHJvdG90eXBlLnN0YXJ0RXZlbnQgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICBpZiAoIXRoaXMudGVsZW1ldHJ5RW1pdHRlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBldmVudEtleSA9IGNyZWF0ZUV2ZW50S2V5KGV2ZW50KTtcclxuICAgICAgICB0aGlzLmluUHJvZ3Jlc3NFdmVudHNbZXZlbnRLZXldID0gZXZlbnQ7XHJcbiAgICB9O1xyXG4gICAgVGVsZW1ldHJ5TWFuYWdlci5wcm90b3R5cGUuc3RvcEV2ZW50ID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIGV2ZW50S2V5ID0gY3JlYXRlRXZlbnRLZXkoZXZlbnQpO1xyXG4gICAgICAgIGlmICghdGhpcy50ZWxlbWV0cnlFbWl0dGVyIHx8ICF0aGlzLmluUHJvZ3Jlc3NFdmVudHNbZXZlbnRLZXldKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXZlbnQuc3RvcCgpO1xyXG4gICAgICAgIHRoaXMuaW5jcmVtZW50RXZlbnRDb3VudChldmVudCk7XHJcbiAgICAgICAgdmFyIGNvbXBsZXRlZEV2ZW50cyA9IHRoaXMuY29tcGxldGVkRXZlbnRzW2V2ZW50LnRlbGVtZXRyeUNvcnJlbGF0aW9uSWRdO1xyXG4gICAgICAgIHRoaXMuY29tcGxldGVkRXZlbnRzW2V2ZW50LnRlbGVtZXRyeUNvcnJlbGF0aW9uSWRdID0gKGNvbXBsZXRlZEV2ZW50cyB8fCBbXSkuY29uY2F0KFtldmVudF0pO1xyXG4gICAgICAgIGRlbGV0ZSB0aGlzLmluUHJvZ3Jlc3NFdmVudHNbZXZlbnRLZXldO1xyXG4gICAgfTtcclxuICAgIFRlbGVtZXRyeU1hbmFnZXIucHJvdG90eXBlLmZsdXNoID0gZnVuY3Rpb24gKGNvcnJlbGF0aW9uSWQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIC8vIElmIHRoZXJlIGlzIG9ubHkgdW5maW5pc2hlZCBldmVudHMgc2hvdWxkIHRoaXMgc3RpbGwgcmV0dXJuIHRoZW0/XHJcbiAgICAgICAgaWYgKCF0aGlzLnRlbGVtZXRyeUVtaXR0ZXIgfHwgIXRoaXMuY29tcGxldGVkRXZlbnRzW2NvcnJlbGF0aW9uSWRdKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG9ycGhhbmVkRXZlbnRzID0gdGhpcy5nZXRPcnBoYW5lZEV2ZW50cyhjb3JyZWxhdGlvbklkKTtcclxuICAgICAgICBvcnBoYW5lZEV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChldmVudCkgeyByZXR1cm4gX3RoaXMuaW5jcmVtZW50RXZlbnRDb3VudChldmVudCk7IH0pO1xyXG4gICAgICAgIHZhciBldmVudHNUb0ZsdXNoID0gdGhpcy5jb21wbGV0ZWRFdmVudHNbY29ycmVsYXRpb25JZF0uY29uY2F0KG9ycGhhbmVkRXZlbnRzKTtcclxuICAgICAgICBkZWxldGUgdGhpcy5jb21wbGV0ZWRFdmVudHNbY29ycmVsYXRpb25JZF07XHJcbiAgICAgICAgdmFyIGV2ZW50Q291bnRzVG9GbHVzaCA9IHRoaXMuZXZlbnRDb3VudEJ5Q29ycmVsYXRpb25JZFtjb3JyZWxhdGlvbklkXTtcclxuICAgICAgICBkZWxldGUgdGhpcy5ldmVudENvdW50QnlDb3JyZWxhdGlvbklkW2NvcnJlbGF0aW9uSWRdO1xyXG4gICAgICAgIC8vIFRPRE8gYWRkIGZ1bmNpdG9uYWxpdHkgZm9yIG9ubHlGbHVzaEZhaWx1cmVzIGFmdGVyIGltcGxlbWVudGluZyBhcGkgZXZlbnQ/ID8/XHJcbiAgICAgICAgaWYgKCFldmVudHNUb0ZsdXNoIHx8ICFldmVudHNUb0ZsdXNoLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBkZWZhdWx0RXZlbnQgPSBuZXcgRGVmYXVsdEV2ZW50KHRoaXMudGVsZW1ldHJ5UGxhdGZvcm0sIGNvcnJlbGF0aW9uSWQsIHRoaXMuY2xpZW50SWQsIGV2ZW50Q291bnRzVG9GbHVzaCk7XHJcbiAgICAgICAgdmFyIGV2ZW50c1dpdGhEZWZhdWx0RXZlbnQgPSBldmVudHNUb0ZsdXNoLmNvbmNhdChbZGVmYXVsdEV2ZW50XSk7XHJcbiAgICAgICAgdGhpcy50ZWxlbWV0cnlFbWl0dGVyKGV2ZW50c1dpdGhEZWZhdWx0RXZlbnQubWFwKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLmdldCgpOyB9KSk7XHJcbiAgICB9O1xyXG4gICAgVGVsZW1ldHJ5TWFuYWdlci5wcm90b3R5cGUuaW5jcmVtZW50RXZlbnRDb3VudCA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBfYTtcclxuICAgICAgICAvLyBUT0RPLCBuYW1lIGNhY2hlIGV2ZW50IGRpZmZlcmVudD9cclxuICAgICAgICAvLyBpZiB0eXBlIGlzIGNhY2hlIGV2ZW50LCBjaGFuZ2UgbmFtZVxyXG4gICAgICAgIHZhciBldmVudE5hbWUgPSBldmVudC5ldmVudE5hbWU7XHJcbiAgICAgICAgdmFyIGV2ZW50Q291bnQgPSB0aGlzLmV2ZW50Q291bnRCeUNvcnJlbGF0aW9uSWRbZXZlbnQudGVsZW1ldHJ5Q29ycmVsYXRpb25JZF07XHJcbiAgICAgICAgaWYgKCFldmVudENvdW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRDb3VudEJ5Q29ycmVsYXRpb25JZFtldmVudC50ZWxlbWV0cnlDb3JyZWxhdGlvbklkXSA9IChfYSA9IHt9LFxyXG4gICAgICAgICAgICAgICAgX2FbZXZlbnROYW1lXSA9IDEsXHJcbiAgICAgICAgICAgICAgICBfYSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBldmVudENvdW50W2V2ZW50TmFtZV0gPSBldmVudENvdW50W2V2ZW50TmFtZV0gPyBldmVudENvdW50W2V2ZW50TmFtZV0gKyAxIDogMTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVGVsZW1ldHJ5TWFuYWdlci5wcm90b3R5cGUuZ2V0T3JwaGFuZWRFdmVudHMgPSBmdW5jdGlvbiAoY29ycmVsYXRpb25JZCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuaW5Qcm9ncmVzc0V2ZW50cylcclxuICAgICAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZXZlbnRLZXkpIHtcclxuICAgICAgICAgICAgaWYgKGV2ZW50S2V5LmluZGV4T2YoY29ycmVsYXRpb25JZCkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnRfMSA9IF90aGlzLmluUHJvZ3Jlc3NFdmVudHNbZXZlbnRLZXldO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIF90aGlzLmluUHJvZ3Jlc3NFdmVudHNbZXZlbnRLZXldO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lbW8uY29uY2F0KFtldmVudF8xXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1lbW87XHJcbiAgICAgICAgfSwgW10pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBUZWxlbWV0cnlNYW5hZ2VyO1xyXG59KCkpO1xyXG5leHBvcnQgZGVmYXVsdCBUZWxlbWV0cnlNYW5hZ2VyO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1UZWxlbWV0cnlNYW5hZ2VyLmpzLm1hcCIsIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbmltcG9ydCAqIGFzIHRzbGliXzEgZnJvbSBcInRzbGliXCI7XHJcbmltcG9ydCB7IEFjY2Vzc1Rva2VuS2V5IH0gZnJvbSBcIi4vQWNjZXNzVG9rZW5LZXlcIjtcclxuaW1wb3J0IHsgQWNjZXNzVG9rZW5WYWx1ZSB9IGZyb20gXCIuL0FjY2Vzc1Rva2VuVmFsdWVcIjtcclxuaW1wb3J0IHsgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMgfSBmcm9tIFwiLi9TZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVyc1wiO1xyXG5pbXBvcnQgeyBDbGllbnRJbmZvIH0gZnJvbSBcIi4vQ2xpZW50SW5mb1wiO1xyXG5pbXBvcnQgeyBDb25zdGFudHMsIGxpYnJhcnlWZXJzaW9uIH0gZnJvbSBcIi4vdXRpbHMvQ29uc3RhbnRzXCI7XHJcbmltcG9ydCB7IElkVG9rZW4gfSBmcm9tIFwiLi9JZFRva2VuXCI7XHJcbmltcG9ydCB7IFN0b3JhZ2UgfSBmcm9tIFwiLi9TdG9yYWdlXCI7XHJcbmltcG9ydCB7IEFjY291bnQgfSBmcm9tIFwiLi9BY2NvdW50XCI7XHJcbmltcG9ydCB7IFNjb3BlU2V0IH0gZnJvbSBcIi4vU2NvcGVTZXRcIjtcclxuaW1wb3J0IHsgU3RyaW5nVXRpbHMgfSBmcm9tIFwiLi91dGlscy9TdHJpbmdVdGlsc1wiO1xyXG5pbXBvcnQgeyBDcnlwdG9VdGlscyB9IGZyb20gXCIuL3V0aWxzL0NyeXB0b1V0aWxzXCI7XHJcbmltcG9ydCB7IFRva2VuVXRpbHMgfSBmcm9tIFwiLi91dGlscy9Ub2tlblV0aWxzXCI7XHJcbmltcG9ydCB7IFRpbWVVdGlscyB9IGZyb20gXCIuL3V0aWxzL1RpbWVVdGlsc1wiO1xyXG5pbXBvcnQgeyBVcmxVdGlscyB9IGZyb20gXCIuL3V0aWxzL1VybFV0aWxzXCI7XHJcbmltcG9ydCB7IFJlc3BvbnNlVXRpbHMgfSBmcm9tIFwiLi91dGlscy9SZXNwb25zZVV0aWxzXCI7XHJcbmltcG9ydCB7IEF1dGhvcml0eUZhY3RvcnkgfSBmcm9tIFwiLi9BdXRob3JpdHlGYWN0b3J5XCI7XHJcbmltcG9ydCB7IGJ1aWxkQ29uZmlndXJhdGlvbiB9IGZyb20gXCIuL0NvbmZpZ3VyYXRpb25cIjtcclxuaW1wb3J0IHsgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yIH0gZnJvbSBcIi4vZXJyb3IvQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yXCI7XHJcbmltcG9ydCB7IEF1dGhFcnJvciB9IGZyb20gXCIuL2Vycm9yL0F1dGhFcnJvclwiO1xyXG5pbXBvcnQgeyBDbGllbnRBdXRoRXJyb3IsIENsaWVudEF1dGhFcnJvck1lc3NhZ2UgfSBmcm9tIFwiLi9lcnJvci9DbGllbnRBdXRoRXJyb3JcIjtcclxuaW1wb3J0IHsgU2VydmVyRXJyb3IgfSBmcm9tIFwiLi9lcnJvci9TZXJ2ZXJFcnJvclwiO1xyXG5pbXBvcnQgeyBJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yIH0gZnJvbSBcIi4vZXJyb3IvSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvclwiO1xyXG5pbXBvcnQgeyBidWlsZFJlc3BvbnNlU3RhdGVPbmx5IH0gZnJvbSBcIi4vQXV0aFJlc3BvbnNlXCI7XHJcbmltcG9ydCBUZWxlbWV0cnlNYW5hZ2VyIGZyb20gXCIuL3RlbGVtZXRyeS9UZWxlbWV0cnlNYW5hZ2VyXCI7XHJcbi8vIGRlZmF1bHQgYXV0aG9yaXR5XHJcbnZhciBERUZBVUxUX0FVVEhPUklUWSA9IFwiaHR0cHM6Ly9sb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tL2NvbW1vblwiO1xyXG4vKipcclxuICogQGhpZGRlblxyXG4gKiBAaWdub3JlXHJcbiAqIHJlc3BvbnNlX3R5cGUgZnJvbSBPcGVuSURDb25uZWN0XHJcbiAqIFJlZmVyZW5jZXM6IGh0dHBzOi8vb3BlbmlkLm5ldC9zcGVjcy9vYXV0aC12Mi1tdWx0aXBsZS1yZXNwb25zZS10eXBlcy0xXzAuaHRtbCAmIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM2NzQ5I3NlY3Rpb24tNC4yLjFcclxuICogU2luY2Ugd2Ugc3VwcG9ydCBvbmx5IGltcGxpY2l0IGZsb3cgaW4gdGhpcyBsaWJyYXJ5LCB3ZSByZXN0cmljdCB0aGUgcmVzcG9uc2VfdHlwZSBzdXBwb3J0IHRvIG9ubHkgJ3Rva2VuJyBhbmQgJ2lkX3Rva2VuJ1xyXG4gKlxyXG4gKi9cclxudmFyIFJlc3BvbnNlVHlwZXMgPSB7XHJcbiAgICBpZF90b2tlbjogXCJpZF90b2tlblwiLFxyXG4gICAgdG9rZW46IFwidG9rZW5cIixcclxuICAgIGlkX3Rva2VuX3Rva2VuOiBcImlkX3Rva2VuIHRva2VuXCJcclxufTtcclxuLyoqXHJcbiAqIEBoaWRkZW5cclxuICogQGlnbm9yZVxyXG4gKiBBIHdyYXBwZXIgdG8gaGFuZGxlIHRoZSB0b2tlbiByZXNwb25zZS9lcnJvciB3aXRoaW4gdGhlIGlGcmFtZSBhbHdheXNcclxuICpcclxuICogQHBhcmFtIHRhcmdldFxyXG4gKiBAcGFyYW0gcHJvcGVydHlLZXlcclxuICogQHBhcmFtIGRlc2NyaXB0b3JcclxuICovXHJcbnZhciByZXNvbHZlVG9rZW5Pbmx5SWZPdXRPZklmcmFtZSA9IGZ1bmN0aW9uICh0YXJnZXQsIHByb3BlcnR5S2V5LCBkZXNjcmlwdG9yKSB7XHJcbiAgICB2YXIgdG9rZW5BY3F1aXNpdGlvbk1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XHJcbiAgICBkZXNjcmlwdG9yLnZhbHVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBhcmdzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5pc0luSWZyYW1lKClcclxuICAgICAgICAgICAgPyBuZXcgUHJvbWlzZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIDogdG9rZW5BY3F1aXNpdGlvbk1ldGhvZC5hcHBseSh0aGlzLCBhcmdzKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZGVzY3JpcHRvcjtcclxufTtcclxuLyoqXHJcbiAqIFVzZXJBZ2VudEFwcGxpY2F0aW9uIGNsYXNzXHJcbiAqXHJcbiAqIE9iamVjdCBJbnN0YW5jZSB0aGF0IHRoZSBkZXZlbG9wZXIgY2FuIHVzZSB0byBtYWtlIGxvZ2luWFggT1IgYWNxdWlyZVRva2VuWFggZnVuY3Rpb25zXHJcbiAqL1xyXG52YXIgVXNlckFnZW50QXBwbGljYXRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICAvKipcclxuICAgICAqIEBjb25zdHJ1Y3RvclxyXG4gICAgICogQ29uc3RydWN0b3IgZm9yIHRoZSBVc2VyQWdlbnRBcHBsaWNhdGlvbiB1c2VkIHRvIGluc3RhbnRpYXRlIHRoZSBVc2VyQWdlbnRBcHBsaWNhdGlvbiBvYmplY3RcclxuICAgICAqXHJcbiAgICAgKiBJbXBvcnRhbnQgYXR0cmlidXRlcyBpbiB0aGUgQ29uZmlndXJhdGlvbiBvYmplY3QgZm9yIGF1dGggYXJlOlxyXG4gICAgICogLSBjbGllbnRJRDogdGhlIGFwcGxpY2F0aW9uIElEIG9mIHlvdXIgYXBwbGljYXRpb24uXHJcbiAgICAgKiBZb3UgY2FuIG9idGFpbiBvbmUgYnkgcmVnaXN0ZXJpbmcgeW91ciBhcHBsaWNhdGlvbiB3aXRoIG91ciBBcHBsaWNhdGlvbiByZWdpc3RyYXRpb24gcG9ydGFsIDogaHR0cHM6Ly9wb3J0YWwuYXp1cmUuY29tLyNibGFkZS9NaWNyb3NvZnRfQUFEX0lBTS9BY3RpdmVEaXJlY3RvcnlNZW51QmxhZGUvUmVnaXN0ZXJlZEFwcHNQcmV2aWV3XHJcbiAgICAgKiAtIGF1dGhvcml0eTogdGhlIGF1dGhvcml0eSBVUkwgZm9yIHlvdXIgYXBwbGljYXRpb24uXHJcbiAgICAgKlxyXG4gICAgICogSW4gQXp1cmUgQUQsIGF1dGhvcml0eSBpcyBhIFVSTCBpbmRpY2F0aW5nIHRoZSBBenVyZSBhY3RpdmUgZGlyZWN0b3J5IHRoYXQgTVNBTCB1c2VzIHRvIG9idGFpbiB0b2tlbnMuXHJcbiAgICAgKiBJdCBpcyBvZiB0aGUgZm9ybSBodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vJmx0O0VudGVyX3RoZV9UZW5hbnRfSW5mb19IZXJlJmd0Oy5cclxuICAgICAqIElmIHlvdXIgYXBwbGljYXRpb24gc3VwcG9ydHMgQWNjb3VudHMgaW4gb25lIG9yZ2FuaXphdGlvbmFsIGRpcmVjdG9yeSwgcmVwbGFjZSBcIkVudGVyX3RoZV9UZW5hbnRfSW5mb19IZXJlXCIgdmFsdWUgd2l0aCB0aGUgVGVuYW50IElkIG9yIFRlbmFudCBuYW1lIChmb3IgZXhhbXBsZSwgY29udG9zby5taWNyb3NvZnQuY29tKS5cclxuICAgICAqIElmIHlvdXIgYXBwbGljYXRpb24gc3VwcG9ydHMgQWNjb3VudHMgaW4gYW55IG9yZ2FuaXphdGlvbmFsIGRpcmVjdG9yeSwgcmVwbGFjZSBcIkVudGVyX3RoZV9UZW5hbnRfSW5mb19IZXJlXCIgdmFsdWUgd2l0aCBvcmdhbml6YXRpb25zLlxyXG4gICAgICogSWYgeW91ciBhcHBsaWNhdGlvbiBzdXBwb3J0cyBBY2NvdW50cyBpbiBhbnkgb3JnYW5pemF0aW9uYWwgZGlyZWN0b3J5IGFuZCBwZXJzb25hbCBNaWNyb3NvZnQgYWNjb3VudHMsIHJlcGxhY2UgXCJFbnRlcl90aGVfVGVuYW50X0luZm9fSGVyZVwiIHZhbHVlIHdpdGggY29tbW9uLlxyXG4gICAgICogVG8gcmVzdHJpY3Qgc3VwcG9ydCB0byBQZXJzb25hbCBNaWNyb3NvZnQgYWNjb3VudHMgb25seSwgcmVwbGFjZSBcIkVudGVyX3RoZV9UZW5hbnRfSW5mb19IZXJlXCIgdmFsdWUgd2l0aCBjb25zdW1lcnMuXHJcbiAgICAgKlxyXG4gICAgICpcclxuICAgICAqIEluIEF6dXJlIEIyQywgYXV0aG9yaXR5IGlzIG9mIHRoZSBmb3JtIGh0dHBzOi8vJmx0O2luc3RhbmNlJmd0Oy90ZnAvJmx0O3RlbmFudCZndDsvJmx0O3BvbGljeU5hbWUmZ3Q7L1xyXG4gIFxyXG4gICAgICogQHBhcmFtIHtAbGluayAoQ29uZmlndXJhdGlvbjp0eXBlKX0gY29uZmlndXJhdGlvbiBvYmplY3QgZm9yIHRoZSBNU0FMIFVzZXJBZ2VudEFwcGxpY2F0aW9uIGluc3RhbmNlXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIFVzZXJBZ2VudEFwcGxpY2F0aW9uKGNvbmZpZ3VyYXRpb24pIHtcclxuICAgICAgICAvLyBjYWxsYmFja3MgZm9yIHRva2VuL2Vycm9yXHJcbiAgICAgICAgdGhpcy5hdXRoUmVzcG9uc2VDYWxsYmFjayA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50b2tlblJlY2VpdmVkQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXJyb3JSZWNlaXZlZENhbGxiYWNrID0gbnVsbDtcclxuICAgICAgICAvLyBTZXQgdGhlIENvbmZpZ3VyYXRpb25cclxuICAgICAgICB0aGlzLmNvbmZpZyA9IGJ1aWxkQ29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uKTtcclxuICAgICAgICAvLyBTZXQgdGhlIGNhbGxiYWNrIGJvb2xlYW5cclxuICAgICAgICB0aGlzLnJlZGlyZWN0Q2FsbGJhY2tzU2V0ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIgPSB0aGlzLmNvbmZpZy5zeXN0ZW0ubG9nZ2VyO1xyXG4gICAgICAgIHRoaXMuY2xpZW50SWQgPSB0aGlzLmNvbmZpZy5hdXRoLmNsaWVudElkO1xyXG4gICAgICAgIHRoaXMuaW5Db29raWUgPSB0aGlzLmNvbmZpZy5jYWNoZS5zdG9yZUF1dGhTdGF0ZUluQ29va2llO1xyXG4gICAgICAgIHRoaXMudGVsZW1ldHJ5TWFuYWdlciA9IHRoaXMuZ2V0VGVsZW1ldHJ5TWFuYWdlckZyb21Db25maWcodGhpcy5jb25maWcuc3lzdGVtLnRlbGVtZXRyeSwgdGhpcy5jbGllbnRJZCk7XHJcbiAgICAgICAgLy8gaWYgbm8gYXV0aG9yaXR5IGlzIHBhc3NlZCwgc2V0IHRoZSBkZWZhdWx0OiBcImh0dHBzOi8vbG9naW4ubWljcm9zb2Z0b25saW5lLmNvbS9jb21tb25cIlxyXG4gICAgICAgIHRoaXMuYXV0aG9yaXR5ID0gdGhpcy5jb25maWcuYXV0aC5hdXRob3JpdHkgfHwgREVGQVVMVF9BVVRIT1JJVFk7XHJcbiAgICAgICAgLy8gdHJhY2sgbG9naW4gYW5kIGFjcXVpcmVUb2tlbiBpbiBwcm9ncmVzc1xyXG4gICAgICAgIHRoaXMubG9naW5JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hY3F1aXJlVG9rZW5JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgLy8gY2FjaGUga2V5cyBtc2FsIC0gdHlwZXNjcmlwdCB0aHJvd3MgYW4gZXJyb3IgaWYgYW55IHZhbHVlIG90aGVyIHRoYW4gXCJsb2NhbFN0b3JhZ2VcIiBvciBcInNlc3Npb25TdG9yYWdlXCIgaXMgcGFzc2VkXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2UgPSBuZXcgU3RvcmFnZSh0aGlzLmNvbmZpZy5jYWNoZS5jYWNoZUxvY2F0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhyb3cgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZUludmFsaWRDYWNoZUxvY2F0aW9uQ29uZmlnRXJyb3IodGhpcy5jb25maWcuY2FjaGUuY2FjaGVMb2NhdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEluaXRpYWxpemUgd2luZG93IGhhbmRsaW5nIGNvZGVcclxuICAgICAgICB3aW5kb3cub3BlbmVkV2luZG93cyA9IFtdO1xyXG4gICAgICAgIHdpbmRvdy5hY3RpdmVSZW5ld2FscyA9IHt9O1xyXG4gICAgICAgIHdpbmRvdy5yZW5ld1N0YXRlcyA9IFtdO1xyXG4gICAgICAgIHdpbmRvdy5jYWxsYmFja01hcHBlZFRvUmVuZXdTdGF0ZXMgPSB7fTtcclxuICAgICAgICB3aW5kb3cucHJvbWlzZU1hcHBlZFRvUmVuZXdTdGF0ZXMgPSB7fTtcclxuICAgICAgICB3aW5kb3cubXNhbCA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHVybEhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaDtcclxuICAgICAgICB2YXIgdXJsQ29udGFpbnNIYXNoID0gdGhpcy51cmxDb250YWluc0hhc2godXJsSGFzaCk7XHJcbiAgICAgICAgLy8gT24gdGhlIHNlcnZlciAzMDIgLSBSZWRpcmVjdCwgaGFuZGxlIHRoaXNcclxuICAgICAgICBpZiAoIXRoaXMuY29uZmlnLmZyYW1ld29yay5pc0FuZ3VsYXIpIHtcclxuICAgICAgICAgICAgaWYgKHVybENvbnRhaW5zSGFzaCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVBdXRoZW50aWNhdGlvblJlc3BvbnNlKHVybEhhc2gpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZSwgXCJhdXRob3JpdHlcIiwge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIE1ldGhvZCB0byBtYW5hZ2UgdGhlIGF1dGhvcml0eSBVUkwuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBhdXRob3JpdHlcclxuICAgICAgICAgKi9cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXV0aG9yaXR5SW5zdGFuY2UuQ2Fub25pY2FsQXV0aG9yaXR5O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogc2V0dGVyIGZvciB0aGUgYXV0aG9yaXR5IFVSTFxyXG4gICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBhdXRob3JpdHlcclxuICAgICAgICAgKi9cclxuICAgICAgICAvLyBJZiB0aGUgZGV2ZWxvcGVyIHBhc3NlcyBhbiBhdXRob3JpdHksIGNyZWF0ZSBhbiBpbnN0YW5jZVxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkge1xyXG4gICAgICAgICAgICB0aGlzLmF1dGhvcml0eUluc3RhbmNlID0gQXV0aG9yaXR5RmFjdG9yeS5DcmVhdGVJbnN0YW5jZSh2YWwsIHRoaXMuY29uZmlnLmF1dGgudmFsaWRhdGVBdXRob3JpdHkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgYXV0aG9yaXR5IGluc3RhbmNlIGZyb20gdGhlIE1TQUwgY29uZmlndXJhdGlvbiBvYmplY3RcclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJucyB7QGxpbmsgQXV0aG9yaXR5fSBhdXRob3JpdHkgaW5zdGFuY2VcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmdldEF1dGhvcml0eUluc3RhbmNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmF1dGhvcml0eUluc3RhbmNlO1xyXG4gICAgfTtcclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5oYW5kbGVSZWRpcmVjdENhbGxiYWNrID0gZnVuY3Rpb24gKGF1dGhPclRva2VuQ2FsbGJhY2ssIGVycm9yUmVjZWl2ZWRDYWxsYmFjaykge1xyXG4gICAgICAgIGlmICghYXV0aE9yVG9rZW5DYWxsYmFjaykge1xyXG4gICAgICAgICAgICB0aGlzLnJlZGlyZWN0Q2FsbGJhY2tzU2V0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRocm93IENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVJbnZhbGlkQ2FsbGJhY2tPYmplY3RFcnJvcihhdXRoT3JUb2tlbkNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU2V0IGNhbGxiYWNrc1xyXG4gICAgICAgIGlmIChlcnJvclJlY2VpdmVkQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdGhpcy50b2tlblJlY2VpdmVkQ2FsbGJhY2sgPSBhdXRoT3JUb2tlbkNhbGxiYWNrO1xyXG4gICAgICAgICAgICB0aGlzLmVycm9yUmVjZWl2ZWRDYWxsYmFjayA9IGVycm9yUmVjZWl2ZWRDYWxsYmFjaztcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybmluZyhcIlRoaXMgb3ZlcmxvYWQgZm9yIGNhbGxiYWNrIGlzIGRlcHJlY2F0ZWQgLSBwbGVhc2UgY2hhbmdlIHRoZSBmb3JtYXQgb2YgdGhlIGNhbGxiYWNrcyB0byBhIHNpbmdsZSBjYWxsYmFjayBhcyBzaG93bjogKGVycjogQXV0aEVycm9yLCByZXNwb25zZTogQXV0aFJlc3BvbnNlKS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmF1dGhSZXNwb25zZUNhbGxiYWNrID0gYXV0aE9yVG9rZW5DYWxsYmFjaztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZWRpcmVjdENhbGxiYWNrc1NldCA9IHRydWU7XHJcbiAgICAgICAgLy8gT24gdGhlIHNlcnZlciAzMDIgLSBSZWRpcmVjdCwgaGFuZGxlIHRoaXNcclxuICAgICAgICBpZiAoIXRoaXMuY29uZmlnLmZyYW1ld29yay5pc0FuZ3VsYXIpIHtcclxuICAgICAgICAgICAgdmFyIGNhY2hlZEhhc2ggPSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy51cmxIYXNoKTtcclxuICAgICAgICAgICAgaWYgKGNhY2hlZEhhc2gpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvY2Vzc0NhbGxCYWNrKGNhY2hlZEhhc2gsIG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5hdXRoUmVzcG9uc2VIYW5kbGVyID0gZnVuY3Rpb24gKGludGVyYWN0aW9uVHlwZSwgcmVzcG9uc2UsIHJlc29sdmUpIHtcclxuICAgICAgICBpZiAoaW50ZXJhY3Rpb25UeXBlID09PSBDb25zdGFudHMuaW50ZXJhY3Rpb25UeXBlUmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZXJyb3JSZWNlaXZlZENhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRva2VuUmVjZWl2ZWRDYWxsYmFjayhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5hdXRoUmVzcG9uc2VDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdXRoUmVzcG9uc2VDYWxsYmFjayhudWxsLCByZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoaW50ZXJhY3Rpb25UeXBlID09PSBDb25zdGFudHMuaW50ZXJhY3Rpb25UeXBlUG9wdXApIHtcclxuICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRBdXRoRXJyb3IuY3JlYXRlSW52YWxpZEludGVyYWN0aW9uVHlwZUVycm9yKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5hdXRoRXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gKGludGVyYWN0aW9uVHlwZSwgYXV0aEVyciwgcmVzcG9uc2UsIHJlamVjdCkge1xyXG4gICAgICAgIGlmIChpbnRlcmFjdGlvblR5cGUgPT09IENvbnN0YW50cy5pbnRlcmFjdGlvblR5cGVSZWRpcmVjdCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5lcnJvclJlY2VpdmVkQ2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JSZWNlaXZlZENhbGxiYWNrKGF1dGhFcnIsIHJlc3BvbnNlLmFjY291bnRTdGF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF1dGhSZXNwb25zZUNhbGxiYWNrKGF1dGhFcnIsIHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChpbnRlcmFjdGlvblR5cGUgPT09IENvbnN0YW50cy5pbnRlcmFjdGlvblR5cGVQb3B1cCkge1xyXG4gICAgICAgICAgICByZWplY3QoYXV0aEVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRBdXRoRXJyb3IuY3JlYXRlSW52YWxpZEludGVyYWN0aW9uVHlwZUVycm9yKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2Ugd2hlbiBpbml0aWF0aW5nIHRoZSBsb2dpbiBwcm9jZXNzIGJ5IHJlZGlyZWN0aW5nIHRoZSB1c2VyJ3MgYnJvd3NlciB0byB0aGUgYXV0aG9yaXphdGlvbiBlbmRwb2ludC5cclxuICAgICAqIEBwYXJhbSB7QGxpbmsgKEF1dGhlbnRpY2F0aW9uUGFyYW1ldGVyczp0eXBlKX1cclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmxvZ2luUmVkaXJlY3QgPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIC8vIFRocm93IGVycm9yIGlmIGNhbGxiYWNrcyBhcmUgbm90IHNldCBiZWZvcmUgcmVkaXJlY3RcclxuICAgICAgICBpZiAoIXRoaXMucmVkaXJlY3RDYWxsYmFja3NTZXQpIHtcclxuICAgICAgICAgICAgdGhyb3cgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZVJlZGlyZWN0Q2FsbGJhY2tzTm90U2V0RXJyb3IoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hY3F1aXJlVG9rZW5JbnRlcmFjdGl2ZShDb25zdGFudHMuaW50ZXJhY3Rpb25UeXBlUmVkaXJlY3QsIHRydWUsIHJlcXVlc3QpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXNlIHdoZW4geW91IHdhbnQgdG8gb2J0YWluIGFuIGFjY2Vzc190b2tlbiBmb3IgeW91ciBBUEkgYnkgcmVkaXJlY3RpbmcgdGhlIHVzZXIncyBicm93c2VyIHdpbmRvdyB0byB0aGUgYXV0aG9yaXphdGlvbiBlbmRwb2ludC5cclxuICAgICAqIEBwYXJhbSB7QGxpbmsgKEF1dGhlbnRpY2F0aW9uUGFyYW1ldGVyczp0eXBlKX1cclxuICAgICAqXHJcbiAgICAgKiBUbyByZW5ldyBpZFRva2VuLCBwbGVhc2UgcGFzcyBjbGllbnRJZCBhcyB0aGUgb25seSBzY29wZSBpbiB0aGUgQXV0aGVudGljYXRpb24gUGFyYW1ldGVyc1xyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuYWNxdWlyZVRva2VuUmVkaXJlY3QgPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIGlmICghcmVxdWVzdCkge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlRW1wdHlSZXF1ZXN0RXJyb3IoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gVGhyb3cgZXJyb3IgaWYgY2FsbGJhY2tzIGFyZSBub3Qgc2V0IGJlZm9yZSByZWRpcmVjdFxyXG4gICAgICAgIGlmICghdGhpcy5yZWRpcmVjdENhbGxiYWNrc1NldCkge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlUmVkaXJlY3RDYWxsYmFja3NOb3RTZXRFcnJvcigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFjcXVpcmVUb2tlbkludGVyYWN0aXZlKENvbnN0YW50cy5pbnRlcmFjdGlvblR5cGVSZWRpcmVjdCwgZmFsc2UsIHJlcXVlc3QpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXNlIHdoZW4gaW5pdGlhdGluZyB0aGUgbG9naW4gcHJvY2VzcyB2aWEgb3BlbmluZyBhIHBvcHVwIHdpbmRvdyBpbiB0aGUgdXNlcidzIGJyb3dzZXJcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge0BsaW5rIChBdXRoZW50aWNhdGlvblBhcmFtZXRlcnM6dHlwZSl9XHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPEF1dGhSZXNwb25zZT59IC0gYSBwcm9taXNlIHRoYXQgaXMgZnVsZmlsbGVkIHdoZW4gdGhpcyBmdW5jdGlvbiBoYXMgY29tcGxldGVkLCBvciByZWplY3RlZCBpZiBhbiBlcnJvciB3YXMgcmFpc2VkLiBSZXR1cm5zIHRoZSB7QGxpbmsgQXV0aFJlc3BvbnNlfSBvYmplY3RcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmxvZ2luUG9wdXAgPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgX3RoaXMuYWNxdWlyZVRva2VuSW50ZXJhY3RpdmUoQ29uc3RhbnRzLmludGVyYWN0aW9uVHlwZVBvcHVwLCB0cnVlLCByZXF1ZXN0LCByZXNvbHZlLCByZWplY3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogVXNlIHdoZW4geW91IHdhbnQgdG8gb2J0YWluIGFuIGFjY2Vzc190b2tlbiBmb3IgeW91ciBBUEkgdmlhIG9wZW5pbmcgYSBwb3B1cCB3aW5kb3cgaW4gdGhlIHVzZXIncyBicm93c2VyXHJcbiAgICAgKiBAcGFyYW0ge0BsaW5rIEF1dGhlbnRpY2F0aW9uUGFyYW1ldGVyc31cclxuICAgICAqXHJcbiAgICAgKiBUbyByZW5ldyBpZFRva2VuLCBwbGVhc2UgcGFzcyBjbGllbnRJZCBhcyB0aGUgb25seSBzY29wZSBpbiB0aGUgQXV0aGVudGljYXRpb24gUGFyYW1ldGVyc1xyXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPEF1dGhSZXNwb25zZT59IC0gYSBwcm9taXNlIHRoYXQgaXMgZnVsZmlsbGVkIHdoZW4gdGhpcyBmdW5jdGlvbiBoYXMgY29tcGxldGVkLCBvciByZWplY3RlZCBpZiBhbiBlcnJvciB3YXMgcmFpc2VkLiBSZXR1cm5zIHRoZSB7QGxpbmsgQXV0aFJlc3BvbnNlfSBvYmplY3RcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmFjcXVpcmVUb2tlblBvcHVwID0gZnVuY3Rpb24gKHJlcXVlc3QpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICghcmVxdWVzdCkge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlRW1wdHlSZXF1ZXN0RXJyb3IoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgX3RoaXMuYWNxdWlyZVRva2VuSW50ZXJhY3RpdmUoQ29uc3RhbnRzLmludGVyYWN0aW9uVHlwZVBvcHVwLCBmYWxzZSwgcmVxdWVzdCwgcmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvLyNyZWdpb24gQWNxdWlyZSBUb2tlblxyXG4gICAgLyoqXHJcbiAgICAgKiBVc2Ugd2hlbiBpbml0aWF0aW5nIHRoZSBsb2dpbiBwcm9jZXNzIG9yIHdoZW4geW91IHdhbnQgdG8gb2J0YWluIGFuIGFjY2Vzc190b2tlbiBmb3IgeW91ciBBUEksXHJcbiAgICAgKiBlaXRoZXIgYnkgcmVkaXJlY3RpbmcgdGhlIHVzZXIncyBicm93c2VyIHdpbmRvdyB0byB0aGUgYXV0aG9yaXphdGlvbiBlbmRwb2ludCBvciB2aWEgb3BlbmluZyBhIHBvcHVwIHdpbmRvdyBpbiB0aGUgdXNlcidzIGJyb3dzZXIuXHJcbiAgICAgKiBAcGFyYW0ge0BsaW5rIChBdXRoZW50aWNhdGlvblBhcmFtZXRlcnM6dHlwZSl9XHJcbiAgICAgKlxyXG4gICAgICogVG8gcmVuZXcgaWRUb2tlbiwgcGxlYXNlIHBhc3MgY2xpZW50SWQgYXMgdGhlIG9ubHkgc2NvcGUgaW4gdGhlIEF1dGhlbnRpY2F0aW9uIFBhcmFtZXRlcnNcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmFjcXVpcmVUb2tlbkludGVyYWN0aXZlID0gZnVuY3Rpb24gKGludGVyYWN0aW9uVHlwZSwgaXNMb2dpbkNhbGwsIHJlcXVlc3QsIHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgLy8gSWYgYWxyZWFkeSBpbiBwcm9ncmVzcywgZG8gbm90IHByb2NlZWRcclxuICAgICAgICBpZiAodGhpcy5sb2dpbkluUHJvZ3Jlc3MgfHwgdGhpcy5hY3F1aXJlVG9rZW5JblByb2dyZXNzKSB7XHJcbiAgICAgICAgICAgIHZhciB0aHJvd25FcnJvciA9IHRoaXMubG9naW5JblByb2dyZXNzID8gQ2xpZW50QXV0aEVycm9yLmNyZWF0ZUxvZ2luSW5Qcm9ncmVzc0Vycm9yKCkgOiBDbGllbnRBdXRoRXJyb3IuY3JlYXRlQWNxdWlyZVRva2VuSW5Qcm9ncmVzc0Vycm9yKCk7XHJcbiAgICAgICAgICAgIHZhciBzdGF0ZU9ubHlSZXNwb25zZSA9IGJ1aWxkUmVzcG9uc2VTdGF0ZU9ubHkodGhpcy5nZXRBY2NvdW50U3RhdGUocmVxdWVzdCAmJiByZXF1ZXN0LnN0YXRlKSk7XHJcbiAgICAgICAgICAgIHRoaXMuYXV0aEVycm9ySGFuZGxlcihpbnRlcmFjdGlvblR5cGUsIHRocm93bkVycm9yLCBzdGF0ZU9ubHlSZXNwb25zZSwgcmVqZWN0KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiBleHRyYVNjb3Blc1RvQ29uc2VudCBpcyBwYXNzZWQgaW4gbG9naW5DYWxsLCBhcHBlbmQgdGhlbSB0byB0aGUgbG9naW4gcmVxdWVzdFxyXG4gICAgICAgIHZhciBzY29wZXMgPSBpc0xvZ2luQ2FsbCA/IHRoaXMuYXBwZW5kU2NvcGVzKHJlcXVlc3QpIDogcmVxdWVzdC5zY29wZXM7XHJcbiAgICAgICAgLy8gVmFsaWRhdGUgYW5kIGZpbHRlciBzY29wZXMgKHRoZSB2YWxpZGF0ZSBmdW5jdGlvbiB3aWxsIHRocm93IGlmIHZhbGlkYXRpb24gZmFpbHMpXHJcbiAgICAgICAgdGhpcy52YWxpZGF0ZUlucHV0U2NvcGUoc2NvcGVzLCAhaXNMb2dpbkNhbGwpO1xyXG4gICAgICAgIC8vIEdldCB0aGUgYWNjb3VudCBvYmplY3QgaWYgYSBzZXNzaW9uIGV4aXN0c1xyXG4gICAgICAgIHZhciBhY2NvdW50ID0gKHJlcXVlc3QgJiYgcmVxdWVzdC5hY2NvdW50ICYmICFpc0xvZ2luQ2FsbCkgPyByZXF1ZXN0LmFjY291bnQgOiB0aGlzLmdldEFjY291bnQoKTtcclxuICAgICAgICAvLyBJZiBubyBzZXNzaW9uIGV4aXN0cywgcHJvbXB0IHRoZSB1c2VyIHRvIGxvZ2luLlxyXG4gICAgICAgIGlmICghYWNjb3VudCAmJiAhU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMuaXNTU09QYXJhbShyZXF1ZXN0KSkge1xyXG4gICAgICAgICAgICBpZiAoaXNMb2dpbkNhbGwpIHtcclxuICAgICAgICAgICAgICAgIC8vIGV4dHJhY3QgQURBTCBpZF90b2tlbiBpZiBleGlzdHNcclxuICAgICAgICAgICAgICAgIHZhciBhZGFsSWRUb2tlbiA9IHRoaXMuZXh0cmFjdEFEQUxJZFRva2VuKCk7XHJcbiAgICAgICAgICAgICAgICAvLyBzaWxlbnQgbG9naW4gaWYgQURBTCBpZF90b2tlbiBpcyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5IC0gU1NPXHJcbiAgICAgICAgICAgICAgICBpZiAoYWRhbElkVG9rZW4gJiYgIXNjb3Blcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJBREFMJ3MgaWRUb2tlbiBleGlzdHMuIEV4dHJhY3RpbmcgbG9naW4gaW5mb3JtYXRpb24gZnJvbSBBREFMJ3MgaWRUb2tlbiBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRva2VuUmVxdWVzdCA9IHRoaXMuYnVpbGRJRFRva2VuUmVxdWVzdChyZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNpbGVudExvZ2luID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjcXVpcmVUb2tlblNpbGVudCh0b2tlblJlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNpbGVudExvZ2luID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5pbmZvKFwiVW5pZmllZCBjYWNoZSBjYWxsIGlzIHN1Y2Nlc3NmdWxcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmF1dGhSZXNwb25zZUhhbmRsZXIoaW50ZXJhY3Rpb25UeXBlLCByZXNwb25zZSwgcmVzb2x2ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2lsZW50TG9naW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLmVycm9yKFwiRXJyb3Igb2NjdXJyZWQgZHVyaW5nIHVuaWZpZWQgY2FjaGUgQVRTOiBcIiArIGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJvY2VlZCB0byBsb2dpbiBzaW5jZSBBVFMgZmFpbGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmFjcXVpcmVUb2tlbkhlbHBlcihudWxsLCBpbnRlcmFjdGlvblR5cGUsIGlzTG9naW5DYWxsLCByZXF1ZXN0LCBzY29wZXMsIHJlc29sdmUsIHJlamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBObyBBREFMIHRva2VuIGZvdW5kLCBwcm9jZWVkIHRvIGxvZ2luXHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjcXVpcmVUb2tlbkhlbHBlcihudWxsLCBpbnRlcmFjdGlvblR5cGUsIGlzTG9naW5DYWxsLCByZXF1ZXN0LCBzY29wZXMsIHJlc29sdmUsIHJlamVjdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gQWNxdWlyZVRva2VuIGNhbGwsIGJ1dCBubyBhY2NvdW50IG9yIGNvbnRleHQgZ2l2ZW4sIHNvIHRocm93IGVycm9yXHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIlVzZXIgbG9naW4gaXMgcmVxdWlyZWRcIik7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBDbGllbnRBdXRoRXJyb3IuY3JlYXRlVXNlckxvZ2luUmVxdWlyZWRFcnJvcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFVzZXIgc2Vzc2lvbiBleGlzdHNcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hY3F1aXJlVG9rZW5IZWxwZXIoYWNjb3VudCwgaW50ZXJhY3Rpb25UeXBlLCBpc0xvZ2luQ2FsbCwgcmVxdWVzdCwgc2NvcGVzLCByZXNvbHZlLCByZWplY3QpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIEhlbHBlciBmdW5jdGlvbiB0byBhY3F1aXJlVG9rZW5cclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5hY3F1aXJlVG9rZW5IZWxwZXIgPSBmdW5jdGlvbiAoYWNjb3VudCwgaW50ZXJhY3Rpb25UeXBlLCBpc0xvZ2luQ2FsbCwgcmVxdWVzdCwgc2NvcGVzLCByZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIC8vIFRyYWNrIHRoZSBhY3F1aXJlVG9rZW4gcHJvZ3Jlc3NcclxuICAgICAgICBpZiAoaXNMb2dpbkNhbGwpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dpbkluUHJvZ3Jlc3MgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hY3F1aXJlVG9rZW5JblByb2dyZXNzID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNjb3BlID0gc2NvcGVzID8gc2NvcGVzLmpvaW4oXCIgXCIpLnRvTG93ZXJDYXNlKCkgOiB0aGlzLmNsaWVudElkLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgdmFyIHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdDtcclxuICAgICAgICB2YXIgYWNxdWlyZVRva2VuQXV0aG9yaXR5ID0gKCFpc0xvZ2luQ2FsbCAmJiByZXF1ZXN0ICYmIHJlcXVlc3QuYXV0aG9yaXR5KSA/IEF1dGhvcml0eUZhY3RvcnkuQ3JlYXRlSW5zdGFuY2UocmVxdWVzdC5hdXRob3JpdHksIHRoaXMuY29uZmlnLmF1dGgudmFsaWRhdGVBdXRob3JpdHkpIDogdGhpcy5hdXRob3JpdHlJbnN0YW5jZTtcclxuICAgICAgICB2YXIgcG9wVXBXaW5kb3c7XHJcbiAgICAgICAgaWYgKGludGVyYWN0aW9uVHlwZSA9PT0gQ29uc3RhbnRzLmludGVyYWN0aW9uVHlwZVBvcHVwKSB7XHJcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGEgcG9wdXAgd2luZG93XHJcbiAgICAgICAgICAgIHBvcFVwV2luZG93ID0gdGhpcy5vcGVuV2luZG93KFwiYWJvdXQ6YmxhbmtcIiwgXCJfYmxhbmtcIiwgMSwgdGhpcywgcmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgICAgICAgICAgaWYgKCFwb3BVcFdpbmRvdykge1xyXG4gICAgICAgICAgICAgICAgLy8gV2UgcGFzcyByZWplY3QgaW4gb3BlbldpbmRvdywgd2UgcmVqZWN0IHRoZXJlIGR1cmluZyBhbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFjcXVpcmVUb2tlbkF1dGhvcml0eS5yZXNvbHZlRW5kcG9pbnRzQXN5bmMoKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gT24gRnVsZmlsbG1lbnRcclxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlVHlwZSA9IGlzTG9naW5DYWxsID8gUmVzcG9uc2VUeXBlcy5pZF90b2tlbiA6IF90aGlzLmdldFRva2VuVHlwZShhY2NvdW50LCBzY29wZXMsIGZhbHNlKTtcclxuICAgICAgICAgICAgdmFyIGxvZ2luU3RhcnRQYWdlO1xyXG4gICAgICAgICAgICBpZiAoaXNMb2dpbkNhbGwpIHtcclxuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB1c2VyIHNldHMgdGhlIGxvZ2luIHN0YXJ0IHBhZ2UgLSBhbmd1bGFyIG9ubHk/P1xyXG4gICAgICAgICAgICAgICAgbG9naW5TdGFydFBhZ2UgPSBfdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShDb25zdGFudHMuYW5ndWxhckxvZ2luUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWxvZ2luU3RhcnRQYWdlIHx8IGxvZ2luU3RhcnRQYWdlID09PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9naW5TdGFydFBhZ2UgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5hbmd1bGFyTG9naW5SZXF1ZXN0LCBcIlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QgPSBuZXcgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMoYWNxdWlyZVRva2VuQXV0aG9yaXR5LCBfdGhpcy5jbGllbnRJZCwgc2NvcGVzLCByZXNwb25zZVR5cGUsIF90aGlzLmdldFJlZGlyZWN0VXJpKCksIHJlcXVlc3QgJiYgcmVxdWVzdC5zdGF0ZSk7XHJcbiAgICAgICAgICAgIF90aGlzLnVwZGF0ZUNhY2hlRW50cmllcyhzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QsIGFjY291bnQsIGxvZ2luU3RhcnRQYWdlKTtcclxuICAgICAgICAgICAgLy8gcG9wdWxhdGUgUXVlcnlQYXJhbWV0ZXJzIChzaWQvbG9naW5faGludC9kb21haW5faGludCkgYW5kIGFueSBvdGhlciBleHRyYVF1ZXJ5UGFyYW1ldGVycyBzZXQgYnkgdGhlIGRldmVsb3BlclxyXG4gICAgICAgICAgICBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QucG9wdWxhdGVRdWVyeVBhcmFtcyhhY2NvdW50LCByZXF1ZXN0KTtcclxuICAgICAgICAgICAgLy8gQ29uc3RydWN0IHVybE5hdmlnYXRlXHJcbiAgICAgICAgICAgIHZhciB1cmxOYXZpZ2F0ZSA9IFVybFV0aWxzLmNyZWF0ZU5hdmlnYXRlVXJsKHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdCkgKyBDb25zdGFudHMucmVzcG9uc2VfbW9kZV9mcmFnbWVudDtcclxuICAgICAgICAgICAgLy8gc2V0IHN0YXRlIGluIGNhY2hlXHJcbiAgICAgICAgICAgIGlmIChpbnRlcmFjdGlvblR5cGUgPT09IENvbnN0YW50cy5pbnRlcmFjdGlvblR5cGVSZWRpcmVjdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpc0xvZ2luQ2FsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5zdGF0ZUFjcXVpcmVUb2tlbiwgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LnN0YXRlLCBfdGhpcy5pbkNvb2tpZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaW50ZXJhY3Rpb25UeXBlID09PSBDb25zdGFudHMuaW50ZXJhY3Rpb25UeXBlUG9wdXApIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW5ld1N0YXRlcy5wdXNoKHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5zdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cucmVxdWVzdFR5cGUgPSBpc0xvZ2luQ2FsbCA/IENvbnN0YW50cy5sb2dpbiA6IENvbnN0YW50cy5yZW5ld1Rva2VuO1xyXG4gICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgY2FsbGJhY2sgdG8gY2FwdHVyZSByZXN1bHRzIGZyb20gc2VydmVyXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5yZWdpc3RlckNhbGxiYWNrKHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5zdGF0ZSwgc2NvcGUsIHJlc29sdmUsIHJlamVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBDbGllbnRBdXRoRXJyb3IuY3JlYXRlSW52YWxpZEludGVyYWN0aW9uVHlwZUVycm9yKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gcHJvbXB0IHVzZXIgZm9yIGludGVyYWN0aW9uXHJcbiAgICAgICAgICAgIF90aGlzLm5hdmlnYXRlV2luZG93KHVybE5hdmlnYXRlLCBwb3BVcFdpbmRvdyk7XHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBfdGhpcy5sb2dnZXIud2FybmluZyhcImNvdWxkIG5vdCByZXNvbHZlIGVuZHBvaW50c1wiKTtcclxuICAgICAgICAgICAgX3RoaXMuYXV0aEVycm9ySGFuZGxlcihpbnRlcmFjdGlvblR5cGUsIENsaWVudEF1dGhFcnJvci5jcmVhdGVFbmRwb2ludFJlc29sdXRpb25FcnJvcihlcnIudG9TdHJpbmcpLCBidWlsZFJlc3BvbnNlU3RhdGVPbmx5KHJlcXVlc3Quc3RhdGUpLCByZWplY3QpO1xyXG4gICAgICAgICAgICBpZiAocG9wVXBXaW5kb3cpIHtcclxuICAgICAgICAgICAgICAgIHBvcFVwV2luZG93LmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFVzZSB0aGlzIGZ1bmN0aW9uIHRvIG9idGFpbiBhIHRva2VuIGJlZm9yZSBldmVyeSBjYWxsIHRvIHRoZSBBUEkgLyByZXNvdXJjZSBwcm92aWRlclxyXG4gICAgICpcclxuICAgICAqIE1TQUwgcmV0dXJuJ3MgYSBjYWNoZWQgdG9rZW4gd2hlbiBhdmFpbGFibGVcclxuICAgICAqIE9yIGl0IHNlbmQncyBhIHJlcXVlc3QgdG8gdGhlIFNUUyB0byBvYnRhaW4gYSBuZXcgdG9rZW4gdXNpbmcgYSBoaWRkZW4gaWZyYW1lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7QGxpbmsgQXV0aGVudGljYXRpb25QYXJhbWV0ZXJzfVxyXG4gICAgICpcclxuICAgICAqIFRvIHJlbmV3IGlkVG9rZW4sIHBsZWFzZSBwYXNzIGNsaWVudElkIGFzIHRoZSBvbmx5IHNjb3BlIGluIHRoZSBBdXRoZW50aWNhdGlvbiBQYXJhbWV0ZXJzXHJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48QXV0aFJlc3BvbnNlPn0gLSBhIHByb21pc2UgdGhhdCBpcyBmdWxmaWxsZWQgd2hlbiB0aGlzIGZ1bmN0aW9uIGhhcyBjb21wbGV0ZWQsIG9yIHJlamVjdGVkIGlmIGFuIGVycm9yIHdhcyByYWlzZWQuIFJldHVybnMgdGhlIHtAbGluayBBdXRoUmVzcG9uc2V9IG9iamVjdFxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmFjcXVpcmVUb2tlblNpbGVudCA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoIXJlcXVlc3QpIHtcclxuICAgICAgICAgICAgdGhyb3cgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZUVtcHR5UmVxdWVzdEVycm9yKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIC8vIFZhbGlkYXRlIGFuZCBmaWx0ZXIgc2NvcGVzICh0aGUgdmFsaWRhdGUgZnVuY3Rpb24gd2lsbCB0aHJvdyBpZiB2YWxpZGF0aW9uIGZhaWxzKVxyXG4gICAgICAgICAgICBfdGhpcy52YWxpZGF0ZUlucHV0U2NvcGUocmVxdWVzdC5zY29wZXMsIHRydWUpO1xyXG4gICAgICAgICAgICB2YXIgc2NvcGUgPSByZXF1ZXN0LnNjb3Blcy5qb2luKFwiIFwiKS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAvLyBpZiB0aGUgZGV2ZWxvcGVyIHBhc3NlcyBhbiBhY2NvdW50LCBnaXZlIHRoYXQgYWNjb3VudCB0aGUgcHJpb3JpdHlcclxuICAgICAgICAgICAgdmFyIGFjY291bnQgPSByZXF1ZXN0LmFjY291bnQgfHwgX3RoaXMuZ2V0QWNjb3VudCgpO1xyXG4gICAgICAgICAgICAvLyBleHRyYWN0IGlmIHRoZXJlIGlzIGFuIGFkYWxJZFRva2VuIHN0YXNoZWQgaW4gdGhlIGNhY2hlXHJcbiAgICAgICAgICAgIHZhciBhZGFsSWRUb2tlbiA9IF90aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5hZGFsSWRUb2tlbik7XHJcbiAgICAgICAgICAgIC8vaWYgdGhlcmUgaXMgbm8gYWNjb3VudCBsb2dnZWQgaW4gYW5kIG5vIGxvZ2luX2hpbnQvc2lkIGlzIHBhc3NlZCBpbiB0aGUgcmVxdWVzdFxyXG4gICAgICAgICAgICBpZiAoIWFjY291bnQgJiYgIShyZXF1ZXN0LnNpZCB8fCByZXF1ZXN0LmxvZ2luSGludCkgJiYgU3RyaW5nVXRpbHMuaXNFbXB0eShhZGFsSWRUb2tlbikpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5pbmZvKFwiVXNlciBsb2dpbiBpcyByZXF1aXJlZFwiKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoQ2xpZW50QXV0aEVycm9yLmNyZWF0ZVVzZXJMb2dpblJlcXVpcmVkRXJyb3IoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlVHlwZSA9IF90aGlzLmdldFRva2VuVHlwZShhY2NvdW50LCByZXF1ZXN0LnNjb3BlcywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QgPSBuZXcgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMoQXV0aG9yaXR5RmFjdG9yeS5DcmVhdGVJbnN0YW5jZShyZXF1ZXN0LmF1dGhvcml0eSwgX3RoaXMuY29uZmlnLmF1dGgudmFsaWRhdGVBdXRob3JpdHkpLCBfdGhpcy5jbGllbnRJZCwgcmVxdWVzdC5zY29wZXMsIHJlc3BvbnNlVHlwZSwgX3RoaXMuZ2V0UmVkaXJlY3RVcmkoKSwgcmVxdWVzdCAmJiByZXF1ZXN0LnN0YXRlKTtcclxuICAgICAgICAgICAgLy8gcG9wdWxhdGUgUXVlcnlQYXJhbWV0ZXJzIChzaWQvbG9naW5faGludC9kb21haW5faGludCkgYW5kIGFueSBvdGhlciBleHRyYVF1ZXJ5UGFyYW1ldGVycyBzZXQgYnkgdGhlIGRldmVsb3BlclxyXG4gICAgICAgICAgICBpZiAoU2VydmVyUmVxdWVzdFBhcmFtZXRlcnMuaXNTU09QYXJhbShyZXF1ZXN0KSB8fCBhY2NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QucG9wdWxhdGVRdWVyeVBhcmFtcyhhY2NvdW50LCByZXF1ZXN0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2lmIHVzZXIgZGlkbid0IHBhc3MgbG9naW5faGludC9zaWQgYW5kIGFkYWwncyBpZHRva2VuIGlzIHByZXNlbnQsIGV4dHJhY3QgdGhlIGxvZ2luX2hpbnQgZnJvbSB0aGUgYWRhbElkVG9rZW5cclxuICAgICAgICAgICAgZWxzZSBpZiAoIWFjY291bnQgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkoYWRhbElkVG9rZW4pKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBhZGFsSWRUb2tlbiBleGlzdHMsIGV4dHJhY3QgdGhlIFNTTyBpbmZvIGZyb20gdGhlIHNhbWVcclxuICAgICAgICAgICAgICAgIHZhciBhZGFsSWRUb2tlbk9iamVjdCA9IFRva2VuVXRpbHMuZXh0cmFjdElkVG9rZW4oYWRhbElkVG9rZW4pO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLnZlcmJvc2UoXCJBREFMJ3MgaWRUb2tlbiBleGlzdHMuIEV4dHJhY3RpbmcgbG9naW4gaW5mb3JtYXRpb24gZnJvbSBBREFMJ3MgaWRUb2tlbiBcIik7XHJcbiAgICAgICAgICAgICAgICBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QucG9wdWxhdGVRdWVyeVBhcmFtcyhhY2NvdW50LCBudWxsLCBhZGFsSWRUb2tlbk9iamVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHVzZXJDb250YWluZWRDbGFpbXMgPSByZXF1ZXN0LmNsYWltc1JlcXVlc3QgfHwgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LmNsYWltc1ZhbHVlO1xyXG4gICAgICAgICAgICB2YXIgYXV0aEVycjtcclxuICAgICAgICAgICAgdmFyIGNhY2hlUmVzdWx0UmVzcG9uc2U7XHJcbiAgICAgICAgICAgIGlmICghdXNlckNvbnRhaW5lZENsYWltcyAmJiAhcmVxdWVzdC5mb3JjZVJlZnJlc2gpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVSZXN1bHRSZXNwb25zZSA9IF90aGlzLmdldENhY2hlZFRva2VuKHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdCwgYWNjb3VudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhFcnIgPSBlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHJlc29sdmUvcmVqZWN0IGJhc2VkIG9uIGNhY2hlUmVzdWx0XHJcbiAgICAgICAgICAgIGlmIChjYWNoZVJlc3VsdFJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIuaW5mbyhcIlRva2VuIGlzIGFscmVhZHkgaW4gY2FjaGUgZm9yIHNjb3BlOlwiICsgc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShjYWNoZVJlc3VsdFJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGF1dGhFcnIpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5pbmZvUGlpKGF1dGhFcnIuZXJyb3JDb2RlICsgXCI6XCIgKyBhdXRoRXJyLmVycm9yTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoYXV0aEVycik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBlbHNlIHByb2NlZWQgd2l0aCBsb2dpblxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZhciBsb2dNZXNzYWdlID0gdm9pZCAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXJDb250YWluZWRDbGFpbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dNZXNzYWdlID0gXCJTa2lwcGVkIGNhY2hlIGxvb2t1cCBzaW5jZSBjbGFpbXMgd2VyZSBnaXZlbi5cIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVlc3QuZm9yY2VSZWZyZXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nTWVzc2FnZSA9IFwiU2tpcHBlZCBjYWNoZSBsb29rdXAgc2luY2UgcmVxdWVzdC5mb3JjZVJlZnJlc2ggb3B0aW9uIHdhcyBzZXQgdG8gdHJ1ZVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nTWVzc2FnZSA9IFwiVG9rZW4gaXMgbm90IGluIGNhY2hlIGZvciBzY29wZTpcIiArIHNjb3BlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLnZlcmJvc2UobG9nTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBDYWNoZSByZXN1bHQgY2FuIHJldHVybiBudWxsIGlmIGNhY2hlIGlzIGVtcHR5LiBJbiB0aGF0IGNhc2UsIHNldCBhdXRob3JpdHkgdG8gZGVmYXVsdCB2YWx1ZSBpZiBubyBhdXRob3JpdHkgaXMgcGFzc2VkIHRvIHRoZSBhcGkuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5hdXRob3JpdHlJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5hdXRob3JpdHlJbnN0YW5jZSA9IHJlcXVlc3QuYXV0aG9yaXR5ID8gQXV0aG9yaXR5RmFjdG9yeS5DcmVhdGVJbnN0YW5jZShyZXF1ZXN0LmF1dGhvcml0eSwgX3RoaXMuY29uZmlnLmF1dGgudmFsaWRhdGVBdXRob3JpdHkpIDogX3RoaXMuYXV0aG9yaXR5SW5zdGFuY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjYWNoZSBtaXNzXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LmF1dGhvcml0eUluc3RhbmNlLnJlc29sdmVFbmRwb2ludHNBc3luYygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlZnJlc2ggYXR0ZW1wdCB3aXRoIGlmcmFtZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgcmVuZXdpbmcgZm9yIHRoaXMgc2NvcGUsIGNhbGxiYWNrIHdoZW4gd2UgZ2V0IHRoZSB0b2tlbi5cclxuICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmFjdGl2ZVJlbmV3YWxzW3Njb3BlXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIudmVyYm9zZShcIlJlbmV3IHRva2VuIGZvciBzY29wZTogXCIgKyBzY29wZSArIFwiIGlzIGluIHByb2dyZXNzLiBSZWdpc3RlcmluZyBjYWxsYmFja1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWN0aXZlIHJlbmV3YWxzIGNvbnRhaW5zIHRoZSBzdGF0ZSBmb3IgZWFjaCByZW5ld2FsLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZWdpc3RlckNhbGxiYWNrKHdpbmRvdy5hY3RpdmVSZW5ld2Fsc1tzY29wZV0sIHNjb3BlLCByZXNvbHZlLCByZWplY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVlc3Quc2NvcGVzICYmIHJlcXVlc3Quc2NvcGVzLmluZGV4T2YoX3RoaXMuY2xpZW50SWQpID4gLTEgJiYgcmVxdWVzdC5zY29wZXMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHAgdXNlcyBpZFRva2VuIHRvIHNlbmQgdG8gYXBpIGVuZHBvaW50c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVmYXVsdCBzY29wZSBpcyB0cmFja2VkIGFzIGNsaWVudElkIHRvIHN0b3JlIHRoaXMgdG9rZW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci52ZXJib3NlKFwicmVuZXdpbmcgaWRUb2tlblwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNpbGVudExvZ2luID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJlbmV3SWRUb2tlbihyZXF1ZXN0LnNjb3BlcywgcmVzb2x2ZSwgcmVqZWN0LCBhY2NvdW50LCBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVuZXcgYWNjZXNzIHRva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIudmVyYm9zZShcInJlbmV3aW5nIGFjY2Vzc3Rva2VuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVuZXdUb2tlbihyZXF1ZXN0LnNjb3BlcywgcmVzb2x2ZSwgcmVqZWN0LCBhY2NvdW50LCBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci53YXJuaW5nKFwiY291bGQgbm90IHJlc29sdmUgZW5kcG9pbnRzXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChDbGllbnRBdXRoRXJyb3IuY3JlYXRlRW5kcG9pbnRSZXNvbHV0aW9uRXJyb3IoZXJyLnRvU3RyaW5nKCkpKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICAvLyNyZWdpb24gUG9wdXAgV2luZG93IENyZWF0aW9uXHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqXHJcbiAgICAgKiBVc2VkIHRvIHNlbmQgdGhlIHVzZXIgdG8gdGhlIHJlZGlyZWN0X3VyaSBhZnRlciBhdXRoZW50aWNhdGlvbiBpcyBjb21wbGV0ZS4gVGhlIHVzZXIncyBiZWFyZXIgdG9rZW4gaXMgYXR0YWNoZWQgdG8gdGhlIFVSSSBmcmFnbWVudCBhcyBhbiBpZF90b2tlbi9hY2Nlc3NfdG9rZW4gZmllbGQuXHJcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIGFsc28gY2xvc2VzIHRoZSBwb3B1cCB3aW5kb3cgYWZ0ZXIgcmVkaXJlY3Rpb24uXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVybE5hdmlnYXRlXHJcbiAgICAgKiBAcGFyYW0gdGl0bGVcclxuICAgICAqIEBwYXJhbSBpbnRlcnZhbFxyXG4gICAgICogQHBhcmFtIGluc3RhbmNlXHJcbiAgICAgKiBAcGFyYW0gcmVzb2x2ZVxyXG4gICAgICogQHBhcmFtIHJlamVjdFxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUub3BlbldpbmRvdyA9IGZ1bmN0aW9uICh1cmxOYXZpZ2F0ZSwgdGl0bGUsIGludGVydmFsLCBpbnN0YW5jZSwgcmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAvLyBHZW5lcmF0ZSBhIHBvcHVwIHdpbmRvd1xyXG4gICAgICAgIHZhciBwb3B1cFdpbmRvdztcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBwb3B1cFdpbmRvdyA9IHRoaXMub3BlblBvcHVwKHVybE5hdmlnYXRlLCB0aXRsZSwgQ29uc3RhbnRzLnBvcFVwV2lkdGgsIENvbnN0YW50cy5wb3BVcEhlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLmxvZ2luSW5Qcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5hY3F1aXJlVG9rZW5JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oQ2xpZW50QXV0aEVycm9yTWVzc2FnZS5wb3BVcFdpbmRvd0Vycm9yLmNvZGUgKyBcIjpcIiArIENsaWVudEF1dGhFcnJvck1lc3NhZ2UucG9wVXBXaW5kb3dFcnJvci5kZXNjKTtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMubXNhbEVycm9yLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLnBvcFVwV2luZG93RXJyb3IuY29kZSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLm1zYWxFcnJvckRlc2NyaXB0aW9uLCBDbGllbnRBdXRoRXJyb3JNZXNzYWdlLnBvcFVwV2luZG93RXJyb3IuZGVzYyk7XHJcbiAgICAgICAgICAgIGlmIChyZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChDbGllbnRBdXRoRXJyb3IuY3JlYXRlUG9wdXBXaW5kb3dFcnJvcigpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUHVzaCBwb3B1cCB3aW5kb3cgaGFuZGxlIG9udG8gc3RhY2sgZm9yIHRyYWNraW5nXHJcbiAgICAgICAgd2luZG93Lm9wZW5lZFdpbmRvd3MucHVzaChwb3B1cFdpbmRvdyk7XHJcbiAgICAgICAgdmFyIHBvbGxUaW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIElmIHBvcHVwIGNsb3NlZCBvciBsb2dpbiBpbiBwcm9ncmVzcywgY2FuY2VsIGxvZ2luXHJcbiAgICAgICAgICAgIGlmIChwb3B1cFdpbmRvdyAmJiBwb3B1cFdpbmRvdy5jbG9zZWQgJiYgKGluc3RhbmNlLmxvZ2luSW5Qcm9ncmVzcyB8fCBpbnN0YW5jZS5hY3F1aXJlVG9rZW5JblByb2dyZXNzKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChDbGllbnRBdXRoRXJyb3IuY3JlYXRlVXNlckNhbmNlbGxlZEVycm9yKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwocG9sbFRpbWVyKTtcclxuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5jb25maWcuZnJhbWV3b3JrLmlzQW5ndWxhcikge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmJyb2FkY2FzdChcIm1zYWw6cG9wVXBDbG9zZWRcIiwgQ2xpZW50QXV0aEVycm9yTWVzc2FnZS51c2VyQ2FuY2VsbGVkRXJyb3IuY29kZSArIENvbnN0YW50cy5yZXNvdXJjZURlbGltaXRlciArIENsaWVudEF1dGhFcnJvck1lc3NhZ2UudXNlckNhbmNlbGxlZEVycm9yLmRlc2MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmxvZ2luSW5Qcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuYWNxdWlyZVRva2VuSW5Qcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9wVXBXaW5kb3dMb2NhdGlvbiA9IHBvcHVwV2luZG93LmxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhlIHBvcHVwIGhhc2ggY2hhbmdlcywgY2xvc2UgdGhlIHBvcHVwIHdpbmRvd1xyXG4gICAgICAgICAgICAgICAgaWYgKHBvcFVwV2luZG93TG9jYXRpb24uaHJlZi5pbmRleE9mKF90aGlzLmdldFJlZGlyZWN0VXJpKCkpICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHBvbGxUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UubG9naW5JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuYWNxdWlyZVRva2VuSW5Qcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLmxvZ2dlci5pbmZvKFwiQ2xvc2luZyBwb3B1cCB3aW5kb3dcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogQ2hlY2sgaG93IHRoaXMgY2FuIGJlIGV4dHJhY3RlZCBmb3IgYW55IGZyYW1ld29yayBzcGVjaWZpYyBjb2RlP1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5jb25maWcuZnJhbWV3b3JrLmlzQW5ndWxhcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5icm9hZGNhc3QoXCJtc2FsOnBvcFVwSGFzaENoYW5nZWRcIiwgcG9wVXBXaW5kb3dMb2NhdGlvbi5oYXNoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aW5kb3cub3BlbmVkV2luZG93cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW5lZFdpbmRvd3NbaV0uY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gQ3Jvc3MgRG9tYWluIHVybCBjaGVjayBlcnJvci5cclxuICAgICAgICAgICAgICAgIC8vIFdpbGwgYmUgdGhyb3duIHVudGlsIEFBRCByZWRpcmVjdHMgdGhlIHVzZXIgYmFjayB0byB0aGUgYXBwXCJzIHJvb3QgcGFnZSB3aXRoIHRoZSB0b2tlbi5cclxuICAgICAgICAgICAgICAgIC8vIE5vIG5lZWQgdG8gbG9nIG9yIHRocm93IHRoaXMgZXJyb3IgYXMgaXQgd2lsbCBjcmVhdGUgdW5uZWNlc3NhcnkgdHJhZmZpYy5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIGludGVydmFsKTtcclxuICAgICAgICByZXR1cm4gcG9wdXBXaW5kb3c7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKlxyXG4gICAgICogQ29uZmlndXJlcyBwb3B1cCB3aW5kb3cgZm9yIGxvZ2luLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB1cmxOYXZpZ2F0ZVxyXG4gICAgICogQHBhcmFtIHRpdGxlXHJcbiAgICAgKiBAcGFyYW0gcG9wVXBXaWR0aFxyXG4gICAgICogQHBhcmFtIHBvcFVwSGVpZ2h0XHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5vcGVuUG9wdXAgPSBmdW5jdGlvbiAodXJsTmF2aWdhdGUsIHRpdGxlLCBwb3BVcFdpZHRoLCBwb3BVcEhlaWdodCkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBhZGRpbmcgd2luTGVmdCBhbmQgd2luVG9wIHRvIGFjY291bnQgZm9yIGR1YWwgbW9uaXRvclxyXG4gICAgICAgICAgICAgKiB1c2luZyBzY3JlZW5MZWZ0IGFuZCBzY3JlZW5Ub3AgZm9yIElFOCBhbmQgZWFybGllclxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdmFyIHdpbkxlZnQgPSB3aW5kb3cuc2NyZWVuTGVmdCA/IHdpbmRvdy5zY3JlZW5MZWZ0IDogd2luZG93LnNjcmVlblg7XHJcbiAgICAgICAgICAgIHZhciB3aW5Ub3AgPSB3aW5kb3cuc2NyZWVuVG9wID8gd2luZG93LnNjcmVlblRvcCA6IHdpbmRvdy5zY3JlZW5ZO1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogd2luZG93LmlubmVyV2lkdGggZGlzcGxheXMgYnJvd3NlciB3aW5kb3dcInMgaGVpZ2h0IGFuZCB3aWR0aCBleGNsdWRpbmcgdG9vbGJhcnNcclxuICAgICAgICAgICAgICogdXNpbmcgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIGZvciBJRTggYW5kIGVhcmxpZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoO1xyXG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7XHJcbiAgICAgICAgICAgIHZhciBsZWZ0ID0gKCh3aWR0aCAvIDIpIC0gKHBvcFVwV2lkdGggLyAyKSkgKyB3aW5MZWZ0O1xyXG4gICAgICAgICAgICB2YXIgdG9wXzEgPSAoKGhlaWdodCAvIDIpIC0gKHBvcFVwSGVpZ2h0IC8gMikpICsgd2luVG9wO1xyXG4gICAgICAgICAgICAvLyBvcGVuIHRoZSB3aW5kb3dcclxuICAgICAgICAgICAgdmFyIHBvcHVwV2luZG93ID0gd2luZG93Lm9wZW4odXJsTmF2aWdhdGUsIHRpdGxlLCBcIndpZHRoPVwiICsgcG9wVXBXaWR0aCArIFwiLCBoZWlnaHQ9XCIgKyBwb3BVcEhlaWdodCArIFwiLCB0b3A9XCIgKyB0b3BfMSArIFwiLCBsZWZ0PVwiICsgbGVmdCk7XHJcbiAgICAgICAgICAgIGlmICghcG9wdXBXaW5kb3cpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IENsaWVudEF1dGhFcnJvci5jcmVhdGVQb3B1cFdpbmRvd0Vycm9yKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHBvcHVwV2luZG93LmZvY3VzKSB7XHJcbiAgICAgICAgICAgICAgICBwb3B1cFdpbmRvdy5mb2N1cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBwb3B1cFdpbmRvdztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJlcnJvciBvcGVuaW5nIHBvcHVwIFwiICsgZS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgdGhpcy5sb2dpbkluUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5hY3F1aXJlVG9rZW5JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRocm93IENsaWVudEF1dGhFcnJvci5jcmVhdGVQb3B1cFdpbmRvd0Vycm9yKGUudG9TdHJpbmcoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgLy8jcmVnaW9uIElmcmFtZSBNYW5hZ2VtZW50XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFJldHVybnMgd2hldGhlciBjdXJyZW50IHdpbmRvdyBpcyBpbiBpZnJhbSBmb3IgdG9rZW4gcmVuZXdhbFxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuaXNJbklmcmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gd2luZG93LnBhcmVudCAhPT0gd2luZG93O1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHBhcmVudCB3aW5kb3cgZXhpc3RzIGFuZCBoYXMgbXNhbFxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUucGFyZW50SXNNc2FsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB3aW5kb3cucGFyZW50ICE9PSB3aW5kb3cgJiYgd2luZG93LnBhcmVudC5tc2FsO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQ2FsbGluZyBfbG9hZEZyYW1lIGJ1dCB3aXRoIGEgdGltZW91dCB0byBzaWduYWwgZmFpbHVyZSBpbiBsb2FkZnJhbWVTdGF0dXMuIENhbGxiYWNrcyBhcmUgbGVmdC5cclxuICAgICAqIHJlZ2lzdGVyZWQgd2hlbiBuZXR3b3JrIGVycm9ycyBvY2N1ciBhbmQgc3Vic2VxdWVudCB0b2tlbiByZXF1ZXN0cyBmb3Igc2FtZSByZXNvdXJjZSBhcmUgcmVnaXN0ZXJlZCB0byB0aGUgcGVuZGluZyByZXF1ZXN0LlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUubG9hZElmcmFtZVRpbWVvdXQgPSBmdW5jdGlvbiAodXJsTmF2aWdhdGUsIGZyYW1lTmFtZSwgc2NvcGUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIC8vc2V0IGlmcmFtZSBzZXNzaW9uIHRvIHBlbmRpbmdcclxuICAgICAgICB2YXIgZXhwZWN0ZWRTdGF0ZSA9IHdpbmRvdy5hY3RpdmVSZW5ld2Fsc1tzY29wZV07XHJcbiAgICAgICAgdGhpcy5sb2dnZXIudmVyYm9zZShcIlNldCBsb2FkaW5nIHN0YXRlIHRvIHBlbmRpbmcgZm9yOiBcIiArIHNjb3BlICsgXCI6XCIgKyBleHBlY3RlZFN0YXRlKTtcclxuICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5yZW5ld1N0YXR1cyArIGV4cGVjdGVkU3RhdGUsIENvbnN0YW50cy50b2tlblJlbmV3U3RhdHVzSW5Qcm9ncmVzcyk7XHJcbiAgICAgICAgdGhpcy5sb2FkRnJhbWUodXJsTmF2aWdhdGUsIGZyYW1lTmFtZSk7XHJcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShDb25zdGFudHMucmVuZXdTdGF0dXMgKyBleHBlY3RlZFN0YXRlKSA9PT0gQ29uc3RhbnRzLnRva2VuUmVuZXdTdGF0dXNJblByb2dyZXNzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBmYWlsIHRoZSBpZnJhbWUgc2Vzc2lvbiBpZiBpdFwicyBpbiBwZW5kaW5nIHN0YXRlXHJcbiAgICAgICAgICAgICAgICBfdGhpcy5sb2dnZXIudmVyYm9zZShcIkxvYWRpbmcgZnJhbWUgaGFzIHRpbWVkIG91dCBhZnRlcjogXCIgKyAoX3RoaXMuY29uZmlnLnN5c3RlbS5sb2FkRnJhbWVUaW1lb3V0IC8gMTAwMCkgKyBcIiBzZWNvbmRzIGZvciBzY29wZSBcIiArIHNjb3BlICsgXCI6XCIgKyBleHBlY3RlZFN0YXRlKTtcclxuICAgICAgICAgICAgICAgIC8vIEVycm9yIGFmdGVyIHRpbWVvdXRcclxuICAgICAgICAgICAgICAgIGlmIChleHBlY3RlZFN0YXRlICYmIHdpbmRvdy5jYWxsYmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2FsbGJhY2tNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdKG51bGwsIENsaWVudEF1dGhFcnJvci5jcmVhdGVUb2tlblJlbmV3YWxUaW1lb3V0RXJyb3IoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMucmVuZXdTdGF0dXMgKyBleHBlY3RlZFN0YXRlLCBDb25zdGFudHMudG9rZW5SZW5ld1N0YXR1c0NhbmNlbGxlZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LCB0aGlzLmNvbmZpZy5zeXN0ZW0ubG9hZEZyYW1lVGltZW91dCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBMb2FkcyBpZnJhbWUgd2l0aCBhdXRob3JpemF0aW9uIGVuZHBvaW50IFVSTFxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUubG9hZEZyYW1lID0gZnVuY3Rpb24gKHVybE5hdmlnYXRlLCBmcmFtZU5hbWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIC8vIFRoaXMgdHJpY2sgb3ZlcmNvbWVzIGlmcmFtZSBuYXZpZ2F0aW9uIGluIElFXHJcbiAgICAgICAgLy8gSUUgZG9lcyBub3QgbG9hZCB0aGUgcGFnZSBjb25zaXN0ZW50bHkgaW4gaWZyYW1lXHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkxvYWRGcmFtZTogXCIgKyBmcmFtZU5hbWUpO1xyXG4gICAgICAgIHZhciBmcmFtZUNoZWNrID0gZnJhbWVOYW1lO1xyXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZnJhbWVIYW5kbGUgPSBfdGhpcy5hZGRIaWRkZW5JRnJhbWUoZnJhbWVDaGVjayk7XHJcbiAgICAgICAgICAgIGlmIChmcmFtZUhhbmRsZS5zcmMgPT09IFwiXCIgfHwgZnJhbWVIYW5kbGUuc3JjID09PSBcImFib3V0OmJsYW5rXCIpIHtcclxuICAgICAgICAgICAgICAgIGZyYW1lSGFuZGxlLnNyYyA9IHVybE5hdmlnYXRlO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLmluZm9QaWkoXCJGcmFtZSBOYW1lIDogXCIgKyBmcmFtZU5hbWUgKyBcIiBOYXZpZ2F0ZWQgdG86IFwiICsgdXJsTmF2aWdhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSwgdGhpcy5jb25maWcuc3lzdGVtLm5hdmlnYXRlRnJhbWVXYWl0KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIEFkZHMgdGhlIGhpZGRlbiBpZnJhbWUgZm9yIHNpbGVudCB0b2tlbiByZW5ld2FsLlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuYWRkSGlkZGVuSUZyYW1lID0gZnVuY3Rpb24gKGlmcmFtZUlkKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBpZnJhbWVJZCA9PT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkFkZCBtc2FsIGZyYW1lIHRvIGRvY3VtZW50OlwiICsgaWZyYW1lSWQpO1xyXG4gICAgICAgIHZhciBhZGFsRnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZnJhbWVJZCk7XHJcbiAgICAgICAgaWYgKCFhZGFsRnJhbWUpIHtcclxuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgJiZcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCAmJlxyXG4gICAgICAgICAgICAgICAgKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFIDUuMFwiKSA9PT0gLTEpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWZyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcclxuICAgICAgICAgICAgICAgIGlmci5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBpZnJhbWVJZCk7XHJcbiAgICAgICAgICAgICAgICBpZnIuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgICAgICAgICBpZnIuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XHJcbiAgICAgICAgICAgICAgICBpZnIuc3R5bGUud2lkdGggPSBpZnIuc3R5bGUuaGVpZ2h0ID0gXCIwXCI7XHJcbiAgICAgICAgICAgICAgICBpZnIuc3R5bGUuYm9yZGVyID0gXCIwXCI7XHJcbiAgICAgICAgICAgICAgICBhZGFsRnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImJvZHlcIilbMF0uYXBwZW5kQ2hpbGQoaWZyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChkb2N1bWVudC5ib2R5ICYmIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKSB7XHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5Lmluc2VydEFkamFjZW50SFRNTChcImJlZm9yZWVuZFwiLCBcIjxpZnJhbWUgbmFtZT0nXCIgKyBpZnJhbWVJZCArIFwiJyBpZD0nXCIgKyBpZnJhbWVJZCArIFwiJyBzdHlsZT0nZGlzcGxheTpub25lJz48L2lmcmFtZT5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHdpbmRvdy5mcmFtZXMgJiYgd2luZG93LmZyYW1lc1tpZnJhbWVJZF0pIHtcclxuICAgICAgICAgICAgICAgIGFkYWxGcmFtZSA9IHdpbmRvdy5mcmFtZXNbaWZyYW1lSWRdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhZGFsRnJhbWU7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICAvLyNyZWdpb24gR2VuZXJhbCBIZWxwZXJzXHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFVzZWQgdG8gcmVkaXJlY3QgdGhlIGJyb3dzZXIgdG8gdGhlIFNUUyBhdXRob3JpemF0aW9uIGVuZHBvaW50XHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsTmF2aWdhdGUgLSBVUkwgb2YgdGhlIGF1dGhvcml6YXRpb24gZW5kcG9pbnRcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLm5hdmlnYXRlV2luZG93ID0gZnVuY3Rpb24gKHVybE5hdmlnYXRlLCBwb3B1cFdpbmRvdykge1xyXG4gICAgICAgIC8vIE5hdmlnYXRlIGlmIHZhbGlkIFVSTFxyXG4gICAgICAgIGlmICh1cmxOYXZpZ2F0ZSAmJiAhU3RyaW5nVXRpbHMuaXNFbXB0eSh1cmxOYXZpZ2F0ZSkpIHtcclxuICAgICAgICAgICAgdmFyIG5hdmlnYXRlV2luZG93ID0gcG9wdXBXaW5kb3cgPyBwb3B1cFdpbmRvdyA6IHdpbmRvdztcclxuICAgICAgICAgICAgdmFyIGxvZ01lc3NhZ2UgPSBwb3B1cFdpbmRvdyA/IFwiTmF2aWdhdGVkIFBvcHVwIHdpbmRvdyB0bzpcIiArIHVybE5hdmlnYXRlIDogXCJOYXZpZ2F0ZSB0bzpcIiArIHVybE5hdmlnYXRlO1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvUGlpKGxvZ01lc3NhZ2UpO1xyXG4gICAgICAgICAgICBuYXZpZ2F0ZVdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKHVybE5hdmlnYXRlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJOYXZpZ2F0ZSB1cmwgaXMgZW1wdHlcIik7XHJcbiAgICAgICAgICAgIHRocm93IEF1dGhFcnJvci5jcmVhdGVVbmV4cGVjdGVkRXJyb3IoXCJOYXZpZ2F0ZSB1cmwgaXMgZW1wdHlcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogVXNlZCB0byBhZGQgdGhlIGRldmVsb3BlciByZXF1ZXN0ZWQgY2FsbGJhY2sgdG8gdGhlIGFycmF5IG9mIGNhbGxiYWNrcyBmb3IgdGhlIHNwZWNpZmllZCBzY29wZXMuIFRoZSB1cGRhdGVkIGFycmF5IGlzIHN0b3JlZCBvbiB0aGUgd2luZG93IG9iamVjdFxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGV4cGVjdGVkU3RhdGUgLSBVbmlxdWUgc3RhdGUgaWRlbnRpZmllciAoZ3VpZCkuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc2NvcGUgLSBEZXZlbG9wZXIgcmVxdWVzdGVkIHBlcm1pc3Npb25zLiBOb3QgYWxsIHNjb3BlcyBhcmUgZ3VhcmFudGVlZCB0byBiZSBpbmNsdWRlZCBpbiB0aGUgYWNjZXNzIHRva2VuIHJldHVybmVkLlxyXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzb2x2ZSAtIFRoZSByZXNvbHZlIGZ1bmN0aW9uIG9mIHRoZSBwcm9taXNlIG9iamVjdC5cclxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHJlamVjdCAtIFRoZSByZWplY3QgZnVuY3Rpb24gb2YgdGhlIHByb21pc2Ugb2JqZWN0LlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUucmVnaXN0ZXJDYWxsYmFjayA9IGZ1bmN0aW9uIChleHBlY3RlZFN0YXRlLCBzY29wZSwgcmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAvLyB0cmFjayBhY3RpdmUgcmVuZXdhbHNcclxuICAgICAgICB3aW5kb3cuYWN0aXZlUmVuZXdhbHNbc2NvcGVdID0gZXhwZWN0ZWRTdGF0ZTtcclxuICAgICAgICAvLyBpbml0aWFsaXplIGNhbGxiYWNrcyBtYXBwZWQgYXJyYXlcclxuICAgICAgICBpZiAoIXdpbmRvdy5wcm9taXNlTWFwcGVkVG9SZW5ld1N0YXRlc1tleHBlY3RlZFN0YXRlXSkge1xyXG4gICAgICAgICAgICB3aW5kb3cucHJvbWlzZU1hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0gPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaW5kZXhpbmcgb24gdGhlIGN1cnJlbnQgc3RhdGUsIHB1c2ggdGhlIGNhbGxiYWNrIHBhcmFtcyB0byBjYWxsYmFja3MgbWFwcGVkXHJcbiAgICAgICAgd2luZG93LnByb21pc2VNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdLnB1c2goeyByZXNvbHZlOiByZXNvbHZlLCByZWplY3Q6IHJlamVjdCB9KTtcclxuICAgICAgICAvLyBTdG9yZSB0aGUgc2VydmVyIGVzcG9uc2UgaW4gdGhlIGN1cnJlbnQgd2luZG93Pz9cclxuICAgICAgICBpZiAoIXdpbmRvdy5jYWxsYmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0pIHtcclxuICAgICAgICAgICAgd2luZG93LmNhbGxiYWNrTWFwcGVkVG9SZW5ld1N0YXRlc1tleHBlY3RlZFN0YXRlXSA9XHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UsIGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgYWN0aXZlIHJlbmV3YWxzXHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFjdGl2ZVJlbmV3YWxzW3Njb3BlXSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGFsbCBwcm9taXNlTWFwcGVkdG9SZW5ld1N0YXRlcyBmb3IgYSBnaXZlbiAnc3RhdGUnIC0gY2FsbCB0aGUgcmVqZWN0L3Jlc29sdmUgd2l0aCBlcnJvci90b2tlbiByZXNwZWN0aXZlbHlcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdpbmRvdy5wcm9taXNlTWFwcGVkVG9SZW5ld1N0YXRlc1tleHBlY3RlZFN0YXRlXS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnByb21pc2VNYXBwZWRUb1JlbmV3U3RhdGVzW2V4cGVjdGVkU3RhdGVdW2ldLnJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5wcm9taXNlTWFwcGVkVG9SZW5ld1N0YXRlc1tleHBlY3RlZFN0YXRlXVtpXS5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IEF1dGhFcnJvci5jcmVhdGVVbmV4cGVjdGVkRXJyb3IoXCJFcnJvciBhbmQgcmVzcG9uc2UgYXJlIGJvdGggbnVsbFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLndhcm5pbmcoZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXRcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucHJvbWlzZU1hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jYWxsYmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbZXhwZWN0ZWRTdGF0ZV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICAvLyNyZWdpb24gTG9nb3V0XHJcbiAgICAvKipcclxuICAgICAqIFVzZSB0byBsb2cgb3V0IHRoZSBjdXJyZW50IHVzZXIsIGFuZCByZWRpcmVjdCB0aGUgdXNlciB0byB0aGUgcG9zdExvZ291dFJlZGlyZWN0VXJpLlxyXG4gICAgICogRGVmYXVsdCBiZWhhdmlvdXIgaXMgdG8gcmVkaXJlY3QgdGhlIHVzZXIgdG8gYHdpbmRvdy5sb2NhdGlvbi5ocmVmYC5cclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xyXG4gICAgICAgIHRoaXMuYWNjb3VudCA9IG51bGw7XHJcbiAgICAgICAgdmFyIGxvZ291dCA9IFwiXCI7XHJcbiAgICAgICAgaWYgKHRoaXMuZ2V0UG9zdExvZ291dFJlZGlyZWN0VXJpKCkpIHtcclxuICAgICAgICAgICAgbG9nb3V0ID0gXCJwb3N0X2xvZ291dF9yZWRpcmVjdF91cmk9XCIgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5nZXRQb3N0TG9nb3V0UmVkaXJlY3RVcmkoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYXV0aG9yaXR5SW5zdGFuY2UucmVzb2x2ZUVuZHBvaW50c0FzeW5jKCkudGhlbihmdW5jdGlvbiAoYXV0aG9yaXR5KSB7XHJcbiAgICAgICAgICAgIHZhciB1cmxOYXZpZ2F0ZSA9IGF1dGhvcml0eS5FbmRTZXNzaW9uRW5kcG9pbnRcclxuICAgICAgICAgICAgICAgID8gYXV0aG9yaXR5LkVuZFNlc3Npb25FbmRwb2ludCArIFwiP1wiICsgbG9nb3V0XHJcbiAgICAgICAgICAgICAgICA6IF90aGlzLmF1dGhvcml0eSArIFwib2F1dGgyL3YyLjAvbG9nb3V0P1wiICsgbG9nb3V0O1xyXG4gICAgICAgICAgICBfdGhpcy5uYXZpZ2F0ZVdpbmRvdyh1cmxOYXZpZ2F0ZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBDbGVhciBhbGwgYWNjZXNzIHRva2VucyBpbiB0aGUgY2FjaGUuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5jbGVhckNhY2hlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHdpbmRvdy5yZW5ld1N0YXRlcyA9IFtdO1xyXG4gICAgICAgIHZhciBhY2Nlc3NUb2tlbkl0ZW1zID0gdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0QWxsQWNjZXNzVG9rZW5zKENvbnN0YW50cy5jbGllbnRJZCwgQ29uc3RhbnRzLmhvbWVBY2NvdW50SWRlbnRpZmllcik7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhY2Nlc3NUb2tlbkl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnJlbW92ZUl0ZW0oSlNPTi5zdHJpbmdpZnkoYWNjZXNzVG9rZW5JdGVtc1tpXS5rZXkpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2UucmVzZXRDYWNoZUl0ZW1zKCk7XHJcbiAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2UuY2xlYXJDb29raWUoKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIENsZWFyIGEgZ2l2ZW4gYWNjZXNzIHRva2VuIGZyb20gdGhlIGNhY2hlLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBhY2Nlc3NUb2tlblxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuY2xlYXJDYWNoZUZvclNjb3BlID0gZnVuY3Rpb24gKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuSXRlbXMgPSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRBbGxBY2Nlc3NUb2tlbnMoQ29uc3RhbnRzLmNsaWVudElkLCBDb25zdGFudHMuaG9tZUFjY291bnRJZGVudGlmaWVyKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjY2Vzc1Rva2VuSXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHRva2VuID0gYWNjZXNzVG9rZW5JdGVtc1tpXTtcclxuICAgICAgICAgICAgaWYgKHRva2VuLnZhbHVlLmFjY2Vzc1Rva2VuID09PSBhY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2UucmVtb3ZlSXRlbShKU09OLnN0cmluZ2lmeSh0b2tlbi5rZXkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIC8vI3JlZ2lvbiBSZXNwb25zZVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKiBDaGVja3MgaWYgdGhlIHJlZGlyZWN0IHJlc3BvbnNlIGlzIHJlY2VpdmVkIGZyb20gdGhlIFNUUy4gSW4gY2FzZSBvZiByZWRpcmVjdCwgdGhlIHVybCBmcmFnbWVudCBoYXMgZWl0aGVyIGlkX3Rva2VuLCBhY2Nlc3NfdG9rZW4gb3IgZXJyb3IuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaGFzaCAtIEhhc2ggcGFzc2VkIGZyb20gcmVkaXJlY3QgcGFnZS5cclxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufSAtIHRydWUgaWYgcmVzcG9uc2UgY29udGFpbnMgaWRfdG9rZW4sIGFjY2Vzc190b2tlbiBvciBlcnJvciwgZmFsc2Ugb3RoZXJ3aXNlLlxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuaXNDYWxsYmFjayA9IGZ1bmN0aW9uIChoYXNoKSB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcImlzQ2FsbGJhY2sgd2lsbCBiZSBkZXByZWNhdGVkIGluIGZhdm9yIG9mIHVybENvbnRhaW5zSGFzaCBpbiBNU0FMLmpzIHYyLjAuXCIpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVybENvbnRhaW5zSGFzaChoYXNoKTtcclxuICAgIH07XHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUudXJsQ29udGFpbnNIYXNoID0gZnVuY3Rpb24gKHVybFN0cmluZykge1xyXG4gICAgICAgIHZhciBwYXJhbWV0ZXJzID0gdGhpcy5kZXNlcmlhbGl6ZUhhc2godXJsU3RyaW5nKTtcclxuICAgICAgICByZXR1cm4gKHBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLmVycm9yRGVzY3JpcHRpb24pIHx8XHJcbiAgICAgICAgICAgIHBhcmFtZXRlcnMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLmVycm9yKSB8fFxyXG4gICAgICAgICAgICBwYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KENvbnN0YW50cy5hY2Nlc3NUb2tlbikgfHxcclxuICAgICAgICAgICAgcGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eShDb25zdGFudHMuaWRUb2tlbikpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogVXNlZCB0byBjYWxsIHRoZSBjb25zdHJ1Y3RvciBjYWxsYmFjayB3aXRoIHRoZSB0b2tlbi9lcnJvclxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IFtoYXNoPXdpbmRvdy5sb2NhdGlvbi5oYXNoXSAtIEhhc2ggZnJhZ21lbnQgb2YgVXJsLlxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUucHJvY2Vzc0NhbGxCYWNrID0gZnVuY3Rpb24gKGhhc2gsIHN0YXRlSW5mbywgcGFyZW50Q2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiUHJvY2Vzc2luZyB0aGUgY2FsbGJhY2sgZnJvbSByZWRpcmVjdCByZXNwb25zZVwiKTtcclxuICAgICAgICAvLyBnZXQgdGhlIHN0YXRlIGluZm8gZnJvbSB0aGUgaGFzaFxyXG4gICAgICAgIGlmICghc3RhdGVJbmZvKSB7XHJcbiAgICAgICAgICAgIHN0YXRlSW5mbyA9IHRoaXMuZ2V0UmVzcG9uc2VTdGF0ZShoYXNoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJlc3BvbnNlO1xyXG4gICAgICAgIHZhciBhdXRoRXJyO1xyXG4gICAgICAgIC8vIFNhdmUgdGhlIHRva2VuIGluZm8gZnJvbSB0aGUgaGFzaFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlID0gdGhpcy5zYXZlVG9rZW5Gcm9tSGFzaChoYXNoLCBzdGF0ZUluZm8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIGF1dGhFcnIgPSBlcnI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIHJlbW92ZSBoYXNoIGZyb20gdGhlIGNhY2hlXHJcbiAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2UucmVtb3ZlSXRlbShDb25zdGFudHMudXJsSGFzaCk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIGNvb2tpZSBpbiB0aGUgaGFzaFxyXG4gICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5jbGVhckNvb2tpZSgpO1xyXG4gICAgICAgICAgICB2YXIgYWNjb3VudFN0YXRlID0gdGhpcy5nZXRBY2NvdW50U3RhdGUoc3RhdGVJbmZvLnN0YXRlKTtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoKHN0YXRlSW5mby5yZXF1ZXN0VHlwZSA9PT0gQ29uc3RhbnRzLnJlbmV3VG9rZW4pIHx8IHJlc3BvbnNlLmFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5wYXJlbnQgIT09IHdpbmRvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci52ZXJib3NlKFwiV2luZG93IGlzIGluIGlmcmFtZSwgYWNxdWlyaW5nIHRva2VuIHNpbGVudGx5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIudmVyYm9zZShcImFjcXVpcmluZyB0b2tlbiBpbnRlcmFjdGl2ZSBpbiBwcm9ncmVzc1wiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UudG9rZW5UeXBlID0gQ29uc3RhbnRzLmFjY2Vzc1Rva2VuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoc3RhdGVJbmZvLnJlcXVlc3RUeXBlID09PSBDb25zdGFudHMubG9naW4pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS50b2tlblR5cGUgPSBDb25zdGFudHMuaWRUb2tlbjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghcGFyZW50Q2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhSZXNwb25zZUhhbmRsZXIoQ29uc3RhbnRzLmludGVyYWN0aW9uVHlwZVJlZGlyZWN0LCByZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCFwYXJlbnRDYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdXRoRXJyb3JIYW5kbGVyKENvbnN0YW50cy5pbnRlcmFjdGlvblR5cGVSZWRpcmVjdCwgYXV0aEVyciwgYnVpbGRSZXNwb25zZVN0YXRlT25seShhY2NvdW50U3RhdGUpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwYXJlbnRDYWxsYmFjayhyZXNwb25zZSwgYXV0aEVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJFcnJvciBvY2N1cnJlZCBpbiB0b2tlbiByZWNlaXZlZCBjYWxsYmFjayBmdW5jdGlvbjogXCIgKyBlcnIpO1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRBdXRoRXJyb3IuY3JlYXRlRXJyb3JJbkNhbGxiYWNrRnVuY3Rpb24oZXJyLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFRoaXMgbWV0aG9kIG11c3QgYmUgY2FsbGVkIGZvciBwcm9jZXNzaW5nIHRoZSByZXNwb25zZSByZWNlaXZlZCBmcm9tIHRoZSBTVFMuIEl0IGV4dHJhY3RzIHRoZSBoYXNoLCBwcm9jZXNzZXMgdGhlIHRva2VuIG9yIGVycm9yIGluZm9ybWF0aW9uIGFuZCBzYXZlcyBpdCBpbiB0aGUgY2FjaGUuIEl0IHRoZW5cclxuICAgICAqIGNhbGxzIHRoZSByZWdpc3RlcmVkIGNhbGxiYWNrcyBpbiBjYXNlIG9mIHJlZGlyZWN0IG9yIHJlc29sdmVzIHRoZSBwcm9taXNlcyB3aXRoIHRoZSByZXN1bHQuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2hhc2g9d2luZG93LmxvY2F0aW9uLmhhc2hdIC0gSGFzaCBmcmFnbWVudCBvZiBVcmwuXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5oYW5kbGVBdXRoZW50aWNhdGlvblJlc3BvbnNlID0gZnVuY3Rpb24gKGhhc2gpIHtcclxuICAgICAgICAvLyByZXRyaWV2ZSB0aGUgaGFzaFxyXG4gICAgICAgIGlmIChoYXNoID09IG51bGwpIHtcclxuICAgICAgICAgICAgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2VsZiA9IG51bGw7XHJcbiAgICAgICAgdmFyIGlzUG9wdXAgPSBmYWxzZTtcclxuICAgICAgICB2YXIgaXNXaW5kb3dPcGVuZXJNc2FsID0gZmFsc2U7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGN1cnJlbnQgd2luZG93IG9wZW5lZCB0aGUgaUZyYW1lL3BvcHVwXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaXNXaW5kb3dPcGVuZXJNc2FsID0gd2luZG93Lm9wZW5lciAmJiB3aW5kb3cub3BlbmVyLm1zYWwgJiYgd2luZG93Lm9wZW5lci5tc2FsICE9PSB3aW5kb3cubXNhbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICAvLyBlcnIgPSBTZWN1cml0eUVycm9yOiBCbG9ja2VkIGEgZnJhbWUgd2l0aCBvcmlnaW4gXCJbdXJsXVwiIGZyb20gYWNjZXNzaW5nIGEgY3Jvc3Mtb3JpZ2luIGZyYW1lLlxyXG4gICAgICAgICAgICBpc1dpbmRvd09wZW5lck1zYWwgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU2V0IHRoZSBzZWxmIHRvIHRoZSB3aW5kb3cgdGhhdCBjcmVhdGVkIHRoZSBwb3B1cC9pZnJhbWVcclxuICAgICAgICBpZiAoaXNXaW5kb3dPcGVuZXJNc2FsKSB7XHJcbiAgICAgICAgICAgIHNlbGYgPSB3aW5kb3cub3BlbmVyLm1zYWw7XHJcbiAgICAgICAgICAgIGlzUG9wdXAgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh3aW5kb3cucGFyZW50ICYmIHdpbmRvdy5wYXJlbnQubXNhbCkge1xyXG4gICAgICAgICAgICBzZWxmID0gd2luZG93LnBhcmVudC5tc2FsO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiAod2luZG93LnBhcmVudCAhPT0gd2luZG93KSwgYnkgdXNpbmcgc2VsZiwgd2luZG93LnBhcmVudCBiZWNvbWVzIGVxdWFsIHRvIHdpbmRvdyBpbiBnZXRSZXNwb25zZVN0YXRlIG1ldGhvZCBzcGVjaWZpY2FsbHlcclxuICAgICAgICB2YXIgc3RhdGVJbmZvID0gc2VsZi5nZXRSZXNwb25zZVN0YXRlKGhhc2gpO1xyXG4gICAgICAgIHZhciB0b2tlblJlc3BvbnNlQ2FsbGJhY2sgPSBudWxsO1xyXG4gICAgICAgIHNlbGYubG9nZ2VyLmluZm8oXCJSZXR1cm5lZCBmcm9tIHJlZGlyZWN0IHVybFwiKTtcclxuICAgICAgICAvLyBJZiBwYXJlbnQgd2luZG93IGlzIHRoZSBtc2FsIGluc3RhbmNlIHdoaWNoIG9wZW5lZCB0aGUgY3VycmVudCB3aW5kb3cgKGlmcmFtZSlcclxuICAgICAgICBpZiAodGhpcy5wYXJlbnRJc01zYWwoKSkge1xyXG4gICAgICAgICAgICB0b2tlblJlc3BvbnNlQ2FsbGJhY2sgPSB3aW5kb3cucGFyZW50LmNhbGxiYWNrTWFwcGVkVG9SZW5ld1N0YXRlc1tzdGF0ZUluZm8uc3RhdGVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDdXJyZW50IHdpbmRvdyBpcyB3aW5kb3cgb3BlbmVyIChwb3B1cClcclxuICAgICAgICBlbHNlIGlmIChpc1dpbmRvd09wZW5lck1zYWwpIHtcclxuICAgICAgICAgICAgdG9rZW5SZXNwb25zZUNhbGxiYWNrID0gd2luZG93Lm9wZW5lci5jYWxsYmFja01hcHBlZFRvUmVuZXdTdGF0ZXNbc3RhdGVJbmZvLnN0YXRlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gUmVkaXJlY3QgY2FzZXNcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdG9rZW5SZXNwb25zZUNhbGxiYWNrID0gbnVsbDtcclxuICAgICAgICAgICAgLy8gaWYgc2V0IHRvIG5hdmlnYXRlIHRvIGxvZ2luUmVxdWVzdCBwYWdlIHBvc3QgbG9naW5cclxuICAgICAgICAgICAgaWYgKHNlbGYuY29uZmlnLmF1dGgubmF2aWdhdGVUb0xvZ2luUmVxdWVzdFVybCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZi5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMudXJsSGFzaCwgaGFzaCk7XHJcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LnBhcmVudCA9PT0gd2luZG93ICYmICFpc1BvcHVwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBzZWxmLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5sb2dpblJlcXVlc3QsIHNlbGYuaW5Db29raWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBcIlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5yZWRpcmVjdENhbGxiYWNrc1NldCkge1xyXG4gICAgICAgICAgICAgICAgLy8gV2UgcmVhY2hlZCB0aGlzIHBvaW50IHRvbyBlYXJseSAtIGNhY2hlIGhhc2gsIHJldHVybiBhbmQgcHJvY2VzcyBpbiBoYW5kbGVSZWRpcmVjdENhbGxiYWNrc1xyXG4gICAgICAgICAgICAgICAgc2VsZi5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMudXJsSGFzaCwgaGFzaCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5wcm9jZXNzQ2FsbEJhY2soaGFzaCwgc3RhdGVJbmZvLCB0b2tlblJlc3BvbnNlQ2FsbGJhY2spO1xyXG4gICAgICAgIC8vIElmIGN1cnJlbnQgd2luZG93IGlzIG9wZW5lciwgY2xvc2UgYWxsIHdpbmRvd3NcclxuICAgICAgICBpZiAoaXNXaW5kb3dPcGVuZXJNc2FsKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2luZG93Lm9wZW5lci5vcGVuZWRXaW5kb3dzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cub3BlbmVyLm9wZW5lZFdpbmRvd3NbaV0uY2xvc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFJldHVybnMgZGVzZXJpYWxpemVkIHBvcnRpb24gb2YgVVJMIGhhc2hcclxuICAgICAqIEBwYXJhbSBoYXNoXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5kZXNlcmlhbGl6ZUhhc2ggPSBmdW5jdGlvbiAodXJsRnJhZ21lbnQpIHtcclxuICAgICAgICB2YXIgaGFzaCA9IFVybFV0aWxzLmdldEhhc2hGcm9tVXJsKHVybEZyYWdtZW50KTtcclxuICAgICAgICByZXR1cm4gQ3J5cHRvVXRpbHMuZGVzZXJpYWxpemUoaGFzaCk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBDcmVhdGVzIGEgc3RhdGVJbmZvIG9iamVjdCBmcm9tIHRoZSBVUkwgZnJhZ21lbnQgYW5kIHJldHVybnMgaXQuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaGFzaCAgLSAgSGFzaCBwYXNzZWQgZnJvbSByZWRpcmVjdCBwYWdlXHJcbiAgICAgKiBAcmV0dXJucyB7VG9rZW5SZXNwb25zZX0gYW4gb2JqZWN0IGNyZWF0ZWQgZnJvbSB0aGUgcmVkaXJlY3QgcmVzcG9uc2UgZnJvbSBBQUQgY29tcHJpc2luZyBvZiB0aGUga2V5cyAtIHBhcmFtZXRlcnMsIHJlcXVlc3RUeXBlLCBzdGF0ZU1hdGNoLCBzdGF0ZVJlc3BvbnNlIGFuZCB2YWxpZC5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmdldFJlc3BvbnNlU3RhdGUgPSBmdW5jdGlvbiAoaGFzaCkge1xyXG4gICAgICAgIHZhciBwYXJhbWV0ZXJzID0gdGhpcy5kZXNlcmlhbGl6ZUhhc2goaGFzaCk7XHJcbiAgICAgICAgdmFyIHN0YXRlUmVzcG9uc2U7XHJcbiAgICAgICAgaWYgKCFwYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgIHRocm93IEF1dGhFcnJvci5jcmVhdGVVbmV4cGVjdGVkRXJyb3IoXCJIYXNoIHdhcyBub3QgcGFyc2VkIGNvcnJlY3RseS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXJhbWV0ZXJzLmhhc093blByb3BlcnR5KFwic3RhdGVcIikpIHtcclxuICAgICAgICAgICAgc3RhdGVSZXNwb25zZSA9IHtcclxuICAgICAgICAgICAgICAgIHJlcXVlc3RUeXBlOiBDb25zdGFudHMudW5rbm93bixcclxuICAgICAgICAgICAgICAgIHN0YXRlOiBwYXJhbWV0ZXJzLnN0YXRlLFxyXG4gICAgICAgICAgICAgICAgc3RhdGVNYXRjaDogZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IEF1dGhFcnJvci5jcmVhdGVVbmV4cGVjdGVkRXJyb3IoXCJIYXNoIGRvZXMgbm90IGNvbnRhaW4gc3RhdGUuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBhc3luYyBjYWxscyBjYW4gZmlyZSBpZnJhbWUgYW5kIGxvZ2luIHJlcXVlc3QgYXQgdGhlIHNhbWUgdGltZSBpZiBkZXZlbG9wZXIgZG9lcyBub3QgdXNlIHRoZSBBUEkgYXMgZXhwZWN0ZWRcclxuICAgICAgICAvLyBpbmNvbWluZyBjYWxsYmFjayBuZWVkcyB0byBiZSBsb29rZWQgdXAgdG8gZmluZCB0aGUgcmVxdWVzdCB0eXBlXHJcbiAgICAgICAgLy8gbG9naW5SZWRpcmVjdFxyXG4gICAgICAgIGlmIChzdGF0ZVJlc3BvbnNlLnN0YXRlID09PSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5zdGF0ZUxvZ2luLCB0aGlzLmluQ29va2llKSB8fCBzdGF0ZVJlc3BvbnNlLnN0YXRlID09PSB0aGlzLnNpbGVudEF1dGhlbnRpY2F0aW9uU3RhdGUpIHsgLy8gbG9naW5SZWRpcmVjdFxyXG4gICAgICAgICAgICBzdGF0ZVJlc3BvbnNlLnJlcXVlc3RUeXBlID0gQ29uc3RhbnRzLmxvZ2luO1xyXG4gICAgICAgICAgICBzdGF0ZVJlc3BvbnNlLnN0YXRlTWF0Y2ggPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGVSZXNwb25zZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWNxdWlyZVRva2VuUmVkaXJlY3RcclxuICAgICAgICBlbHNlIGlmIChzdGF0ZVJlc3BvbnNlLnN0YXRlID09PSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5zdGF0ZUFjcXVpcmVUb2tlbiwgdGhpcy5pbkNvb2tpZSkpIHsgLy9hY3F1aXJlVG9rZW5SZWRpcmVjdFxyXG4gICAgICAgICAgICBzdGF0ZVJlc3BvbnNlLnJlcXVlc3RUeXBlID0gQ29uc3RhbnRzLnJlbmV3VG9rZW47XHJcbiAgICAgICAgICAgIHN0YXRlUmVzcG9uc2Uuc3RhdGVNYXRjaCA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVJlc3BvbnNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBleHRlcm5hbCBhcGkgcmVxdWVzdHMgbWF5IGhhdmUgbWFueSByZW5ld3Rva2VuIHJlcXVlc3RzIGZvciBkaWZmZXJlbnQgcmVzb3VyY2VcclxuICAgICAgICBpZiAoIXN0YXRlUmVzcG9uc2Uuc3RhdGVNYXRjaCkge1xyXG4gICAgICAgICAgICBzdGF0ZVJlc3BvbnNlLnJlcXVlc3RUeXBlID0gd2luZG93LnJlcXVlc3RUeXBlO1xyXG4gICAgICAgICAgICB2YXIgc3RhdGVzSW5QYXJlbnRDb250ZXh0ID0gd2luZG93LnJlbmV3U3RhdGVzO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YXRlc0luUGFyZW50Q29udGV4dC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlc0luUGFyZW50Q29udGV4dFtpXSA9PT0gc3RhdGVSZXNwb25zZS5zdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXRlUmVzcG9uc2Uuc3RhdGVNYXRjaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlUmVzcG9uc2U7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICAvLyNyZWdpb24gVG9rZW4gUHJvY2Vzc2luZyAoRXh0cmFjdCB0byBUb2tlblByb2Nlc3NpbmcudHMpXHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFVzZWQgdG8gZ2V0IHRva2VuIGZvciB0aGUgc3BlY2lmaWVkIHNldCBvZiBzY29wZXMgZnJvbSB0aGUgY2FjaGVcclxuICAgICAqIEBwYXJhbSB7QGxpbmsgU2VydmVyUmVxdWVzdFBhcmFtZXRlcnN9IC0gUmVxdWVzdCBzZW50IHRvIHRoZSBTVFMgdG8gb2J0YWluIGFuIGlkX3Rva2VuL2FjY2Vzc190b2tlblxyXG4gICAgICogQHBhcmFtIHtBY2NvdW50fSBhY2NvdW50IC0gQWNjb3VudCBmb3Igd2hpY2ggdGhlIHNjb3BlcyB3ZXJlIHJlcXVlc3RlZFxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0Q2FjaGVkVG9rZW4gPSBmdW5jdGlvbiAoc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LCBhY2NvdW50KSB7XHJcbiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuQ2FjaGVJdGVtID0gbnVsbDtcclxuICAgICAgICB2YXIgc2NvcGVzID0gc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LnNjb3BlcztcclxuICAgICAgICAvLyBmaWx0ZXIgYnkgY2xpZW50SWQgYW5kIGFjY291bnRcclxuICAgICAgICB2YXIgdG9rZW5DYWNoZUl0ZW1zID0gdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0QWxsQWNjZXNzVG9rZW5zKHRoaXMuY2xpZW50SWQsIGFjY291bnQgPyBhY2NvdW50LmhvbWVBY2NvdW50SWRlbnRpZmllciA6IG51bGwpO1xyXG4gICAgICAgIC8vIE5vIG1hdGNoIGZvdW5kIGFmdGVyIGluaXRpYWwgZmlsdGVyaW5nXHJcbiAgICAgICAgaWYgKHRva2VuQ2FjaGVJdGVtcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBmaWx0ZXJlZEl0ZW1zID0gW107XHJcbiAgICAgICAgLy8gaWYgbm8gYXV0aG9yaXR5IHBhc3NlZFxyXG4gICAgICAgIGlmICghc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LmF1dGhvcml0eSkge1xyXG4gICAgICAgICAgICAvLyBmaWx0ZXIgYnkgc2NvcGVcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbkNhY2hlSXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjYWNoZUl0ZW0gPSB0b2tlbkNhY2hlSXRlbXNbaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgY2FjaGVkU2NvcGVzID0gY2FjaGVJdGVtLmtleS5zY29wZXMuc3BsaXQoXCIgXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKFNjb3BlU2V0LmNvbnRhaW5zU2NvcGUoY2FjaGVkU2NvcGVzLCBzY29wZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRJdGVtcy5wdXNoKGNhY2hlSXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gaWYgb25seSBvbmUgY2FjaGVkIHRva2VuIGZvdW5kXHJcbiAgICAgICAgICAgIGlmIChmaWx0ZXJlZEl0ZW1zLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW5DYWNoZUl0ZW0gPSBmaWx0ZXJlZEl0ZW1zWzBdO1xyXG4gICAgICAgICAgICAgICAgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LmF1dGhvcml0eUluc3RhbmNlID0gQXV0aG9yaXR5RmFjdG9yeS5DcmVhdGVJbnN0YW5jZShhY2Nlc3NUb2tlbkNhY2hlSXRlbS5rZXkuYXV0aG9yaXR5LCB0aGlzLmNvbmZpZy5hdXRoLnZhbGlkYXRlQXV0aG9yaXR5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpZiBtb3JlIHRoYW4gb25lIGNhY2hlZCB0b2tlbiBpcyBmb3VuZFxyXG4gICAgICAgICAgICBlbHNlIGlmIChmaWx0ZXJlZEl0ZW1zLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IENsaWVudEF1dGhFcnJvci5jcmVhdGVNdWx0aXBsZU1hdGNoaW5nVG9rZW5zSW5DYWNoZUVycm9yKHNjb3Blcy50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpZiBubyBtYXRjaCBmb3VuZCwgY2hlY2sgaWYgdGhlcmUgd2FzIGEgc2luZ2xlIGF1dGhvcml0eSB1c2VkXHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGF1dGhvcml0eUxpc3QgPSB0aGlzLmdldFVuaXF1ZUF1dGhvcml0eSh0b2tlbkNhY2hlSXRlbXMsIFwiYXV0aG9yaXR5XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGF1dGhvcml0eUxpc3QubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IENsaWVudEF1dGhFcnJvci5jcmVhdGVNdWx0aXBsZUF1dGhvcml0aWVzSW5DYWNoZUVycm9yKHNjb3Blcy50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5hdXRob3JpdHlJbnN0YW5jZSA9IEF1dGhvcml0eUZhY3RvcnkuQ3JlYXRlSW5zdGFuY2UoYXV0aG9yaXR5TGlzdFswXSwgdGhpcy5jb25maWcuYXV0aC52YWxpZGF0ZUF1dGhvcml0eSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgYW4gYXV0aG9yaXR5IGlzIHBhc3NlZCBpbiB0aGUgQVBJXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGZpbHRlciBieSBhdXRob3JpdHkgYW5kIHNjb3BlXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9rZW5DYWNoZUl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2FjaGVJdGVtID0gdG9rZW5DYWNoZUl0ZW1zW2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhY2hlZFNjb3BlcyA9IGNhY2hlSXRlbS5rZXkuc2NvcGVzLnNwbGl0KFwiIFwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChTY29wZVNldC5jb250YWluc1Njb3BlKGNhY2hlZFNjb3Blcywgc2NvcGVzKSAmJiBVcmxVdGlscy5DYW5vbmljYWxpemVVcmkoY2FjaGVJdGVtLmtleS5hdXRob3JpdHkpID09PSBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QuYXV0aG9yaXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyZWRJdGVtcy5wdXNoKGNhY2hlSXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gbm8gbWF0Y2hcclxuICAgICAgICAgICAgaWYgKGZpbHRlcmVkSXRlbXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpZiBvbmx5IG9uZSBjYWNoZWRUb2tlbiBGb3VuZFxyXG4gICAgICAgICAgICBlbHNlIGlmIChmaWx0ZXJlZEl0ZW1zLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgYWNjZXNzVG9rZW5DYWNoZUl0ZW0gPSBmaWx0ZXJlZEl0ZW1zWzBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gaWYgbW9yZSB0aGFuIGNhY2hlZCB0b2tlbiBpcyBmb3VuZFxyXG4gICAgICAgICAgICAgICAgdGhyb3cgQ2xpZW50QXV0aEVycm9yLmNyZWF0ZU11bHRpcGxlTWF0Y2hpbmdUb2tlbnNJbkNhY2hlRXJyb3Ioc2NvcGVzLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhY2Nlc3NUb2tlbkNhY2hlSXRlbSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIHZhciBleHBpcmVkID0gTnVtYmVyKGFjY2Vzc1Rva2VuQ2FjaGVJdGVtLnZhbHVlLmV4cGlyZXNJbik7XHJcbiAgICAgICAgICAgIC8vIElmIGV4cGlyYXRpb24gaXMgd2l0aGluIG9mZnNldCwgaXQgd2lsbCBmb3JjZSByZW5ld1xyXG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gdGhpcy5jb25maWcuc3lzdGVtLnRva2VuUmVuZXdhbE9mZnNldFNlY29uZHMgfHwgMzAwO1xyXG4gICAgICAgICAgICBpZiAoZXhwaXJlZCAmJiAoZXhwaXJlZCA+IFRpbWVVdGlscy5ub3coKSArIG9mZnNldCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZFRva2VuT2JqID0gbmV3IElkVG9rZW4oYWNjZXNzVG9rZW5DYWNoZUl0ZW0udmFsdWUuaWRUb2tlbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWFjY291bnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhY2NvdW50ID0gdGhpcy5nZXRBY2NvdW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhY2NvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IEF1dGhFcnJvci5jcmVhdGVVbmV4cGVjdGVkRXJyb3IoXCJBY2NvdW50IHNob3VsZCBub3QgYmUgbnVsbCBoZXJlLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgYVN0YXRlID0gdGhpcy5nZXRBY2NvdW50U3RhdGUoc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LnN0YXRlKTtcclxuICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICB1bmlxdWVJZDogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICB0ZW5hbnRJZDogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICB0b2tlblR5cGU6IChhY2Nlc3NUb2tlbkNhY2hlSXRlbS52YWx1ZS5pZFRva2VuID09PSBhY2Nlc3NUb2tlbkNhY2hlSXRlbS52YWx1ZS5hY2Nlc3NUb2tlbikgPyBDb25zdGFudHMuaWRUb2tlbiA6IENvbnN0YW50cy5hY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgICAgICAgICBpZFRva2VuOiBpZFRva2VuT2JqLFxyXG4gICAgICAgICAgICAgICAgICAgIGlkVG9rZW5DbGFpbXM6IGlkVG9rZW5PYmouY2xhaW1zLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlbkNhY2hlSXRlbS52YWx1ZS5hY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgICAgICAgICBzY29wZXM6IGFjY2Vzc1Rva2VuQ2FjaGVJdGVtLmtleS5zY29wZXMuc3BsaXQoXCIgXCIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGV4cGlyZXNPbjogbmV3IERhdGUoZXhwaXJlZCAqIDEwMDApLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjY291bnQ6IGFjY291bnQsXHJcbiAgICAgICAgICAgICAgICAgICAgYWNjb3VudFN0YXRlOiBhU3RhdGUsXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgUmVzcG9uc2VVdGlscy5zZXRSZXNwb25zZUlkVG9rZW4ocmVzcG9uc2UsIGlkVG9rZW5PYmopO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2UucmVtb3ZlSXRlbShKU09OLnN0cmluZ2lmeShmaWx0ZXJlZEl0ZW1zWzBdLmtleSkpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFVzZWQgdG8gZ2V0IGEgdW5pcXVlIGxpc3Qgb2YgYXV0aG9yaXR1ZXMgZnJvbSB0aGUgY2FjaGVcclxuICAgICAqIEBwYXJhbSB7QXJyYXk8QWNjZXNzVG9rZW5DYWNoZUl0ZW0+fSAgYWNjZXNzVG9rZW5DYWNoZUl0ZW1zIC0gYWNjZXNzVG9rZW5DYWNoZUl0ZW1zIHNhdmVkIGluIHRoZSBjYWNoZVxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0VW5pcXVlQXV0aG9yaXR5ID0gZnVuY3Rpb24gKGFjY2Vzc1Rva2VuQ2FjaGVJdGVtcywgcHJvcGVydHkpIHtcclxuICAgICAgICB2YXIgYXV0aG9yaXR5TGlzdCA9IFtdO1xyXG4gICAgICAgIHZhciBmbGFncyA9IFtdO1xyXG4gICAgICAgIGFjY2Vzc1Rva2VuQ2FjaGVJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50LmtleS5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eSkgJiYgKGZsYWdzLmluZGV4T2YoZWxlbWVudC5rZXlbcHJvcGVydHldKSA9PT0gLTEpKSB7XHJcbiAgICAgICAgICAgICAgICBmbGFncy5wdXNoKGVsZW1lbnQua2V5W3Byb3BlcnR5XSk7XHJcbiAgICAgICAgICAgICAgICBhdXRob3JpdHlMaXN0LnB1c2goZWxlbWVudC5rZXlbcHJvcGVydHldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBhdXRob3JpdHlMaXN0O1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQ2hlY2sgaWYgQURBTCBpZF90b2tlbiBleGlzdHMgYW5kIHJldHVybiBpZiBleGlzdHMuXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZXh0cmFjdEFEQUxJZFRva2VuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBhZGFsSWRUb2tlbiA9IHRoaXMuY2FjaGVTdG9yYWdlLmdldEl0ZW0oQ29uc3RhbnRzLmFkYWxJZFRva2VuKTtcclxuICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYWRhbElkVG9rZW4pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBUb2tlblV0aWxzLmV4dHJhY3RJZFRva2VuKGFkYWxJZFRva2VuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBBY3F1aXJlcyBhY2Nlc3MgdG9rZW4gdXNpbmcgYSBoaWRkZW4gaWZyYW1lLlxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUucmVuZXdUb2tlbiA9IGZ1bmN0aW9uIChzY29wZXMsIHJlc29sdmUsIHJlamVjdCwgYWNjb3VudCwgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0KSB7XHJcbiAgICAgICAgdmFyIHNjb3BlID0gc2NvcGVzLmpvaW4oXCIgXCIpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIudmVyYm9zZShcInJlbmV3VG9rZW4gaXMgY2FsbGVkIGZvciBzY29wZTpcIiArIHNjb3BlKTtcclxuICAgICAgICB2YXIgZnJhbWVIYW5kbGUgPSB0aGlzLmFkZEhpZGRlbklGcmFtZShcIm1zYWxSZW5ld0ZyYW1lXCIgKyBzY29wZSk7XHJcbiAgICAgICAgdGhpcy51cGRhdGVDYWNoZUVudHJpZXMoc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LCBhY2NvdW50KTtcclxuICAgICAgICB0aGlzLmxvZ2dlci52ZXJib3NlKFwiUmVuZXcgdG9rZW4gRXhwZWN0ZWQgc3RhdGU6IFwiICsgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LnN0YXRlKTtcclxuICAgICAgICAvLyBCdWlsZCB1cmxOYXZpZ2F0ZSB3aXRoIFwicHJvbXB0PW5vbmVcIiBhbmQgbmF2aWdhdGUgdG8gVVJMIGluIGhpZGRlbiBpRnJhbWVcclxuICAgICAgICB2YXIgdXJsTmF2aWdhdGUgPSBVcmxVdGlscy51cmxSZW1vdmVRdWVyeVN0cmluZ1BhcmFtZXRlcihVcmxVdGlscy5jcmVhdGVOYXZpZ2F0ZVVybChzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QpLCBDb25zdGFudHMucHJvbXB0KSArIENvbnN0YW50cy5wcm9tcHRfbm9uZTtcclxuICAgICAgICB3aW5kb3cucmVuZXdTdGF0ZXMucHVzaChzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3Quc3RhdGUpO1xyXG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0VHlwZSA9IENvbnN0YW50cy5yZW5ld1Rva2VuO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJDYWxsYmFjayhzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3Quc3RhdGUsIHNjb3BlLCByZXNvbHZlLCByZWplY3QpO1xyXG4gICAgICAgIHRoaXMubG9nZ2VyLmluZm9QaWkoXCJOYXZpZ2F0ZSB0bzpcIiArIHVybE5hdmlnYXRlKTtcclxuICAgICAgICBmcmFtZUhhbmRsZS5zcmMgPSBcImFib3V0OmJsYW5rXCI7XHJcbiAgICAgICAgdGhpcy5sb2FkSWZyYW1lVGltZW91dCh1cmxOYXZpZ2F0ZSwgXCJtc2FsUmVuZXdGcmFtZVwiICsgc2NvcGUsIHNjb3BlKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFJlbmV3cyBpZHRva2VuIGZvciBhcHBcInMgb3duIGJhY2tlbmQgd2hlbiBjbGllbnRJZCBpcyBwYXNzZWQgYXMgYSBzaW5nbGUgc2NvcGUgaW4gdGhlIHNjb3BlcyBhcnJheS5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLnJlbmV3SWRUb2tlbiA9IGZ1bmN0aW9uIChzY29wZXMsIHJlc29sdmUsIHJlamVjdCwgYWNjb3VudCwgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0KSB7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcInJlbmV3aWRUb2tlbiBpcyBjYWxsZWRcIik7XHJcbiAgICAgICAgdmFyIGZyYW1lSGFuZGxlID0gdGhpcy5hZGRIaWRkZW5JRnJhbWUoXCJtc2FsSWRUb2tlbkZyYW1lXCIpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlQ2FjaGVFbnRyaWVzKHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdCwgYWNjb3VudCk7XHJcbiAgICAgICAgdGhpcy5sb2dnZXIudmVyYm9zZShcIlJlbmV3IElkdG9rZW4gRXhwZWN0ZWQgc3RhdGU6IFwiICsgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LnN0YXRlKTtcclxuICAgICAgICAvLyBCdWlsZCB1cmxOYXZpZ2F0ZSB3aXRoIFwicHJvbXB0PW5vbmVcIiBhbmQgbmF2aWdhdGUgdG8gVVJMIGluIGhpZGRlbiBpRnJhbWVcclxuICAgICAgICB2YXIgdXJsTmF2aWdhdGUgPSBVcmxVdGlscy51cmxSZW1vdmVRdWVyeVN0cmluZ1BhcmFtZXRlcihVcmxVdGlscy5jcmVhdGVOYXZpZ2F0ZVVybChzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QpLCBDb25zdGFudHMucHJvbXB0KSArIENvbnN0YW50cy5wcm9tcHRfbm9uZTtcclxuICAgICAgICBpZiAodGhpcy5zaWxlbnRMb2dpbikge1xyXG4gICAgICAgICAgICB3aW5kb3cucmVxdWVzdFR5cGUgPSBDb25zdGFudHMubG9naW47XHJcbiAgICAgICAgICAgIHRoaXMuc2lsZW50QXV0aGVudGljYXRpb25TdGF0ZSA9IHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5zdGF0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0VHlwZSA9IENvbnN0YW50cy5yZW5ld1Rva2VuO1xyXG4gICAgICAgICAgICB3aW5kb3cucmVuZXdTdGF0ZXMucHVzaChzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3Quc3RhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBub3RlOiBzY29wZSBoZXJlIGlzIGNsaWVudElkXHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckNhbGxiYWNrKHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5zdGF0ZSwgdGhpcy5jbGllbnRJZCwgcmVzb2x2ZSwgcmVqZWN0KTtcclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvUGlpKFwiTmF2aWdhdGUgdG86XCIgKyB1cmxOYXZpZ2F0ZSk7XHJcbiAgICAgICAgZnJhbWVIYW5kbGUuc3JjID0gXCJhYm91dDpibGFua1wiO1xyXG4gICAgICAgIHRoaXMubG9hZElmcmFtZVRpbWVvdXQodXJsTmF2aWdhdGUsIFwibXNhbElkVG9rZW5GcmFtZVwiLCB0aGlzLmNsaWVudElkKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqXHJcbiAgICAgKiBUaGlzIG1ldGhvZCBtdXN0IGJlIGNhbGxlZCBmb3IgcHJvY2Vzc2luZyB0aGUgcmVzcG9uc2UgcmVjZWl2ZWQgZnJvbSBBQUQuIEl0IGV4dHJhY3RzIHRoZSBoYXNoLCBwcm9jZXNzZXMgdGhlIHRva2VuIG9yIGVycm9yLCBzYXZlcyBpdCBpbiB0aGUgY2FjaGUgYW5kIGNhbGxzIHRoZSByZWdpc3RlcmVkIGNhbGxiYWNrcyB3aXRoIHRoZSByZXN1bHQuXHJcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gYXV0aG9yaXR5IGF1dGhvcml0eSByZWNlaXZlZCBpbiB0aGUgcmVkaXJlY3QgcmVzcG9uc2UgZnJvbSBBQUQuXHJcbiAgICAgKiBAcGFyYW0ge1Rva2VuUmVzcG9uc2V9IHJlcXVlc3RJbmZvIGFuIG9iamVjdCBjcmVhdGVkIGZyb20gdGhlIHJlZGlyZWN0IHJlc3BvbnNlIGZyb20gQUFEIGNvbXByaXNpbmcgb2YgdGhlIGtleXMgLSBwYXJhbWV0ZXJzLCByZXF1ZXN0VHlwZSwgc3RhdGVNYXRjaCwgc3RhdGVSZXNwb25zZSBhbmQgdmFsaWQuXHJcbiAgICAgKiBAcGFyYW0ge0FjY291bnR9IGFjY291bnQgYWNjb3VudCBvYmplY3QgZm9yIHdoaWNoIHNjb3BlcyBhcmUgY29uc2VudGVkIGZvci4gVGhlIGRlZmF1bHQgYWNjb3VudCBpcyB0aGUgbG9nZ2VkIGluIGFjY291bnQuXHJcbiAgICAgKiBAcGFyYW0ge0NsaWVudEluZm99IGNsaWVudEluZm8gY2xpZW50SW5mbyByZWNlaXZlZCBhcyBwYXJ0IG9mIHRoZSByZXNwb25zZSBjb21wcmlzaW5nIG9mIGZpZWxkcyB1aWQgYW5kIHV0aWQuXHJcbiAgICAgKiBAcGFyYW0ge0lkVG9rZW59IGlkVG9rZW4gaWRUb2tlbiByZWNlaXZlZCBhcyBwYXJ0IG9mIHRoZSByZXNwb25zZS5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIEBwcml2YXRlXHJcbiAgICAgKi9cclxuICAgIC8qIHRzbGludDpkaXNhYmxlOm5vLXN0cmluZy1saXRlcmFsICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuc2F2ZUFjY2Vzc1Rva2VuID0gZnVuY3Rpb24gKHJlc3BvbnNlLCBhdXRob3JpdHksIHBhcmFtZXRlcnMsIGNsaWVudEluZm8sIGlkVG9rZW5PYmopIHtcclxuICAgICAgICB2YXIgc2NvcGU7XHJcbiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuUmVzcG9uc2UgPSB0c2xpYl8xLl9fYXNzaWduKHt9LCByZXNwb25zZSk7XHJcbiAgICAgICAgdmFyIGNsaWVudE9iaiA9IG5ldyBDbGllbnRJbmZvKGNsaWVudEluZm8pO1xyXG4gICAgICAgIHZhciBleHBpcmF0aW9uO1xyXG4gICAgICAgIC8vIGlmIHRoZSByZXNwb25zZSBjb250YWlucyBcInNjb3BlXCJcclxuICAgICAgICBpZiAocGFyYW1ldGVycy5oYXNPd25Qcm9wZXJ0eShcInNjb3BlXCIpKSB7XHJcbiAgICAgICAgICAgIC8vIHJlYWQgdGhlIHNjb3Blc1xyXG4gICAgICAgICAgICBzY29wZSA9IHBhcmFtZXRlcnNbXCJzY29wZVwiXTtcclxuICAgICAgICAgICAgdmFyIGNvbnNlbnRlZFNjb3BlcyA9IHNjb3BlLnNwbGl0KFwiIFwiKTtcclxuICAgICAgICAgICAgLy8gcmV0cmlldmUgYWxsIGFjY2VzcyB0b2tlbnMgZnJvbSB0aGUgY2FjaGUsIHJlbW92ZSB0aGUgZHVwIHNjb3Jlc1xyXG4gICAgICAgICAgICB2YXIgYWNjZXNzVG9rZW5DYWNoZUl0ZW1zID0gdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0QWxsQWNjZXNzVG9rZW5zKHRoaXMuY2xpZW50SWQsIGF1dGhvcml0eSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYWNjZXNzVG9rZW5DYWNoZUl0ZW1zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWNjZXNzVG9rZW5DYWNoZUl0ZW0gPSBhY2Nlc3NUb2tlbkNhY2hlSXRlbXNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW5DYWNoZUl0ZW0ua2V5LmhvbWVBY2NvdW50SWRlbnRpZmllciA9PT0gcmVzcG9uc2UuYWNjb3VudC5ob21lQWNjb3VudElkZW50aWZpZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FjaGVkU2NvcGVzID0gYWNjZXNzVG9rZW5DYWNoZUl0ZW0ua2V5LnNjb3Blcy5zcGxpdChcIiBcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFNjb3BlU2V0LmlzSW50ZXJzZWN0aW5nU2NvcGVzKGNhY2hlZFNjb3BlcywgY29uc2VudGVkU2NvcGVzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5yZW1vdmVJdGVtKEpTT04uc3RyaW5naWZ5KGFjY2Vzc1Rva2VuQ2FjaGVJdGVtLmtleSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBHZW5lcmF0ZSBhbmQgY2FjaGUgYWNjZXNzVG9rZW5LZXkgYW5kIGFjY2Vzc1Rva2VuVmFsdWVcclxuICAgICAgICAgICAgdmFyIGV4cGlyZXNJbiA9IFRpbWVVdGlscy5wYXJzZUV4cGlyZXNJbihwYXJhbWV0ZXJzW0NvbnN0YW50cy5leHBpcmVzSW5dKTtcclxuICAgICAgICAgICAgZXhwaXJhdGlvbiA9IFRpbWVVdGlscy5ub3coKSArIGV4cGlyZXNJbjtcclxuICAgICAgICAgICAgdmFyIGFjY2Vzc1Rva2VuS2V5ID0gbmV3IEFjY2Vzc1Rva2VuS2V5KGF1dGhvcml0eSwgdGhpcy5jbGllbnRJZCwgc2NvcGUsIGNsaWVudE9iai51aWQsIGNsaWVudE9iai51dGlkKTtcclxuICAgICAgICAgICAgdmFyIGFjY2Vzc1Rva2VuVmFsdWUgPSBuZXcgQWNjZXNzVG9rZW5WYWx1ZShwYXJhbWV0ZXJzW0NvbnN0YW50cy5hY2Nlc3NUb2tlbl0sIGlkVG9rZW5PYmoucmF3SWRUb2tlbiwgZXhwaXJhdGlvbi50b1N0cmluZygpLCBjbGllbnRJbmZvKTtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShKU09OLnN0cmluZ2lmeShhY2Nlc3NUb2tlbktleSksIEpTT04uc3RyaW5naWZ5KGFjY2Vzc1Rva2VuVmFsdWUpKTtcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW5SZXNwb25zZS5hY2Nlc3NUb2tlbiA9IHBhcmFtZXRlcnNbQ29uc3RhbnRzLmFjY2Vzc1Rva2VuXTtcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW5SZXNwb25zZS5zY29wZXMgPSBjb25zZW50ZWRTY29wZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGlmIHRoZSByZXNwb25zZSBkb2VzIG5vdCBjb250YWluIFwic2NvcGVcIiAtIHNjb3BlIGlzIHVzdWFsbHkgY2xpZW50X2lkIGFuZCB0aGUgdG9rZW4gd2lsbCBiZSBpZF90b2tlblxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzY29wZSA9IHRoaXMuY2xpZW50SWQ7XHJcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGFuZCBjYWNoZSBhY2Nlc3NUb2tlbktleSBhbmQgYWNjZXNzVG9rZW5WYWx1ZVxyXG4gICAgICAgICAgICB2YXIgYWNjZXNzVG9rZW5LZXkgPSBuZXcgQWNjZXNzVG9rZW5LZXkoYXV0aG9yaXR5LCB0aGlzLmNsaWVudElkLCBzY29wZSwgY2xpZW50T2JqLnVpZCwgY2xpZW50T2JqLnV0aWQpO1xyXG4gICAgICAgICAgICBleHBpcmF0aW9uID0gTnVtYmVyKGlkVG9rZW5PYmouZXhwaXJhdGlvbik7XHJcbiAgICAgICAgICAgIHZhciBhY2Nlc3NUb2tlblZhbHVlID0gbmV3IEFjY2Vzc1Rva2VuVmFsdWUocGFyYW1ldGVyc1tDb25zdGFudHMuaWRUb2tlbl0sIHBhcmFtZXRlcnNbQ29uc3RhbnRzLmlkVG9rZW5dLCBleHBpcmF0aW9uLnRvU3RyaW5nKCksIGNsaWVudEluZm8pO1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKEpTT04uc3RyaW5naWZ5KGFjY2Vzc1Rva2VuS2V5KSwgSlNPTi5zdHJpbmdpZnkoYWNjZXNzVG9rZW5WYWx1ZSkpO1xyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlblJlc3BvbnNlLnNjb3BlcyA9IFtzY29wZV07XHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuUmVzcG9uc2UuYWNjZXNzVG9rZW4gPSBwYXJhbWV0ZXJzW0NvbnN0YW50cy5pZFRva2VuXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV4cGlyYXRpb24pIHtcclxuICAgICAgICAgICAgYWNjZXNzVG9rZW5SZXNwb25zZS5leHBpcmVzT24gPSBuZXcgRGF0ZShleHBpcmF0aW9uICogMTAwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIkNvdWxkIG5vdCBwYXJzZSBleHBpcmVzSW4gcGFyYW1ldGVyXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYWNjZXNzVG9rZW5SZXNwb25zZTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIFNhdmVzIHRva2VuIG9yIGVycm9yIHJlY2VpdmVkIGluIHRoZSByZXNwb25zZSBmcm9tIEFBRCBpbiB0aGUgY2FjaGUuIEluIGNhc2Ugb2YgaWRfdG9rZW4sIGl0IGFsc28gY3JlYXRlcyB0aGUgYWNjb3VudCBvYmplY3QuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5zYXZlVG9rZW5Gcm9tSGFzaCA9IGZ1bmN0aW9uIChoYXNoLCBzdGF0ZUluZm8pIHtcclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFwiU3RhdGUgc3RhdHVzOlwiICsgc3RhdGVJbmZvLnN0YXRlTWF0Y2ggKyBcIjsgUmVxdWVzdCB0eXBlOlwiICsgc3RhdGVJbmZvLnJlcXVlc3RUeXBlKTtcclxuICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5tc2FsRXJyb3IsIFwiXCIpO1xyXG4gICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLm1zYWxFcnJvckRlc2NyaXB0aW9uLCBcIlwiKTtcclxuICAgICAgICB2YXIgcmVzcG9uc2UgPSB7XHJcbiAgICAgICAgICAgIHVuaXF1ZUlkOiBcIlwiLFxyXG4gICAgICAgICAgICB0ZW5hbnRJZDogXCJcIixcclxuICAgICAgICAgICAgdG9rZW5UeXBlOiBcIlwiLFxyXG4gICAgICAgICAgICBpZFRva2VuOiBudWxsLFxyXG4gICAgICAgICAgICBpZFRva2VuQ2xhaW1zOiBudWxsLFxyXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogbnVsbCxcclxuICAgICAgICAgICAgc2NvcGVzOiBbXSxcclxuICAgICAgICAgICAgZXhwaXJlc09uOiBudWxsLFxyXG4gICAgICAgICAgICBhY2NvdW50OiBudWxsLFxyXG4gICAgICAgICAgICBhY2NvdW50U3RhdGU6IFwiXCIsXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgZXJyb3I7XHJcbiAgICAgICAgdmFyIGhhc2hQYXJhbXMgPSB0aGlzLmRlc2VyaWFsaXplSGFzaChoYXNoKTtcclxuICAgICAgICB2YXIgYXV0aG9yaXR5S2V5ID0gXCJcIjtcclxuICAgICAgICB2YXIgYWNxdWlyZVRva2VuQWNjb3VudEtleSA9IFwiXCI7XHJcbiAgICAgICAgdmFyIGlkVG9rZW5PYmogPSBudWxsO1xyXG4gICAgICAgIC8vIElmIHNlcnZlciByZXR1cm5zIGFuIGVycm9yXHJcbiAgICAgICAgaWYgKGhhc2hQYXJhbXMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLmVycm9yRGVzY3JpcHRpb24pIHx8IGhhc2hQYXJhbXMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLmVycm9yKSkge1xyXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvUGlpKFwiRXJyb3IgOlwiICsgaGFzaFBhcmFtc1tDb25zdGFudHMuZXJyb3JdICsgXCI7IEVycm9yIGRlc2NyaXB0aW9uOlwiICsgaGFzaFBhcmFtc1tDb25zdGFudHMuZXJyb3JEZXNjcmlwdGlvbl0pO1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5tc2FsRXJyb3IsIGhhc2hQYXJhbXNbQ29uc3RhbnRzLmVycm9yXSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLm1zYWxFcnJvckRlc2NyaXB0aW9uLCBoYXNoUGFyYW1zW0NvbnN0YW50cy5lcnJvckRlc2NyaXB0aW9uXSk7XHJcbiAgICAgICAgICAgIC8vIGxvZ2luXHJcbiAgICAgICAgICAgIGlmIChzdGF0ZUluZm8ucmVxdWVzdFR5cGUgPT09IENvbnN0YW50cy5sb2dpbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dpbkluUHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLmxvZ2luRXJyb3IsIGhhc2hQYXJhbXNbQ29uc3RhbnRzLmVycm9yRGVzY3JpcHRpb25dICsgXCI6XCIgKyBoYXNoUGFyYW1zW0NvbnN0YW50cy5lcnJvcl0pO1xyXG4gICAgICAgICAgICAgICAgYXV0aG9yaXR5S2V5ID0gU3RvcmFnZS5nZW5lcmF0ZUF1dGhvcml0eUtleShzdGF0ZUluZm8uc3RhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGFjcXVpcmVUb2tlblxyXG4gICAgICAgICAgICBpZiAoc3RhdGVJbmZvLnJlcXVlc3RUeXBlID09PSBDb25zdGFudHMucmVuZXdUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hY3F1aXJlVG9rZW5JblByb2dyZXNzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBhdXRob3JpdHlLZXkgPSBTdG9yYWdlLmdlbmVyYXRlQXV0aG9yaXR5S2V5KHN0YXRlSW5mby5zdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWNjb3VudCA9IHRoaXMuZ2V0QWNjb3VudCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjY291bnRJZCA9IHZvaWQgMDtcclxuICAgICAgICAgICAgICAgIGlmIChhY2NvdW50ICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KGFjY291bnQuaG9tZUFjY291bnRJZGVudGlmaWVyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFjY291bnRJZCA9IGFjY291bnQuaG9tZUFjY291bnRJZGVudGlmaWVyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWNjb3VudElkID0gQ29uc3RhbnRzLm5vX2FjY291bnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhY3F1aXJlVG9rZW5BY2NvdW50S2V5ID0gU3RvcmFnZS5nZW5lcmF0ZUFjcXVpcmVUb2tlbkFjY291bnRLZXkoYWNjb3VudElkLCBzdGF0ZUluZm8uc3RhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBfYSA9IENvbnN0YW50cy5lcnJvciwgaGFzaEVyciA9IGhhc2hQYXJhbXNbX2FdLCBfYiA9IENvbnN0YW50cy5lcnJvckRlc2NyaXB0aW9uLCBoYXNoRXJyRGVzYyA9IGhhc2hQYXJhbXNbX2JdO1xyXG4gICAgICAgICAgICBpZiAoSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvci5pc0ludGVyYWN0aW9uUmVxdWlyZWRFcnJvcihoYXNoRXJyKSB8fFxyXG4gICAgICAgICAgICAgICAgSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvci5pc0ludGVyYWN0aW9uUmVxdWlyZWRFcnJvcihoYXNoRXJyRGVzYykpIHtcclxuICAgICAgICAgICAgICAgIGVycm9yID0gbmV3IEludGVyYWN0aW9uUmVxdWlyZWRBdXRoRXJyb3IoaGFzaFBhcmFtc1tDb25zdGFudHMuZXJyb3JdLCBoYXNoUGFyYW1zW0NvbnN0YW50cy5lcnJvckRlc2NyaXB0aW9uXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlcnJvciA9IG5ldyBTZXJ2ZXJFcnJvcihoYXNoUGFyYW1zW0NvbnN0YW50cy5lcnJvcl0sIGhhc2hQYXJhbXNbQ29uc3RhbnRzLmVycm9yRGVzY3JpcHRpb25dKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBJZiB0aGUgc2VydmVyIHJldHVybnMgXCJTdWNjZXNzXCJcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gVmVyaWZ5IHRoZSBzdGF0ZSBmcm9tIHJlZGlyZWN0IGFuZCByZWNvcmQgdG9rZW5zIHRvIHN0b3JhZ2UgaWYgZXhpc3RzXHJcbiAgICAgICAgICAgIGlmIChzdGF0ZUluZm8uc3RhdGVNYXRjaCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIlN0YXRlIGlzIHJpZ2h0XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGhhc2hQYXJhbXMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLnNlc3Npb25TdGF0ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5tc2FsU2Vzc2lvblN0YXRlLCBoYXNoUGFyYW1zW0NvbnN0YW50cy5zZXNzaW9uU3RhdGVdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlLmFjY291bnRTdGF0ZSA9IHRoaXMuZ2V0QWNjb3VudFN0YXRlKHN0YXRlSW5mby5zdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2xpZW50SW5mbyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFjY2Vzc190b2tlblxyXG4gICAgICAgICAgICAgICAgaWYgKGhhc2hQYXJhbXMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLmFjY2Vzc1Rva2VuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oXCJGcmFnbWVudCBoYXMgYWNjZXNzIHRva2VuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWNxdWlyZVRva2VuSW5Qcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJldHJpZXZlIHRoZSBpZF90b2tlbiBmcm9tIHJlc3BvbnNlIGlmIHByZXNlbnRcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzaFBhcmFtcy5oYXNPd25Qcm9wZXJ0eShDb25zdGFudHMuaWRUb2tlbikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWRUb2tlbk9iaiA9IG5ldyBJZFRva2VuKGhhc2hQYXJhbXNbQ29uc3RhbnRzLmlkVG9rZW5dKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuaWRUb2tlbiA9IGlkVG9rZW5PYmo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmlkVG9rZW5DbGFpbXMgPSBpZFRva2VuT2JqLmNsYWltcztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkVG9rZW5PYmogPSBuZXcgSWRUb2tlbih0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5pZFRva2VuS2V5KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gUmVzcG9uc2VVdGlscy5zZXRSZXNwb25zZUlkVG9rZW4ocmVzcG9uc2UsIGlkVG9rZW5PYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyByZXRyaWV2ZSB0aGUgYXV0aG9yaXR5IGZyb20gY2FjaGUgYW5kIHJlcGxhY2Ugd2l0aCB0ZW5hbnRJRFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdXRob3JpdHlLZXlfMSA9IFN0b3JhZ2UuZ2VuZXJhdGVBdXRob3JpdHlLZXkoc3RhdGVJbmZvLnN0YXRlKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXV0aG9yaXR5ID0gdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShhdXRob3JpdHlLZXlfMSwgdGhpcy5pbkNvb2tpZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGF1dGhvcml0eSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yaXR5ID0gVXJsVXRpbHMucmVwbGFjZVRlbmFudFBhdGgoYXV0aG9yaXR5LCByZXNwb25zZS50ZW5hbnRJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHJldHJpZXZlIGNsaWVudF9pbmZvIC0gaWYgaXQgaXMgbm90IGZvdW5kLCBnZW5lcmF0ZSB0aGUgdWlkIGFuZCB1dGlkIGZyb20gaWRUb2tlblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChoYXNoUGFyYW1zLmhhc093blByb3BlcnR5KENvbnN0YW50cy5jbGllbnRJbmZvKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGllbnRJbmZvID0gaGFzaFBhcmFtc1tDb25zdGFudHMuY2xpZW50SW5mb107XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci53YXJuaW5nKFwiQ2xpZW50SW5mbyBub3QgcmVjZWl2ZWQgaW4gdGhlIHJlc3BvbnNlIGZyb20gQUFEXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBDbGllbnRBdXRoRXJyb3IuY3JlYXRlQ2xpZW50SW5mb05vdFBvcHVsYXRlZEVycm9yKFwiQ2xpZW50SW5mbyBub3QgcmVjZWl2ZWQgaW4gdGhlIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuYWNjb3VudCA9IEFjY291bnQuY3JlYXRlQWNjb3VudChpZFRva2VuT2JqLCBuZXcgQ2xpZW50SW5mbyhjbGllbnRJbmZvKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjY291bnRLZXkgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmFjY291bnQgJiYgIVN0cmluZ1V0aWxzLmlzRW1wdHkocmVzcG9uc2UuYWNjb3VudC5ob21lQWNjb3VudElkZW50aWZpZXIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRLZXkgPSByZXNwb25zZS5hY2NvdW50LmhvbWVBY2NvdW50SWRlbnRpZmllcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY291bnRLZXkgPSBDb25zdGFudHMubm9fYWNjb3VudDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYWNxdWlyZVRva2VuQWNjb3VudEtleSA9IFN0b3JhZ2UuZ2VuZXJhdGVBY3F1aXJlVG9rZW5BY2NvdW50S2V5KGFjY291bnRLZXksIHN0YXRlSW5mby5zdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjcXVpcmVUb2tlbkFjY291bnRLZXlfbm9hY2NvdW50ID0gU3RvcmFnZS5nZW5lcmF0ZUFjcXVpcmVUb2tlbkFjY291bnRLZXkoQ29uc3RhbnRzLm5vX2FjY291bnQsIHN0YXRlSW5mby5zdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhY2hlZEFjY291bnQgPSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKGFjcXVpcmVUb2tlbkFjY291bnRLZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhY3F1aXJlVG9rZW5BY2NvdW50ID0gdm9pZCAwO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIHdpdGggdGhlIGFjY291bnQgaW4gdGhlIENhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KGNhY2hlZEFjY291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjcXVpcmVUb2tlbkFjY291bnQgPSBKU09OLnBhcnNlKGNhY2hlZEFjY291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuYWNjb3VudCAmJiBhY3F1aXJlVG9rZW5BY2NvdW50ICYmIEFjY291bnQuY29tcGFyZUFjY291bnRzKHJlc3BvbnNlLmFjY291bnQsIGFjcXVpcmVUb2tlbkFjY291bnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHRoaXMuc2F2ZUFjY2Vzc1Rva2VuKHJlc3BvbnNlLCBhdXRob3JpdHksIGhhc2hQYXJhbXMsIGNsaWVudEluZm8sIGlkVG9rZW5PYmopO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIlRoZSB1c2VyIG9iamVjdCByZWNlaXZlZCBpbiB0aGUgcmVzcG9uc2UgaXMgdGhlIHNhbWUgYXMgdGhlIG9uZSBwYXNzZWQgaW4gdGhlIGFjcXVpcmVUb2tlbiByZXF1ZXN0XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIud2FybmluZyhcIlRoZSBhY2NvdW50IG9iamVjdCBjcmVhdGVkIGZyb20gdGhlIHJlc3BvbnNlIGlzIG5vdCB0aGUgc2FtZSBhcyB0aGUgb25lIHBhc3NlZCBpbiB0aGUgYWNxdWlyZVRva2VuIHJlcXVlc3RcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkodGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShhY3F1aXJlVG9rZW5BY2NvdW50S2V5X25vYWNjb3VudCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdGhpcy5zYXZlQWNjZXNzVG9rZW4ocmVzcG9uc2UsIGF1dGhvcml0eSwgaGFzaFBhcmFtcywgY2xpZW50SW5mbywgaWRUb2tlbk9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBpZF90b2tlblxyXG4gICAgICAgICAgICAgICAgaWYgKGhhc2hQYXJhbXMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLmlkVG9rZW4pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcIkZyYWdtZW50IGhhcyBpZCB0b2tlblwiKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyBsb2dpbiBubyBsb25nZXIgaW4gcHJvZ3Jlc3NcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2luSW5Qcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgaWRUb2tlblxyXG4gICAgICAgICAgICAgICAgICAgIGlkVG9rZW5PYmogPSBuZXcgSWRUb2tlbihoYXNoUGFyYW1zW0NvbnN0YW50cy5pZFRva2VuXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBSZXNwb25zZVV0aWxzLnNldFJlc3BvbnNlSWRUb2tlbihyZXNwb25zZSwgaWRUb2tlbk9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2hQYXJhbXMuaGFzT3duUHJvcGVydHkoQ29uc3RhbnRzLmNsaWVudEluZm8pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWVudEluZm8gPSBoYXNoUGFyYW1zW0NvbnN0YW50cy5jbGllbnRJbmZvXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLndhcm5pbmcoXCJDbGllbnRJbmZvIG5vdCByZWNlaXZlZCBpbiB0aGUgcmVzcG9uc2UgZnJvbSBBQURcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhvcml0eUtleSA9IFN0b3JhZ2UuZ2VuZXJhdGVBdXRob3JpdHlLZXkoc3RhdGVJbmZvLnN0YXRlKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXV0aG9yaXR5ID0gdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShhdXRob3JpdHlLZXksIHRoaXMuaW5Db29raWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghU3RyaW5nVXRpbHMuaXNFbXB0eShhdXRob3JpdHkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml0eSA9IFVybFV0aWxzLnJlcGxhY2VUZW5hbnRQYXRoKGF1dGhvcml0eSwgaWRUb2tlbk9iai50ZW5hbnRJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjb3VudCA9IEFjY291bnQuY3JlYXRlQWNjb3VudChpZFRva2VuT2JqLCBuZXcgQ2xpZW50SW5mbyhjbGllbnRJbmZvKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuYWNjb3VudCA9IHRoaXMuYWNjb3VudDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaWRUb2tlbk9iaiAmJiBpZFRva2VuT2JqLm5vbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIG5vbmNlIGludGVncml0eSBpZiBpZFRva2VuIGhhcyBub25jZSAtIHRocm93IGFuIGVycm9yIGlmIG5vdCBtYXRjaGVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZFRva2VuT2JqLm5vbmNlICE9PSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5ub25jZUlkVG9rZW4sIHRoaXMuaW5Db29raWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFjY291bnQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMubG9naW5FcnJvciwgXCJOb25jZSBNaXNtYXRjaC4gRXhwZWN0ZWQgTm9uY2U6IFwiICsgdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShDb25zdGFudHMubm9uY2VJZFRva2VuLCB0aGlzLmluQ29va2llKSArIFwiLFwiICsgXCJBY3R1YWwgTm9uY2U6IFwiICsgaWRUb2tlbk9iai5ub25jZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihcIk5vbmNlIE1pc21hdGNoLkV4cGVjdGVkIE5vbmNlOiBcIiArIHRoaXMuY2FjaGVTdG9yYWdlLmdldEl0ZW0oQ29uc3RhbnRzLm5vbmNlSWRUb2tlbiwgdGhpcy5pbkNvb2tpZSkgKyBcIixcIiArIFwiQWN0dWFsIE5vbmNlOiBcIiArIGlkVG9rZW5PYmoubm9uY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBDbGllbnRBdXRoRXJyb3IuY3JlYXRlTm9uY2VNaXNtYXRjaEVycm9yKHRoaXMuY2FjaGVTdG9yYWdlLmdldEl0ZW0oQ29uc3RhbnRzLm5vbmNlSWRUb2tlbiwgdGhpcy5pbkNvb2tpZSksIGlkVG9rZW5PYmoubm9uY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdGhlIHRva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMuaWRUb2tlbktleSwgaGFzaFBhcmFtc1tDb25zdGFudHMuaWRUb2tlbl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMubXNhbENsaWVudEluZm8sIGNsaWVudEluZm8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2F2ZSBpZFRva2VuIGFzIGFjY2VzcyB0b2tlbiBmb3IgYXBwIGl0c2VsZlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlQWNjZXNzVG9rZW4ocmVzcG9uc2UsIGF1dGhvcml0eSwgaGFzaFBhcmFtcywgY2xpZW50SW5mbywgaWRUb2tlbk9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml0eUtleSA9IHN0YXRlSW5mby5zdGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNxdWlyZVRva2VuQWNjb3VudEtleSA9IHN0YXRlSW5mby5zdGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXCJJbnZhbGlkIGlkX3Rva2VuIHJlY2VpdmVkIGluIHRoZSByZXNwb25zZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBDbGllbnRBdXRoRXJyb3IuY3JlYXRlSW52YWxpZElkVG9rZW5FcnJvcihpZFRva2VuT2JqKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMubXNhbEVycm9yLCBlcnJvci5lcnJvckNvZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5tc2FsRXJyb3JEZXNjcmlwdGlvbiwgZXJyb3IuZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gU3RhdGUgbWlzbWF0Y2ggLSB1bmV4cGVjdGVkL2ludmFsaWQgc3RhdGVcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhdXRob3JpdHlLZXkgPSBzdGF0ZUluZm8uc3RhdGU7XHJcbiAgICAgICAgICAgICAgICBhY3F1aXJlVG9rZW5BY2NvdW50S2V5ID0gc3RhdGVJbmZvLnN0YXRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGV4cGVjdGVkU3RhdGUgPSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5zdGF0ZUxvZ2luLCB0aGlzLmluQ29va2llKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKFwiU3RhdGUgTWlzbWF0Y2guRXhwZWN0ZWQgU3RhdGU6IFwiICsgZXhwZWN0ZWRTdGF0ZSArIFwiLFwiICsgXCJBY3R1YWwgU3RhdGU6IFwiICsgc3RhdGVJbmZvLnN0YXRlKTtcclxuICAgICAgICAgICAgICAgIGVycm9yID0gQ2xpZW50QXV0aEVycm9yLmNyZWF0ZUludmFsaWRTdGF0ZUVycm9yKHN0YXRlSW5mby5zdGF0ZSwgZXhwZWN0ZWRTdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5tc2FsRXJyb3IsIGVycm9yLmVycm9yQ29kZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5tc2FsRXJyb3JEZXNjcmlwdGlvbiwgZXJyb3IuZXJyb3JNZXNzYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5yZW5ld1N0YXR1cyArIHN0YXRlSW5mby5zdGF0ZSwgQ29uc3RhbnRzLnRva2VuUmVuZXdTdGF0dXNDb21wbGV0ZWQpO1xyXG4gICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnJlbW92ZUFjcXVpcmVUb2tlbkVudHJpZXMoc3RhdGVJbmZvLnN0YXRlKTtcclxuICAgICAgICAvLyB0aGlzIGlzIHJlcXVpcmVkIGlmIG5hdmlnYXRlVG9Mb2dpblJlcXVlc3RVcmw9ZmFsc2VcclxuICAgICAgICBpZiAodGhpcy5pbkNvb2tpZSkge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtQ29va2llKGF1dGhvcml0eUtleSwgXCJcIiwgLTEpO1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5jbGVhckNvb2tpZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghcmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdGhyb3cgQXV0aEVycm9yLmNyZWF0ZVVuZXhwZWN0ZWRFcnJvcihcIlJlc3BvbnNlIGlzIG51bGxcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH07XHJcbiAgICAvKiB0c2xpbnQ6ZW5hYmxlOm5vLXN0cmluZy1saXRlcmFsICovXHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIC8vI3JlZ2lvbiBBY2NvdW50XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHNpZ25lZCBpbiBhY2NvdW50XHJcbiAgICAgKiAodGhlIGFjY291bnQgb2JqZWN0IGlzIGNyZWF0ZWQgYXQgdGhlIHRpbWUgb2Ygc3VjY2Vzc2Z1bCBsb2dpbilcclxuICAgICAqIG9yIG51bGwgd2hlbiBubyBzdGF0ZSBpcyBmb3VuZFxyXG4gICAgICogQHJldHVybnMge0BsaW5rIEFjY291bnR9IC0gdGhlIGFjY291bnQgb2JqZWN0IHN0b3JlZCBpbiBNU0FMXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRBY2NvdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIGlmIGEgc2Vzc2lvbiBhbHJlYWR5IGV4aXN0cywgZ2V0IHRoZSBhY2NvdW50IGZyb20gdGhlIHNlc3Npb25cclxuICAgICAgICBpZiAodGhpcy5hY2NvdW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjY291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGZyYW1lIGlzIHVzZWQgdG8gZ2V0IGlkVG9rZW4gYW5kIHBvcHVsYXRlIHRoZSBhY2NvdW50IGZvciB0aGUgZ2l2ZW4gc2Vzc2lvblxyXG4gICAgICAgIHZhciByYXdJZFRva2VuID0gdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShDb25zdGFudHMuaWRUb2tlbktleSk7XHJcbiAgICAgICAgdmFyIHJhd0NsaWVudEluZm8gPSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRJdGVtKENvbnN0YW50cy5tc2FsQ2xpZW50SW5mbyk7XHJcbiAgICAgICAgaWYgKCFTdHJpbmdVdGlscy5pc0VtcHR5KHJhd0lkVG9rZW4pICYmICFTdHJpbmdVdGlscy5pc0VtcHR5KHJhd0NsaWVudEluZm8pKSB7XHJcbiAgICAgICAgICAgIHZhciBpZFRva2VuID0gbmV3IElkVG9rZW4ocmF3SWRUb2tlbik7XHJcbiAgICAgICAgICAgIHZhciBjbGllbnRJbmZvID0gbmV3IENsaWVudEluZm8ocmF3Q2xpZW50SW5mbyk7XHJcbiAgICAgICAgICAgIHRoaXMuYWNjb3VudCA9IEFjY291bnQuY3JlYXRlQWNjb3VudChpZFRva2VuLCBjbGllbnRJbmZvKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgbG9naW4gbm90IHlldCBkb25lLCByZXR1cm4gbnVsbFxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICpcclxuICAgICAqIEV4dHJhY3RzIHN0YXRlIHZhbHVlIGZyb20gdGhlIGFjY291bnRTdGF0ZSBzZW50IHdpdGggdGhlIGF1dGhlbnRpY2F0aW9uIHJlcXVlc3QuXHJcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBzY29wZS5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmdldEFjY291bnRTdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xyXG4gICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgc3BsaXRJbmRleCA9IHN0YXRlLmluZGV4T2YoXCJ8XCIpO1xyXG4gICAgICAgICAgICBpZiAoc3BsaXRJbmRleCA+IC0xICYmIHNwbGl0SW5kZXggKyAxIDwgc3RhdGUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuc3Vic3RyaW5nKHNwbGl0SW5kZXggKyAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVc2UgdG8gZ2V0IGEgbGlzdCBvZiB1bmlxdWUgYWNjb3VudHMgaW4gTVNBTCBjYWNoZSBiYXNlZCBvbiBob21lQWNjb3VudElkZW50aWZpZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHtAbGluayBBcnJheTxBY2NvdW50Pn0gQWNjb3VudCAtIGFsbCB1bmlxdWUgYWNjb3VudHMgaW4gTVNBTCBjYWNoZS5cclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmdldEFsbEFjY291bnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBhY2NvdW50cyA9IFtdO1xyXG4gICAgICAgIHZhciBhY2Nlc3NUb2tlbkNhY2hlSXRlbXMgPSB0aGlzLmNhY2hlU3RvcmFnZS5nZXRBbGxBY2Nlc3NUb2tlbnMoQ29uc3RhbnRzLmNsaWVudElkLCBDb25zdGFudHMuaG9tZUFjY291bnRJZGVudGlmaWVyKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFjY2Vzc1Rva2VuQ2FjaGVJdGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgaWRUb2tlbiA9IG5ldyBJZFRva2VuKGFjY2Vzc1Rva2VuQ2FjaGVJdGVtc1tpXS52YWx1ZS5pZFRva2VuKTtcclxuICAgICAgICAgICAgdmFyIGNsaWVudEluZm8gPSBuZXcgQ2xpZW50SW5mbyhhY2Nlc3NUb2tlbkNhY2hlSXRlbXNbaV0udmFsdWUuaG9tZUFjY291bnRJZGVudGlmaWVyKTtcclxuICAgICAgICAgICAgdmFyIGFjY291bnQgPSBBY2NvdW50LmNyZWF0ZUFjY291bnQoaWRUb2tlbiwgY2xpZW50SW5mbyk7XHJcbiAgICAgICAgICAgIGFjY291bnRzLnB1c2goYWNjb3VudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFVuaXF1ZUFjY291bnRzKGFjY291bnRzKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqXHJcbiAgICAgKiBVc2VkIHRvIGZpbHRlciBhY2NvdW50cyBiYXNlZCBvbiBob21lQWNjb3VudElkZW50aWZpZXJcclxuICAgICAqIEBwYXJhbSB7QXJyYXk8QWNjb3VudD59ICBBY2NvdW50cyAtIGFjY291bnRzIHNhdmVkIGluIHRoZSBjYWNoZVxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0VW5pcXVlQWNjb3VudHMgPSBmdW5jdGlvbiAoYWNjb3VudHMpIHtcclxuICAgICAgICBpZiAoIWFjY291bnRzIHx8IGFjY291bnRzLmxlbmd0aCA8PSAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhY2NvdW50cztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGZsYWdzID0gW107XHJcbiAgICAgICAgdmFyIHVuaXF1ZUFjY291bnRzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGFjY291bnRzLmxlbmd0aDsgKytpbmRleCkge1xyXG4gICAgICAgICAgICBpZiAoYWNjb3VudHNbaW5kZXhdLmhvbWVBY2NvdW50SWRlbnRpZmllciAmJiBmbGFncy5pbmRleE9mKGFjY291bnRzW2luZGV4XS5ob21lQWNjb3VudElkZW50aWZpZXIpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgZmxhZ3MucHVzaChhY2NvdW50c1tpbmRleF0uaG9tZUFjY291bnRJZGVudGlmaWVyKTtcclxuICAgICAgICAgICAgICAgIHVuaXF1ZUFjY291bnRzLnB1c2goYWNjb3VudHNbaW5kZXhdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5pcXVlQWNjb3VudHM7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICAvLyNyZWdpb24gU2NvcGVzIChFeHRyYWN0IHRvIFNjb3Blcy50cylcclxuICAgIC8vIE5vdGU6IFwidGhpc1wiIGRlcGVuZGVuY3kgaW4gdGhpcyBzZWN0aW9uIGlzIG1pbmltYWwuXHJcbiAgICAvLyBJZiBwQ2FjaGVTdG9yYWdlIGlzIHNlcGFyYXRlZCBmcm9tIHRoZSBjbGFzcyBvYmplY3QsIG9yIHBhc3NlZCBhcyBhIGZuIHBhcmFtLCBzY29wZXNVdGlscy50cyBjYW4gYmUgY3JlYXRlZFxyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKlxyXG4gICAgICogVXNlZCB0byB2YWxpZGF0ZSB0aGUgc2NvcGVzIGlucHV0IHBhcmFtZXRlciByZXF1ZXN0ZWQgIGJ5IHRoZSBkZXZlbG9wZXIuXHJcbiAgICAgKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IHNjb3BlcyAtIERldmVsb3BlciByZXF1ZXN0ZWQgcGVybWlzc2lvbnMuIE5vdCBhbGwgc2NvcGVzIGFyZSBndWFyYW50ZWVkIHRvIGJlIGluY2x1ZGVkIGluIHRoZSBhY2Nlc3MgdG9rZW4gcmV0dXJuZWQuXHJcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNjb3Blc1JlcXVpcmVkIC0gQm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIgdGhlIHNjb3BlcyBhcnJheSBpcyByZXF1aXJlZCBvciBub3RcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLnZhbGlkYXRlSW5wdXRTY29wZSA9IGZ1bmN0aW9uIChzY29wZXMsIHNjb3Blc1JlcXVpcmVkKSB7XHJcbiAgICAgICAgaWYgKCFzY29wZXMpIHtcclxuICAgICAgICAgICAgaWYgKHNjb3Blc1JlcXVpcmVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlU2NvcGVzUmVxdWlyZWRFcnJvcihzY29wZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIENoZWNrIHRoYXQgc2NvcGVzIGlzIGFuIGFycmF5IG9iamVjdCAoYWxzbyB0aHJvd3MgZXJyb3IgaWYgc2NvcGVzID09IG51bGwpXHJcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHNjb3BlcykpIHtcclxuICAgICAgICAgICAgdGhyb3cgQ2xpZW50Q29uZmlndXJhdGlvbkVycm9yLmNyZWF0ZVNjb3Blc05vbkFycmF5RXJyb3Ioc2NvcGVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ2hlY2sgdGhhdCBzY29wZXMgaXMgbm90IGFuIGVtcHR5IGFycmF5XHJcbiAgICAgICAgaWYgKHNjb3Blcy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIHRocm93IENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVFbXB0eVNjb3Blc0FycmF5RXJyb3Ioc2NvcGVzLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBDaGVjayB0aGF0IGNsaWVudElkIGlzIHBhc3NlZCBhcyBzaW5nbGUgc2NvcGVcclxuICAgICAgICBpZiAoc2NvcGVzLmluZGV4T2YodGhpcy5jbGllbnRJZCkgPiAtMSkge1xyXG4gICAgICAgICAgICBpZiAoc2NvcGVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IENsaWVudENvbmZpZ3VyYXRpb25FcnJvci5jcmVhdGVDbGllbnRJZFNpbmdsZVNjb3BlRXJyb3Ioc2NvcGVzLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICpcclxuICAgICAqIEV4dHJhY3RzIHNjb3BlIHZhbHVlIGZyb20gdGhlIHN0YXRlIHNlbnQgd2l0aCB0aGUgYXV0aGVudGljYXRpb24gcmVxdWVzdC5cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBzdGF0ZVxyXG4gICAgICogQHJldHVybnMge3N0cmluZ30gc2NvcGUuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRTY29wZUZyb21TdGF0ZSA9IGZ1bmN0aW9uIChzdGF0ZSkge1xyXG4gICAgICAgIGlmIChzdGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgc3BsaXRJbmRleCA9IHN0YXRlLmluZGV4T2YoXCJ8XCIpO1xyXG4gICAgICAgICAgICBpZiAoc3BsaXRJbmRleCA+IC0xICYmIHNwbGl0SW5kZXggKyAxIDwgc3RhdGUubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuc3Vic3RyaW5nKHNwbGl0SW5kZXggKyAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqIEFwcGVuZHMgZXh0cmFTY29wZXNUb0NvbnNlbnQgaWYgcGFzc2VkXHJcbiAgICAgKiBAcGFyYW0ge0BsaW5rIEF1dGhlbnRpY2F0aW9uUGFyYW1ldGVyc31cclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmFwcGVuZFNjb3BlcyA9IGZ1bmN0aW9uIChyZXF1ZXN0KSB7XHJcbiAgICAgICAgdmFyIHNjb3BlcztcclxuICAgICAgICBpZiAocmVxdWVzdCAmJiByZXF1ZXN0LnNjb3Blcykge1xyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC5leHRyYVNjb3Blc1RvQ29uc2VudCkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGVzID0gcmVxdWVzdC5zY29wZXMuY29uY2F0KHJlcXVlc3QuZXh0cmFTY29wZXNUb0NvbnNlbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2NvcGVzID0gcmVxdWVzdC5zY29wZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNjb3BlcztcclxuICAgIH07XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIC8vI3JlZ2lvbiBBbmd1bGFyXHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqXHJcbiAgICAgKiBCcm9hZGNhc3QgbWVzc2FnZXMgLSBVc2VkIG9ubHkgZm9yIEFuZ3VsYXI/ICAqXHJcbiAgICAgKiBAcGFyYW0gZXZlbnROYW1lXHJcbiAgICAgKiBAcGFyYW0gZGF0YVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuYnJvYWRjYXN0ID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGF0YSkge1xyXG4gICAgICAgIHZhciBldnQgPSBuZXcgQ3VzdG9tRXZlbnQoZXZlbnROYW1lLCB7IGRldGFpbDogZGF0YSB9KTtcclxuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldnQpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICpcclxuICAgICAqIEhlbHBlciBmdW5jdGlvbiB0byByZXRyaWV2ZSB0aGUgY2FjaGVkIHRva2VuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHNjb3Blc1xyXG4gICAgICogQHBhcmFtIHtAbGluayBBY2NvdW50fSBhY2NvdW50XHJcbiAgICAgKiBAcGFyYW0gc3RhdGVcclxuICAgICAqIEByZXR1cm4ge0BsaW5rIEF1dGhSZXNwb25zZX0gQXV0aFJlc3BvbnNlXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRDYWNoZWRUb2tlbkludGVybmFsID0gZnVuY3Rpb24gKHNjb3BlcywgYWNjb3VudCwgc3RhdGUpIHtcclxuICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgc2Vzc2lvbidzIGFjY291bnQgb2JqZWN0XHJcbiAgICAgICAgdmFyIGFjY291bnRPYmplY3QgPSBhY2NvdW50IHx8IHRoaXMuZ2V0QWNjb3VudCgpO1xyXG4gICAgICAgIGlmICghYWNjb3VudE9iamVjdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gQ29uc3RydWN0IEF1dGhlbnRpY2F0aW9uUmVxdWVzdCBiYXNlZCBvbiByZXNwb25zZSB0eXBlXHJcbiAgICAgICAgdmFyIG5ld0F1dGhvcml0eSA9IHRoaXMuYXV0aG9yaXR5SW5zdGFuY2UgPyB0aGlzLmF1dGhvcml0eUluc3RhbmNlIDogQXV0aG9yaXR5RmFjdG9yeS5DcmVhdGVJbnN0YW5jZSh0aGlzLmF1dGhvcml0eSwgdGhpcy5jb25maWcuYXV0aC52YWxpZGF0ZUF1dGhvcml0eSk7XHJcbiAgICAgICAgdmFyIHJlc3BvbnNlVHlwZSA9IHRoaXMuZ2V0VG9rZW5UeXBlKGFjY291bnRPYmplY3QsIHNjb3BlcywgdHJ1ZSk7XHJcbiAgICAgICAgdmFyIHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdCA9IG5ldyBTZXJ2ZXJSZXF1ZXN0UGFyYW1ldGVycyhuZXdBdXRob3JpdHksIHRoaXMuY2xpZW50SWQsIHNjb3BlcywgcmVzcG9uc2VUeXBlLCB0aGlzLmdldFJlZGlyZWN0VXJpKCksIHN0YXRlKTtcclxuICAgICAgICAvLyBnZXQgY2FjaGVkIHRva2VuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2FjaGVkVG9rZW4oc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LCBhY2NvdW50KTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqXHJcbiAgICAgKiBHZXQgc2NvcGVzIGZvciB0aGUgRW5kcG9pbnQgLSBVc2VkIGluIEFuZ3VsYXIgdG8gdHJhY2sgcHJvdGVjdGVkIGFuZCB1bnByb3RlY3RlZCByZXNvdXJjZXMgd2l0aG91dCBpbnRlcmFjdGlvbiBmcm9tIHRoZSBkZXZlbG9wZXIgYXBwXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGVuZHBvaW50XHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRTY29wZXNGb3JFbmRwb2ludCA9IGZ1bmN0aW9uIChlbmRwb2ludCkge1xyXG4gICAgICAgIC8vIGlmIHVzZXIgc3BlY2lmaWVkIGxpc3Qgb2YgdW5wcm90ZWN0ZWRSZXNvdXJjZXMsIG5vIG5lZWQgdG8gc2VuZCB0b2tlbiB0byB0aGVzZSBlbmRwb2ludHMsIHJldHVybiBudWxsLlxyXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5mcmFtZXdvcmsudW5wcm90ZWN0ZWRSZXNvdXJjZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29uZmlnLmZyYW1ld29yay51bnByb3RlY3RlZFJlc291cmNlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVuZHBvaW50LmluZGV4T2YodGhpcy5jb25maWcuZnJhbWV3b3JrLnVucHJvdGVjdGVkUmVzb3VyY2VzW2ldKSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gcHJvY2VzcyBhbGwgcHJvdGVjdGVkIHJlc291cmNlcyBhbmQgc2VuZCB0aGUgbWF0Y2hlZCBvbmVcclxuICAgICAgICBpZiAodGhpcy5jb25maWcuZnJhbWV3b3JrLnByb3RlY3RlZFJlc291cmNlTWFwLnNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBBcnJheS5mcm9tKHRoaXMuY29uZmlnLmZyYW1ld29yay5wcm90ZWN0ZWRSZXNvdXJjZU1hcC5rZXlzKCkpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbmZpZ0VuZHBvaW50IGlzIGxpa2UgL2FwaS9Ub2RvIHJlcXVlc3RlZCBlbmRwb2ludCBjYW4gYmUgL2FwaS9Ub2RvLzFcclxuICAgICAgICAgICAgICAgIGlmIChlbmRwb2ludC5pbmRleE9mKGtleSkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5mcmFtZXdvcmsucHJvdGVjdGVkUmVzb3VyY2VNYXAuZ2V0KGtleSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZGVmYXVsdCByZXNvdXJjZSB3aWxsIGJlIGNsaWVudGlkIGlmIG5vdGhpbmcgc3BlY2lmaWVkXHJcbiAgICAgICAgLy8gQXBwIHdpbGwgdXNlIGlkdG9rZW4gZm9yIGNhbGxzIHRvIGl0c2VsZlxyXG4gICAgICAgIC8vIGNoZWNrIGlmIGl0J3Mgc3RhcmluZyBmcm9tIGh0dHAgb3IgaHR0cHMsIG5lZWRzIHRvIG1hdGNoIHdpdGggYXBwIGhvc3RcclxuICAgICAgICBpZiAoZW5kcG9pbnQuaW5kZXhPZihcImh0dHA6Ly9cIikgPiAtMSB8fCBlbmRwb2ludC5pbmRleE9mKFwiaHR0cHM6Ly9cIikgPiAtMSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5nZXRIb3N0RnJvbVVyaShlbmRwb2ludCkgPT09IHRoaXMuZ2V0SG9zdEZyb21VcmkodGhpcy5nZXRSZWRpcmVjdFVyaSgpKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheSh0aGlzLmNsaWVudElkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gaW4gYW5ndWxhciBsZXZlbCwgdGhlIHVybCBmb3IgJGh0dHAgaW50ZXJjZXB0b3IgY2FsbCBjb3VsZCBiZSByZWxhdGl2ZSB1cmwsXHJcbiAgICAgICAgICAgIC8vIGlmIGl0J3MgcmVsYXRpdmUgY2FsbCwgd2UnbGwgdHJlYXQgaXQgYXMgYXBwIGJhY2tlbmQgY2FsbC5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheSh0aGlzLmNsaWVudElkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgbm90IHRoZSBhcHAncyBvd24gYmFja2VuZCBvciBub3QgYSBkb21haW4gbGlzdGVkIGluIHRoZSBlbmRwb2ludHMgc3RydWN0dXJlXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm4gYm9vbGVhbiBmbGFnIHRvIGRldmVsb3BlciB0byBoZWxwIGluZm9ybSBpZiBsb2dpbiBpcyBpbiBwcm9ncmVzc1xyXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IHRydWUvZmFsc2VcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmdldExvZ2luSW5Qcm9ncmVzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcGVuZGluZ0NhbGxiYWNrID0gdGhpcy5jYWNoZVN0b3JhZ2UuZ2V0SXRlbShDb25zdGFudHMudXJsSGFzaCk7XHJcbiAgICAgICAgaWYgKHBlbmRpbmdDYWxsYmFjaykge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9naW5JblByb2dyZXNzO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBsb2dpbkluUHJvZ3Jlc3NcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLnNldGxvZ2luSW5Qcm9ncmVzcyA9IGZ1bmN0aW9uIChsb2dpbkluUHJvZ3Jlc3MpIHtcclxuICAgICAgICB0aGlzLmxvZ2luSW5Qcm9ncmVzcyA9IGxvZ2luSW5Qcm9ncmVzcztcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqIEBpZ25vcmVcclxuICAgICAqXHJcbiAgICAgKiByZXR1cm5zIHRoZSBzdGF0dXMgb2YgYWNxdWlyZVRva2VuSW5Qcm9ncmVzc1xyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0QWNxdWlyZVRva2VuSW5Qcm9ncmVzcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hY3F1aXJlVG9rZW5JblByb2dyZXNzO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBhY3F1aXJlVG9rZW5JblByb2dyZXNzXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5zZXRBY3F1aXJlVG9rZW5JblByb2dyZXNzID0gZnVuY3Rpb24gKGFjcXVpcmVUb2tlbkluUHJvZ3Jlc3MpIHtcclxuICAgICAgICB0aGlzLmFjcXVpcmVUb2tlbkluUHJvZ3Jlc3MgPSBhY3F1aXJlVG9rZW5JblByb2dyZXNzO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICpcclxuICAgICAqIHJldHVybnMgdGhlIGxvZ2dlciBoYW5kbGVcclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmdldExvZ2dlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuc3lzdGVtLmxvZ2dlcjtcclxuICAgIH07XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIC8vI3JlZ2lvbiBHZXR0ZXJzIGFuZCBTZXR0ZXJzXHJcbiAgICAvKipcclxuICAgICAqXHJcbiAgICAgKiBVc2UgdG8gZ2V0IHRoZSByZWRpcmVjdCB1cmkgY29uZmlndXJlZCBpbiBNU0FMIG9yIG51bGwuXHJcbiAgICAgKiBFdmFsdWF0ZXMgcmVkaXJlY3RVcmkgaWYgaXRzIGEgZnVuY3Rpb24sIG90aGVyd2lzZSBzaW1wbHkgcmV0dXJucyBpdHMgdmFsdWUuXHJcbiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSByZWRpcmVjdCBVUkxcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRSZWRpcmVjdFVyaSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuY29uZmlnLmF1dGgucmVkaXJlY3RVcmkgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuYXV0aC5yZWRpcmVjdFVyaSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuYXV0aC5yZWRpcmVjdFVyaTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFVzZSB0byBnZXQgdGhlIHBvc3QgbG9nb3V0IHJlZGlyZWN0IHVyaSBjb25maWd1cmVkIGluIE1TQUwgb3IgbnVsbC5cclxuICAgICAqIEV2YWx1YXRlcyBwb3N0TG9nb3V0cmVkaXJlY3RVcmkgaWYgaXRzIGEgZnVuY3Rpb24sIG90aGVyd2lzZSBzaW1wbHkgcmV0dXJucyBpdHMgdmFsdWUuXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMge3N0cmluZ30gcG9zdCBsb2dvdXQgcmVkaXJlY3QgVVJMXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRQb3N0TG9nb3V0UmVkaXJlY3RVcmkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNvbmZpZy5hdXRoLnBvc3RMb2dvdXRSZWRpcmVjdFVyaSA9PT0gXCJmdW5jdGlvblwiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5hdXRoLnBvc3RMb2dvdXRSZWRpcmVjdFVyaSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuYXV0aC5wb3N0TG9nb3V0UmVkaXJlY3RVcmk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVc2UgdG8gZ2V0IHRoZSBjdXJyZW50IHtAbGluayBDb25maWd1cmF0aW9ufSBvYmplY3QgaW4gTVNBTFxyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zIHtAbGluayBDb25maWd1cmF0aW9ufVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0Q3VycmVudENvbmZpZ3VyYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZykge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlTm9TZXRDb25maWd1cmF0aW9uRXJyb3IoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnO1xyXG4gICAgfTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgLy8jcmVnaW9uIFN0cmluZyBVdGlsIChTaG91bGQgYmUgZXh0cmFjdGVkIHRvIFV0aWxzLnRzKVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKlxyXG4gICAgICogZXh0cmFjdCBVUkkgZnJvbSB0aGUgaG9zdFxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBVUklcclxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IGhvc3QgZnJvbSB0aGUgVVJJXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRIb3N0RnJvbVVyaSA9IGZ1bmN0aW9uICh1cmkpIHtcclxuICAgICAgICAvLyByZW1vdmUgaHR0cDovLyBvciBodHRwczovLyBmcm9tIHVyaVxyXG4gICAgICAgIHZhciBleHRyYWN0ZWRVcmkgPSBTdHJpbmcodXJpKS5yZXBsYWNlKC9eKGh0dHBzPzopXFwvXFwvLywgXCJcIik7XHJcbiAgICAgICAgZXh0cmFjdGVkVXJpID0gZXh0cmFjdGVkVXJpLnNwbGl0KFwiL1wiKVswXTtcclxuICAgICAgICByZXR1cm4gZXh0cmFjdGVkVXJpO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICpcclxuICAgICAqIFV0aWxzIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgQXV0aGVudGljYXRpb25cclxuICAgICAqIEBwYXJhbSB7QGxpbmsgYWNjb3VudH0gYWNjb3VudCBvYmplY3RcclxuICAgICAqIEBwYXJhbSBzY29wZXNcclxuICAgICAqIEBwYXJhbSBzaWxlbnRDYWxsXHJcbiAgICAgKlxyXG4gICAgICogQHJldHVybnMge3N0cmluZ30gdG9rZW4gdHlwZTogaWRfdG9rZW4gb3IgYWNjZXNzX3Rva2VuXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0VG9rZW5UeXBlID0gZnVuY3Rpb24gKGFjY291bnRPYmplY3QsIHNjb3Blcywgc2lsZW50Q2FsbCkge1xyXG4gICAgICAgIC8vIGlmIGFjY291bnQgaXMgcGFzc2VkIGFuZCBtYXRjaGVzIHRoZSBhY2NvdW50IG9iamVjdC9vciBzZXQgdG8gZ2V0QWNjb3VudCgpIGZyb20gY2FjaGVcclxuICAgICAgICAvLyBpZiBjbGllbnQtaWQgaXMgcGFzc2VkIGFzIHNjb3BlLCBnZXQgaWRfdG9rZW4gZWxzZSB0b2tlbi9pZF90b2tlbl90b2tlbiAoaW4gY2FzZSBubyBzZXNzaW9uIGV4aXN0cylcclxuICAgICAgICB2YXIgdG9rZW5UeXBlO1xyXG4gICAgICAgIC8vIGFjcXVpcmVUb2tlblNpbGVudFxyXG4gICAgICAgIGlmIChzaWxlbnRDYWxsKSB7XHJcbiAgICAgICAgICAgIGlmIChBY2NvdW50LmNvbXBhcmVBY2NvdW50cyhhY2NvdW50T2JqZWN0LCB0aGlzLmdldEFjY291bnQoKSkpIHtcclxuICAgICAgICAgICAgICAgIHRva2VuVHlwZSA9IChzY29wZXMuaW5kZXhPZih0aGlzLmNvbmZpZy5hdXRoLmNsaWVudElkKSA+IC0xKSA/IFJlc3BvbnNlVHlwZXMuaWRfdG9rZW4gOiBSZXNwb25zZVR5cGVzLnRva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdG9rZW5UeXBlID0gKHNjb3Blcy5pbmRleE9mKHRoaXMuY29uZmlnLmF1dGguY2xpZW50SWQpID4gLTEpID8gUmVzcG9uc2VUeXBlcy5pZF90b2tlbiA6IFJlc3BvbnNlVHlwZXMuaWRfdG9rZW5fdG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRva2VuVHlwZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWxsIG90aGVyIGNhc2VzXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghQWNjb3VudC5jb21wYXJlQWNjb3VudHMoYWNjb3VudE9iamVjdCwgdGhpcy5nZXRBY2NvdW50KCkpKSB7XHJcbiAgICAgICAgICAgICAgICB0b2tlblR5cGUgPSBSZXNwb25zZVR5cGVzLmlkX3Rva2VuX3Rva2VuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdG9rZW5UeXBlID0gKHNjb3Blcy5pbmRleE9mKHRoaXMuY2xpZW50SWQpID4gLTEpID8gUmVzcG9uc2VUeXBlcy5pZF90b2tlbiA6IFJlc3BvbnNlVHlwZXMudG9rZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRva2VuVHlwZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKlxyXG4gICAgICogU2V0cyB0aGUgY2FjaGVrZXlzIGZvciBhbmQgc3RvcmVzIHRoZSBhY2NvdW50IGluZm9ybWF0aW9uIGluIGNhY2hlXHJcbiAgICAgKiBAcGFyYW0gYWNjb3VudFxyXG4gICAgICogQHBhcmFtIHN0YXRlXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5zZXRBY2NvdW50Q2FjaGUgPSBmdW5jdGlvbiAoYWNjb3VudCwgc3RhdGUpIHtcclxuICAgICAgICAvLyBDYWNoZSBhY3F1aXJlVG9rZW5BY2NvdW50S2V5XHJcbiAgICAgICAgdmFyIGFjY291bnRJZCA9IGFjY291bnQgPyB0aGlzLmdldEFjY291bnRJZChhY2NvdW50KSA6IENvbnN0YW50cy5ub19hY2NvdW50O1xyXG4gICAgICAgIHZhciBhY3F1aXJlVG9rZW5BY2NvdW50S2V5ID0gU3RvcmFnZS5nZW5lcmF0ZUFjcXVpcmVUb2tlbkFjY291bnRLZXkoYWNjb3VudElkLCBzdGF0ZSk7XHJcbiAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShhY3F1aXJlVG9rZW5BY2NvdW50S2V5LCBKU09OLnN0cmluZ2lmeShhY2NvdW50KSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKlxyXG4gICAgICogU2V0cyB0aGUgY2FjaGVLZXkgZm9yIGFuZCBzdG9yZXMgdGhlIGF1dGhvcml0eSBpbmZvcm1hdGlvbiBpbiBjYWNoZVxyXG4gICAgICogQHBhcmFtIHN0YXRlXHJcbiAgICAgKiBAcGFyYW0gYXV0aG9yaXR5XHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5zZXRBdXRob3JpdHlDYWNoZSA9IGZ1bmN0aW9uIChzdGF0ZSwgYXV0aG9yaXR5KSB7XHJcbiAgICAgICAgLy8gQ2FjaGUgYXV0aG9yaXR5S2V5XHJcbiAgICAgICAgdmFyIGF1dGhvcml0eUtleSA9IFN0b3JhZ2UuZ2VuZXJhdGVBdXRob3JpdHlLZXkoc3RhdGUpO1xyXG4gICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oYXV0aG9yaXR5S2V5LCBVcmxVdGlscy5DYW5vbmljYWxpemVVcmkoYXV0aG9yaXR5KSwgdGhpcy5pbkNvb2tpZSk7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBVcGRhdGVzIGFjY291bnQsIGF1dGhvcml0eSwgYW5kIG5vbmNlIGluIGNhY2hlXHJcbiAgICAgKiBAcGFyYW0gc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0XHJcbiAgICAgKiBAcGFyYW0gYWNjb3VudFxyXG4gICAgICogQGhpZGRlblxyXG4gICAgICogQGlnbm9yZVxyXG4gICAgICovXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUudXBkYXRlQ2FjaGVFbnRyaWVzID0gZnVuY3Rpb24gKHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdCwgYWNjb3VudCwgbG9naW5TdGFydFBhZ2UpIHtcclxuICAgICAgICAvLyBDYWNoZSBhY2NvdW50IGFuZCBhdXRob3JpdHlcclxuICAgICAgICBpZiAobG9naW5TdGFydFBhZ2UpIHtcclxuICAgICAgICAgICAgLy8gQ2FjaGUgdGhlIHN0YXRlLCBub25jZSwgYW5kIGxvZ2luIHJlcXVlc3QgZGF0YVxyXG4gICAgICAgICAgICB0aGlzLmNhY2hlU3RvcmFnZS5zZXRJdGVtKENvbnN0YW50cy5sb2dpblJlcXVlc3QsIGxvZ2luU3RhcnRQYWdlLCB0aGlzLmluQ29va2llKTtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZVN0b3JhZ2Uuc2V0SXRlbShDb25zdGFudHMubG9naW5FcnJvciwgXCJcIik7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLnN0YXRlTG9naW4sIHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5zdGF0ZSwgdGhpcy5pbkNvb2tpZSk7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLm1zYWxFcnJvciwgXCJcIik7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLm1zYWxFcnJvckRlc2NyaXB0aW9uLCBcIlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWNjb3VudENhY2hlKGFjY291bnQsIHNlcnZlckF1dGhlbnRpY2F0aW9uUmVxdWVzdC5zdGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIENhY2hlIGF1dGhvcml0eUtleVxyXG4gICAgICAgIHRoaXMuc2V0QXV0aG9yaXR5Q2FjaGUoc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0LnN0YXRlLCBzZXJ2ZXJBdXRoZW50aWNhdGlvblJlcXVlc3QuYXV0aG9yaXR5KTtcclxuICAgICAgICAvLyBDYWNoZSBub25jZVxyXG4gICAgICAgIHRoaXMuY2FjaGVTdG9yYWdlLnNldEl0ZW0oQ29uc3RhbnRzLm5vbmNlSWRUb2tlbiwgc2VydmVyQXV0aGVudGljYXRpb25SZXF1ZXN0Lm5vbmNlLCB0aGlzLmluQ29va2llKTtcclxuICAgIH07XHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgbG9nZ2VkIGluIGFjY291bnRcclxuICAgICAqIEBwYXJhbSBhY2NvdW50XHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKi9cclxuICAgIFVzZXJBZ2VudEFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRBY2NvdW50SWQgPSBmdW5jdGlvbiAoYWNjb3VudCkge1xyXG4gICAgICAgIC8vcmV0dXJuIGAke2FjY291bnQuYWNjb3VudElkZW50aWZpZXJ9YCArIENvbnN0YW50cy5yZXNvdXJjZURlbGltaXRlciArIGAke2FjY291bnQuaG9tZUFjY291bnRJZGVudGlmaWVyfWA7XHJcbiAgICAgICAgdmFyIGFjY291bnRJZDtcclxuICAgICAgICBpZiAoIVN0cmluZ1V0aWxzLmlzRW1wdHkoYWNjb3VudC5ob21lQWNjb3VudElkZW50aWZpZXIpKSB7XHJcbiAgICAgICAgICAgIGFjY291bnRJZCA9IGFjY291bnQuaG9tZUFjY291bnRJZGVudGlmaWVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYWNjb3VudElkID0gQ29uc3RhbnRzLm5vX2FjY291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBhY2NvdW50SWQ7XHJcbiAgICB9O1xyXG4gICAgLyoqXHJcbiAgICAgKiBAaGlkZGVuXHJcbiAgICAgKiBAaWdub3JlXHJcbiAgICAgKlxyXG4gICAgICogQ29uc3RydWN0ICd0b2tlblJlcXVlc3QnIGZyb20gdGhlIGF2YWlsYWJsZSBkYXRhIGluIGFkYWxJZFRva2VuXHJcbiAgICAgKiBAcGFyYW0gZXh0cmFRdWVyeVBhcmFtZXRlcnNcclxuICAgICAqIEBoaWRkZW5cclxuICAgICAqL1xyXG4gICAgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLmJ1aWxkSURUb2tlblJlcXVlc3QgPSBmdW5jdGlvbiAocmVxdWVzdCkge1xyXG4gICAgICAgIHZhciB0b2tlblJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIHNjb3BlczogW3RoaXMuY2xpZW50SWRdLFxyXG4gICAgICAgICAgICBhdXRob3JpdHk6IHRoaXMuYXV0aG9yaXR5LFxyXG4gICAgICAgICAgICBhY2NvdW50OiB0aGlzLmdldEFjY291bnQoKSxcclxuICAgICAgICAgICAgZXh0cmFRdWVyeVBhcmFtZXRlcnM6IHJlcXVlc3QuZXh0cmFRdWVyeVBhcmFtZXRlcnNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB0b2tlblJlcXVlc3Q7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICBVc2VyQWdlbnRBcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0VGVsZW1ldHJ5TWFuYWdlckZyb21Db25maWcgPSBmdW5jdGlvbiAoY29uZmlnLCBjbGllbnRJZCkge1xyXG4gICAgICAgIGlmICghY29uZmlnKSB7IC8vIGlmIHVuc2V0XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpZiBzZXQgdGhlbiB2YWxpZGF0ZVxyXG4gICAgICAgIHZhciBhcHBsaWNhdGlvbk5hbWUgPSBjb25maWcuYXBwbGljYXRpb25OYW1lLCBhcHBsaWNhdGlvblZlcnNpb24gPSBjb25maWcuYXBwbGljYXRpb25WZXJzaW9uLCB0ZWxlbWV0cnlFbWl0dGVyID0gY29uZmlnLnRlbGVtZXRyeUVtaXR0ZXI7XHJcbiAgICAgICAgaWYgKCFhcHBsaWNhdGlvbk5hbWUgfHwgIWFwcGxpY2F0aW9uVmVyc2lvbiB8fCAhdGVsZW1ldHJ5RW1pdHRlcikge1xyXG4gICAgICAgICAgICB0aHJvdyBDbGllbnRDb25maWd1cmF0aW9uRXJyb3IuY3JlYXRlVGVsZW1ldHJ5Q29uZmlnRXJyb3IoY29uZmlnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYgdmFsaWQgdGhlbiBjb25zdHJ1Y3RcclxuICAgICAgICB2YXIgdGVsZW1ldHJ5UGxhdGZvcm0gPSB7XHJcbiAgICAgICAgICAgIHNkazogXCJtc2FsLmpzXCIsXHJcbiAgICAgICAgICAgIHNka1ZlcnNpb246IGxpYnJhcnlWZXJzaW9uKCksXHJcbiAgICAgICAgICAgIGFwcGxpY2F0aW9uTmFtZTogYXBwbGljYXRpb25OYW1lLFxyXG4gICAgICAgICAgICBhcHBsaWNhdGlvblZlcnNpb246IGFwcGxpY2F0aW9uVmVyc2lvblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHRlbGVtZXRyeU1hbmFnZXJDb25maWcgPSB7XHJcbiAgICAgICAgICAgIHBsYXRmb3JtOiB0ZWxlbWV0cnlQbGF0Zm9ybSxcclxuICAgICAgICAgICAgY2xpZW50SWQ6IGNsaWVudElkXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gbmV3IFRlbGVtZXRyeU1hbmFnZXIodGVsZW1ldHJ5TWFuYWdlckNvbmZpZywgdGVsZW1ldHJ5RW1pdHRlcik7XHJcbiAgICB9O1xyXG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcclxuICAgICAgICByZXNvbHZlVG9rZW5Pbmx5SWZPdXRPZklmcmFtZVxyXG4gICAgXSwgVXNlckFnZW50QXBwbGljYXRpb24ucHJvdG90eXBlLCBcImFjcXVpcmVUb2tlblNpbGVudFwiLCBudWxsKTtcclxuICAgIHJldHVybiBVc2VyQWdlbnRBcHBsaWNhdGlvbjtcclxufSgpKTtcclxuZXhwb3J0IHsgVXNlckFnZW50QXBwbGljYXRpb24gfTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VXNlckFnZW50QXBwbGljYXRpb24uanMubWFwIiwiZXhwb3J0IHsgVXNlckFnZW50QXBwbGljYXRpb24gfSBmcm9tIFwiLi9Vc2VyQWdlbnRBcHBsaWNhdGlvblwiO1xyXG5leHBvcnQgeyBMb2dnZXIgfSBmcm9tIFwiLi9Mb2dnZXJcIjtcclxuZXhwb3J0IHsgTG9nTGV2ZWwgfSBmcm9tIFwiLi9Mb2dnZXJcIjtcclxuZXhwb3J0IHsgQWNjb3VudCB9IGZyb20gXCIuL0FjY291bnRcIjtcclxuZXhwb3J0IHsgQ29uc3RhbnRzIH0gZnJvbSBcIi4vdXRpbHMvQ29uc3RhbnRzXCI7XHJcbmV4cG9ydCB7IEF1dGhvcml0eSB9IGZyb20gXCIuL0F1dGhvcml0eVwiO1xyXG4vLyBFcnJvcnNcclxuZXhwb3J0IHsgQXV0aEVycm9yIH0gZnJvbSBcIi4vZXJyb3IvQXV0aEVycm9yXCI7XHJcbmV4cG9ydCB7IENsaWVudEF1dGhFcnJvciB9IGZyb20gXCIuL2Vycm9yL0NsaWVudEF1dGhFcnJvclwiO1xyXG5leHBvcnQgeyBTZXJ2ZXJFcnJvciB9IGZyb20gXCIuL2Vycm9yL1NlcnZlckVycm9yXCI7XHJcbmV4cG9ydCB7IENsaWVudENvbmZpZ3VyYXRpb25FcnJvciB9IGZyb20gXCIuL2Vycm9yL0NsaWVudENvbmZpZ3VyYXRpb25FcnJvclwiO1xyXG5leHBvcnQgeyBJbnRlcmFjdGlvblJlcXVpcmVkQXV0aEVycm9yIH0gZnJvbSBcIi4vZXJyb3IvSW50ZXJhY3Rpb25SZXF1aXJlZEF1dGhFcnJvclwiO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5qcy5tYXAiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n')}])}));